<!-- markdownlint-disable-file MD033 -->

------

# 第一部分：Tableau基础 <div id="page_20"></div>

本节为Tableau中的数据可视化奠定了基础。它概述了界面和术语，解释了数据连接，并涵盖了多种可视化类型。

本节包括以下章节：

- [第1章](docs/Book.md#page_21)，*第一章 与Tableau一起起飞*
- [第2章](docs/Book.md#page_43)，*第二章 在Tableau中处理数据*
- [第3章](docs/Book.md#page_70)，*尝试高级可视化*

## 第一章 与Tableau一起起飞 <div id="page_21"></div>

初次遇到数据集时，通常首先看到的是原始数据-数字，日期，文本，字段名称和数据类型。几乎可以肯定的是，需要发现和讲述一些见解和故事，做出决定并采取行动。但是您如何找到意义呢？您如何发现含义并讲出数据中隐藏的故事？

**Tableau**是一个了不起的平台，可用于根据您的数据查看，理解和做出关键决策！有了它，您将能够实现令人难以置信的数据发现，数据分析和数据讲故事。您将使用为自然而无缝地思考和工作而设计的界面，以可视方式完成这些任务和目标。

要利用Tableau的功能，您无需编写复杂的脚本或查询。取而代之的是，您将在可视环境中与数据进行交互，在该环境中，您拖放的所有内容都将转换为适合您的必要查询，然后以可视方式显示。您将实时工作，因此您将立即看到结果，可以提问题就尽快获得答案，并能够通过潜在的数十种方法进行迭代以可视化数据以找到关键的见解或告诉您故事。

本章介绍Tableau的基本原理。我们将介绍一系列示例，这些示例将介绍连接到数据，以可视方式探索和分析数据以及最终将它们全部放到一个完全交互式的仪表板中的基础知识。这些概念将在后续章节中进行更广泛的开发。但是请不要跳过本章，因为它介绍了关键术语和关键概念，包括以下内容：

- 分析周期
- 连接数据
- 构建可视化的基础
- 创建条形图
- 创建折线图
- 创建地理可视化
- 使用“向我展示”
- 通过仪表板将所有内容整合在一起

### 分析周期 <div id="page_22"></div>

作为致力于并理解数据的人，您会发现自己正在分析周期内工作。此周期可能如下所示：

![img](../images/000291.gif)

通过Tableau，您可以跳至循环的任何步骤，在各步骤之间自由移动，并非常快速地循环浏览循环。使用Tableau，您可以执行以下操作：

- **数据** **发现**：您可以使用Tableau轻松浏览数据集，并开始直观地了解您拥有哪些数据。
- **数据准备**：通过Tableau，您可以连接来自许多不同来源的数据，并在必要时创建最适合您的分析的结构。在大多数情况下，这就像将Tableau指向数据库或打开文件一样容易，但是Tableau为您提供了将来自多个来源的复杂数据和混乱数据组合在一起的工具。
- **数据分析**：Tableau可以轻松地可视化数据，因此您可以查看和了解趋势，异常值和关系。除此之外，Tableau还具有不断增长的一组分析功能，使您可以深入了解数据中的复杂关系，模式和相关性。
- **数据叙事**：Tableau允许您使用可视化和见解构建完全交互式的仪表板和故事，以便与他人共享数据故事。

所有这些都是通过视觉完成的。**数据可视化**是Tableau的核心。您可以通过无数种可视化数据的方式进行迭代，以提出和回答问题，提出新问题并获得新见解。并且您将通过思想流程完成此操作。

### 连接数据 <div id="page_23"></div>

Tableau连接到存储在各种文件和数据库中的数据。其中包括平面文件，例如Excel文档，空间文件和文本文件；关系数据库，例如SQL Server和Oracle；基于云的数据源，例如Google Analytics（分析）和Amazon  Redshift；和OLAP数据源，例如Microsoft Analysis  Services。除了极少数例外，无论您使用什么数据源，分析和创建可视化的过程都是相同的。

我们将讨论连接到不同类型的数据源的详细信息[第2章](docs/Book.md#page_43)， *在的Tableau使用数据*。在其他章节中，我们将涵盖跨多个行业的数据。现在，我们将连接到文本文件，特别是**逗号分隔的值**文件（.csv）。数据是Tableau：Superstore附带的样本的一种变体，这是一个虚构的零售连锁店，向美国各地的客户销售各种产品。请使用提供的数据文件代替Tableau示例数据，因为变化会导致可视化效果有所不同。

Chapter 1代码文件捆绑包中包含的工作簿已经与该文件建立了连接，但是在此示例中，我们将逐步完成在新工作簿中创建连接的步骤：

1. 打开Tableau。您应该看到主屏幕，左侧有一个连接选项列表，并且在中心处（如果有）还有最近编辑的工作簿的缩略图预览，而在底部则有示例工作簿。
2. 在“ 连接并到文件”下，单击“ 文本文件”。
3. 在“ 打开”对话框中，导航到\Learning Tableau\Chapter 01目录并选择Superstore.csv文件。
4.现在，您将看到“数据连接”屏幕，该屏幕使您可以直观地创建与数据源的连接。我们将在详细检查该屏幕的功能*连接到数据*的部分[第2章](docs/Book.md#page_43)， *在工作与数据的Tableau*。目前，Tableau已经添加并提供了用于连接的文件的预览：

![img](../images/Image%20[2].jpg)

对于此连接，不需要其他配置，因此只需单击底部的Sheet 1选项卡即可开始可视化数据！现在，您应该看到Tableau中的主要工作区域，如下所示：

![img](../images/Image%20[3].jpg)

在本书中，我们将使用特定的术语来引用界面的元素，因此请花一些时间熟悉一下前面屏幕截图中编号的各个组件所使用的术语：

[1] 该**菜单**中包含用于执行多种功能的各种菜单项目。

[2] 该**工具栏**允许常见功能，例如撤消，重做，保存，添加一个数据源，等等。

[3] 该**边栏**包含标签数据和分析。当“ 数据”选项卡处于活动状态时，我们将侧栏称为“数据”窗格。当“ 分析”标签处于活动状态时，我们将侧栏称为“分析”窗格。我们将在本章稍后详细介绍，但现在请注意，数据窗格在顶部显示数据源，并在下面包含来自数据源的字段列表，分为维度和度量。

[4] 各种架子（例如Columns，Rows，Pages和Filters）用作从数据窗格拖放字段的区域。该**标志**卡包含附加板，如颜色，大小，文字，详细介绍和工具提示。Tableau将根据您放在架子上的字段来可视化数据。

> 数据窗格中的数据字段可用于添加到视图。放置在架子上的字段在**视图**或**活动字段**中称为，因为它们在Tableau绘制可视化文件的方式中起着积极的作用。

[5] 所述**canvas**或**视图**是其中的Tableau将绘制数据可视化。您也可以将字段直接放在视图上。您会在画布顶部找到无缝标题。默认情况下，它将显示工作表的名称，但是可以对其进行编辑甚至隐藏。

[6] Show Me是一项功能，使您可以根据感兴趣的数据字段快速迭代各种类型的可视化。我们将在本章结尾处查看“向我展示”。

[7] 窗口底部的选项卡为您提供了编辑数据源的选项，以及在任意数量的工作表，仪表板或故事之间导航和添加的选项。很多时候，任何标签（无论是工作表，仪表板还是故事）都通常称为工作**sheet**。

 > Tableau工作簿是数据源，工作表，仪表板和故事的集合。所有这些都保存为单个Tableau工作簿文件（*.twb*或*.twbx*）。在后面的章节中，我们将研究文件类型的差异，并详细探讨另存为工作簿的内容。一个工作簿被组织成各种类型的选项卡的集合：
 >
 > 1. 工作表是单个数据可视化，例如条形图或折线图。由于工作表也是任何选项卡的通用术语，因此我们经常将工作表称为**视图**，因为它是数据的单个视图。  
 > 2. **仪表盘**是任何数量的相关的视图和其他元素（例如文本或图像）的呈现排列在一起作为一个整体的信息传达给观众。**仪表板通常设计为交互式的。
 > 3. **故事***是仪表板或配置成从所述数据通信的叙述单个视图的集合。故事也可能是互动的。

[8] 工作时，状态栏将显示重要信息以及有关视图，选择和用户的详细信息。

[9] 各种控件使您可以在工作表，仪表板和故事之间导航，以及使用“ **显示胶片”**查看选项卡， 或切换到工作表分类器，以显示工作簿中所有工作表的交互式缩略图。现在，您已经连接到文本文件中的数据，我们将探索一些示例，这些示例为数据可视化奠定了基础，然后继续构建一些基础的可视化类型。为此，请执行以下操作：

1. 从菜单中，选择文件| 退出。
2. 当提示您保存更改时，选择否。
3. 在\learning Tableau\Chapter 01 目录中，打开文件 Chapter 01 Starter.twbx。该文件包含与 数据文件的连接，Superstore 旨在帮助您逐步阅读本章中的示例。

> 每章的文件都包含一个**Starter**工作簿，使您可以阅读本书中给出的示例。如果您想随时查看完整的示例，请打开**Complete**本章的工作簿。

连接到数据后，就可以开始可视化和分析数据了。当您开始这样做时，您将在零售链中担当分析师的角色。您将提出有关数据的问题，构建可视化工具来回答这些问题，并最终设计一个仪表板以共享结果。首先，为了解Tableau如何可视化数据奠定基础。

### 构建可视化的基础 <div id="page_24"></div>

首次连接到Superstore文件等数据源时，Tableau将在左侧边栏的数据窗格中显示数据连接和字段。可以将字段从数据窗格拖动到画布区域或各种架子上，例如“ 行”，“ 列”，“ 颜色 ”或“ 大小”。正如我们将看到的，基于字段的类型，字段的放置将导致数据的不同编码。

#### 度量和维度 <div id="page_25"></div>

数据源中的字段在数据窗格中可见，并分为**“度量”**和“ **维”**。度量和尺寸之间的差异是使用Tableau时要理解的基本概念：

- 度量 是汇总的值。例如，它们被求和，平均，计数或具有最小值或最大值。
- 维度 是确定汇总度量的详细程度的值。您可以将它们视为对度量进行切片或创建适合度量的组。视图中使用的尺寸组合定义了视图的基本详细程度。

作为一个示例（可以Chapter 01 Starter 在“ 度量和维”表的工作簿中查看），请考虑使用这些Region 字段 并Sales通过Superstore连接创建的视图：

![img](../images/Image%20[4].jpg)

该 Sales 字段在此视图中用作度量。具体来说，它被汇总为一个总和。当在该视图使用一个场作为一个措施，型聚集（例如， SUM，MIN，MAX，和AVG）将在活动字段示出。请注意，在前面的示例中，行上的活动字段清楚地指示了Sales：的总和SUM(Sales)。

该 Region 字段是一个维，其中包含每个数据记录的四个值之一：**Central**，**East**，**South**或**West**。当将该字段用作视图中的维时，它将对度量进行切片。因此，前面的视图显示了每个区域的销售总和，而不是总的销售总和。

#### 离散场和连续场 <div id="page_26"></div>

使用字段的另一个重要区别是字段是**离散的**还是**连续的。**字段是离散字段还是连续字段，取决于Tableau在视图中使用的位置，确定Tableau如何可视化该字段*。*Tableau将直观显示字段的默认值（数据窗格中图标的颜色）以及视图中如何使用该字段（架子上活动字段的颜色）。离散域（例如Region上一个示例）为蓝色。诸如的连续字段为Sales绿色。

*在本书印刷版的屏幕截图中，您应该能够区分离散字段（蓝色）和连续字段（绿色）之间的阴影略有不同，但是在使用Tableau时，请特别注意界面。**您可能还希望从Packt Publishing下载彩色图像包，*[网址](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf)*为：*[https](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf) *:* [//www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf)

##### 离散字段 <div id="page_27"></div>

离散 （蓝色）字段的值显示为不同且彼此分开。离散值可以重新排序，但仍然有意义。例如，您可以轻松地将的值重新排列Region为 **East**， **South**， **West**和 **Central**，而不是前面的屏幕快照中的默认顺序。

在“ 行” 或“ 列” 架子上使用离散字段时 ，该字段定义标题。在这里，离散字段Region定义列标题：

![img](../images/Image%20[5].jpg)

在这里，它定义了行标题：

![img](../images/Image%20[6].jpg)

当用于颜色时，“ 离散”字段定义离散的调色板，其中每种颜色与该字段的不同值对齐：

![img](../images/Image%20[7].jpg)

##### 连续场 <div id="page_28"></div>

连续（绿色）字段具有从第一个到最后一个连续流的值。在视图中，数字和日期字段经常（尽管并非总是）用作连续字段。这些字段的值具有更改几乎没有意义的顺序。

在“ 行”或“ 列”上使用时，连续字段定义轴：

![img](../images/Image%20[8].jpg)

当用于颜色时，连续字段定义渐变：

![img](../images/Image%20[9].jpg)

请务必注意，*连续* 和*离散* 是与**Measure** 和**Dimension**不同的概念。虽然大多数尺寸默认情况下是离散的，而大多数度量默认情况下是连续的，但可以将任何度量用作离散字段，而某些尺寸用作视图中的连续字段。

*要更改字段的默认值，请在数据窗格中右键单击该字段，然后选择“* *转换为离散”* *或“* *转换为连续”**。*

*要更改视图中字段的使用方式，请右键单击视图中的字段，然后选择“* *离散”* *或“* *连续”**。* *或者，您可以* *在数据窗格中的“* *维度”* *和* *“度量”* *之间拖放字段**。*

通常，您可以想到字段类型之间的差异，如下所示：

- 在维度和度量之间进行选择可以告诉Tableau *如何切片* *或* *聚合*数据
- 在d增量和连续之间进行选择可以告诉Tableau *如何显示* 带有标题或轴的数据，以及如何定义单独的颜色或渐变。

在阅读本书中的示例时，请注意用于创建可视化的字段，无论这些字段是尺寸还是度量，以及它们是离散的还是连续的。尝试将视图中的字段从连续更改为离散，反之亦然，以了解可视化中的差异。

### 可视化数据 <div id="page_29"></div>

与数据源的新连接是探索和发现的邀请！有时，您可能会遇到非常明确定义的问题，并且对所要查找的内容有很强的理解力。有时，您会遇到一些一般性问题，而对所发现的内容却一无所知。Tableau的可视化分析功能使您能够快速迭代地探索数据，提出新问题并做出新发现。

以下可视化示例涵盖了一些最基础的可视化类型。在研究示例时，请记住，目标不仅仅是学习如何创建特定的图表。相反，这些示例旨在帮助您思考数据问题并通过可视化迭代获得答案的过程。Tableau旨在使该过程直观，快速和透明。

*与记住创建特定图表类型的步骤相比，重要的是要了解如何以及为何使用Tableau来创建条形图，并在提出新问题时调整可视化以获取新见解。*

#### 条形图 <div id="page_30"></div>

**条形图**以一种直观的方式表示数据，可以轻松比较不同类别中的值。条的长度是您直观地了解数据的主要方法。您还可以合并颜色，大小，堆叠和顺序以传达其他属性和值。

在Tableau中创建条形图非常容易。只需将要查看的度量拖放到“ 行”或“ 列”架子上，然后将定义类别的维拖放到相对的“ 行”或“ 列”架子上。

作为的分析师Superstore，您准备好开始针对销售（尤其是销售的美元价值）的发现过程。当您按照示例操作时，请逐步完成Chapter 01 Starter 工作簿中的表单。该Chapter 01 Complete 工作簿包含完整的示例，因此您可以随时比较结果：

1. 单击“ 按部门销售”选项卡以查看该工作表。
2. 将Sales字段从“数据”窗格中的“度量 ”拖放到“ 列”架子上。现在，您有了一个带有单个条形图的条形图，代表数据源中所有数据的销售总额。
3. 将Department字段从数据窗格的“ 维度 ”拖放到“ 行”架子。这将对数据进行切片，以提供三个条形，每个条形的长度对应于每个部门的销售总额：

![img](../images/Image%20[10].jpg)

您现在有了一个水平条形图。这使得比较部门之间的销售变得容易。在上的标记类型下拉菜单标志卡被设置为自动，并显示一个指示的Tableau已确定条是给你放置在视场中最好的可视化。作为维度，Department 切片数据。由于是离散的，因此为数据中的每个部门定义行标题。作为度量，该Sales字段是聚合的。连续时，它定义了一个轴。条形标记的标记类型导致每个部门的单个条形从0该部门的销售额总和中得出。

*通常，Tableau为视图中尺寸值的每个交集绘制一个标记（例如，条，圆，正方形）。**在这种简单情况下，Tableau将为***Department的***每个尺寸值（***家具***，***办公用品***和***技术***）**绘制单个条形标记**。**标出了标记的类型，可以在**标记**卡**的下拉菜单中更改标记的类型**。**在视图的左下角状态栏中可以看到标记的数量。*

Tableau以不同的方式绘制不同的标记；例如，沿着轴从0开始绘制条（如果堆叠，则从前一条的末端开始绘制）。在由定义轴的字段的值所定义的位置处绘制圆形和其他形状。花一点时间尝试从“ 标记” 卡上的下拉菜单中选择不同的标记类型 。了解Tableau如何绘制不同标记类型将有助于您掌握该工具。

##### 条形图的迭代以进行更深入的分析 <div id="page_31"></div>

使用前面的条形图，您可以轻松地看到技术部门的总销售额比家具部门或办公用品部门多。如果您想进一步了解各个地区部门的销售额，该怎么办？请遵循以下两个步骤：

1. 导航至工作Bar Chart (two levels)表，您将在其中找到与之前创建的视图相同的初始视图。
2. 将Region字段从数据窗格中的“ 维度 ”拖到“ 行”架子，并将其拖放到Department已在视图中的字段的左侧

您现在应该拥有一个如下所示的视图：

![img](../images/Image%20[11].jpg)

您仍然有一个水平条形图，但是现在您已经引入Region了另一个维度，它可以更改视图中的详细程度并进一步分割销售总额。通过在Region之前放置Department，您可以轻松比较给定区域内每个部门的销售额。

现在您开始发现一些东西。例如：技术部门在每一个地区最具销售力，除了在东方，在那里家具有较高的销售额。办公用品从未在任何地区拥有最高的销售额。

让我们看一下使用不同排列的相同字段的不同视图：

1. 导航到“ 条形图（堆叠）”表，您将在其中找到与原始条形图相同的视图。
2. 将Region字段从“ 行”架子拖放到“ 颜色”架子上：

![img](../images/Image%20[12].jpg)

您现在有了**堆叠的条形图**，而不是**并排的**条形图。条形图的每个部分均按字段进行颜色编码。此外，颜色图例已添加到工作区。您尚未更改视图中的详细程度，因此仍然可以对区域和部门的每个组合进行销售汇总：Region

*使用Tableau时，**“* **查看** **详细级别”***是一个关键概念。**在大多数基本的可视化中，视图中所有维度的值的组合定义了该视图的最低详细级别。**所有度量将按最低详细级别汇总或划分。**在最简单的视图中，标记的数量（在左下方的状态栏中指示）对应于尺寸值的相交数量。**也就是说，尺寸值的每种组合都会有一个标记。*

- 如果 Department 是用作维度的唯一字段，则将在部门详细信息级别具有一个视图，并且视图中的所有度量将按部门汇总。
- 如果 Region 是唯一用作维度的字段，则将在区域详细信息级别具有一个视图，并且该视图中的所有度量将按区域汇总。
- 如果 在视图中同时使用 Department 和 Region作为维，则将在部门和区域级别拥有一个视图。所有度量将按部门和地区的唯一组合进行汇总，并且每个部门和地区的组合均会有一个标记。

当您想了解零件与整体之间的关系时，堆叠的钢筋会很有用。现在可以很容易地看出每个部门在每个地区的总销售额中有哪一部分。但是，很难比较部门之间大多数地区的销售额。例如，您能否轻易分辨出哪个部门在东部地区的销售额最高？这很困难，因为除West之外，酒吧的每个部分都有不同的起点。

现在花一些时间试验条形图，看看可以创建哪些变体：

1. 导航到“ 条形图（实验）”表。
2. 尝试将Region字段从Color拖到 Marks卡上的其他各个架子上，例如Size，Label和Detail。请注意，在每种情况下，这些条都保持堆叠状态，但会根据Region字段定义的视觉编码进行重绘。
3. 使用工具栏上的“ **交换”**按钮交换行和列上的字段。这使您可以轻松地从水平条形图更改为垂直条形图（反之亦然）：

![img](../images/000115.gif)

1. 将“ 销售”从“数据” 卡的“度量”部分拖放到“ 标记”卡上“ 区域”字段顶部的位置以进行替换。如有必要，将“ 销售”字段拖到“颜色”，并注意颜色图例如何成为连续字段的渐变。
2. 通过将其他字段拖放到各个架子上，进一步进行实验。注意您执行的每个操作的Tableau行为。
3. 从文件菜单中，选择保存。

*Tableau具有自动保存功能！**如果您的计算机崩溃了，那么下次您打开Tableau时，系统将提示您打开任何以前未保存的工作簿。**不过，您仍然应该养成一种习惯，即尽早且经常保存您的工作，并维护适当的备份。*

#### 折线图 <div id="page_32"></div>

**折线图**连接可视化中的相关标记，以显示这些连接的标记之间的运动或关系。标记的位置和连接标记的线是传递数据的主要方法。此外，您可以使用大小和颜色来传达其他信息。

折线图最常见的一种是**时间序列**。时间序列显示值随时间的移动。在Tableau中创建一个只需要一个日期和一个度量。

使用Chapter 01 Starter您刚刚保存的工作簿继续对Superstore销售进行分析：

[1] 导航到销售 随着时间的推移表。

[2] 拖动Sales领域的措施，以行。这为您提供了一个垂直的竖线，表示数据源中所有销售额的总和。

[3] 要将其转换为时间序列，必须引入一个日期。将Order Date字段从左侧数据窗格中的“ 维度”拖放到“ 列”中。Tableau具有内置的日期层次结构，默认的Year年为您提供了连接四年的折线图。请注意，您可以清楚地看到年复一年的销售增长：

![img](../images/Image%20[13].jpg)

[4] 使用“ 列 ” YEAR(Order Date)字段上的下拉菜单（或右键单击该字段），然后将日期字段切换为使用“ 季度”。您可能会注意到在下拉菜单中两次列出了Quarter。我们将探索日期部分，价值观和层次的各种选项在 *可视化日期和时间*  的部分 [第3章](docs/Book.md#page_70)， *冒险到高级可视化*。现在，选择第二个选项：

![img](../images/Image%20[14].jpg)

请注意，按季度查看销售额时，周期性模式非常明显：

![img](../images/Image%20[15].jpg)

##### 折线图迭代可进行更深入的分析 <div id="page_33"></div>

现在，您正在查看一段时间内的总体销售额。让我们在更深层次上进行一些分析：

1. 导航到“ 随时间推移的销售” （重叠线）表，您将在其中找到与您刚刚创建的视图相同的视图。
2. 拖动Region从外地尺寸到颜色。现在，每个区域都有一行，每行都有不同的颜色，还有一个图例指示用于该区域的颜色。与条形图一样，为颜色添加尺寸会拆分标记。但是，与条形段堆叠在一起的条不同，这些线没有堆叠。取而代之的是，按照每个区域和每个季度的销售总和的确切值绘制线。这样可以轻松而准确地进行比较。有趣的是，可以观察到每个区域的周期性模式：

![img](../images/Image%20[16].jpg)

只有四个区域，将线条分开很容易。但是，具有更独特价值的维度又如何呢？步骤如下：

1. 导航到“ 随时间推移销售 （多行）”工作表，您将在其中找到与刚创建的视图相同的视图。
2. Category从“ 维度”中拖动字段，然后将其直接Region放在“ 标记”卡上当前字段的顶部。这将Region字段替换为Category。现在，您有17条重叠的线。通常，您将需要避免多于两行或三行重叠的行。但是，您也可以考虑使用颜色或大小来展示其他线条中的重要线条。另请注意，单击颜色图例中的项目将在视图中突出显示关联的行。突出显示是挑选单个项目并将其与所有其他项目进行比较的有效方法。
3. 将Category字段从“ 标记”卡上的“ 颜色 ” 拖放到“ 行”中。现在，每个类别都有一个折线图。现在，您可以比较一段时间内的每个产品，而不会产生过多的重叠，并且仍然可以比较一段时间内的趋势和模式。这是将在更充分地开发出了火花线可视化的开始*高级可视化*的部分[第11章](docs/Book.md#page_231)， *高级可视化，技术，技巧，和技巧*。

#### 地理可视化 <div id="page_34"></div>

在画面，内置的地理数据库认识到地理领域的角色，比如Country，State，City，Airport，Congressional District，或Zip Code。即使您的数据不包含纬度和经度值，您也可以简单地使用地理字段在地图上绘制位置。如果您的数据确实包含纬度和经度字段，则可以使用这些字段代替生成的值。

*Tableau将根据字段名称和数据中的值采样自动将地理角色分配给某些字段。**您可以通过右键单击数据窗格中的字段并使用“* *地理角色”**选项**来将**地理角色**分配或重新分配给任何字段**。**这也是查看可用的内置地理角色的好方法。*

Tableau还可以从某些数据库读取形状文件和几何形状。这些和其他地理能力将在更详细的覆盖*映射技术*的部分[第11章](docs/Book.md#page_231)， *高级Visuali* *zations，技术，技巧，和技巧。*在以下示例中，我们将考虑一些地理可视化的关键概念。

当您需要了解事情发生在哪里以及数据中是否存在任何空间关系时，地理可视化非常有用。Tableau提供了三种主要的地理可视化类型：

- 填充地图（在Tableau界面中简称为*地图*）
- 符号图
- 密度图

##### 填满的地图 <div id="page_35"></div>

填充的地图会填充国家/地区，州/县或邮政编码等区域，以显示位置。填充区域的颜色可用于编码值，大多数情况下是汇总度量值，有时还包括尺寸。这些地图也称为“ **choropleth地图”**。

假设您想了解销售情况，Superstore并查看地理上是否存在任何模式。您可能会采用类似于以下方法：

1. 导航到按州销售表。
2. 双击State数据窗格中的字段。画面自动创建使用地理可视化Latitude (generated)，Longitude (generated)和State字段。
3. 将Sales字段从数据窗格中拖放到Marks卡的Color架子上。根据您使用的字段和架子，Tableau已将自动标记类型切换为Map：

![img](../images/Image%20[17].jpg)

填充的地图用一种颜色填充每个州，以指示该州的相对销售额。现在在视图中可见的颜色图例给出了值的范围，并表示销售额最低的州总计**3,543**，销售额最高的州总计**1,090,616**。

当您查看底部状态栏中显示的标记数时，您会看到它是49。仔细检查后发现，标记由较低的48个州和华盛顿特区组成。没有显示夏威夷和阿拉斯加。如果Tableau存在于数据中并且未被过滤器排除，则Tableau仅会绘制地理标记，例如填充状态。

请注意，地图确实显示了加拿大，墨西哥和数据中未包括的其他位置。这些是从在线地图服务检索到的背景图像的一部分。然后将状态标记绘制在背景图像的顶部。我们来看看如何自定义地图，甚至在使用其他地图服务*测绘技术*的部分[第11章](docs/Book.md#page_231)， *高级Visualizations，技术，技巧，和技巧*。

填充的地图可以在交互式仪表板中很好地工作，并且具有相当的美学价值。但是，使用填充图很难进行某些类型的分析。与其他可视化类型不同，在其他可视化类型中，可以使用大小来传达数据的各个方面，填充的地理区域的大小仅与地理大小有关，并且可能使比较变得困难。例如：哪个州的销售额最高？您可能会想说德克萨斯州或加利福尼亚州，因为它们看上去更大，但是您会猜到马萨诸塞州吗？与较大的区域相比，某些位置可能足够小，甚至无法显示。请谨慎使用已填充的地图，并考虑将其与仪表板上的其他可视化文件配对以进行清晰的通信。

##### 符号图 <div id="page_36"></div>

对于符号地图，地图上的标记不会绘制为填充区域。相反，标记是放置在特定地理位置的形状或符号。大小，颜色和形状也可以用于编码其他尺寸和度量。

请Superstore按照以下步骤继续进行销售分析：

1. 导航到“ 按邮政编码销售”表。
2. Postal Code在尺寸下双击。画面会自动添加Postal Code到详细的的标志牌，并Longitude (generated)和Latitude (generated)以列和行。默认情况下，标记类型设置为圆形，并以正确的纬度和经度为每个邮政编码绘制一个圆圈。
3. 将“ 销售”从“度量 ” 拖到“ 标记”卡上的“ 大小”架子。这将使每个圆圈根据该邮政编码的销售总额确定大小。
4. 将利润从度量拖动到标记卡上的颜色架子。这会将标记颜色编码为与利润之和相对应。现在，您可以同时查看利润和销售的地理位置。这很有用，因为您会看到一些销售量高，利润低的位置，这可能需要采取一些措施。

对尺寸和颜色进行一些微调后，最终视图应如下所示：

![img](../images/Image%20[18].jpg)

有时，您需要调整符号图上的标记以使其更明显。一些选项包括：

- 如果标记重叠，请单击“ 颜色”架子，然后将透明度设置为50%和之间的某个位置75%。此外，添加深色边框。这样可以使标记脱颖而出，并且您通常可以更好地识别任何重叠的标记。
- 如果标记太小，请单击“ 尺寸”架子并调整滑块。您也可以双击尺寸图例，然后编辑有关Tableau分配尺寸的详细信息。
- 如果标记太淡，请双击颜色图例，然后编辑Tableau分配颜色的详细信息。当您使用定义颜色渐变的连续字段时，此功能特别有用。

调整大小并使用“分步颜色”和“ 使用全色范围”（如下所示）相结合，产生了此示例的最终结果：

![img](../images/Image%20[19].jpg)

与填充图不同，符号图使您可以使用大小以可视方式对数据的各个方面进行编码。符号映射也允许更高的精度。实际上，如果数据中包含经度和纬度，则可以在街道地址详细级别上非常精确地绘制标记。这种类型的可视化还允许您映射没有明确定义的边界的位置。

有时，当您在“ **标记”**卡下拉菜单中手动选择“ **地图”**时，会收到一条错误消息，指示视图的详细信息级别不支持填充的地图。在这些情况下，Tableau将呈现没有内置形状的地理位置。除了无法填充地图的情况以外，您需要确定哪种类型最能满足您的需求。在后面的章节中，我们还将考虑在单个视图中组合填充图和符号图的可能性。

##### 密度图 <div id="page_37"></div>

密度图显示值在一个地理区域内的分布和集中。这些标记代替了单个的点或符号，融合在一起，显示出高浓度区域的强度。您可以控制颜色，大小和强度。

假设您想了解订单的地理位置集中。您可以使用以下步骤创建密度图：

1. 导航到“ 订单密度” 表。
2. 双击Postal Code 数据窗格中的 字段。正如前，画面自动创建一个使用一个符号地图地理可视化 Latitude (generated)， Longitude (generated)以及 State 多个领域。
3. 使用标记 卡上的下拉菜单，将标记类型更改为密度。现在，各个圆圈融合在一起，显示出浓度：

![img](../images/Image%20[20].jpg)

尝试尝试使用 颜色 和 尺寸 选项。例如，单击颜色，将显示一些特定于密度标记类型的选项：

![img](../images/Image%20[21].jpg)

可以使用几种调色板来很好地处理浓度标记（默认调色板可以在浅色背景下很好地工作，但是还有其他一些调色板可以在深色背景下工作）。强度滑块可让您根据浓度确定标记绘制的强度。

该密度图显示了来自东海岸的大量订单。有时，您会看到仅反映人口密度的模式-在这种情况下，您的分析可能没有特别的意义。在这种情况下，与西海岸缺乏密度相比，东海岸的集中度令人着迷。

#### 使用“向我展示” <div id="page_38"></div>

Show Me是Tableau的强大组件，可将所选字段和活动字段排列到所选可视化类型所需的位置。“  显示我”工具栏显示了不同类型的可视化效果的小缩略图图像，使您只需单击即可创建可视化效果。根据您在数据窗格中选择的字段以及已经在视图中的字段，“  显示我”将启用可能的可视化并突出显示推荐的可视化。

请按照以下步骤探索“ 向我展示 ”功能：

1. 导航到“ 向我显示”工作 表。
2. 如果“ 显示我”窗格没有展开，请单击工具栏右上方的“ 显示我”按钮以展开该窗格。
3. 在数据窗格中单击“ 邮政编码”，“ 州 ”和“ 利润”字段时，按住*Ctrl*键，以选择每个字段。在突出显示这些字段的情况下，“ 向我显示”应如下所示：

![img](../images/Image%20[22].jpg)

请注意，“ 显示我”窗口已启用某些可视化类型，例如**文本表**，**热图**，**符号图**，**填充图**和**条形图**。除了在数据窗格中选择的任何字段外，这些视图还可以在视图中已有字段的情况下提供。“向我展示”突出显示了所选字段的推荐可视化效果，并提供了将鼠标悬停在每种可视化类型上时需要哪些字段的描述。例如，符号地图需要一个地理维度和0到2个度量。

其他可视化显示为灰色，例如折线图，面积图和直方图。Show Me不会使用视图中当前在数据窗格中选择的字段来创建这些可视化类型。将鼠标悬停在“ 向我展示”中的灰色折线图选项上。它表示折线图需要一个或多个度量（已选择），但还需要一个日期字段（尚未选择）。

*Tableau将使用日期以外的其他字段绘制折线图。**Show Me**为您提供了通常被视为可视化的良好做法的选项。**但是，有时候您知道折线图可以**更好地代表您的数据**。**了解Tableau如何基于字段和架子来呈现可视化效果，而不是始终依赖于**Show Me，**将为您提供更大的可视化灵活性，并允许您在**Show Me**无法提供所需的确切结果**时重新排列内容**。**同时，您将需要培养良好的可视化实践意识。*

当您搜索数据的见解时，“ 显示我”可能是一种快速迭代不同可视化类型的有效方法。但是，作为数据浏览器，分析师和讲故事的人，您应该考虑“ 向我展示”  作为提供建议的有用指南。您可能知道某种可视化类型比“向我展示”的建议会更有效地回答您的问题。您也可能有一个可视化类型的计划，该计划可以很好地用作仪表板的一部分，但甚至不包含在Show Me中。

如果可以有效地使用Show Me，那么您将很好地学习和掌握Tableau ，但如果没有它，也可以轻松构建可视化效果。Show Me功能强大，可以在您寻找见解并提出新问题时快速迭代可视化。这对于从您进一步自定义的标准可视化开始很有用。作为教学工具，它很棒。

但是，请注意不要在不了解如何从数据实际构建可视化的情况下将其用作拐杖。花时间评估为什么某些可视化是可行的还是不可能的。暂停查看在选择某种可视化类型时使用了哪些字段和架子。

通过单击各种可视化类型尝试“ 演示”，结束“ 演示我”示例，以基于可视化类型寻找对数据可能或多或少显而易见的见解。**圆形视图**和**箱须图**显示了每个州的邮政编码分布。条形图容易暴露一些邮政编码为负的邮政编码。

现在您已经熟悉了如何创建数据的各个视图，现在让我们将注意力转移到仪表板上。

### 将所有内容放到仪表板中 <div id="page_39"></div>

通常，您不仅仅需要一个可视化文件来传达数据的全部内容。在这些情况下，Tableau使您非常轻松地在仪表板上一起使用多个可视化文件。在Tableau中，*仪表板*是视图，过滤器，参数，图像和其他对象的集合，这些对象一起工作以传达数据故事。仪表板通常是交互式的，并允许最终用户浏览数据的不同方面。

仪表板有多种用途，可以量身定制以适合各种受众。考虑以下可能的仪表板：

- 利润和销售的摘要级别视图，使高管可以快速了解公司的当前状态
- 交互式仪表板，允许销售经理深入研究销售区域以识别威胁或机会
- 仪表板可让医生跟踪患者的再入院，诊断和程序，从而做出有关患者护理的更好决策
- 仪表板，可让房地产公司的主管确定趋势并为各种公寓大楼做出决策
- 一个交互式的仪表板，供信贷员根据信用等级和地理位置细分的投资组合做出贷款决策

为不同的受众和先进技术方面的考虑进行详细覆盖 [第7章](docs/Book.md#page_160) ， *讲述与仪表板数据的故事*.

#### 仪表板界面 <div id="page_40"></div>

创建新的仪表板时，界面将与设计单个视图时稍有不同。在简要了解界面之后，我们将开始设计您的第一个仪表板。您可能会导航到“ Superstore Sales”表，然后自己快速浏览一下。

仪表板窗口由几个关键组件组成。使用这些对象的技术将在[第7章](docs/Book.md#page_160)*“用仪表板讲述数据故事”中*详细介绍*。* 目前，重点关注对可用选项的一些熟悉。您会注意到的一件事是，左侧边栏已替换为特定于仪表板的内容：

![img](../images/Image%20[23].jpg)

左侧栏包含两个选项卡：

- 甲仪表板标签，上浆选项和添加表和对象到仪表板
- 甲布局选项卡，用于调节各种对象的布局仪表盘上的

“ 仪表板”窗格包含用于基于目标设备进行预览的选项以及几个部分：

- 一个**面积**部分，仪表盘大小的选项
- 甲**表**部分中，包含在仪表盘上的所有片材（视图）提供给处
- 具有可添加到仪表板的其他对象的“ **对象”**部分

您可以通过拖放将工作表和对象添加到仪表板。拖动视图时，一旦放下工作表，浅灰色阴影将指示工作表在仪表板上的位置。您也可以双击任何工作表，它将自动添加。

除了添加工作表之外，还可以将以下对象添加到仪表板：

- **水平**和**垂直**布局容器可让您更好地控制布局
- **文字**可让您添加文字标签和标题
- 的**图像**  ，甚至嵌入**网页**内容可以加
- 使用**Blank**对象可以保留仪表板中的空白，也可以用作占位符，直到设计了其他内容
- 甲**按钮**是一个对象，允许用户仪表板之间导航
- 一个**扩展**  让你添加控件的能力和对象，你或者第三方已开发与仪表板进行交互，并提供扩展功能

使用切换按钮，您可以选择是否将新对象添加为平铺或浮动。平铺对象将对齐到其他平铺对象旁边或布局容器内的平铺布局中。浮动对象将在连续的图层中浮动在仪表板上。

第一次将工作表添加到仪表板时，在工作表视图中可见的所有图例，过滤器或参数都将添加到仪表板。如果您希望稍后添加它们，请在仪表板中选择工作表，然后单击右上角的小下拉记号。几乎每个对象都具有下拉符号，提供许多选项来微调外观和控制行为。

请注意对于仪表板上的所选对象可见的各种**用户界面**（**UI**）元素：

![img](../images/Image%20[24].jpg)

您可以使用边框在仪表板上调整对象的大小。屏幕快照中标记的**Grip**允许您在放置对象后移动它。我们将考虑其他选择。

#### 建立仪表板 <div id="page_41"></div>

有了界面概述，您现在可以按照以下步骤来构建仪表板：

[1] 导航到“ 超级市场销售”表。您应该看到一个空白的仪表板。  

[2] 先后双击每个中列出的后页纸张的仪表盘左侧部分：由销售部，随着时间的推移销售，并通过邮编销售。请注意，双击对象会将其添加到仪表板的布局。  

[3] 通过选中边栏左下角的“ 显示仪表板标题”，向仪表板添加标题。  

[4] 在仪表板上选择“ 按部门销售”表，然后单击下拉箭头以显示菜单。  

[5] 选择适合 | 整个视图。本**飞度**选项描述的可视化应该如何填充任何可用空间。  

> 使用各种**适合**选项**时要小心**。**如果您使用的大小不固定的仪表板，或者您的视图根据交互性动态更改显示的项目数，那么曾经看起来不错的视图可能不太适合该视图。*

[6] 通过单击选择销售规模图例。使用**Remove UI**元素从仪表板中删除图例。

[7] 通过单击选择“ 利润”颜色图例。使用握柄拖动图例，并将其放置在地图下。

[8] 对于每个视图（由部门销售，通过邮政编码销售，并且销售一段时间内），选择通过单击视图的空白区域的观点。然后，单击用作筛选器**UI**元素以使该视图成为仪表板的交互式筛选器。您的仪表板应类似于以下内容：

![img](../images/Image%20[25].jpg)

[9] 花一点时间与仪表板进行交互。单击各种标记，例如线条，状态和线的点。请注意，每个选择都会过滤仪表板的其余部分。单击所选标记将取消选择它并清除过滤器。还要注意，在多个视图中选择标记会使过滤器一起工作。例如，选择在酒吧家具在由部销售和2016年第一季度在一段时间的销售  可以让你看到所有的邮政编码是曾在2016年第一季度家具销售。

恭喜你！现在，您已经创建了一个可以进行交互式分析的仪表板！

作为超市连锁店的分析师，您的可视化效果使您可以浏览和分析数据。您创建的仪表板可以与管理人员共享，并且可以用作帮助他们查看和理解数据以做出更好决策的工具。当经理选择家具部门时，很明显，有些地方的销售额很高，但利润实际上很低。这可能会导致做出决定，例如更改该位置的行销或新的销售重点。最有可能的是，这将需要进行额外的分析，以确定最佳的行动方案。在这种情况下，Tableau将使您能够继续发现，分析和讲故事的周期。

### 总结 <div id="page_42"></div>

Tableau的视觉环境允许视觉上快速探索和分析数据的迭代过程。您已迈出了了解如何使用该平台的第一步。您连接到数据，然后使用一些关键的可视化类型（例如条形图，折线图和地理可视化）来浏览和分析数据。在此过程中，您专注于学习技术和理解关键概念，例如度量和维度之间的差异以及离散和连续的字段。最后，您将所有部分放在一起以创建功能全面的仪表板，最终用户可以通过该仪表板了解您的分析并发现自己的发现。

在下一章中，我们将探讨Tableau如何处理数据。您将了解如何连接各种数据源的基本概念和实际示例。结合您刚刚学习的有关构建可视化的关键概念，您将有能力继续进行更高级的可视化，更深入的分析以及讲述完全交互式的数据故事。

## 第二章 在Tableau中处理数据 <div id="page_43"></div>

Tableau提供了连接到几乎所有数据源的功能。它使用独特的范例来做到这一点，从而使其能够利用现有数据库引擎的功能和效率，并可以选择在本地提取数据。本章重点介绍Tableau如何处理数据的基本概念，包括以下主题：

- Tableau范例
- 连接数据
- 使用抽取而不是实时连接
- Tableau文件类型
- 元数据和共享连接
- 连接和融合
- 筛选数据

### Tableau范例 <div id="page_44"></div>

（**VizQL** **可视查询语言**）的结果是第二章 在Tableau中处理数据的独特而令人兴奋的体验。

VizQL是作为斯坦福大学的一个研究项目而开发的，专注于人类视觉感知世界的自然方式以及如何将其应用于数据可视化。我们自然会察觉到大小，形状，空间位置和颜色的差异。当您在可视环境中拖放数据字段时，通过VizQL，Tableau可以将您的操作转换为查询语言，该查询语言定义了数据如何编码这些可视元素。您将不需要读取，写入或调试VizQL。在将字段拖放到定义大小，颜色，形状和空间位置的各个架子上时，Tableau将在后台生成VizQL。这使您可以专注于可视化数据，而不是编写代码！

VizQL的优点之一是它提供了一种通用的方式来描述视图中各个字段的排列方式如何定义与数据相关的查询。然后可以将此通用基准转换为SQL，MDX和**TQL**（**Tableau Query Language的**缩写，用于提取数据）的**多种形式**。Tableau将自动将VizQL转换为由源数据引擎运行的本机查询。

以最简单的形式，Tableau处理数据的范例如下图所示：

![img](../images/Image%20[26].jpg)

#### 一个简单的例子 <div id="page_45"></div>

继续并打开目录中的Chapter 02 Starter.twbx工作簿\Learning Tableau\Chapter 02，然后导航到Tableau Paradigm表。看一下下面的屏幕快照，该屏幕快照是通过将ColumnsRegion  上的维度和Rows上的 measure 拖放到屏幕上而创建的 ：Sales

![img](../images/Image%20[27].jpg)

该 Region 字段在视图中用作离散（蓝色）字段，因此定义了列标题。作为维度，它定义了视图中的详细程度，并对度量进行切片，以便每个区域获得一个条形图。该 Sales 字段是通过汇总每个区域内的每个销售而汇总的度量。作为连续（绿色）字段，Sales定义一个轴。

就本示例而言（尽管主体适用于任何数据源），假设您使用Superstore存储在表中的数据实时连接到SQL Server数据库。首次创建上述屏幕截图时，Tableau会生成一个VizQL脚本，该脚本会转换为SQL脚本并发送到SQL  Server。SQL  Server数据库引擎评估查询并将汇总结果返回给Tableau，然后将其可视化呈现。整个过程类似于Tableau范例中的下图：

![img](../images/Image%20[28].jpg)

SQL Server中可能有成百上千，甚至上百万的销售数据行。但是，当SQL Server处理查询时，它将返回聚合结果。在这种情况下，SQL Server仅将四行汇总数据返回到Tableau，每个区域一行。

要查看Tableau用来绘制视图的聚合数据，请按*Ctrl* *+* *A*选择所有条，然后右键单击它们之一，然后选择“ 查看数据”。

*有时，数据库管理员可能希望找出针对某个数据库运行的脚本，以调试性能问题，或确定更有效的索引或数据结构。**许多数据库提供概要分析实用程序或查询的日志执行。**此外，您可以在**My Tableau RepositoryLogs**目录**中的日志中找到Tableau生成的SQL或MDX* *。*

*您也可以使用Tableau的内置***Performance Recorder***查找已执行的查询。**在顶部菜单中，选择**帮助* *|。**设置和性能* *|* *开始演奏记录**，然后与视图进行交互，最后从菜单中停止录制。**Tableau将打开一个仪表板，使您可以查看在录制会话期间执行的任务，性能和查询。*

通过执行以下步骤，您实际上可以查看Tableau用于渲染条形图和基础记录的聚合数据：

1. 导航到 工作簿中的“ Tableau范例”表Chapter 02 Starter。
2. 按*Ctrl* *+* *A*选择所有四个栏。
3. 右键单击这些条之一，然后从上下文菜单中选择“ 查看数据... ”，如下所示：

![img](../images/Image%20[29].jpg)

“ 查看数据”屏幕使您可以观察视图中的数据。“ 摘要”选项卡显示用于渲染视图的聚合级别数据。Sales此处的值是每个地区的销售额总和。单击“ 基础”选项卡时，Tableau将查询数据源以检索构成聚合记录的所有记录。在这种情况下，有9,426条基础记录，如以下屏幕快照右下角的状态栏所示：

![img](../images/Image%20[30].jpg)

Tableau不需要9,426条记录来绘制视图，并且直到单击“ 基础数据”选项卡之前才从数据源请求它们。

数据库引擎经过优化，可以对数据执行聚合。通常，这些数据库引擎也位于功能强大的服务器上。Tableau利用了基础数据源的优化和功能。通过这种方式，Tableau可以可视化大量数据集，而对数据的本地处理相对较少。

此外，Tableau仅在您进行更改时需要查询新查询或刷新视图时才查询数据源。否则，它将使用存储在本地缓存中的聚合结果，如下所示：

![img](../images/Image%20[31].jpg)

在前面的示例中，基于视图中字段的查询（即，区域作为维度，销售总额作为度量）将仅向数据源发出一次。当返回四行聚合结果时，它们将存储在缓存中。然后，如果要移到Region另一个视觉编码架子（例如颜色），或Sales另一个视觉编码架子（例如大小），Tableau将从缓存中检索聚合行，并简单地重新渲染视图。

*您可以通过按**F5键**或从“* *数据”**菜单中选择**数据源**并选择“* *刷新”**来强制Tableau绕过缓存并刷新**数据源中的**数据**。**只要您希望视图反映实时数据源中的最新更改，就可以执行此操作。*

当然，如果要向视图中引入没有缓存结果的新字段，则Tableau会将新查询发送到数据源，检索汇总结果，然后将这些结果添加到缓存中。

### 连接数据 <div id="page_46"></div>

Tableau可视化的数据几乎没有限制！几乎每个新版本的Tableau都添加了新的本机连接。Tableau继续为基于云的数据添加本机连接器。该**网络的数据连接器**允许你写一个连接器，你想检索任何在线数据。此外，对于任何没有本机连接的数据库，Tableau都可以使用通用的ODBC连接。通过**Extract API**，您可以以编程方式提取和组合任何数据源，以供Tableau使用。

您可能在同一工作簿中具有到不同源的多个数据源连接。每个连接将显示在左侧栏的“ 数据”选项卡下。

本节将重点介绍一些连接到各种数据源的实际示例。我们不会介绍所有可能的连接，但是会介绍几个代表其他连接的地方。在以下示例中，您可能会或可能不会访问某些数据源。*如果您无法遵循每个示例，请不要担心*。仅观察差异。

*从Tableau 10开始，***连接从***技术上讲是指对单个数据集（例如，单个数据库中的表或目录中的文件）的连接。**甲***数据源***可包含一个以上的连接，可以连接在一起，如在SQL Server加入到Excel表的表。**您可能经常听到这些术语可以互换使用。*

#### 连接到文件中的数据 <div id="page_47"></div>

基于文件的数据包括将数据存储在文件中的所有数据源。基于文件的数据源包括以下内容：

- **提取物**：.hyper 包含从原始来源提取的数据的文件或.tde 文件。
- **Microsoft Access中**：一个.mdb或.accdb数据库文件在Access中创建。
- **Microsoft Excel中****：**一个.xls，.xlsx或.xlsm在Excel中创建的电子表格。多个Excel工作表或子表可以在单个连接中联接或结合在一起。
- **文本文件**：分隔的文本文件，最常见的.txt，.csv或.tab。单个目录中的多个文本文件可以在单个连接中合并或合并在一起。
- **本地多维数据集文件**：.cub包含**多维数据的文件**。这些文件通常是从OLAP数据库中导出的。
- **Adobe PDF**： .pdf可能包含Tableau可以解析的数据表的文件。
- **空间文件**：甲.kml，.shp，.tab，.mif，或.geojson文件，它包含可通过的Tableau呈现空间对象。
- **统计文件**：一个.sav，.sas7bdat，.rda，或.rdata文件通过统计工具，如SAS或R.产生
- **JSON** **文件**：.json包含JSON格式的数据的文件。

除了前面提到的那些连接，您还可以连接到Tableau文件，以导入保存在另一个Tableau工作簿（.twb或.twbx）中的连接。连接将被导入，更改将仅影响当前工作簿。

请按照以下示例查看与Excel文件的连接：

1. 导航到工作簿中的“ 连接到Excel”表Chapter 02 Starter.twbx。
2. 从菜单中，选择数据 | 创建新的数据源，然后从可能的连接列表中选择Excel。
3. 在打开的对话框中，Superstore.xlsx从\Learning Tableau\Chapter 02目录中打开文件。Tableau将打开“ 数据源”屏幕。您应该看到左侧列出的两张Excel文档。
4. 双击订单表，然后双击退货表。您的数据源屏幕应类似于以下屏幕截图：

![img](../images/Image%20[32].jpg)

花一些时间来熟悉“ **数据源”**屏幕界面，该界面具有以下功能（在前面的屏幕快照中编号）：

1. 工具栏：工具栏具有一些熟悉的控件，包括撤消，重做和保存。它还包括刷新当前数据源的选项。
2. 连接：当前数据源中的所有连接。单击“ 添加”将新连接添加到当前数据源。这使您可以跨不同的连接类型联接数据。每个连接都将使用颜色编码，以便您可以区分来自哪个连接的数据。
3. 表格（或表格）：列出了可用于给定连接的所有数据表格。其中包括Excel的工作表，子表和命名范围；关系数据库的表，视图和存储过程；以及其他依赖于连接的选项，例如New Union或Custom SQL。
4. 数据源名称：这是当前所选数据源的名称。您可以使用数据库图标旁边的下拉箭头选择其他数据源。您可以单击数据源的名称进行编辑。
5. 连接编辑器：将表格和表格从左侧拖放到该区域中，以使它们成为连接的一部分。对于许多连接，您可以添加将联接或联合在一起的多个表。在本章的后面，我们将看一些选项的高级示例。现在，请注意，您可以将鼠标悬停在该空间中的表上，并通过下拉菜单获取选项。
6. 实时或提取选项：对于许多数据源，您可以选择是要保持实时连接还是提取连接。我们将在本章后面详细介绍这些内容。
7. 数据源过滤器：您可以将过滤器添加到数据源。这些将应用于数据源级别，因此将应用于工作簿中使用此数据源的数据的所有视图。
8. 预览窗格选项：这些选项使您可以指定是要查看数据预览还是元数据列表，以及要如何预览数据（示例包括别名值，显示的隐藏字段以及多少个）您要预览的行）。
9. 预览窗格/元数据视图：根据您在选项中的选择，此空间将显示数据预览或包含附加元数据的所有字段的列表。请注意，这些视图为您提供了广泛的选择，例如更改数据类型，隐藏或重命名字段以及应用各种数据转换功能。我们将在本章和后续章节中考虑其中一些选项。

*创建并配置数据源后，您可以单击任意工作表以开始使用它。*

通过以下步骤结束本练习：

1. 单击数据源名称以编辑文本，然后将数据源重命名为 Orders and Returns。
2. 导航到连接到Excel片，并使用订单和返回数据源，创建一个时间序列示出了**记录数**由**退货原因**。您的视图应类似于以下屏幕截图：

![img](../images/Image%20[33].jpg)

1. 由于您创建的连接基于Orders和Returns的内部联接，因此该视图显示每个原因码的退货数。

如果你需要编辑在任何时候连接，选择数据从菜单中，找到您的连接，然后选择编辑数据  源......。或者，您可以右键单击左侧边栏“ 数据”选项卡下的任何数据源，然后选择“ 编辑数据源...”，或单击左下方的“  数据源”选项卡。您可以随时通过单击Tableau Desktop左下角的“ 数据源”选项卡来访问数据源屏幕。

#### 连接到服务器上的数据 <div id="page_48"></div>

SQL  Server，MySQL，Vertica和Oracle等数据库服务器将数据托管在一台或多台服务器计算机上，并使用强大的数据库引擎根据来自客户端应用程序的查询来存储，聚集，排序和提供数据。Tableau可以利用这些服务器的功能来检索数据以进行可视化和分析。或者，可以从这些来源中提取数据并将其存储在提取物中（.hyper或.tde）。

作为连接到服务器数据源的示例，我们将演示连接到SQL  Server。如果您有权访问基于服务器的数据源，则可能希望创建一个新的数据源并浏览详细信息。但是，本章的工作簿中没有具体的示例可以遵循。一旦选择了Microsoft SQL Server连接，该界面就会显示一些初始配置的选项，如下所示：

![img](../images/Image%20[34].jpg)

与SQL Server的连接需要服务器名称以及身份验证信息。

数据库管理员可以将SQL Server配置为使用Windows身份验证或SQL Server用户名和密码。使用SQL  Server，您还可以选择允许读取未提交的数据。这可能会提高性能，但如果在查询Tableau的同时插入，更新或删除数据，也可能导致不可预测的结果。另外，您可以使用左下角的Initial SQL ...链接指定要在连接时运行的SQL。

*为了维持高标准的安全性，Tableau不会将密码保存为数据源连接的一部分。**这意味着，如果您使用实时连接与他人共享工作簿，则他们将需要具有凭据才能访问数据。**这也意味着，首次打开工作簿时，对于需要密码的任何连接，您都需要重新输入密码。*

单击橙色的“ 登录”按钮后，您将看到一个非常类似于您在Excel中看到的连接屏幕的屏幕。主要区别在左侧，您可以在其中选择数据库，如以下屏幕快照所示：

![img](../images/Image%20[35].jpg)

选择数据库后，将看到以下内容：

- 表格：显示所选数据库中包含的所有数据表或视图。
- 新的自定义SQL：您可以编写自己的自定义SQL脚本并将其添加为表。您可以像加入其他任何表或视图一样将它们加入。
- 新建联合：您可以将数据库中的表联合在一起。Tableau将根据名称和数据类型匹配字段，并且您还可以根据需要合并字段。
- 存储过程：您可以使用存储过程来返回数据表。您可以选择设置存储过程参数的值，或者使用或创建Tableau参数来传递值。

配置完连接后，单击任意工作表的选项卡即可开始可视化数据。

#### 连接到云中的数据 <div id="page_49"></div>

与云中托管的数据建立了某些数据连接。这些包括**Amazon Redshift**，**Google Analytics（分析）**，**Google Sheets**，**Salesforce**等。深入讨论每个连接都超出了本书的范围，但是作为云数据源的示例，我们将考虑连接到Google表格。

Google表格允许用户在线创建和维护数据电子表格。表单可以由许多不同的用户共享和协作。在这里，我们将通过一个示例链接到通过链接共享的工作表。

要遵循该示例，您需要一个免费的Google帐户。使用您的凭据，请按照下列步骤操作：

1. 单击工具栏上的“ 添加新数据源”按钮，如下所示：

![img](../images/000133.gif)

1. 从可能的数据源列表中选择Google表格。您可以使用搜索框快速缩小列表的范围。
2. 在接下来的屏幕上，登录您的Google帐户，并授予Tableau Desktop适当的权限。然后，将向您显示所有Google表格的列表以及预览和搜索功能，如以下屏幕截图所示：

![img](../images/Image%20[36].jpg)

1. 在搜索框中输入此URL（为方便起见，该URL包含在Chapter 02 Starter工作簿的“ 连接到Google表格”标签中，并且可以复制和粘贴），然后单击“ **搜索”**按钮：[https](https://docs.google.com/spreadsheets/d/1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A/edit?usp=sharing) : [//docs.google.com/spreadsheets/ d / 1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A / edit？usp = sharing](https://docs.google.com/spreadsheets/d/1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A/edit?usp=sharing)。
2. Superstore在列表中选择结果表，然后单击“ 连接”按钮。现在，您应该看到“ **数据源”**屏幕。
3. 将数据源重命名为 Superstore (Google Sheets)。
4. 就本示例而言，请将连接选项从实时切换为提取。连接到自己的Google表格数据时，您可以选择实时或提取。
5. 导航到“ 连接到Google表格”工作表。应在几秒钟内提取数据。
6. 创建一个按**州**划分的**利润**图填充图，其中**利润**定义**颜色**和**标签**。

#### 连接数据的快捷方式 <div id="page_50"></div>

您可以非常快速地建立某些连接。这些选项使您可以更快地开始分析：

- **从剪贴板粘贴数据**。如果您从电子表格，网页上的表格或文本文件中复制了数据，则通常可以将数据直接粘贴到Tableau中。可以使用*Ctrl* *+* *V*或Data | 从菜单粘贴数据。数据将存储为文件，并且在保存工作簿时会提示您其位置。
- **选择****文件** **|** **从菜单中****打开**。这将允许您打开Tableau支持的任何数据文件，例如文本文件，Excel文件，Access文件（在macOS上不可用），空间文件，统计文件，JSON甚至是脱机多维数据集（.cub）文件。
- **将文件从Windows资源管理器或Finder拖放到Tableau工作区中**。任何有效的基于文件的数据源都可以拖放到Tableau工作区上，甚至可以放到桌面或任务栏上的Tableau快捷方式上。
- **复制现有连接**。您可以通过右键单击并选择Duplicate来复制现有的数据源连接。

### 管理数据源元数据 <div id="page_51"></div>

Tableau中的数据源存储有关连接的信息。除了连接本身（例如，数据库服务器名称，数据库和/或文件名）之外，数据源还包含有关所有可用字段的信息（例如字段名称，数据类型，默认格式，注释和别名） 。通常，*有关该数据的该数据*称为**元数据**。

右键单击数据窗格中的字段会显示一个元数据选项菜单。其中一些选项将在以后的练习中进行演示；其他内容将在整本书中进行说明。这些是通过右键单击可用的一些选项：

- 重命名领域
- 隐藏领域
- 更改尺寸值的别名（日期字段除外）
- 创建计算的字段，组，集，箱或参数
- 分裂领域
- 将日期或数字字段的默认用法更改为离散或连续
- 将字段重新定义为维度或度量
- 更改字段的数据类型
- 分配领域的地理角色
- 更改字段在可视化中的显示方式的默认值，例如默认的颜色和形状，数字或日期格式，排序顺序（用于尺寸）或聚合类型（用于度量）
- 为字段添加默认注释（将鼠标悬停在数据窗格中的字段时将显示为工具提示，或者从菜单中选择“ 描述...”时将显示为说明的一部分）
- 在层次结构中添加或删除字段

*与字段的可视显示相关的元数据选项（例如默认排序顺序或默认数字格式）定义了字段的整体默认值。**但是，可以通过右键单击架子上的活动字段并选择所需的选项来覆盖任何单个视图中的默认设置。*

要查看其工作原理，请使用在“ 连接到Google表格”视图中创建的“ 按**州**划分的**利润** ”填充地图视图。如果未创建此视图，则可以使用“ 订单和退货”数据源，尽管结果视图将略有不同。将填充的地图摆在您面前，请按照以下步骤操作：

1. 右键单击Profit数据窗格中的字段，然后选择默认属性 | 数字格式...。出现的对话框为您提供了许多数字格式选项。
2. 将数字格式设置为使用小数位数的货币（自定义）。单击“ 确定”后，您应该注意到地图上的标签已更新为包括货币符号。0
3. Profit再次右键单击该字段，然后选择默认属性 |。颜色...。出现的对话框为您提供了选择和自定义Profit字段默认颜色编码的选项。试用各种调色板和设置。请注意，每次单击“ 应用”按钮，可视化都会更新。

*分散调色板（从一种颜色混合到另一种颜色的调色板）特别适合诸如的字段**Profit**，该**字段* *可以具有负值和正值。**默认中心为**0**，您可以根据显示的颜色轻松判断正值或负值。*

![img](../images/Image%20[37].jpg)

由于您已在数据源级别为该字段设置了默认格式，因此您使用创建的任何其他视图Profit将包括您指定的默认格式。

*考虑在可视化中使用色盲安全色。**通常认为橙色和蓝色是红色和绿色的一种色盲安全替代品。**Tableau还包括一个离散的色盲安全调色板。**此外，请考虑调整颜色的强度。*

### 使用抽取而不是实时连接 <div id="page_52"></div>

大多数数据源都允许连接实时数据或提取数据。但是，某些基于云的数据源需要提取。相反，无法提取OLAP数据源并且需要实时连接。

使用实时连接时，Tableau会直接向数据源发出查询（或在可能的情况下使用缓存中的数据）。提取数据时，Tableau将从原始源中提取部分或全部数据并将其存储在提取文件中。在10.5版之前，Tableau使用Tableau数据提取（.tde）文件。从版本10.5开始，Tableau使用超级提取（.hyper），并在您更新较旧的工作簿时将.tde文件转换.hyper为。

摘录扩展了Tableau处理数据的方式。考虑下图：

![img](../images/Image%20[38].jpg)

Tableau如何处理数据的基本范例没有改变，但是您会注意到Tableau现在正在从提取中查询并获取结果。可以再次从源中检索数据以刷新提取。因此，每个提取都是最新刷新时数据源的快照。提取物具有便携性和高效性的优点。

#### 创建抽取 <div id="page_53"></div>

提取可以通过多种方式创建，如下所示：

- 如下所示在“ 数据源”屏幕上选择“ 提取 ” 。该编辑...链接将允许您配置的摘录：

![img](../images/000321.gif)

- 从“ 数据”菜单中选择数据源，或在数据窗格上右键单击数据源，然后选择“ 提取数据...”。如下面的屏幕快照所示，您将有机会设置摘录的配置选项：

![img](../images/Image%20[39].jpg)

- 开发人员可以使用Tableau Data Extract API创建抽取。该API允许您使用Python或C / C ++以编程方式创建提取文件。这种方法的详细信息超出了本书的范围，但是可以在Tableau的网站上随时获得文档。
- 某些工具（例如Alteryx或Tableau Prep）能够输出Tableau提取。

首次创建或随后配置提取时，将提示您选择某些选项，如下所示：

![img](../images/Image%20[40].jpg)

配置摘录时，您具有很多控制权。以下是各种选项，以及您的选择将对性能和灵活性产生影响：

- 您可以选择添加**提取**过滤器，以将**提取**限制为原始源的子集。只有在这个例子中，记录，其中Region为**中央**或**南**哪里Category是**办公设备**将被列入提取物。
- 您可以通过选中复选框来汇总摘录。这意味着数据将被汇总到可见维度的级别，并可选地汇总到指定的日期级别，例如年或月。

**可见** **字段***是数据窗格中显示的***字段***。**您可以**通过右键单击字段并选择**隐藏，**从***数据源***屏幕或数据窗格中**隐藏**字段**。**如果在工作簿的任何视图中使用了该字段，则将禁用此选项。**Hidden**字段不可用于视图中。**Hidden**只要在创建或优化提取之前将其隐藏，字段就不会包含在提取中。*

- 在前面的示例中，如果只有Region和Category维度可见，则所得提取将仅包含两行数据（一行用于**Central**，另一行用于**South**）。此外，任何度量都将在Region/ Category级别汇总，并将针对“ **提取”**  过滤器进行。例如，Sales将被卷起来销售的总和**Ç** **entral** / **办公设备**和**南** / **办公设备**。所有度量均根据其默认聚合进行聚合。
- 您可以通过包含数据集中的所有行或对前**N**行的采样来调整摘录中的行数。如果选择所有行，则可以指示增量刷新。如果源数据以增量方式添加记录，并且您具有诸如身份列或日期字段之类的字段，可在添加新记录时可靠地用来标识新记录，则增量提取可以使您将这些记录添加到提取中而无需重新创建整个提取物。在前面的示例中，**行ID**高于上一次提取刷新的最大值的所有新行将包含在下一个增量刷新中。

*增量刷新可能是处理随时间增长的大量数据的好方法。**但是，请谨慎使用增量刷新，因为增量刷新只会根据您指定的字段添加新的数据行。**您将不会对现有行进行任何更改，如果在源中删除了行，也不会删除它们。**如果增量字段的值小于现有提取中的最大值，那么您还将错过任何新行。*

#### 使用抽取 <div id="page_54"></div>

使用提取的任何数据源都将带有一个独特的图标，指示数据已从原始源提取到提取中，如以下屏幕截图所示：

![img](../images/Image%20[41].jpg)

提取前一个数据窗格中的第一个数据连接，而不提取第二个。创建抽取后，您可以选择是否使用抽取。当你右键点击（或数据源的数据从菜单，然后将数据源），你会看到下面的菜单选项，在这个截图所示：

![img](../images/Image%20[42].jpg)

1. 刷新：数据源下的“ 刷新”选项只是告诉Tableau刷新本地数据缓存。使用实时数据源，这将重新查询基础数据。使用提取的源时，将清除缓存并重新查询提取，但是此“ 刷新”选项不会更新原始源中的提取。为此，请使用“ 提取”子菜单下的“ 刷新 ” （请参阅此列表中的第4步）。
2. 提取数据...：这将从数据源中创建新的提取（如果存在，则替换现有的提取）。
3. 使用提取：如果有给定数据源的提取，则启用此选项。取消选中该选项将告诉Tableau使用实时连接而不是数据提取。摘录将不会被删除，可以随时通过选中此选项来再次使用。如果原始数据源不可用于该工作簿，则Tableau将询问在哪里找到它。
4. 刷新：此“ 刷新”选项使用原始来源的数据刷新提取。对于您所做的某些更改（例如隐藏字段或创建新的计算），它不会优化提取。
5. 从文件追加数据...：：如果其他文件具有与原始源相同的确切数据结构，则此选项允许您将其他文件追加到现有提取中。这会将行添加到现有的摘录中；它不会添加新列。
6. 优化：这将根据您自最初创建提取文件以来所做的更改重新构造提取文件，以使其尽可能高效。例如，某些计算字段可能会**实现**（即计算一次，以便可以存储结果值），并且将从提取中删除新隐藏的列或删除的计算。
7. 删除：这将删除提取的定义，可以选择删除提取文件，并恢复到原始数据源的实时连接。
8. 历史记录：这使您可以查看摘录和刷新的历史记录。
9. 属性：这使您可以查看提取的属性，例如位置，基础源，过滤器和行限制。

#### 性能 <div id="page_55"></div>

在10.5之前，Tableau Data Extracts（.tde 文件）是非常高效的柱状数据库，在Tableau数据引擎中运行良好。在Tableau 10.5中，Tableau引入了Hyper数据引擎，该引擎显示出显着的性能提升，尤其是对于大型数据集。无论.tde和.hyper提取将执行比大多数传统的现场数据库连接速度更快。这是基于以下几个因素：

- 超提取利用OLTP和OLAP模型的混合，引擎确定最佳查询。Tableau数据提取是纵栏式的，而且查询效率很高。
- 提取程序具有结构性，因此可以将它们快速加载到内存中，而无需进行其他处理，并且可以在内存和磁盘存储之间移动，因此其大小不受可用RAM数量的限制。
- 在摘录中实现了许多计算字段。与每次执行查询时执行计算相比，通常可以更快地读取提取物中存储的预计算值。超提取通过潜在地实现许多聚合来扩展此范围。

您可以选择使用提取来提高传统数据库的性能。为了最大程度地提高性能，请考虑以下操作：

- 在创建提取之前，隐藏未使用的字段。如果创建了所有所需的可视化，则可以单击提取对话框上的“ 隐藏未使用的字段”按钮以隐藏所有视图或计算中未使用的所有字段。
- 如果可能，请使用原始来源的数据子集。例如，如果您具有最近10年的历史数据，但仅需要最近两年进行分析，则可以按“ 日期”字段过滤提取的数据。
- 在创建或编辑计算所得的字段，或删除或隐藏字段之后优化提取。
- 将提取程序存储在固态驱动器上。

#### 便携性和安全性 <div id="page_56"></div>

假设您的数据托管在只能从办公室网络内部访问的数据库服务器上。通常，您必须在现场或使用VPN来处理数据。通过摘录，您可以随身携带数据并脱机工作。

提取文件包含从源提取的数据。保存工作簿时，可以将其另存为Tableau工作簿（.twb）文件或Tableau打包工作簿（.twbx）文件。工作簿（.twb）包含所有连接，字段，可视化文件和仪表板的定义，但不包含任何数据或外部文件，例如图像。保存打包的工作簿（.twbx）时，所有摘录和外部文件都与工作簿一起打包在一个文件中。

可以使用Tableau Desktop，Tableau Reader打开使用抽取打包的工作簿，并将其发布到Tableau Public或Tableau Online。

*打包的工作簿文件（**.twbx**）实际上只是一个压缩**.zip**文件。**如果将扩展名从重命名**.twbx**为**.zip**，则可以像访问其他任何**.zip**文件**一样访问内容**。**您也可以考虑将**.twbx**扩展名与ZIP实用程序**相关联，**这样就不必重命名文件。*

使用抽取时，需要牢记两个安全注意事项：

- 提取使用一组凭据进行。创建抽取后，任何根据使用的凭据限制可以访问哪些数据的安全层都将无效。摘录不需要用户名或密码。任何人都可以读取摘录中的所有数据。
- 即使在可视化文件中未显示数据，也可以访问提取文件（.hyper或.tde）或打包的工作簿（.twbx）中包含的可见（非隐藏）字段的任何数据。请特别注意限制对包含敏感或专有数据的摘录或打包工作簿的访问。

故事讲述了一位员工向公司中的其他人发送了包含人力资源数据的打包工作簿。即使所有仪表板都未显示敏感数据，但摘录仍包含其中。不久，公司中的每个人都知道了其他人的薪水，原来的个人不再是雇员。

#### 何时使用抽取 <div id="page_57"></div>

在确定是否使用提取物时，应考虑各种因素。在某些情况下，您将没有选择（例如，OLAP需要实时连接，而某些基于云的数据源则需要摘录）。在其他情况下，您将需要评估您的选择。

通常，在以下情况下使用抽取：

- 与实时连接相比，您需要更好的性能。
- 您需要数据是可移植的。
- 您需要使用数据库数据引擎不支持的功能（例如， MEDIAN与SQL Server的实时连接不支持这些功能）。
- 您要共享打包的工作簿。如果要与使用免费Tableau Reader的人共享打包的工作簿，则尤其如此，后者只能读取提取了数据的打包的工作簿。

通常，当您具有以下任何一种使用情况时，请不要使用抽取：

- 您拥有某些用户不应该访问的敏感数据，或者您无法控制谁可以访问摘录。但是，您可以在创建提取之前隐藏敏感字段，在这种情况下，它们不再是提取的一部分。
- 您需要基于登录凭据来管理安全性。（但是，如果您使用的是Tableau Server，则仍可以使用Tableau Server上托管的提取连接，这些连接通过登录进行保护。我们将在[第12章](docs/Book.md#page_255)， *共享数据故事中*考虑与Tableau Server共享您的工作）。
- 您需要查看实时更新的源数据中的更改。
- 大量的数据使构建提取所需的时间变得不切实际。在合理的时间内可以提取的记录数取决于诸如字段的数据类型，字段数，数据源的速度和网络带宽之类的因素。超级引擎通常.hyper比旧.tde文件的生成速度快得多。

### Tableau文件类型 <div id="page_58"></div>

除了前面提到的文件类型之外，还有许多其他与Tableau相关的文件类型。以下是一些Tableau文件类型：

- .tbm：一个Tableau书签文件-一个XML文件，其中包含单个视图的静态快照和相关数据源的定义。现在可以将工作表从一个工作簿复制并粘贴到另一个工作簿，因此基本上不需要此文件类型。您可以创建书签并将其从“ 窗口”菜单导入到其他工作簿中。
- .hyper：超级提取—一个二进制文件，其中包含从其他来源提取的数据。这是Tableau 10.5和更高版本使用的提取格式，该格式利用了速度更快且可伸缩的超级引擎。
- .tde：Tableau数据提取—一个二进制文件，其中包含从其他来源提取的数据。该.tde文件本身不包含有关原始数据源的信息。10.5之前的版本使用Tableau Data Extract。Tableau 10.5和更高版本可以读取.tde文件，但是在大多数情况下，它们会将它们更新为新.hyper格式。
- .tds：Tableau数据源文件-一个XML文件，其中包含数据源的定义（服务器名称，文件路径等），但不包含数据。您可以.tds通过右键单击数据源并选择添加到保存的数据源来将数据源导出为文件。目录中的所有.tds文件My Tableau Repository Data Sources都会在主屏幕上显示为数据连接快捷方式。
- **.**tfl：Tableau Flow文件-定义Tableau Prep流的文件。Tableau Desktop无法读取此文件类型。
- .tflx：打包的Tableau Flow文件-一个压缩.zip文件，包含该.tfl 文件以及该流的基于文件的数据源的摘要。Tableau Desktop无法读取此文件类型。
- .tdsx：Tableau数据源提取的文件-一个压缩文件，其中包含数据源的定义以及数据的提取。您可以使用与创建.tds文件相同的方式来创建打包数据源，选择.tdsx作为文件类型。
- .tld/.tlf/.tlq/.tlr：一个Tableau许可证文件—Disconnected / File/ Request/ Return/ Response文件类型用于许可证激活。
- .tms：Tableau Map Source文件-一种XML文件类型，用于指定Tableau可用的地图服务和配置。
- .tmsd：Tableau Map Source Defaults文件-一个XML文件，其中包含地图服务的默认值
- .tps：Tableau首选项-一个XML文件，其中包含Tableau Desktop的首选项默认值，包括UI元素和调色板。
- .tsvc：Tableau Atom服务文件类型。
- .twb：阿的Tableau工作簿-包含所有片材的定义，数据源，偏好和格式化的XML文件。它不包含任何数据。
- .twbx：Tableau打包的工作簿-一个压缩文件，其中包含Tableau工作簿（.twb）文件以及所有数据提取（.tde）和任何其他外部文件（例如，未提取数据源的图像或文本/ Excel文件）。

### 连接和融合 <div id="page_59"></div>

联接表和混合数据源是在Tableau中将相关数据链接在一起的两种不同方式。执行**联接**以逐行将数据表链接在一起。**共混物**被执行以在一起的多个数据源在总体水平联系起来。

#### 联接表 <div id="page_60"></div>

大多数数据库都有多个以某种方式相关的数据表。此外，使用Tableau 10及更高版本，您可以跨许多数据源的各种数据连接将数据表连接在一起。正如我们将看到的，Tableau相对容易地使将数据表联接在一起非常容易。

例如，考虑如下表：

![img](../images/000065.gif)

主表是“ **医院就诊”**表，该表记录了患者每次去**医院**的记录，并包含诸如入院类型（例如住院，门诊和急诊室）等详细信息。它还包含将访问链接到**主治医师**，**患者**和**出院详细信息的**关键字段。

当您连接到Tableau中的数据库时，您将看到左侧列出的表，并且可以选择将它们拖放到数据源设计器中。

*通常，您首先需要将主表拖到设计器中。**在这种情况下，“* **医院访问”***包含用于联接其他表的键。**这些表应拖放到主表之后。*

如果在数据库中定义了关键字段和关系，则当您添加其他表时，Tableau将自动创建联接。否则，它将尝试匹配字段名称。无论如何，您都可以根据需要调整连接。当放到设计器中时，上述表格将与下图相似：

![img](../images/Image%20[43].jpg)

您可以通过单击表之间的小图来调整连接。该图指示使用哪种连接。例如，“ **医院就诊”**和“ **患者”**之间的**联接**是“ **内部联接”，**因为假定每次访问都将有一个患者，每个患者都将有一个**就诊**。但是，“ **医院就诊”**与“ **出院详细信息”**之间的连接是左连接，因为“ **医院就诊”中的**某些记录可能是针对仍在医院中的患者（因此他们尚未出院）。

单击该图将允许您选择其他类型的联接，并定义哪些字段是联接的一部分。

您可以指定以下类型的联接：

- **内部**：仅保留左侧表和右侧表中符合连接条件的记录。在以下示例中，结果中仅保留三个匹配行：

![img](../images/Image%20[44].jpg)

- **左**：将保留左侧表中的所有记录。右侧表中的匹配记录将在结果表中具有值，而不匹配的记录将包含NULL右侧表的所有字段的值。在以下示例中，左侧表的五行保留了NULL不匹配的右侧值的结果：

![img](../images/000143.gif)

- **右**：将保留右表中的所有记录。左侧表中的匹配记录将产生值，而不匹配的记录中将包含NULL左侧表的所有字段的值。并非每个数据源都支持右连接。如果不支持，则该选项将被禁用。在以下示例中，右侧表的五行保留了NULL不匹配的左侧值的结果：

![img](../images/000098.gif)

- **全部外部**：将保留双方表中的所有记录。匹配的记录将具有左右两边的值。不匹配的记录将具有NULL未找到左侧或右侧匹配记录的值。并非每个数据源都支持完整的外部联接。如果不支持，则该选项将被禁用。在以下示例中，所有行都从两侧保留NULL有未找到匹配项的值：

![img](../images/000053.gif)

#### 跨数据库联接 <div id="page_61"></div>

使用Tableau，您可以跨多个不同的数据连接（在行级别）联接。跨不同数据连接的联接称为**跨数据库**联接。例如，您可以将SQL Server表与文本文件或Excel文件联接，或者将一个数据库中的表与另一个数据库中的表联接，即使这些表位于不同的服务器上。这为补充数据或分析来自不同来源的数据提供了各种可能性。

考虑前面提到的医院数据。计费数据与患者护理数据位于不同的系统中并不少见。假设您有一个用于患者账单的文件，其中包含要包含在对医院就诊分析中的数据。您可以通过将文本文件添加为数据连接，然后将其连接到现有表来完成此操作，如下所示：

![img](../images/Image%20[45].jpg)

您会注意到，“ 数据源”屏幕上的界面包含一个“ 添加”链接，该链接可让您向数据源添加数据连接。单击每个连接将允许您将表从该连接拖放到数据源设计器中，并根据需要指定连接。每个数据连接都将进行颜色编码，以便您可以立即在设计器中识别各种表的来源。

在前面的示例中，该 Patient Billing.txt 文本文件 已从SQL Server 连接到Patient表。

*对于所有联接，包括跨数据连接联接，您将需要确保表之间具有相同的共享字段。**例如，加入**Patient Billing.txt**到**Patient**表中，将需要某种形式的患者ID或可匹配账号。**跨数据库联接还要求数据类型相同。**如果需要，**可以使用***联接计算***来更改类型。*

#### 混合数据源 <div id="page_62"></div>

数据混合是Tableau中的强大功能和创新功能。它允许您在同一视图中使用来自多个数据源的数据。通常，这些来源可能是不同的类型。例如，您可以将Oracle中的数据与Excel中的数据混合。您可以将Google Analytics（分析）数据与空间文件混合。数据混合还允许您比较不同详细程度的数据。数据混合的一些先进的应用将覆盖[第8章](docs/Book.md#page_185)，*深入研究：趋势，聚类，分布和预测*。现在，让我们考虑基础知识和简单示例。

数据混合是在聚合级别完成的，涉及到发送到每个数据源的不同查询，与联接不同，联接是在行级别完成的，并且涉及到对单个数据源的单个查询。一个简单的数据混合过程涉及几个步骤，如下图所示：

![img](../images/Image%20[46].jpg)

从上图可以看到以下内容：

- Tableau向主数据源发出查询。
- 基础数据引擎返回汇总结果。
- Tableau向辅助数据源发出另一个查询。该查询是根据从主数据源返回的用于链接两个数据源的维的值集进行过滤的。
- 基础数据引擎从辅助数据源返回汇总结果。
- 来自主数据源的汇总结果和来自辅助数据源的汇总结果在缓存中混合在一起。

重要的是要注意数据混合与联接有何不同。联接在单个查询中完成，结果逐行匹配。数据混合是通过发出两个单独的查询，然后将汇总结果混合在一起而发生的。

只能有一个主要来源，但可以有任意多个次要来源。对于每个辅助来源，将重复步骤3和步骤4。返回所有聚合结果后，Tableau将基于链接字段匹配聚合行。

*当您在Tableau工作簿中有多个数据源时，在视图中首先使用的那个数据源将成为该视图的主要源。*

*混合是特定于视图的。**您可以在一个视图中将一个数据源作为主数据源，而在另一个视图中将其作为辅助数据源。**可以在混合中使用任何数据源，但是必须使用OLAP多维数据集（例如SSAS）作为主要源。*

**链接字段**是用于匹配主要和次要数据源之间混合的数据的维。链接字段定义了辅助来源的详细程度。如果字段在数据源之间按名称和类型匹配，则将自动分配链接字段。否则，您可以通过从菜单中选择数据 |手动分配字段之间的关系。 编辑关系，如下所示：

![img](../images/Image%20[47].jpg)

“ 关系”窗口将显示不同数据源之间识别的关系。您可以从“ 自动”切换到“ 自定义”以定义自己的链接字段。

可以激活或禁用链接字段以在视图中进行融合。默认情况下，视图中使用的链接字段通常会处于活动状态，而其他字段则不会。但是，您可以通过单击“ 数据”窗格中链接字段旁边的链接图标来更改链接字段是否处于活动状态。

*此外，使用“* *编辑数据关系”**屏幕来定义将用于***跨数据源过滤器***的字段，这些字段将**在下一节（“* *过滤”**）中**进行讨论**。*

##### 一个混合的例子 <div id="page_63"></div>

以下屏幕截图显示了一个实际的数据混合示例：

![img](../images/Image%20[48].jpg)

在此工作簿中定义了两个数据源连接，一个用于Superstore数据，另一个用于Superstore Sales Goals。所述Superstore数据源是在此视图（用蓝色勾选指示）主数据源和Superstore Sales Goals是第二源（由橙色复选标记指示）。来自辅助数据源的视图中的活动字段也用橙色的选中标记图标指示。

该Sales度量已从主要来源和Goals次要来源使用。在这两种情况下，该值都是合计的。的State尺寸是活动的链接字段中，由橙链节图标表示旁边的数据窗格中的字段。两种度量都在州一级汇总（按州划分的销售额，按州划分的Superstore Sales目标Superstore Sales Goals），然后由Tableau根据链接字段的值进行匹配State。

*数据混合将基于链接字段的尺寸值的精确匹配进行。**请小心，因为这可能导致错过一些比赛。**您会在前面的屏幕截图的右下方注意到该指示器，该指示器指示**> 1个null**（至少一个**null**值）。*

*数据的检查表明，**State**在价值**Superstore Sales**是**哥伦比亚特区**，而这是**DC*  *的**Superstore Sales Goals**数据源。**您将需要修复数据源中的值，创建一个计算字段以更改值，或者更改一个数据源中值的别名以匹配另一个数据源中的值。**例如，您可以* *在行标题中**右键单击**“哥伦比亚特区* *”，然后选择**编辑别名...**，并将值设置为**DC。*

我们将在整本书中看到一些编辑别名的示例。请注意以下定义：

*一个***别名***为将被用于显示和数据混合的尺寸值的替代值。**可以通过右键单击行标题或使用视图或“* *数据窗格* *”中字段上的菜单**，然后选择用于编辑别名的选项**来更改尺寸的**别名。*

### 筛选数据 <div id="page_64"></div>

通常，您将需要在Tableau中过滤数据，以便对数据的子集进行分析，缩小焦点或深入研究细节。Tableau提供了多种过滤数据的方法。

如果要将分析范围限制为数据子集，则可以使用以下一种技术在源处过滤数据：

- **数据源过滤器**在所有其他过滤器之前应用，并且在您希望将分析范围限制为数据的子集时很有用。这些过滤器先于其他过滤器应用。
- **提取过滤器**限制提取（.tde或.hyper）中存储的数据。如果提取数据时存在数据源过滤器，则通常会将它们转换为提取过滤器。
- 可以使用与自定义SQL的实时连接来完成**自定义SQL筛选器**，该WHERE子句中具有Tableau参数。我们将在检查参数[第4章](docs/Book.md#page_96)， *启动和冒险计算*。

此外，您可以使用以下一种技术将过滤器应用于一个或多个视图：

- 将字段从数据窗格拖放到“ 过滤器”架子。
- 在视图中选择一个或多个标记或标题，然后选择“仅保留”或“ 排除”，如下所示：

![img](../images/000192.gif)。

- 右键点击数据窗格或视图中的任何字段，然后选择显示过滤器。过滤器将显示为控件（示例包括下拉列表和复选框），以允许视图或仪表板的最终用户更改过滤器。
- 使用动作过滤器。我们将在仪表板的上下文中进一步介绍过滤器和操作过滤器。

每个选项都将一个或多个字段添加到视图的“ 过滤器”功能区。将字段放到“ 过滤器”架子上时，将提示您定义过滤器的选项。取决于字段是离散的还是连续的，过滤器选项的差异将最为明显。将字段作为维度还是作为度量进行过滤将极大地影响过滤器的应用方式和结果。

#### 过滤离散（蓝色）字段 <div id="page_65"></div>

使用离散字段进行过滤时，将为您提供选择保留或排除单个值的选项。例如，当您将不连续的 部门  维度放到“ 过滤器”架子上时，Tableau将为您提供以下选项：

![img](../images/Image%20[49].jpg)

该过滤器选项包括通用，通配符，条件，以及顶部的标签。您的过滤器可以包含每个选项卡中的选项。在总结了上一节常规选项卡将显示选择的所有选项：

- “ 常规”选项卡允许您从列表中选择项目（如果维度包含大量需要长时间加载的值，则可以使用自定义列表手动添加项目。）您可以使用“ 排除”选项排除所选项目。
- 该通配符选项卡允许您匹配字符串值包含，首先，以结束，或完全匹配给定值。
- 使用“ 条件”选项卡，您可以根据满足条件的其他字段的汇总来指定条件（例如，保留任何部门  的总销售额大于$ 1,000,000的条件）。此外，您可以编写自定义计算以形成复杂条件。我们将更多的覆盖计算在[第4章](docs/Book.md#page_96)，*潜水深度与表计算*。
- “ 顶部”选项卡允许您将过滤器限制为仅顶部或底部。例如，您可能决定只保留销售总额中的前五项。

*离散量度（使用表计算的计算字段除外）无法添加到“* *过滤器”功能区**。**如果该字段包含日期或数字值，则可以在过滤之前将其转换为连续字段。**其他数据类型将需要创建一个计算字段，以将您希望过滤的值转换为连续的数值。*

#### 过滤连续（绿色）字段 <div id="page_66"></div>

如果将连续尺寸放置到“ 过滤器”架子上，则会得到不同的选项集。通常，首先会提示您如何过滤字段，如下所示：

![img](../images/Image%20[50].jpg)

这里的选项分为两个主要类别：

- 所有值：过滤器将基于字段的每个单独值。例如，仅使销售额保持在$ 100以上的“ 全值”过滤器将评估基础数据的每条记录，并仅使个体销售额保持在$ 100以上。
- **聚合**：过滤器将基于指定的聚合（例如， 萨姆，平均，最小，最大，标准 偏差， 和 方差）和聚合将在视图的细节水平来执行。例如，一个过滤器仅在类别级别的视图上将销售总额保持在100,000美元以上，则将仅保留总销售额至少100,000美元的类别。

做出选择后（或者如果选择不适用于所选字段），将为您提供另一个界面，用于设置实际过滤器，如下所示：

![img](../images/Image%20[51].jpg)

在这里，您将看到用于基于具有开始和/或结束的范围过滤连续值的选项。“ 特殊”选项卡提供用于显示所有值，NULL值或非NULL值的选项。

#### 筛选日期 <div id="page_67"></div>

我们就来看看特殊的方式在经济表处理日期*可视化日期和时间*的部分[第3章](docs/Book.md#page_70)， *冒险到高级可视化*。现在，请考虑将Order Date字段放到“ 过滤器”架子上时可用的选项 ，如下所示：

![img](../images/Image%20[52].jpg)

这里的选项包括：

- 相对日期：此选项可让您根据特定日期过滤日期（例如，保留从今天开始的最后三周，或从1月1日开始的最后六个月）。
- 日期范围：此选项可让您根据包含开始日期和/或结束日期或两者兼有的范围来过滤日期。
- **日期部分**：此选项可让您根据日期的离散部分（例如年，月，日或部分组合，例如月/年）进行过滤。
- 单个日期：此选项使您可以基于数据中日期字段的每个单独值进行过滤。
- 计数 或计数（不重复）：此选项可让您根据数据中日期值的计数或不重复计数进行过滤。

#### 其他过滤选项 <div id="page_68"></div>

在进行过滤时，您还需要注意以下选项：

- 通过右键单击并选择显示过滤器，可以显示几乎所有字段的过滤器控件。控件的类型取决于字段的类型，无论它是离散的还是连续的，都可以使用过滤器控件右上角的小下拉箭头进行自定义。
- 可以将过滤器添加到**Context中**。首先评估添加到上下文中的所有过滤器，然后将其视为数据的子集。其他过滤器和计算（例如，计算集和固定的详细程度计算）基于数据的子集。例如，如果您希望过滤到前五名客户，但又希望能够首先过滤到特定区域，这将很有用。将Region设置为上下文过滤器可确保在Region过滤器的上下文中计算前五个过滤器。
- 可以设置过滤器以显示数据库中的所有值，上下文中的所有值，层次结构中的所有值或仅基于其他过滤器相关的值。这些选项可通过“ 过滤器”控件上的下拉菜单使用。
- 默认情况下，“ 过滤器”功能区上放置的任何字段都定义特定于当前视图的过滤器。但是，您可以使用“ 筛选器 ”功能区上的字段菜单来指定范围。选择“ 应用于”，然后选择以下选项之一：

- 所有相关的数据源：所有数据源将按指定的值进行过滤。字段的关系与混合相同（即，默认名称和类型匹配，或通过“ 数据” |“ 编辑关系...”菜单选项自定义）。使用任何相关数据源的所有视图都将受到过滤器的影响。此选项有时称为**跨数据源过滤**。
- 当前数据源：该字段的数据源将被过滤。使用该数据源的任何视图都将受到过滤器的影响。
- 选定的工作表：使用该字段的数据源选择的任何工作表都将受到过滤器的影响。
- 当前工作表：仅当前视图将受到过滤器的影响。

- 使用Tableau Server时，您可以定义用户过滤器，以通过基于用户凭据的过滤来提供行级安全性。

### 总结 <div id="page_69"></div>

本章介绍了Tableau如何处理数据的关键概念。尽管您通常不会担心Tableau会生成什么查询来查询基础数据引擎，但是对Tableau的范例有深入的了解将在您分析数据时极大地帮助您。

我们查看了到不同数据源的不同连接的多个示例，考虑了使用数据提取的好处和潜在的弊端，考虑了如何管理元数据，深入研究了联接和混合的细节，最后介绍了过滤数据的选项。

处理数据对于您在Tableau中所做的一切至关重要。当您开始进行更深入的分析和更复杂的可视化时（例如下一章中介绍的内容），了解连接到各种数据源，使用提取，自定义元数据以及联接和混合之间的区别将是关键。

## 第三章 冒险进入高级可视化 <div id="page_70"></div>

现在，您就可以着手设计高级可视化了！Advanced不一定意味着困难，因为Tableau使许多可视化易于创建。高级也不一定意味着复杂。目的是传达数据，而不是使数据不必要地复杂。

而是，这些可视化在某种意义上是高级的，您需要了解何时应使用它们，它们为何有用以及如何利用Tableau的功能来创建它们。另外，我们将看到的许多示例将介绍一些高级技术，例如计算，以扩展基础可视化的实用性。这些技术中有许多将在以后的章节中进行全面开发，因此不必担心现在就尝试吸收每个细节。

本章中的大多数示例都是经过精心设计的，以便您可以继续学习。但是，不要简单地记住一组说明。相反，请花一些时间来了解您放置在不同架子上的不同字段类型的组合如何改变标题，轴和标记的呈现方式。尝试甚至不时偏离说明，只是想看看还有什么可能。您始终可以使用Tableau的后退按钮再次遵循该示例！

在本章中，可视化将分为以下主要类别：

- 比较方式
- 日期和时间
- 整体的一部分
- 发行版
- 多轴

您可能已经注意到前面的列表中缺少空间位置或地理类别。映射年推出的 [第1章](docs/Book.md#page_21)，*高级可视化，技术，技巧，和技巧*。

您可以使用Chapter 03 Starter.twbx工作簿来重新创建本章中找到的示例，甚至可以使用空白工作簿并连接到Hospital Visits.csv文件Learning Tableau/Chapter 03夹中的文件从头开始。完整的示例可以在Chapter 03 Complete.twbx工作簿中找到。

### 比较值 <div id="page_71"></div>

通常，您将需要比较不同类别的测量值之间的差异。您可能会发现自己在问以下问题：

- 每家商店为多少客户提供服务？
- 每个风电场产生多少能量？
- 每位医生看了多少患者？

在每种情况下，您都希望在一些定量测量（客户数量，兆瓦电和患者数量）方面进行比较（在商店，风电场或医生之间）。

#### 条形图 <div id="page_72"></div>

下面是一个简单的柱状图，类似于我们建在一个[第1章](docs/Book.md#page_21)，*以砍掉的Tableau*：

![img](../images/Image%20[53].jpg)

此条形图使您可以轻松比较医院各个部门之间的患者就诊次数。作为维度，Department根据每个不同的值如切片数据ER，ICU或Cardiology。它为这些值创建标题，因为它是离散的（蓝色）。作为一种度量，Number of Patient Visits给出每个部门的患者就诊总数。因为它是一个连续的（绿色）字段，所以它定义了一个轴，并渲染了条形图以使值可视化。

请注意，条形图是按部门进行排序的，患者就诊的总数最高，而底部最低。对条形图进行排序通常会为分析增加很多价值，因为它使进行比较和查看排名顺序变得更加容易。例如，很容易看出**微生物****科比营养**科有更多的患者就诊。如果未对图表进行排序，则可能不那么明显。

您可以通过多种方式对视图进行排序，如下所示：

- **单击工具栏上的排序图标之一**：这将根据定义轴的度量对尺寸进行自动排序。导致新顺序的数据更改或筛选将反映在视图中：

![img](../images/000289.gif)

- **单击轴上的排序图标**：当您将鼠标悬停在轴上时，选项图标将变为可见，然后在启用排序时保留在原处。这也将导致自动排序：

![img](../images/Image%20[54].jpg)

- **使用活动维度字段上的下拉列表，** 然后选择排序以查看和编辑排序选项。您也可以选择清除排序以删除任何排序：

![img](../images/Image%20[55].jpg)

- **拖放行标题**以手动重新排列它们。这将导致无法通过数据刷新来进行手动排序。

这些排序方法中的任何一种都特定于视图，并且将覆盖您在元数据中定义的任何默认排序。

#### 条形图变化 <div id="page_73"></div>

基本条形图可以通过多种方式扩展以实现各种目标。考虑以下变化：

- 项目符号图显示实现目标，指标或阈值的进度
- 条形图显示目标的进度或比较类别中的两个特定值
- 突出兴趣类别

##### 项目符号图与目标，目标或阈值进行比较 <div id="page_74"></div>

甲**子弹图形**（有时也称为**子弹图表**）是一个伟大的方式直观地比较与一个目标，目标，或阈值的量度。条形表示测量值，而线形表示目标。Tableau还默认设置为阴影以指示距目标或阈值的距离的**60％**和**80％**。该线和阴影是可以调整的参考线（我们将在以后的章节中详细探讨）：

![img](../images/000149.gif)

假设医院管理部门已经设定了一些服务时间目标，即患者到达医院与开始接受护理之间的分钟数。主管部门知道每个部门都有独特的功能和要求，因此他们为每个部门定义了不同的目标，如下所示：

![img](../images/Image%20[56].jpg)

您可以在电子表格中维护这些目标（此处Hospital Goals.xlsx位于Chapter 03 文件夹中）。您的目标是创建一个可视化文件，以显示每个部门的实际平均水平，并将其与管理部门设定的目标进行比较。

我们将使用Chapter 3工作簿构建项目符号图，该工作簿包含“ 医院就诊” 和“ 医院目标” 电子表格数据源。按照以下步骤，我们将使用这两个数据源来可视化实际和目标服务分钟之间的关系：

1. 导航至“ 平均 服务时间”（子弹图）表。
2. 使用 Hospital Visits 数据源，创建平均的基本条形图 Minutes to Service 每 Department。（提示：使用“ 行 ” 字段上的下拉箭头选择“ 度量 | 平均”。这将设置适当的聚合）。Minutes to Service
3. Department 从最高到最低 排序。此时，您的视图应如下所示：

![img](../images/Image%20[57].jpg)

1. 在左侧数据窗格中，选择Hospital Goals数据源，然后单击以Minutes to Service Goal在“度量”下的数据窗格中选择字段。

1. 打开“ 向我显示”，然后选择项目符号图。此时，Tableau将使用视图中的Minutes to Service Goal字段和您选择的字段创建项目符号图。您将观察到该Department字段已在数据混合中用于链接两个数据源，并且已启用该Department字段，因为在视图中使用了该字段：

![img](../images/Image%20[58].jpg)

*当您使用“* *向我展示”**来创建项目符号图表时，有时您可能会发现Tableau使用的字段与期望的使用顺序相反（错误的度量定义了坐标轴和条形图，而其他定义了参考线）。**如果发生这种情况，只需右键单击轴并选择“* *交换参考线字段”**。*

使用项目符号图表，可视地标注超出阈值的条形会很有帮助。我们将在下一章中深入研究计算，但是现在，您可以通过以下步骤完成此示例：

1. 单击 Hospital Visits 数据源以将其选中。
2. 在根据数据窗格中右键单击空白处尺寸或措施，并选择创建计算领域。
3. Over Service Time Goal?使用以下代码命名计算字段：

AVG（[服务时数]）> SUM（[医院目标]。[服务时数]）

1. 单击确定并拖动新的Over Service Time Goal？数据窗格中的字段，然后将其放在Col 或上。

如果Average Minutes to Service值大于目标值，则计算返回true ，否则返回false。使用Color上的计算字段，可以很容易地看到哪些部门超出阈值。项目符号图使您可以轻松查看哪些部门已超过了管理部门设置的阈值：

![img](../images/Image%20[59].jpg)

##### 条形图 <div id="page_75"></div>

显示每个类别的两个值之间的关系的另一种可能性是条形图。像项目符号图一样，条形图可以显示实现目标的进度，但也可以用于比较任何两个值。例如，您可以将收入与目标进行比较，或者可以将本年度与上一年的收入进行比较：

![img](../images/Image%20[60].jpg)

若要创建此视图，请在同一工作簿中继续并按照以下步骤操作：

1. 导航到“按年收入”（Bar-in-Bar）表。
2. Revenue 从 数据源拖放到视图中的水平轴上（其结果与将其拖放到“ 列”架子上的结果相同）。Hospital Visits
3. 拖放 Department Type 到Rows上。
4. 拖放 Date of Admit 到Color上。我们将在下一节中更详细地讨论日期，但是您会注意到Tableau使用日期的年份为您提供了一个堆积的条形图，如下所示：

![img](../images/Image%20[61].jpg)

1. 对于条形图，我们不希望将标记堆叠在一起。要关闭堆栈，请使用顶部菜单选择Analysis | 堆叠标记 | 关。
2. 现在，所有条形图段都从**0**开始，但是有些可能会完全重叠。要查看每个栏，我们需要调整另一个视觉元素。在这种情况下，按住*Ctrl*键的同时将“ 标记”卡中“ 颜色”YEAR(Date of Admit) 上当前 的字段拖到“ 大小”中。

*按住**Ctrl键**键，同时从一个货架移动领域到另一个创建领域的复印件。*

完成上一步后，将出现一个图例。条形将根据年份进行大小调整，即使它们重叠，我们也将看到所有可用的细分。

1. 我们希望2018年在前，而 2017  年在背景中，因此在大小图例中拖放2018以重新排列值，以便2017年在2018 年之后：

![img](../images/Image%20[62].jpg)

1. 双击**颜色**图例以编辑颜色，以便强调2018。2018年的橙色或蓝色和2019年的浅灰色将很好地达到此目的（尽管您可能会找到其他喜欢的颜色组合！）。

此时，您的视图应类似于本节开头显示的条形图。您可能希望通过执行以下操作来进一步增强可视化效果：

- 在栏上添加边框。通过单击“ **颜色”**架子并使用“ 边框”选项来完成此操作。
- 调整大小范围以减小大极端与小极端之间的差异。通过双击大小图例（或使用插入符号下拉菜单，然后从菜单中选择编辑）来完成此操作。
- 调整视图的大小。通过将鼠标悬停在画布上的底部边框上方，直到鼠标光标变为大小光标，然后单击并拖动以调整视图大小，即可完成此操作。
- 隐藏大小图例。您可能会决定尺寸图例不向该特定视图添加任何内容，因为尺寸仅用于允许重叠的条形。要隐藏任何图例，请使用图例上的下拉箭头，然后选择“ 隐藏卡片”：

![img](../images/Image%20[63].jpg)

##### 突出兴趣类别 <div id="page_76"></div>

假设您在医院的主要职责之一是监视ICU和新生儿科的患者就诊次数。您不一定要关心其他部门的细节，但是您确实想跟踪两个部门与其他部门的比较情况。您可以设计如下：

![img](../images/Image%20[64].jpg)

现在，随着时间的推移刷新数据，您将能够立即查看您感兴趣的两个部门与其他部门相比的情况。要创建此视图，请按照下列步骤操作：

[1] 导航至ICU和新生儿表。
[2] 广场 Department 上的行和 Number of Patient Visits 在列。将条形图按降序排序。
[3] 单击ICU视图中的栏，然后在*按住Ctrl*键的同时单击Neonatal栏。
[4] 将光标悬停在选定的条形上几秒钟，然后从出现的菜单中单击“ 创建组”按钮（看起来像回形针）：

![img](../images/Image%20[65].jpg)

[5] 这将创建一个组，从而Department (group)在左侧数据窗格中产生一个名为的新维度。Tableau会自动将此字段分配给Color。

> 临时组在Tableau中功能强大。您可以在视图中创建组（如前所述），也可以使用数据窗格中维的菜单并选择创建|创建。组**。**您可以像使用其他任何维度一样使用它们。

[6] 要仅将标签添加到这两个部门的条形图中，请右键单击每个条形，然后选择“ 标记标签 | 总是显示。即使为视图关闭了其他标签，或者标签与标记或其他标签重叠，也始终会显示该标签的标签。

### 可视化日期和时间 <div id="page_77"></div>

在分析中，您通常会希望了解何时发生了什么。您会问如下问题：

- 我们什么时候获得了新客户？
- 一天中什么时候通话量最高？
- 我们在销售和利润中看到哪些季节性趋势？

幸运的是，Tableau简化了这种可视化发现和分析。

#### 日期部分，日期值和确切日期 <div id="page_78"></div>

连接到平面文件，关系或提取的数据源时，Tableau可为任何日期字段提供可靠的内置日期层次结构。

*多维数据集/ OLAP连接不允许使用Tableau层次结构。**您将要确保在多维数据集中定义了所需的所有日期层次结构和日期值。*

看到这个动作，继续与Chapter 3工作簿，导航到内置日期层次 片，并产生类似于这是通过拖放所示的一个视图 Number of Patient Visits ，以行和 Date of Admit 对列。 **列**上的YEAR(Date of Admit) 字段将带有加号指示符，如下所示：

![img](../images/Image%20[66].jpg)

当您单击它时，层次结构将通过 QUARTER(Date of Admit) 在 on Columns的右侧添加来扩展，并且视图将扩展到层次结构的新级别：YEAR(Date of Admit)

![img](../images/Image%20[67].jpg)

YEAR(Date of Admit) 现在， 该字段具有减号指示符，使您可以将层次结构折叠回年份级别。该QUARTER 字段也带有加号，表示您可以进一步扩展层次结构。与今年起，层次流向如下： **年** | **季度** | **月** | **天**。当该字段是日期和时间时，您可以进一步向下钻取到**Hour** | **分钟** | **第二**。层次结构的任何部分都可以在视图内移动或完全从视图中删除。

层次结构由**日期部分**组成，**日期部分**是使用日期字段的三种方式之一。在视图中右键单击日期字段或使用下拉菜单时，您将看到多个日期选项，如下所示：

![img](../images/Image%20[68].jpg)

在菜单中可以看到三种主要的日期类型，尽管没有明确标记：

- **日期部分**：此字段将代表日期的特定部分，例如季度或月份。日期的一部分将单独使用，而不参考日期的任何其他部分。这意味着1980年11月8日的日期（用作月份日期的一部分）就是**11月**。在此处的视图中选择的**11月**代表数据集中的所有11月，而患者就诊次数是2017年和2018年的总数：

![img](../images/Image%20[69].jpg)

- **日期值**：此字段将代表日期值，但会向上滚动或截断为您选择的级别。例如，如果选择月的日期值，则2018年11月8日将被截断为月和年，即**2018年11月**。您会注意到，**2017** **年****11月**和**2018年****11月**在标题和单独的栏中分别具有单独的值：

![img](../images/Image%20[70].jpg)

- **确切日期**：此字段表示数据中的确切日期值（包括时间，如果适用）。这意味着将1980年11月8日上午2:01与1980年11月8日下午3:08区别开来。

重要的是要注意，几乎所有这些选项都可以用作离散或连续字段。日期部分 默认情况下是离散的。 默认情况下，日期值和确切日期 是连续的。但是，您可以根据需要在离散和连续之间切换，以实现可视化的灵活性。

例如，您必须具有一条轴（需要一个连续字段）才能创建参考线。此外，Tableau仅连接行或列标题最低级别的行。使用连续的日期值而不是多个离散的日期部分，将使您可以连接跨越多年，季度和月份的行。

*作为一种快捷方式，您可以右键单击日期字段，然后将其拖放到视图中，以获取选项菜单，以获取在绘制视图之前应如何使用日期字段的选项。*

#### 日期和时间可视化的变化 <div id="page_79"></div>

使用日期的各个部分和值，甚至混合和匹配它们的能力，使您在创建独特而有用的可视化文件时具有很大的灵活性。

例如，对于列使用月日期部分，而对于颜色使用年日期部分，则会得到一个时间序列，这使得逐年分析非常容易。年日期部分已复制到标签，以便可以标记行：

![img](../images/Image%20[71].jpg)

*单击***Marks***卡**上的任何架子，**将为您提供选项菜单。**在这里，* **标签***被点击，标签调整仅在每个行的末尾显示。*

以下热图是使用不同货架上的日期零件来进行有用分析的另一个示例。当查看时间的不同部分（例如一天中的小时或一个月中的几周）的模式时，这种可视化功能非常有用。在这里，我们正在按月和日查看有多少患者入院：

![img](../images/Image%20[72].jpg)

该视图未包括年份，因此这是对数据中所有年份的分析，使我们能够查看是否存在任何季节性模式或热点。我们可能会注意到与流行病，医生的日程安排或保险福利时间有关的模式。也许2月患者入院强度的增加与流感季节相对应。

请注意，在“ **颜色”**架子上放置“ **连续”**字段会导致Tableau 用编码患者访问总和的颜色阴影完全填充“ **行”**和“ **列”的**每个交点。单击**颜色**架子会为我们提供一些微调选项，包括为标记添加边框的选项。此处，添加了黑色边框以帮助区分每个单元格。

#### 甘特图 <div id="page_80"></div>

甘特图对于理解具有持续时间的一系列事件特别有用，尤其是在那些事件具有某种关系的情况下。在视觉上，它们对于确定某些事件是否比其他事件重叠，具有依赖性或花费的时间长或短非常有用。

以下**甘特图**显示了启动应用程序时运行的一系列过程。这些过程中的某些并行运行，而某些显然依赖于其他进程。在**甘特图**，使这些依赖明显：

![img](../images/Image%20[73].jpg)

要在Tableau中创建**甘特图**，可以在标记卡下拉列表中选择甘特标记类型。这将放置一个甘特条形标记，该标记从定义轴的字段所定义的值开始。然后，由**尺寸**卡上的字段定义甘特图条的长度，其中正值向右延伸，负值向左延伸。

在医院，您可能希望查看2018年每位患者去急诊室的情况，并了解每次就诊持续了多长时间，是否有患者返回医院，以及两次就诊之间的间隔时间。以下步骤提供了一个示例，说明如何创建**甘特图**以观察这些模式：

1. 将部门放在过滤器上，仅保留ER。
2. 将准入日期置于过滤器上，选择Years作为过滤选项，并仅保留2018。
3. 将准入日期作为连续的“ 确切日期”或“ 天”值（不是天部分）放置在列上。请注意，Tableau标记类型的自动默认值为甘特线：

![img](../images/Image%20[74].jpg)

1. 将患者姓名放在行上。结果是每个患者一行。甘特图条显示订单日期。在大多数情况下，我们还希望向视图添加唯一的标识符，例如s Patient ID，以确保在可视化中区分碰巧共享相同名称的患者。对于该数据集，这不是必须的，因为所有名称恰好都是唯一的，但是在处理数据时，这可能至关重要。
2. 甘特栏的长度是通过在“ 大小”架子上放置一个具有持续时间值的字段来设置的。此数据集中没有此类字段。但是，我们有排放日期，我们可以为持续时间创建一个计算字段。在下一章中，我们将更详细地介绍计算。现在，从菜单中选择“ 分析 ”，然后单击“ 创建计算字段...”。命名字段 Days in the Hospital并输入以下代码：

DATEDIFF（'day'，[录取日期]，[出院日期]）

1. 新的计算字段将出现在数据窗格的“度量”下。将字段拖放到“ 尺寸”架子上。现在，您将有一个**甘特图，**显示患者入院的时间以及每次就诊的时间。
2. 通过从视图中“ 行”上的字段的下拉菜单中选择“ 排序”，对“ 患者姓名”字段进行排序。选择以下选项：

- **排序依据**：字段
- **排序顺序**：升序
- **字段名称**：录取日期
- **汇总**：最低：

![img](../images/000297.gif)

指定这些选项后，关闭“ 排序[患者名称]”对话框。

通过排序，您可以查看较早入院的患者和较晚入院的患者。即使患者多次入院，也是基于患者的最早（最短）入院日期。排序是查看**甘特图中的**模式的非常有用的技术。您的最终视图应如下所示：

![img](../images/Image%20[75].jpg)

>在日期轴上绘制时，定义甘特图条长的字段始终需要以天为单位。如果要使用以小时或秒为单位的持续时间来可视化事件，请避免使用参数，因为该参数会计算整天，并且会损失小时和秒的精度。而是，以小时或秒为单位计算差异，然后转换回天。以下代码转换开始日期和结束日期之间的秒数，然后除以86,400，将结果转换为天，包括一天中的小数部分：

```Tableau
DATEDIFF('second', [Start Date], [End Date]) / 86400
```

### 将部分数据关联到整体 <div id="page_81"></div>

在浏览和分析数据时，您通常会想要了解各个部分如何加起来成为一个整体。例如，您将询问以下问题：

- 每种发电方式（风能，太阳能，煤炭和核能）对产生的能源总量有多少贡献？
- 每个州赚取的总利润的百分比是多少？
- 每个文件，子目录和目录在硬盘上占用多少空间？

这些类型的问题询问的是零件（生产方法，状态，文件/目录）与整体（能源总量，国内销售和硬盘）之间的关系。有几种类型的可视化和变体可以帮助您进行分析。

#### 堆积条 <div id="page_82"></div>

我们看一看在堆积条形图中[第1章](docs/Book.md#page_21)，*以砍掉的Tableau*，我们注意到一个显著的缺点：它是很难在大多数类别的比较值。除了最左侧（或最底部）的条形以外，其他条形段的起点都不同，因此长度比较起来比较困难。这并不意味着绝不能使用堆叠的条形，但应谨慎操作以确保沟通的清晰度。

在这里，我们使用堆叠的条形图来可视化整体外观。我们不太关注视觉上跨类别的比较，而更关注查看组成一个类别的部分。

例如，在医院，我们可能想知道每种类型的科室中患者的状况。也许每个患者在入院时都被分配了风险简介。我们可以将通过风险概况细分的访问次数可视化为堆积条形，如下所示：

![img](../images/Image%20[76].jpg)

这样可以很好地了解每种部门类型的访问情况。我们可以知道，访问普通科之一的人越来越多，普通科和专科门诊的高危患者数量大致相同。实验室和重症监护室发现高危患者减少，总体患者减少。但这只是故事的一部分。

考虑一个没有给出绝对值，但给出每种部门类型的百分比的堆叠条形：

![img](../images/Image%20[77].jpg)

比较前两个堆叠的条形图。从两个图表中可以明显看出，将近50％的**重症监护**患者被视为**高风险**。但是，第二张图立即使这一点显而易见。

两个图表之间的数据没有任何变化，但是第二个图表中的条形代表每种类型部门的总数百分比。您不再能够比较绝对值，但是比较每种部门类型的相对细分将变得更加容易。尽管**重症监护病房**的患者较少，但高危人群的比例更高。

让我们考虑如何在Tableau中创建上述图表，甚至将其组合为一个可视化文件。我们将使用一个快速的表计算，这将在深度覆盖在[第5章](docs/Book.md#page_121)，*潜水深度与表计算*。在这里，只需点击几下即可实现。

继续Chapter 03 工作簿，请按照下列步骤操作：

1. 通过将创建一个堆积条形图 Department Type 上的行， Number of Patient Visits 上柱，并 Patient Risk Profile 在颜色。现在，您将获得一个堆积的条形图。
2. 将条形图按降序排序。
3. 重复 Number of Patient Visits 实地列按住 *Ctrl键*的同时拖动该 Number of Patient Visits 领域的视图中的一个点上列，应立即到其当前位置的右边。或者，您可以将字段从数据窗格拖放到Columns。在这一点上，您有两个 Number of Patient Visits 轴，实际上是复制堆积的条形图：

![img](../images/Image%20[78].jpg)

1. 使用第二个 Number of Patient Visits 字段 的下拉菜单，选择快速表计算 | 占总额的百分比。该表计算对从数据源返回的值进行辅助计算，以计算总数的百分比。在这里，您将需要进一步指定应如何计算总数。
2. 使用相同的下拉菜单，选择“ 计算使用 | |”。患者风险简介。这会告诉Tableau计算给定部门内每个患者风险状况的百分比。这意味着每个部门的价值总计为100％。
3. 通过单击顶部工具栏上的T按钮打开标签。这将打开每个标记的默认标签：

![img](../images/Image%20[79].jpg)

完成上述步骤后，完成的堆叠条形图应显示如下：

![img](../images/Image%20[80].jpg)

*在单个视图中同时使用绝对值和百分比可以揭示重要的方面和细节，只有其中一个图表可能会掩盖这些方面和细节。*

#### 树状图 <div id="page_83"></div>

树图使用一系列嵌套的矩形来显示整体的一部分，尤其是在层次关系中。当您具有具有**高基数**（大量不同值）的层次结构和维度时，树图特别有用。

这是一个树形图的示例，该树形图显示了患者在医院度过的天数。最大的矩形截面显示Department Type。其中包括科室和患者：

![img](../images/Image%20[81].jpg)

要创建树形图，您只需要在“ 尺寸”架子上放置一个度量，在“  细节”架子上放置一个尺寸。您可以在细节级别添加其他尺寸以增加视图的细节。Tableau将添加不同厚度的边框，以分隔由多个尺寸创建的细节级别。请注意，在前面的视图中，您可以轻松地看到部门类型的划分，然后是部门，然后是医生，最后是个别患者。您可以通过单击颜色架子来调整最低级别的边框。

标记卡上的尺寸顺序定义了树形图对矩形进行分组的方式。此外，您可以向行或列添加尺寸，以将树图切成多个树图。最终结果实际上是树状图的条形图：

![img](../images/Image%20[82].jpg)

前面的树图不仅展示了具有多行（或列）树图的能力，还展示了在“ 颜色”架子上放置多个字段的技术。这只能通过离散字段完成。您可以在*按住Shift*键的同时将第二个字段放在颜色上来分配两种或更多种颜色。或者，可以单击Marks卡上每个字段左侧的图标或空格，以更改用于该字段的架子：

![img](../images/Image%20[83].jpg)

*树形图**以及**填充的气泡**，**词云**和其他一些图表类型被称为***非笛卡尔***图表类型。**这意味着它们绘制时没有**x**轴**或**y**轴，甚至不需要行或列标题。**要创建任何这些图表类型，请执行以下操作：*

- *确保**在行**或**列**上不使用连续字段*  
- *使用任何字段作为***大小***的度量*
- *根据所需的图表类型更改标记类型：用于树形图的正方形，用于填充气泡的圆形或用于词云的文本（在**Label**上具有所需字段**）*

#### 面积图 <div id="page_84"></div>

绘制折线图，然后填写折线下方的区域。如果有多行，则将填充区域彼此堆叠。这就是您可能想到的面积图。

事实上，在画面，你会发现很容易地创建一个折线图，就像你以前做的，然后更改的标记类型标记卡区。Color，Label或Detail架子上的任何尺寸 都将创建一片区域，这些区域将相互堆叠。“ 大小”架子不适用于面积图。

例如，考虑按时间划分的患者就诊可视化图，按医院分支细分：

![img](../images/Image%20[84].jpg)

每个频段代表一个不同的医院分支机构位置。在许多方面，该视图在美学上令人愉悦，并且确实突出了数据中的某些模式。但是，它具有与堆积条形图相同的缺点。根据轴上的值，只能读取底部带（**South**）。

其他频段则堆叠在顶部，很难进行比较。例如，很明显，每年的**2月**都有一个峰值。但是在每个分公司吗？还是较低的频段之一将较高的频段向上推？哪个频段的峰值最大？

现在，考虑以下视图：

![img](../images/Image%20[85].jpg)

此视图使用快速表格计算，类似于堆叠的条形示例。如第一个图表所示，不再可能看到峰值。但是，很容易看到，**东**分行（中带）在2018年**2月**前后看到的患者百分比急剧增加，并且直到该分行结束时，该分行继续看到大量患者。年。

通过选择其他图表类型，了解强调（或隐藏）数据故事的哪些方面非常重要。您甚至可以Chapter 3通过将第一个面积图更改为折线图来在工作簿中进行实验。您可能会注意到，您可以看到峰值，以及每个分支机构的患者访视的绝对增加和减少。每种图表类型都有助于数据故事的某个方面。

*您可以通过更改**Marks* *卡**架子上尺寸的排序顺序来定义区域的堆叠顺序**。**此外，您可以通过在“* **颜色图例”中***拖放它们来重新排列它们，**以进一步调整顺序。*

#### 饼状图 <div id="page_85"></div>

饼图也可以用于显示零件之间的整体关系。要在Tableau中创建饼图，请将标记类型更改为Pie。这将为您提供一个角度架，可用于对度量进行编码。无论您在标记卡上放置的尺寸（通常在**颜色**架子上）如何，都将定义饼图的切片：

![img](../images/Image%20[86].jpg)

观察前面的饼图使用收益之和定义每个切片的角度；总和越高，切分越宽。该**医院分院**维度切片的措施和规定的馅饼切片。此视图还演示了在“ **标签”**架子上放置多个字段的能力。第二个 SUM(Revenue) 字段是您之前看到的总表计算的百分比。这使您可以查看收入的绝对值以及全部收入的百分比。

*饼图可以很好地配合使用。**在大多数情况下，很难看到和理解超过两个或三个。**同样，作为一种好习惯，请通过对定义切片的维进行排序来对切片进行排序。**在前面的示例中，“* **医院分支”***维度按**SUM**收入递减的**排序* *。**这是通过使用下拉菜单选项完成的。**这将导致切片按从最大到最小的顺序排列，并且即使在大小和角度几乎相同的情况下，任何阅读图表的人都可以轻松查看哪些切片更大。*

### 可视化分布 <div id="page_86"></div>

通常，仅了解总数，总和，甚至是零件之间的细分，也只能提供整体情况。大多数时候，您会希望了解单个项目在所有相似项目的分布中的位置。

您可能会发现自己在问如下问题：

- 每个客户在我们的商店花多少钱，与所有其他客户相比如何？
- 我们大多数患者在医院待多长时间？哪些患者不在正常范围内？
- 机器中组件的平均预期寿命是多少？哪些组件高于或低于该平均值？是否有寿命极长或极短的组件？
- 学生的考试成绩是高于还是低于及格？

这些问题都有相似之处。在每种情况下，您都希望了解个人（患者，组成部分，学生）与小组的关系。在每种情况下，您最有可能拥有相对较高的人数。用数据的术语来说，您有一个维度（客户，患者，组成部分和学生）代表相对较大的一群人，并且要比较一些度量（花费的金额，停留的时间，预期寿命，测试分数）。使用以下一种或多种可视化效果可能是实现此目的的好方法。

#### 圆图 <div id="page_87"></div>

圆图是一种可视化分布的方法。考虑以下视图，该视图显示了根据开始治疗患者所需的平均分钟数，每个医生与同类部门内其他医生的比较：

![img](../images/Image%20[87].jpg)

在这里，您可以很容易地看出，就开始治疗病人而言，某些医生的平均表现要好于或差于其他人。还有趣的是，某些类型的部门平均需要花费更多或更少的时间。这很有意义，因为每种类型的部门都有不同的约束条件和操作程序。在某些部门，时间比其他部门更为关键。能够评估其所属部门中的医生，使比较变得更加有意义。

要创建前面的圆形图，您需要将字段放在显示的架子上，然后将标记类型从“ 自动”（以前是条形标记）更改为Circle。Department Type定义行，并在Doctor级别（在Marks卡上的Detail级别）上绘制每个圆圈。最后，要添加平均线，只需切换到左侧边栏的“ 分析”选项卡，然后将“ **平均线”**拖动到视图，特别是将其拖放到“ 单元格”选项上：

![img](../images/Image%20[88].jpg)

您也可以单击所得平均线之一，然后选择“ 编辑”以找到微调选项，例如标签。

##### 抖动 <div id="page_88"></div>

当使用圆形图或其他类似的可视化类型的视图时，您经常会看到标记重叠，这可能导致掩盖真实故事的一部分。仅通过观察，您是否可以肯定地知道，只有重症监护中的医生高于平均水平，而只有两名低于平均水平？还是可能存在两个或多个完全重叠的圆圈？最小化此方法的一种方法是单击“ 颜色”架子，并为每个圆添加一些透明度和边框。另一种方法是称为**抖动**的技术。

**抖动***是数据可视化中的一种常见技术，该技术涉及在可视化中添加一些有意的噪声，以避免重叠而又不损害通信内容的完整性。**艾伦·艾德里奇（Alan Eldridge）和史蒂夫·韦克斯勒（Steve Wexler）都是开创Tableau抖动技术的先锋。**通过在**Tableau论坛上**搜索**抖动**或**使用搜索引擎进行**Tableau抖动**，可以找到*

*各种抖动技术，例如使用**Index()* *或**Random()**功能**。*

这是一种使用Index()沿着Doctor计算的函数作为Rows上连续字段的方法。由于索引是连续的（绿色），因此它定义了一个轴并导致圆垂直展开。现在，您可以更清楚地看到每个单独的标记，并更有把握地确信重叠不会遮盖数据的真实图像。您可以在多种可视化中使用抖动技术：

![img](../images/Image%20[89].jpg)

*在上一个视图中，“* *索引”**字段**创建的垂直轴被**隐藏。**您可以通过使用定义轴或标题的字段的下拉菜单并取消选中“* *显示标题”**来隐藏轴或标题**。**或者，您可以右键单击视图中的任何轴或标题，然后选择相同的选项。*

#### 箱须图 <div id="page_89"></div>

箱形图和 晶须 图（有时也称为**箱形图**）为分布增加了额外的统计上下文。要了解箱形图和晶须图，请考虑下图：

![img](../images/Image%20[90].jpg)

此处，箱形图已添加到圆形图中。该框除以中位数，这意味着一半的值在上方，另一半在以下。该框还指示了上下四分位数，每个四分位数都包含值的四分之一。框的跨度构成了**四分位间距**（**IQR**）。晶须延伸到IQR值的1.5倍（或数据的最大范围）。晶须以外的任何痕迹都是异常值。

要添加箱形图和晶须图，请使用左侧边栏上的“ 分析”选项卡，然后将“ **箱形图”**拖到视图中。对我们之前考虑的圆形图执行此操作，将产生以下图表：

![img](../images/Image%20[91].jpg)

箱形图帮助我们查看和比较中位数，数据范围，值的集中度以及任何离群值。您可以通过单击或右键单击方框或晶须并选择编辑来编辑方框图。这将显示多个选项，包括应如何绘制晶须，是否仅显示异常值以及其他格式设置可能性。

#### 直方图 <div id="page_90"></div>

显示分布的另一种可能性是使用直方图。一个柱状图类似于条形图，但是条显示的值发生计数。例如，寻找成绩篡改证据的标准化考试审核员可能会构建学生考试成绩的直方图。通常，分布可能如下所示：

![img](../images/Image%20[92].jpg)

测试成绩显示在*x*轴上，每个横条的高度显示做出该特定成绩的学生人数。一个典型的分布应该具有相当容易辨认的钟形曲线，其中一些学生表现不佳，一些学生表现极好，而大多数则跌落到中间。

如果审计师看到这样的事情怎么办？

![img](../images/Image%20[93].jpg)

显然是错误的。也许是一年级生把那些不及格的学生丢给了勉强及格的学生。这也可能表明主观评分存在偏差，而不是公然篡改。我们不应该得出结论，但是这种模式是不正常的，需要进行调查。直方图对于捕获这样的异常非常有用。

假设您想查看开始患者治疗所需时间的直方图。您可能从空白视图开始，并遵循以下步骤：

1. 单击以选中 数据窗格中“度量”下的Minutes to Service 字段。
2. 如有必要，展开显示我，然后选择直方图。

选择直方图后，Tableau会通过创建Minutes to Service (bin)视图中使用的新维度以及来渲染视图的COUNTof Minutes to Service来构建统计图：

![img](../images/Image%20[94].jpg)

您可以看到曲线，该曲线仅在40分钟以上达到峰值，然后逐渐变细，一些患者不得不等待长达110分钟。直方图的关键是bin。

**Bin***是度量值范围，可用作维度以切片数据。**您可以将垃圾箱视为水桶。**例如，您可能以0-5％，5-10％等的方式查看测试分数，或者以0-10、10-20等的方式查看人们的年龄。**您可以在创建垃圾箱时设置其大小或范围，并可以随时对其进行编辑。**Tableau还将根据查看数据中存在的值的算法来建议垃圾箱的大小。**Tableau将对所有垃圾箱使用统一的垃圾箱大小。*

您可以通过右键单击一个数字字段并选择“ 创建” |“  自己”来创建新的垃圾箱。垃圾箱。您也可以通过右键单击bin字段本身并选择Edit来编辑现有的bin字段。首次创建垃圾箱（或Tableau基于Show Me创建一个垃圾箱）时，Tableau使用一种算法来确定垃圾箱的最佳大小。

对于您之前创建的直方图，大小设置为6.5分钟。在这种情况下，这可能不是最有助于理解数据的方法，因此您可能希望通过以下方法来编辑箱的大小：右键单击数据窗格中“ 维度”Minutes to Service (bin)下的字段，选择“ 编辑”，然后将大小调整为更直观的方式，如：5

![img](../images/Image%20[95].jpg)

您还需要确定要为每个bin计数的数量并将其放在Rows上。当您使用Show Me时，Tableau将 COUNT of Minutes to Service 放在on Rows上，这只是该值不为null的每条记录的计数。在这种情况下，这相当于患者就诊次数。但是，如果您要计算不重复患者的数量，则可以考虑使用替换视图中的字段 COUNTD([Patient ID])。

就像日期一样，当视图中的bin字段是离散的时，下拉菜单包括一个用于显示缺失值的选项。如果使用离散的bin字段，则可能希望使用此选项以避免扭曲可视化效果并确定数据中未出现哪些值。

### 可视化多个轴以比较不同的度量 <div id="page_91"></div>

通常，您需要使用多个轴来比较不同的度量，了解相关性或以不同的详细程度分析同一度量。在这些情况下，您将使用不止一个轴的可视化。

#### 散点图 <div id="page_92"></div>

一个散点图是理解两项措施之间的关系的极其重要的可视化类型。当您发现自己提出如下问题时，请考虑一个散点图：

- 我在营销上花了多少钱才能真正改变销售量？
- 每种加热/冷却方式的功耗会增加多少？
- 学习时间与考试成绩之间是否有相关性？

这些问题中的每一个都试图了解两个度量之间的相关性（如果有）。散点图非常适合查看这些关系以及查找异常值。

考虑以下散点图，该散点图用于查找平均服务时间与医院平均停留天数之间的关系，并按部门类型和医生细分：

![img](../images/Image%20[96].jpg)

的尺寸 Department Type 和 Doctor 所述上标记卡定义详细的视图级别。已使用颜色来轻松查看每个医生所执业的科室类型。视图中的每个标记代表部门类型的医生所见患者的平均服务时间和平均住院天数。每个圆圈的大小表示该医生看过的患者总数。

每位医生的服务时间和住院天数之间似乎没有太多相关性。但是，散点图对于查看某些部门内医生的某些分组模式很有用，并且还说明了重症监护（右上角的标记）可能是异常值。

#### 双轴和组合图 <div id="page_93"></div>

Tableau中的一个非常重要的功能是使用双轴的功能。散点图使用两个轴，但他们是X和Y ^。您还在堆叠的条形示例中观察到，在行或列上彼此相邻放置多个连续（绿色）字段会导致多个并排的轴。另一方面，双轴意味着视图使用的两个轴彼此相反，且具有共同的窗格。

这是对Sales和使用双轴的示例视图Profit：

![img](../images/Image%20[97].jpg)

该视图有几个关键功能，如下所示：

- 行上的Sales 和 Profit 字段通过共享展平的一面表示它们具有双轴。
- Sales 和 定义的轴Profit 位于视图的相对侧。另外，请注意它们不同步，这在许多情况下会导致数据视图失真。如果利润接近总销售额，那就太好了！但事实并非如此。要同步轴，请右键单击右轴，然后选择“ 同步轴”。如果该选项显示为灰色，则可能其中一个值是整数类型，而另一个值是十进制类型。您可以通过在数据窗格中右键单击并选择Change Data Type |来更改字段之一的数据类型。数字（整个）或数字（十进制）。
- 该标志卡现在是一个手风琴状与控制的所有部分以及一个用于 Sales 和 Profit。你可以用它来定制的所有措施商标或专门定制标记的两种 Sales 或 Profit。

要创建双轴，请将两个连续的（绿色）字段拖放到“ 行”或“ 列”上，然后使用第二个下拉菜单，然后选择“ 双轴”。或者，您可以将第二个字段放到画布上与现有轴相反的位置。

*双轴可与**定义轴的**任何***连续***字段**一起使用**。**这包括定义地理可视化的数字字段，日期字段以及纬度或经度字段。**如果是经度或纬度，只需复制一个字段并将其紧挨着放在“* *行”**或“* *列”**架子上即可。**然后，**使用下拉菜单**选择“* *双轴”**。*

甲组合图表延伸使用双轴的叠加不同类型的标记。这是可能的，因为“ 标记”卡将提供用于编辑所有标记或为每个轴定制标记的选项。

*每当“* *行”**或“* *列”**上两个或多个连续字段彼此相邻时，就可以使用多种标记类型**。*

作为组合双轴图表的示例，请考虑以下可视化：

![img](../images/Image%20[98].jpg)

该图表使用条形和线条组合来显示一段时间内的患者就诊总数（使用条形图）以及医院分支机构随时间推移的患者就诊细目（使用线）。这种可视化可以非常有效地为细节提供额外的上下文。

关于此视图，需要注意几件事：

- “ 颜色”架子上的字段在 标记卡上列出为，Multiple Fields 并且为灰色。这表明在Marks上每个轴的Color都使用了不同的字段。
- 该视图演示了在同一视图中混合细节级别的能力。条形图是在最高级别绘制的（每个月的病人拜访），而线形图是在较低级别绘制的（每个月每个分支的病人拜访）。
- 该视图演示了在同一架子（本例中为Rows）上多次使用同一字段（本例中为Patient Visits）的能力。
- 第二个轴（右侧的Patient Visits字段）具有隐藏的标题，以从视图中删除冗余。您可以通过取消选中做这个展会Header在视图上的字段从下拉菜单或右键单击轴或头要隐藏。

双轴和组合图为混合标记类型和详细程度提供了广泛的可能性，对于生成独特的见解非常有用。在本书的其余部分中，我们将看到更多这些示例，但是绝对可以尝试使用此功能，并让您的想象力随处可见。

### 总结 <div id="page_94"></div>

在本章中，我们已经介绍了很多内容！现在，您应该掌握何时使用某些类型的可视化效果。您对数据提出的问题类型通常会导致您进入某种类型的视图。您已经探索了如何创建这些各种类型，以及如何使用各种高级技术来扩展基本的可视化效果，例如计算字段，抖动，多种标记类型和双轴。在此过程中，我们还介绍了有关Tableau中日期如何工作的一些细节。

希望本章中使用计算的示例激发您学习更多有关创建计算字段的兴趣。在Tableau中创建计算的能力为扩展对数据的分析，计算结果，自定义可视化以及创建丰富的用户交互性开辟了无限的可能性。在接下来的两章中，我们将深入计算，以了解它们是如何工作的以及它们可以做什么令人惊奇的事情。

------

# 第二部分：充分利用Tableau的强大功能 <div id="page_95"></div>

本节说明如何使用Tableau的高级功能。 您将学习使用计算来解决挑战，设计交互式仪表板以及利用强大的视觉和统计功能。

本节包括以下章节：

- [第4章](docs/Book.md#page_96)，*第四章 通过计算开始冒险*
- [第5章](docs/Book.md#page_121)，*深入探讨表计算*
- [第6章](docs/Book.md#page_146)，*使视觉效果看起来不错并且工作良好*
- [第7章](docs/Book.md#page_160)，*第七章 使用仪表板讲述数据故事*
- [第8章](docs/Book.md#page_185)，*深入挖掘–趋势，聚类，分布和预测*

## 第四章 通过计算开始冒险 <div id="page_96"></div>

我们已经了解到，只需连接到数据并拖放字段，Tableau就能实现惊人的发现，分析和数据故事讲述。现在，我们将第四章 通过计算开始冒险。

计算极大地扩展了Tableau中分析，设计和交互性的可能性。在本章中，我们将看到如何以多种不同方式使用计算。我们将看到如何使用计算来解决数据的常见问题，如何通过添加新的维度和度量来扩展数据以及在交互性方面提供更多的灵活性。

同时，尽管计算提供了难以置信的功能和灵活性，但它们却带来了一定程度的复杂性和复杂性。在学习本章时，请尝试了解Tableau中计算工作原理背后的关键概念。像往常一样，跟随示例，但随时可以进行探索和实验。目标不仅是提供可复制的计算列表，而且还应了解如何使用计算来解决问题并向可视化和仪表板添加创意功能。

本章的前半部分着重于奠定基础，而后者则提供了许多实际示例。我们将在这里研究的主题如下：

- 创建计算
- 四种主要计算类型概述
- 行级示例
- 聚合级别的示例
- 详细程度示例
- 参量
- 实际例子
- 性能考量

在下一章中，我们将检查表的计算。

### 计算导论 <div id="page_97"></div>

在Tableau中，计算通常被称为“ **计算字段”**，因为在大多数情况下，创建计算时，它将在数据窗格中显示为新度量或维。计算由代码，功能，操作以及对其他字段，参数，常量，组或集合的引用组成。此代码返回一个值。有时，此结果是每行数据，有时是在聚合级别完成。我们将尽快考虑差异。

#### 创建和编辑计算 <div id="page_98"></div>

有多种方法可在Tableau中创建计算字段：

- 选择分析 | 从菜单中创建计算字段...。
- 使用数据窗格中“ 维度”旁边的下拉菜单：

![img](../images/Image%20[99].jpg)

- 在数据窗格中右键单击空白区域，然后选择创建计算域...。
- 使用数据窗格中字段，集合或参数上的下拉菜单，然后选择“ 创建” |“设置”。计算字段...。
- 双击“ 行”，“ 列 ”或“ 度量值”架子上的空白区域，或在“ 标记”卡上的空白区域中双击以创建临时计算。

从现有字段或参数开始计算时，该计算将作为对该字段的引用而开始。您创建的计算字段将成为创建时当前选定的数据源的一部分。您可以使用下拉菜单并选择编辑...在数据窗格中编辑现有的计算字段。

用于创建和编辑计算的界面如下所示：

![img](../images/Image%20[100].jpg)

该窗口具有几个主要功能：

- **计算字段名称**：在此处输入**计算字段的名称**。创建后，计算所得的字段将在数据窗格中显示为字段，并带有您在此文本框中输入的名称。
- **代码编辑器**：在此文本区域中输入代码以执行计算。该编辑器包括已识别字段和功能的自动完成功能。此外，您可以将字段，集合和参数从数据窗格中拖动或查看到代码编辑器中，以将它们插入代码中。

*您也可以在代码编辑器窗口中选择代码片段，然后将所选文本拖放到数据窗格中以创建其他计算字段。**您也可以将选定的代码段从“代码”窗口拖放到视图中的架子上，以进行**临时计算。**这**是测试复杂计算部分的有效方法。*

- 编辑器底部的指示器将警告您代码中的错误。此外，如果在视图或其他计算字段中使用了计算，您将看到一个下拉指示器，可让您查看相关性。单击“ 应用”按钮，将更改应用于整个工作簿，同时保持计算编辑器处于打开状态。“ 确定”按钮将保存代码更改并关闭编辑器。如果您希望放弃所做的任何更改，请单击右上角的X按钮以取消更改。

- 函数列表包含您可以在代码中使用的所有函数。其中许多功能将在示例中使用或在本章中讨论。Tableau根据其总体用途将各种功能分组：

  - **Number**：数学函数，例如舍入，绝对值，trig函数，平方根和指数。
  - **字符串**：对字符串操作有用的函数，例如获取子字符串，在字符串中查找匹配项，替换字符串的一部分以及将字符串值转换为大写或小写。
  - **日期**：对日期处理有用的功能，例如查找两个日期之间的差，为日期添加间隔，获取当前日期以及将非标准格式的字符串转换为日期。
  - **类型转换**：可用于将一种类型的字段转换为另一种类型的函数，例如将整数转换为字符串，将浮点小数转换为整数或将字符串转换为日期。
  - **逻辑**：决策功能，例如if then else逻辑或case语句。
  - **聚合**：用于**聚合的**函数，例如求和，获取最小值或最大值或计算标准差或方差。
  - **传递**：（仅在实时连接到某些数据库（例如SQL Server）时可用）：这些函数使您可以将原始SQL代码传递给基础数据库，并在行级别或聚合级别检索返回的值。
  - **用户**：用于获取用户名并检查当前用户是否为组成员的功能。这些功能通常与逻辑功能结合使用，以自定义用户的体验或在发布到Tableau Server或Tableau Online时实现基于用户的安全性。
  - **表格计算**：这些功能彼此不同。在从基础数据源返回聚合数据*之后*以及在呈现视图之前，它们对聚合数据*进行*操作。这些是Tableau中一些最强大的功能。我们将为他们专门写一整章，以便我们涵盖它们。

- 在列表中选择一个功能或单击代码中的字段，参数或功能将在右侧显示有关选择的详细信息。当在代码中嵌套其他计算字段时，当您想要查看该特定计算字段的代码时，或者当您想要了解函数的语法时，这将非常有用。

#### 附加功能和运算符 <div id="page_99"></div>

Tableau支持许多功能和运算符。除了计算屏幕上列出的功能之外，Tableau还支持以下运算符，关键字和语法约定：

- **AND**：逻辑*和*  两个布尔（true/ false）值或语句之间
- **OR**：逻辑*或*  两个布尔值或语句之间
- **NOT**：逻辑上*不*  取反布尔值或语句
- **=**或**==**：逻辑*相等以*测试两个语句或值是否相等（单或双等号在Tableau语法中等效）
- **+**：数字或日期值的附加或字符串的并置
- **-**：减去数字或日期值
- *****：数值相乘
- **/**：数值的除法
- **^**：用数值提高到幂
- **（）**：括号定义操作顺序或包含函数参数
- **[]**：方括号括起来的字段名称
- **{}**：花括号括起来的详细程度计算
- **//**：双斜线开始评论

*在计算中使用时，可以将单个单词的字段名称括在方括号中。**带有空格，特殊字符或来自辅助数据源的字段名称必须放在方括号中。*

#### 四种主要计算类型 <div id="page_100"></div>

我们前面提到的功能分组对于理解哪种功能是重要的。但是，了解Tableau中的计算的最基本方法是考虑四种主要类型的计算：

- **行级计算**：这些计算是针对基础数据的每一行执行的。
- **聚合级计算**：这些计算是在聚合级执行的，聚合级通常由视图中使用的维定义。
- **详细级别计算**：这些特殊计算是在指定的详细级别执行的聚合，结果在行级别可用。我们将在本章后面详细介绍这些内容。
- **表格计算**：这些计算是在数据源已返回Tableau的汇总数据表上的汇总级别上执行的。

*了解和认识四种主要计算类型将使您能够利用Tableau中的计算能力和潜力。*

在本章中，我们将仔细研究Tableau中四种主要的计算类型中的三种：行级别，聚合级别和明细级别。我们将深入到表计算 在下一章中，详细 [第5章](docs/Book.md#page_121) ， *潜水深度与表计算*。

#### 示例数据 <div id="page_101"></div>

在开始一些示例之前，让我们考虑一个示例数据集，该数据集将用于本章中的示例。它既简单又小巧，这意味着我们将能够轻松地看到计算是如何完成的。

此数据集包含Vacation Rentals.csv在\Learning Tableau\Chapter 04本书资源的目录中，也包含在 Chapter 4工作簿中作为名为的数据源Vacation Rentals：

| **出租物业**   | **名字** | **姓**   | **开始** | **结束** | **折扣** | **出租** |
| -------------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 112-阿瓦隆海岸 | 玛丽     | 里瑟     | 十二月2  | 12月9    | $ 150    | $ 1,500  |
| 112-阿瓦隆海岸 | 艾米     | 卡迈克尔 | 12月9    | 十二月15 | $ 0      | $ 1,500  |
| 155海滩微风    | 查尔斯   | 雷里     | 十二月2  | 12月9    | $ 260    | $ 1,300  |
| 155海滩微风    | 德怀特   | 五旬节   | 十二月16 | 十二月23 | $ 280    | $ 1,400  |
| 207-海滩微风   | 刘易斯   | 金龟子   | 12月9    | 十二月23 | $ 280    | $ 2,800  |
| 207-海滩微风   | 约翰     | 沃尔沃德 | 十二月2  | 12月9    | 0        | $ 1,500  |

数据集描述了几个度假出租物业，出租人，出租期的开始和结束日期，折扣和租金。

### 行级计算 <div id="page_102"></div>

我们可能知道，假期出租数据中出租单元的命名约定实际上为我们提供了房间号和建筑物名称。例如，名为**207-Beach Breeze**的单元是Beach Breeze公寓大楼的207室。

在Chapter 04工作簿中，创建几个计算字段。

Room用以下代码命名第一个：

SPLIT（[出租物业]，“-”，1）

然后，创建另一个Building使用以下代码命名的计算字段：

SPLIT（[出租物业]，“-”，2）

这两个函数都使用该Split()函数，该函数将字符串拆分为多个值并保留其中一个值。此函数采用三个参数：**字符串**，**定界符**（用于分隔值的字符或字符集）和令**牌号**（要保留在拆分中的值，即1st，2nd，3rd等）。使用- （破折号）作为分隔符，则Room是第一个值，Building而第二个是值。

使用两个计算出的字段，创建一个Revenueper Building和的条形图Room，类似于此：

![img](../images/Image%20[101].jpg)

在Building和Room下数据窗格中的字段显示尺寸。所计算的尺寸可以像其他尺寸一样使用。他们可以对数据进行切片，定义详细程度以及对度量进行分组。

行级计算是在行级计算的，但是您可以选择汇总结果。例如，您可以合计找到最高的Room number (MAX)或计算的不同数量Buildings (COUNTD)。实际上，如果行级计算的结果为数字，则默认情况下，Tableau通常会将结果字段置于“度量”下。如前所述，可以通过将字段的默认用法从度量更改为维度，反之亦然，方法是将其拖放到数据窗格中。

请注意，Tableau在数据窗格中的字段图标上添加了一个小等号，以指示它们是计算字段：

![img](../images/Image%20[102].jpg)

这两个计算字段的代码针对每行数据执行，并返回行级值。我们可以通过检查源数据来验证代码是否在行级别上运行。只需单击维度旁边的“  查看数据”图标以查看行级别的详细信息（位于上一个屏幕快照中的放大镜图标旁边）。在这里，可以清楚地看到Building和Unit的新字段以及行级值：

![img](../images/Image%20[103].jpg)

*Tableau实际上提供了拆分字段的快捷方式。**您可以使用数据窗格中某个字段上的下拉菜单，然后选择“* *变换”* *|“* *变换”**。**拆分**或**变换* *|* *自定义* *拆分**（如果您使用非标准的定界符）。**结果是与先前创建的字段相似的计算字段，但在确定数据类型方面带有一些其他逻辑。* **转换** *功能（例如拆分）也可用于* *“* *数据源”* *屏幕**上“* *预览”* *或“* *元数据”* *视图* *中的字段**。*

您还可以构建使用其他计算的计算。这称为**嵌套**，而所得的计算称为**嵌套计算**。

例如，假设您知道房间的楼层由房间号指示。从100到199的房间在二楼，从200到299的房间在二楼。您希望该信息可供分析。

我们可能会将此属性添加到源数据中，但是有时这可能不是一种选择，或者是不可行的。我们可能无权更改源数据，或者源可能是每天自动生成的电子表格，所有更改都将被覆盖。

相反，我们可以在Tableau中创建行级计算以扩展数据。为此，创建一个Floor使用以下代码命名的计算字段：

IF LEFT（[Room]，1）=“ 1”

然后“第一层”

ELSEIF LEFT（[Room]，1）=“ 2”

然后“第二层”

结束

此代码使用该LEFT()函数返回房间的最左边字符。因此，112给出结果1；207的结果为2。该IF THEN END逻辑允许我们的结果分配（或者First Floor 或Second Floor），这取决于该情况下是真实的。请注意，您Room在计算中使用了该字段，而该字段又是另一个计算。您可以使用的嵌套级别没有限制。

*每次在Tableau中编写计算时都会问自己几个很好的问题，如下所示：* *如果数据更改，会发生什么？* *我有没有盖过每一种情况？* *例如，仅当所有房间都是100或200层房间时，上一层计算才起作用。**如果有一个房间，306，在3* *次**楼，或者房间，822，在8* *个**楼？*

为了考虑其他情况，我们可以将计算简化为以下内容：

左（[Room]，1）

此代码仅返回房间号的最左字符。我们会得到3 的306和8 为822。但是，如果我们有房号，如1056的10 个楼层和1617 16号？我们必须考虑其他选项，例如：

MID（[Room]，0，LEN（[Room]）-2）

尽管这更复杂，但是字符串函数返回的子字符串从字符串的开头开始，但在最后两个字符之后停止。那给我们10 提供了基础1025，也为我们提供18 了基础1856。

为了总结我们的行级示例，让我们再创建一个计算。Full Name使用以下代码创建一个新的计算字段：

[名字] +“” + [姓氏]

这段代码将的字符串串联在一起，First name并Last Name在它们之间有一个空格。现在，我们只有一个字段，它将显示单个租户的全名。

### 聚合级别的计算 <div id="page_103"></div>

我们已经在Tableau中考虑了汇总，例如sum，min和max。通常，您将字段用作视图中的简单聚合。但是有时候，您可能想在更复杂的计算中使用聚合。

例如，您可能想知道打折后租金的百分比。数据中没有此类字段。它不能真正存储在源中，因为值会根据视图中显示的详细程度而变化（例如，单个单元的折扣百分比将与每层或每栋建筑物的折扣百分比不同）。相反，它必须作为一个汇总进行计算，并随着详细程度的变化而重新计算。

让我们创建一个Discount %使用以下代码命名的计算：

SUM（[折扣]）/ SUM（[出租]）

此代码表明的总和Discount应除以的总和Rent。这意味着Discount将添加所有的值，Rent并将添加所有的值。只有在计算了总和之后，才会进行除法运算。

一旦你创建的计算，你会注意到的Tableau放置在新领域的措施。Tableau  默认将所有带有数字结果的计算放在“度量”下，但是如果需要，您可以将行级计算更改为维。但是，在这种情况下，您甚至无法将新字段重新定义为维度。这样做的原因是，无论返回哪种数据类型，Tableau都会将每个聚合计算视为一种度量。这是因为合计计算取决于尺寸来定义执行计算的详细程度。因此，汇总计算不能是维度本身。

*由于计算值是百分比，因此您可能还需要将格式定义为百分比。**为此，右键单击***Discount％***字段，选择***Default Properties** *|* **Default***。***数字格式***，然后选择***百分比***。**如果需要，您可以调整显示的小数位数。*

现在，创建几个视图，以查看计算如何返回不同的结果，具体取决于视图中的详细程度。首先，我们将构建一个视图来查看每个单独的租赁期：

1. 广场Building，Room，Full Name，Start，和End 上**行**。
2. 在数据窗格中，根据办法，双击每个以下字段：Rent，Discount，和Discount %。Tableau将使用Measure Names和将所有这些措施放置在视图中Measure Values。
3. 重新排列上的字段Measure Values架子，这样的顺序是Rent，Discount和Discount %：

![img](../images/Image%20[104].jpg)

您可以看到每个租期以折扣方式给出的百分比。但是，请注意，当删除除Building和以外的所有字段时，值将如何更改Room：

![img](../images/Image%20[105].jpg)

为什么值会改变？因为聚合取决于定义视图详细程度的维度。在第一种情况，Building和Room，Full Name，Start，和End所定义的细节视图中的水平。因此，计算将每个租赁期的所有租金与该租赁期的所有折扣相加，然后除以它们。在第二种情况下，Building和Room重新定义信息的详细程度。因此，计算将每个建筑物和房间的所有价格与每个建筑物和房间的所有折扣相加，然后将它们相除。

*Measure Names**和**Measure Values**是出现在每个数据连接中的特殊字段（分别在“* *尺寸”**部分和**“度量”**部分**的底部**）。**它们充当在视图中共享同一空间的多个度量的占位符。**例如，在您刚创建的视图中，三个测量了窗格中的所有共享空间。**Measure Values**“在**文本上”**表示**Measure Values**应将架子**上的所有度量值**显示为文本。**的**Measure Names**上字段**列**创建了一列用于每个度量，与该量值的名称的值。*

请注意，如果您查看整个数据集而不按任何维度切片，则值将按预期再次更改：

![img](../images/Image%20[106].jpg)

*使Tableau* *实施**Measure Names**/的**Measure Values**一种简单方法**是记住，**只要您想在视图的同一空间中使用两个或多个度量**，* *就可以使用它们**。*

#### 为什么行级/聚合级差异很重要 <div id="page_104"></div>

假设您Discount % (row-level)使用以下代码创建了一个计算：

[折扣] / [出租]

该代码与您之前创建的汇总计算不同，后者具有以下代码：

SUM（[折扣]）/ SUM（[出租]）

这是结果的巨大差异：

![img](../images/Image%20[107].jpg)

为什么结果会有如此差异？这是执行计算方式的结果。

请注意，它作为SUM Discount % (row-level)出现在Measure Values架子上。这是因为该计算是行级计算，因此它逐行获取计算，然后在确定所有行级值之后将其汇总为度量。您看到的60％值实际上是在基础数据的每条记录中计算出的百分比之和。

实际上，执行行级计算然后进行最终聚合是这样的：

![img](../images/Image%20[108].jpg)

与执行聚合级别计算的方式相反。请注意，该Measure Values视图在架子上的活动字段中列出的聚合是AGG，而不是SUM。这表明您已经在计算中定义了聚合。Tableau不会进一步汇总结果。这是执行聚合级别计算的方式：

![img](../images/Image%20[109].jpg)

了解行级和聚合级计算之间的区别至关重要，以确保获得所需和期望的结果。通常，当您确定将值用作维度或行级值的集合有意义时，请使用行级计算。如果必须在其他操作之前执行汇总，请使用汇总计算。

*编写Tableau计算时遇到的最常见错误消息之一是***不能使用此函数混合聚合和非聚合参数***。**遇到此消息时，请检查您的代码，以确保您没有将行级字段和计算与聚合字段和计算不正确地混合在一起。**例如，您不能拥有* *[Discount] / SUM([Rent])**。*

*行级值（此混合物**Discount**）和（聚集**SUM**的**Rent**）无效。*

### 详细程度计算 <div id="page_105"></div>

**详细程度计算**（有时称为**LOD calc**或**LOD表达式**）是第四种计算类型，可让您以指定的详细程度执行聚合，该聚合可能不同于视图中定义的详细程度。在许多情况下，您可以在行级别使用结果值。这样，您可能会认为LOD计算是聚合计算和行级计算之间的混合。

#### 详细级别语法 <div id="page_106"></div>

详细程度计算遵循以下基本语法格式：

{FIXED | INCLUDE | EXCLUDE [Dim 1]，[Dim 2]：AGG（[Row-Level]）}

前面的声明的定义如下：

- FIXED或INCLUDE或EXCLUDE，是指示LOD计算类型的关键字。我们将在下一节中详细讨论差异。
- Dim 1，Dim 2 （以及所需的尽可能多的维度）是维度字段的逗号分隔列表，用于定义执行计算所依据的详细程度。您可以使用任意数量的尺寸来定义详细程度。
- AGG是您要执行聚合函数（例如SUM，AVG，MIN，和 MAX）。
- Row-Level 是将根据您选择的聚合指定进行聚合的行级字段或行级计算。

#### 详细等级类型 <div id="page_107"></div>

三种类型的详细计算的水平在使用的Tableau： ，FIXED，INCLUDE和EXCLUDE。

##### 固定 <div id="page_108"></div>

**固定**的详细程度表达式聚集在由代码中的维度列表指定的详细程度， *而不管*视图中的维度*如何*。例如，以下代码将返回Rentper 的平均值Building，而不管视图中其他什么维度：

{FIXED [Building]：AVG（[Rent]）}

以下两个代码段表示整个数据源（或上下文过滤器定义的子集）的平均租金的固定计算：

{FIXED：AVG（[Rent]）}

这是您可以使用的其他代码段：

{AVG（[出租]）}

##### 包括 <div id="page_109"></div>

**包括**详细表达式的聚集水平在该真实通过在视图中尺寸确定的详细程度， *以沿着*在代码列出的尺寸。例如，以下代码在由视图中的维定义的明细级别上计算平均租金Room，即使该维Room不在视图中，但也包括维：

{包括[房间]：AVG（[出租]）}

##### 排除 <div id="page_110"></div>

**排除**细节级别表达式以视图中的维度确定的细节级别聚合，*不包括*代码中列出的任何细节。例如，以下代码以视图中定义的详细程度计算平均价格，但即使视图中包含Apartment维，也不包括维数作为详细程度的一部分Apartment：

{排除[公寓]：AVG（[价格]）}

#### 详细程度示例 <div id="page_111"></div>

如果您想将单个房间的平均租金价格与同一建筑物中所有房间的总体平均租金价格进行比较，该怎么办？获得每个房间的平均租金价格相当容易：

![img](../images/Image%20[110].jpg)

在上一个视图中，**视图的详细**级别（由视图中使用的维定义**的详细**级别）为Building并且Room因为这些是视图中的维。因此，平均租金是按每栋建筑的每个房间计算的。

Building 只需从视图中删除单元尺寸，就很容易获得平均面积，如下所示：

![img](../images/Image%20[111].jpg)

但是，如果要在同一视图中同时使用每间客房的平均租金和每栋建筑物的平均租金，该怎么办？这是详细程度计算进入其中的地方。

有几种方法可以解决此问题，但是您可以考虑使用以如下代码EXCLUDE命名的详细程度计算Average Rent (exclude Room)：

{排除[Room]：AVG（Rent）}

然后，您可以在包含视图的视图中使用它，Building并Room在视图的详细程度中使用以下方法：

![img](../images/Image%20[112].jpg)

“ 度量值”架子AVG(Rent)上的字段是在详细信息视图级别执行的，因此我们将获得每个建筑物的每个房间的平均租金。

但是，Average Rent (exclude Room)用于度量的字段不包括“房间”尺寸，因此是按建筑物（视图中唯一的其他尺寸）计算的。现在，我们可以看到，整体平均海滩微风为$ 1,750，而在大楼各个房间可能是更高或更低。

我们将考虑另外的例子两个在解决复杂问题的详细的计算水平的[第11章](docs/Book.md#page_231)， *高级可视化，技术，技巧，和技巧*。

### 参量 <div id="page_112"></div>

在继续介绍行级计算和聚合计算的其他示例之前，让我们花一点时间检查一下参数，因为它们可以在计算中以不可思议的方式使用。

甲**参数**中的Tableau为单一的全局值的占位符，诸如数字，日期或字符串。参数可以显示为控制板或视图的最终用户的控件（例如滑块，下拉列表或键入文本框），使他们能够更改参数的当前值。参数的值是全局值，因此，如果更改了该值，则工作簿中引用该参数的每个视图和计算都将使用新值。参数提供了另一种方式来为仪表板和可视化的最终用户提供丰富的交互性。

参数可用于允许与您的视图或仪表板进行交互的任何人动态地执行许多操作，包括以下内容：

- 更改计算结果
- 更改垃圾箱的大小
- 更改前*n个*过滤器或前*n个*集合中的顶部或底部项目数
- 设置参考线或参考带的值
- 更改垃圾箱的大小
- 将值传递到数据源中使用的自定义SQL语句

其中一些是我们将在后面的章节中考虑的选项。

由于可以在计算中使用参数，并且由于可以使用计算字段来定义可视化的任何方面（从过滤器到颜色再到行和列），因此参数值的更改可能会产生戏剧性的结果。我们将在以下各节中看到一些示例。

#### 创建参数 <div id="page_113"></div>

创建参数类似于创建计算字段。

有多种方法可以在Tableau中创建参数：

- 使用数据窗格中“ 维度”旁边的下拉菜单，然后选择“ 创建参数”
- 右键单击数据窗格中的空白区域，然后选择创建参数
- 使用数据窗格中字段，集合或参数上的下拉菜单，然后选择“ 创建” |“设置”。参数...

在最后一种情况下，Tableau将基于该字段的**域**（不同的值）创建一个带有潜在值列表的参数。对于数据窗格中默认为**离散**（蓝色）的字段，Tableau将创建一个参数，该参数的值列表与该字段的离散值匹配。对于数据窗格中的**连续**字段（绿色），Tableau将创建一个参数，其范围设置为数据中存在的字段的最小值和最大值。

首次创建参数（或随后编辑现有参数）时，Tableau将显示如下界面：

![img](../images/Image%20[113].jpg)

该界面包含以下功能：

1. 该名称将显示为参数控制默认的标题，也将是在计算的参考。您还可以添加注释以描述参数的使用。
2. 数据类型定义参数值允许的数据类型。选项包括整数，浮点数（浮点十进制），字符串，布尔值，日期或带时间的日期。
3. 在当前值定义参数的初始默认值是什么。在此屏幕或显示参数控件的仪表板或可视化文件中更改此值将更改当前值。
4. 的显示格式定义的值将如何被显示。例如，您可能希望将整数值显示为美元金额，将十进制显示为百分比，或以特定格式显示日期。
5. 在允许值的选项给我们，以限制允许值的范围的能力。允许值有三个选项：

- “所有值”允许用户输入的任何与参数的数据类型匹配的输入。
- 列表允许我们定义一个值列表，用户必须从中选择一个选项。该列表可以手动输入，从剪贴板粘贴或从相同数据类型的维加载。从字段添加是一次性操作。如果数据更改并且添加了新值，它们将不会自动出现在参数列表中。
- 范围允许我们定义可能值的范围，包括可选的上限和下限以及步长。也可以从字段或其他参数设置。

1. 在前面的屏幕截图中，“ 值列表”允许我们输入所有可能的值。在此示例中，已输入三个项目的列表。请注意，该值必须与数据类型匹配，但是显示值可以是任何字符串值。该列表是静态的，必须手动更新。即使将参数基于字段中存在的值，即使新值出现在数据中，列表也不会更改。您可以在列表中拖放值以对列表重新排序。

*如果使用的是选项列表，请考虑一种具有最终用户易于理解的显示值的整数数据类型。**可以轻松地在计算中引用这些值来确定进行了哪些选择，并且可以轻松更改显示值而不会中断计算。**这也可以提高性能，因为数值比较比字符串比较更有效。**但是，您将需要在计算的可读性与整数的灵活性和性能之间取得平衡。*

1. 使用List或Range的允许值，您将获得一系列按钮，可让您从各种来源获取值或范围的列表。从参数添加从现有参数复制值列表或范围；“从字段添加”将复制数据中某个字段的不同值或范围的列表，而“ 从剪贴板粘贴”将从已复制到系统剪贴板的所有内容创建值列表。全部清除将清除值列表。
2. 单击确定以保存对参数的更改，或单击取消以还原。

创建参数后，它会出现在“ 参数”部分下的数据窗格中。参数的下拉菜单显示一个选项Show Parameter Control，该选项  将参数控件添加到视图中。参数控件右上角的小下拉箭头显示了一个用于自定义参数控件的外观和行为的菜单。这是我们之前创建的参数的参数控件，显示为单个值列表：

![img](../images/Image%20[114].jpg)

该控件可以显示在任何工作表或仪表板上，并允许最终用户选择一个值。更改值后，将重新评估使用该参数的所有计算，过滤器，集或箱，并且将重绘所有受影响的视图。

### 计算和参数的实际示例 <div id="page_114"></div>

让我们将注意力转向一些实际的计算示例。这些将是行级和聚合级计算的示例。这些仅是示例。目的是学习和理解一些可能的计算方法。在着手进行分析和可视化过程时，您将能够基于这些示例。

*查找有关计算的帮助和建议的好地方是*[community.tableau.com/community/forums上](http://community.tableau.com/community/forums)*的官方Tableau论坛**。*

#### 解决数据问题 <div id="page_115"></div>

通常，数据并不完全干净。也就是说，在完成有意义的分析之前，它需要解决一些问题。例如，日期格式可能不正确，或者字段可能包含数值和字符代码的混合，需要将其分成多个字段。计算字段通常可用于解决此类问题。

我们将继续处理Vacation Rentals数据。您会记得开始日期和结束日期看起来像这样：

| **开始** | **结束** |
| -------- | -------- |
| 十二月2  | 12月9    |
| 12月9    | 十二月15 |
| 十二月16 | 十二月23 |

没有年份，Tableau无法将“ **开始”** 或“ **结束”** 字段识别为日期。相反，Tableau会将它们识别为字符串。您可以尝试使用数据窗格中字段上的下拉菜单将数据类型更改为日期，但是如果没有年份，Tableau几乎肯定会错误地或至少不完全地解析它们。在这种情况下，我们需要使用计算来解决此问题。

假设在这种情况下，您确信年份应始终为2018年，则可以创建名为Start Date和的计算字段End Date。这是获取开始日期的代码：

DATE（[开始] +“，2018”）

这是获取结束日期的代码：

DATE（[结束] +“，2018”）

这些计算字段的作用是将月份和日期与年份连接起来，然后使用该DATE()函数将字符串转换为日期值。实际上，Tableau会将结果字段识别为日期（具有日期字段的所有功能，例如内置层次结构）。在Tableau中进行快速检查即可发现预期结果：

![img](../images/Image%20[115].jpg)

#### 扩展数据 <div id="page_116"></div>

通常，您会希望在数据中包含一些维度或度量，但是这些度量或度量不会出现在源中。很多时候，您将能够使用计算所得的字段扩展数据集。我们已经考虑了为访客的全名创建一个字段的示例，其中只有名字和姓氏字段。

此外，可能需要进行一些有趣的分析的一件事是计算每次租赁的时间。我们有开始和结束日期，但没有这两个日期之间的时间长度。幸运的是，这很容易计算。

创建一个Days Rented使用以下代码命名的计算字段：

DATEDIFF（'day'，[开始日期]，[结束日期]）

*Tableau使用智能代码完成功能。**在代码编辑器中键入时，它将提供有关功能和字段名称的建议。**按**Tab**键将自动完成您根据当前建议开始输入的内容。*

![img](../images/Image%20[116].jpg)

该DATEDIFF()函数采用日期部分说明，开始和结束日期，并返回两个日期之间的差的数值。现在，我们有了一项新措施，以前是无法使用的。我们可以在可视化中使用此新度量，例如“甘特图”租赁图，如下所示：

![img](../images/Image%20[117].jpg)

该图表使我们可以立即了解每个客人的停留时间，房间的占用时间以及房间的空置时间。

#### 增强用户体验，分析和可视化 <div id="page_117"></div>

计算和参数可以极大地增强用户体验，分析和可视化效果。

假设我们要让度假公寓经理能够进行假设分析。每年的12月，她都会提供一个免费的夜晚。她希望能够查看哪些租金将获得免费住宿，具体取决于她选择的夜晚。

为此，请按照下列步骤操作：

1. 如果尚未这样做，请创建先前显示的甘特图。
2. 创建一个名为Free Night的数据类型为Date且起始值为12/12/2018的参数。这将使经理可以设置和调整促销月份的开始日期。通过从数据窗格中参数的下拉菜单中选择“ 显示参数控件”，在视图上显示参数控件。
3. 现在，在视图中添加参考线以显示空闲的夜晚。为此，请切换到左侧栏中的“ 分析”标签。将参考线拖放到视图上，并将其放在表格上：

![img](../images/Image%20[118].jpg)

1. 在出现的对话框中，将“ 线值”设置为“ 免费住宿”。您可能希望将设置标签，以无或自定义与文本晚免费住宿。您可能还希望调整行的格式：

![img](../images/Image%20[119].jpg)

1. 创建一个称为计算字段Gets Free Night，该字段将返回a true或false值，具体取决于免费住宿是否在租赁期内：

[免费住宿]> = [开始日期]

和

[免费住宿] <= [结束日期]

1. 将此新的计算字段放在“ 颜色”架子上。

现在，我们有了一个视图，该视图允许公寓管理员更改日期并查看动态变化的视图，从而可以清楚地看出哪些租户在给定的促销期内会掉价。通过更改Promotional Month Start参数的值进行实验，以查看视图如何更新：

![img](../images/Image%20[120].jpg)

前面的视图以虚线显示了建议的免费住宿，并突出显示了哪些租期将获得免费住宿。线条和颜色会随着公寓管理员调整Free Night参数值而改变。

### 临时计算 <div id="page_118"></div>

通过临时计算，您可以在单个视图中将计算字段添加到货架，而无需在数据窗格中添加字段。

假设您有一个显示的简单视图Rent per Guest，如下所示：

![img](../images/Image%20[121].jpg)

如果您想快速突出显示任何价格低于$ 1,450的房客，该怎么办？一种选择是创建临时计算。为此，只需双击Columns，Rows或Measure  Values卡的空白区域，或Marks架子的空白区域，然后开始键入用于计算的代码。在此示例中，我们双击了“ 标记”架子上的空白区域：

![img](../images/Image%20[122].jpg)

在这里，我们输入了代码，True如果总和Rent小于$ 1,450，False否则将返回。按*Enter键*或在文本框外单击将显示一个新的临时字段，可以将其拖放到视图内的任何位置。在这里，我们将其添加到“ 颜色”架子中：

![img](../images/Image%20[123].jpg)

临时字段仅在视图内可用，而不会显示在数据窗格中。您可以双击该字段以编辑代码。

*将临时字段拖放到数据窗格中会将其转换为常规的计算字段，该字段可用于使用该数据源的其他视图。*

### 性能考量 <div id="page_119"></div>

当使用小型数据集和高效的数据库时，您通常不会注意到效率低下的计算。使用更大的数据集，计算效率可以开始显着提高视图渲染的速度。

以下是一些使您的计算尽可能高效的提示：

- 布尔和数字计算比字符串计算快。如果可能，请避免字符串操作，并使用别名或格式来提供用户友好的标签。例如，请勿编写以下代码： IF [value] == 1 THEN "Yes" ELSE "No" END。相反，只需编写[value] == 1，然后编辑该字段的别名并设置True为Yes 和False即可No。
- 始终寻找提高计算效率的方法。如果发现自己写的IF ELSEIF带有很多条件的长语句，请先检查是否存在一个或两个条件，以消除对所有其他条件的检查。例如，让我们考虑简化以下代码：

如果[类型] =“狗”且[年龄] <1然后是“小狗”

ELSEIF [类型] =“猫”和[年龄] <1然后是“小猫”

结束

- 前面的代码片段也可以这样写：

IF [年龄] <1 THEN

IF [类型] = “狗” THEN “小狗”

ELSEIF [类型] = “猫” THEN “小猫”

END

END

请注意，对于年龄小于的任何记录，都不必对类型进行检查1。这可能是数据集中记录的很高百分比。

必须为每一行数据执行行级计算。尝试最小化行级计算的复杂性。但是，如果这不可能或不能解决性能问题，请考虑最后一种选择。

创建数据提取时，将实现某些行级计算。这意味着在创建提取后，将执行一次计算，然后将结果存储在提取中。这意味着数据引擎不必一遍又一遍地执行计算。取而代之的是，仅从提取中读取值。使用任何用户功能或参数或TODAY()或的计算NOW()都不会在提取中实现，因为该值必定会根据当前用户，参数选择和系统时间而变化。Tableau的优化器还可以确定是否要实现某些在内存中更有效执行的计算，而不必读取存储的值。

*当您使用提取物来实现行级计算时，仅实现在提取时创建的计算。**如果在创建提取后编辑计算的字段或创建新字段，则需要优化提取（使用数据源上的下拉菜单，或从“* *数据”**菜单中**选择它**，然后选择“* *提取”* *|“* *优化”**）。*

### 总结 <div id="page_120"></div>

计算为Tableau开辟了惊人的可能性。您不再局限于源数据中的字段。通过计算，您可以通过添加新的维度和度量来扩展数据，修复格式错误或格式不正确的数据，并通过用于增强可视化效果的用户输入和计算参数来增强用户体验。

使用计算字段的关键是了解Tableau中的四种主要计算类型。对源数据的每一行执行行级计算。这些计算的字段可以用作维度，也可以汇总为度量。聚合级别的计算在视图中存在的维定义的详细级别进行。当您必须先汇总计算的组成部分然后再执行其他操作时，它们特别有用，甚至有必要。详细程度计算允许您定义执行聚合的详细程度，然后在行级别处理结果。

在下一章中，我们将探讨最终的主要计算类型：**表格计算**。就解决问题的能力和进行深入分析的可能性而言，这些是一些最强大的计算方法。实际上，它们的范围从非常简单到异常复杂。

## 第五章 深入了解表格计算 <div id="page_121"></div>

**表计算**是Tableau中最强大的功能之一。它们提供了其他任何方式都无法实现的解决方案（无需编写自定义应用程序或复杂的自定义SQL脚本！）。这些功能包括：

- 他们使使用结构不佳的数据成为可能，并且仍然可以快速获得结果，而无需等待有人在源头修复数据
- 它们使得可以比较结果表中各行的合计值并进行计算
- 他们为分析和创造性方法打开了令人难以置信的可能性，以解决问题，强调见解或改善用户体验

表格计算的复杂程度从难以置信的易于创建（单击两次）到极其复杂（需要了解寻址，分区和数据密集化）。在本章中，我们将从简单开始，然后转向复杂性。目的是为创建和使用表计算，了解它们的工作方式并查看如何使用它们的示例奠定坚实的基础。我们将考虑以下主题：

- 表计算概述
- 快速表格计算
- 范围和方向
- 寻址和分区
- 自定义表格计算
- 实际例子
- 数据密集化

本章中的示例将返回Superstore我们在第一章中使用的示例数据。要跟随示例，请使用Chapter 05 Starter.twbx工作簿。

### 表计算概述 <div id="page_122"></div>

表计算与Tableau中的所有其他计算不同。在上一章中我们已经考虑了行级，聚合计算和LOD表达式，这些查询是对数据源进行查询的一部分。如果要检查Tableau发送到数据源的查询，您会发现将计算代码转换为数据源使用的任何SQL风格。

另一方面，表计算是在初始查询之后执行的。这是一个扩展图，显示了聚合结果如何存储在Tableau的缓存中：

![img](../images/Image%20[124].jpg)

在呈现数据可视化之前，将对Tableau缓存中的数据汇总表执行表计算。正如我们将看到的，出于多种原因要理解这一点很重要，其中包括：

- **汇总**：表计算对汇总数据进行操作。您不能在表计算中引用字段而不将其作为汇总引用。
- **过滤**：常规过滤器将在表格计算之前应用。这意味着表计算将仅应用于从源返回到缓存的数据。您将需要避免过滤任何表格计算所需的数据，以使其按预期工作。
- **后期过滤**：从数据源返回汇总结果后，将应用用作过滤器的表计算。顺序变得很重要：首先应用行级过滤器和聚合过滤器，将聚合数据返回到缓存，然后将表计算应用为有效地从视图中隐藏数据的过滤器。这允许使用一些创造性的方法来解决某些示例中将要考虑的某些类型的问题。
- **性能**：如果您使用到企业数据库服务器的实时连接，那么行级和聚合级计算将利用企业级硬件。表计算在缓存中执行，这意味着它们将在运行Tableau的任何计算机上执行。如果您的表计算是在十二行甚至几百行的汇总数据上运行，或者您期望发布到功能强大的Tableau Server，您将不必担心。但是，如果要在本地计算机上获取成千上万的聚合数据行，则需要考虑表计算的性能。同时，在某些情况下，可以使用表计算来避免从源头进行昂贵的过滤器或计算。

#### 创建和编辑表计算 <div id="page_123"></div>

有多种方法可以在Tableau中创建表计算，包括：

- 使用下拉菜单查看在视图中用作数字聚合的任何活动字段，选择“ 快速表计算”，然后选择所需的计算类型
- 使用下拉菜单查看在视图中用作数字聚合的任何活动字段，选择添加表格计算， 然后选择计算类型，然后调整任何所需的设置
- 创建一个计算字段并使用一个或多个表计算功能编写您自己的自定义表计算

前两个选项创建一个快速表计算，可以使用字段上的下拉菜单并选择编辑表计算...或清除表计算来进行编辑或删除。第三个选项创建一个计算字段，该字段可以像其他任何计算字段一样进行编辑或删除。

视图中使用“表计算”的架子上的字段，或者是使用“表计算”功能计算的字段，都将具有增量符号图标，如下所示：

以下是**Active Field**的代码段 ：

![img](../images/Image%20[125].jpg)

以下是带有表计算的**活动字段**：

![img](../images/Image%20[126].jpg)

本章中的大多数示例都将使用文本表/交叉表报告，因为它们与缓存中的实际汇总表最匹配。这样可以更轻松地查看表计算的工作方式。

*表计算可用于任何类型的可视化。**但是，在构建使用表计算（尤其是更复杂的表）的视图时，请尝试使用在“* **行”***架子**上具有所有维的表，**然后将表计算作为离散值添加**到维右边的“* **行”***上。**一旦所有表计算都按需工作，就可以重新排列视图中的字段以提供适当的可视化效果。*

### 快速表格计算 <div id="page_124"></div>

**快速表计算**是预定义的表计算，可以应用于视图中用作度量的任何字段。这些计算包括常用和有用的计算，例如运行总计，差异，百分比差异，总计百分比，等级，百分位数，移动平均值，年初至今累计，复合增长率Year over Year Growth和年初至今增长。您可以在视图中用作度量的字段的下拉列表中找到适用的选项，如以下屏幕截图所示：

![img](../images/Image%20[127].jpg)

考虑以下使用示例Superstore Sales数据的示例：

![img](../images/Image%20[128].jpg)

在这里，显示 Sales了随着时间的推移。Sales已在“ 行”架子上放置了两次，第二个SUM(Sales)字段已应用“ 运行总快速表计算”。使用快速表计算避免编写任何代码。

*您实际上可以通过双击视图中的“表计算”字段来查看“快速表计算”使用的代码。**这将其转换为临时计算。**您也可以拖动一个活动字段，并将“快速表计算”应用到数据窗格，这会将其转换为可在其他视图中重复使用的计算字段。*

下表演示了一些可用的快速表计算：

![img](../images/Image%20[129].jpg)

### 相对还是固定 <div id="page_125"></div>

稍后，我们将介绍表计算的一些选项。基于这些选项，您可以通过以下两种方式之一来计算表计算：

- **相对的**：表格计算将相对于表格的布局进行计算。他们可能在桌子上或桌子下移动。以更改表格的方式重新排列尺寸将更改表格计算结果。正如我们将看到的，相对表计算的关键是 scope和 direction。当您将表计算设置为使用相对计算时，即使您重新布置视图，它也会继续使用相同的相对范围和方向。
- **固定**：表格计算将使用一个或多个维度进行计算。重新排列这些尺寸将不会更改表格计算的计算。在这里，范围和方向保持固定为一个或多个尺寸，无论它们在视图中的什么位置。在讨论固定表计算时，我们将重点讨论分区和寻址的概念。

您可以在用户界面中看到这些概念。下面是当您从“表计算”字段的菜单中选择“ **编辑表计算** ”时出现的“ **表计算”**编辑器：

![img](../images/Image%20[130].jpg)

我们将更详细地探讨这些选项和术语，但是现在，请注意与指定相对于**Rows**和**Columns**计算的Table Calculation有关的选项，以及指定针对于其中的特定维而固定计算的Table Calculation的选项。风景。

#### 范围和方向 <div id="page_126"></div>

**范围**和**方向**是描述如何相对于表格计算表格计算的术语。当表格计算相对于表格布局时，重新排列视图中的字段不会改变范围和方向：

- **范围**：范围定义了给定表计算可以引用其他值的范围
- **方向**：方向定义表计算在范围内的移动方式

您已经看到表计算是计算表（跨表）（一段时间内的销售总和）和表（向下）（在上一个表中）。在这些情况下，范围是整个表格，方向是交叉或向下。例如，正在运行的总计计算遍及整个表，并在从左向右移动时添加后续值。

要定义表计算的范围和方向，请使用视图中该字段的下拉菜单，然后选择“  使用计算”。您将获得一个选项列表，这些选项将根据视图中维的位置而略有不同。列出的第一个选项使您可以定义相对于表格的范围和方向。在cell的选项之后，您将看到视图中存在的尺寸列表。我们将在下一节中介绍这些内容。

*相对于表格的范围和方向选项：*

- **范围选项***：表格，窗格和单元格*
- **方向选项***：* *下，跨，下，跨，跨，下*

为了理解这些选项，请考虑以下示例：

![img](../images/Image%20[131].jpg)

关于表计算的范围，Tableau进行以下区别：

- 该**表**是整个汇总数据集。
- 该**窗格**是整个表的一小部分。从技术上讲，它是由表的倒数第二个最低级别定义的；也就是说，“ **行**和/或**列”**架子上的倒数第二个维度定义了窗格。在上图中，您可以看到**“** **行**上的**年份** ” 和“ **列**上的**区域”**的交集定义了窗格（突出显示了一个窗格，但视图中实际上有八个窗格）。
- 该**单元格**由表的最低级别定义。在此视图中，一个的交叉点 Department 内的 Region ，一个**季度**一个内**年份**是单细胞（一个被高亮显示，但实际上96有在视图中）。

前面的屏幕快照中的边界区域由范围定义。范围（以及我们将看到的分区）定义 了包含各种表计算的数据中的窗口。窗口功能，例如WINDOW_SUM() ，特别是在窗口范围内。

##### 确定范围和方向 <div id="page_127"></div>

为了了解范围和方向如何协同工作，让我们来看几个示例。我们将从创建自己的自定义表格计算开始。使用代码创建一个名为Index的新计算字段Index()。

*Index()**是一个表计算函数，**1**当它沿着给定方向并在给定范围内移动时，它**的值开始* *并以1递增。**可用于的许多实际用途**Index**，但是我们将在这里使用它，因为很容易看出它在给定范围和方向上的运动方式。*

创建与前面显示的表 YEAR(Order Date) 和 QUARTER(Order Date) 对行和 Region 并 Department 在列。与其在视图中放置“销售”，不如将新创建的 Index 字段 添加到“ 文本”架子。然后使用该字段上的下拉菜单进行实验，然后Index 选择“ 计算依据”以遍历各种范围和方向组合。在以下示例中，我们仅保留了东部和西部地区以及两年的时间：

- **Table（跨表）**：当表中有列时，这是Tableau的默认设置。注意以下内容如何 Index 在整个表中递增：

![img](../images/Image%20[132].jpg)

- **表格（下）**：使用表格（下）时， Index 将整个表格递减：

![img](../images/Image%20[133].jpg)

- **表格（先下然后下）**：Index在整个表格上递增，然后下移，继续在整个表格上递增，然后对整个表格重复：

![img](../images/Image%20[134].jpg)

- **窗格（跨）**：这为定义边界，Index 并导致Index跨边界递增，直到到达窗格边界为止，此时索引重新开始：

![img](../images/Image%20[135].jpg)

- **窗格（向下）**：这为定义边界Index，并使索引向下递增，直到到达窗格边界为止，此时索引重新开始：

![img](../images/Image%20[136].jpg)

- **窗格（横跨然后向下）**：允许Index在窗格上增加，并继续向下移动。窗格在此处定义边界：

![img](../images/Image%20[137].jpg)

您可以在任何表计算中使用范围和方向。请考虑如何使用此处显示的相同移动和边界来计算运行总额或百分比差异。继续尝试不同的选择，直到您对范围和方向的工作方式感到满意为止。

范围和方向相对于表格进行操作，因此您可以重新排列字段，并且计算将继续在相同的范围和方向上进行。例如，可以互换 Year of Order Date 使用 Department ，仍然可以看到 Index 根据你所限定的范围和方向来计算。

#### 寻址和分区 <div id="page_128"></div>

**地址**和**分区**与作用域和方向非常相似，但最常用于描述如何绝对引用视图中的某些字段来计算表计算。通过寻址和分区，您可以定义视图中的哪些维定义寻址（方向），而所有其他维定义分区（作用域）。

使用寻址和分区可以为您提供更好的控制，因为“表计算”不再与表布局相关，并且您还有更多选择可以微调计算的范围，方向和顺序。

为了开始理解它是如何工作的，让我们考虑一个简单的例子。使用前面的视图，从“ 文本 ” 字段的下拉菜单中选择“ 编辑表计算”。在出现的对话框中，在“ 特定尺寸”下进行检查。Index Department

这是选择的结果 Department：

![img](../images/Image%20[138].jpg)

您会注意到，Tableau 沿（沿）检查维的方向计算Index Department。换句话说，您已经使用 Department 了寻址，因此每个新部门都会增加index。视图中所有其他未检查的维都隐式用于分区； 也就是说，它们定义了索引函数必须重新启动的范围或边界。正如我们在范围上看到的那样，这些边界有时被称为窗口。

前面的视图看起来与您设置 Index 为使用**Pane** **（跨）**进行计算时 所看到的视图相同。但是，有很大的不同。使用**Pane** **（跨**Index 窗格）时，即使在视图中重新排列尺寸，删除某些尺寸或添加其他尺寸  ，也始终会在整个窗格中进行计算。但是，当使用维进行寻址计算时，表计算将始终使用该维进行计算。删除该尺寸会破坏表格计算（该字段将变成红色并带有感叹号），您需要通过下拉菜单编辑表格计算以调整设置。如果您在视图中重新排列尺寸，索引将继续沿尺寸进行计算Department 。

例如，这是单击工具栏中的“ **交换行和列”**按钮的结果：

![img](../images/Image%20[139].jpg)

请注意， 即使表格的整个方向已更改，**索引也将**继续计算Department 。为了完成以下示例，我们将撤消“ **行**和**列”**的交换，以将表恢复为原始方向。

##### 高级寻址和分区 <div id="page_129"></div>

让我们看一下添加其他维度时会发生什么情况的其他示例。例如，如果你检查 Quarter of Order Date，你会看到的Tableau突出一个分区的定义 Region 和 Year of Order Date， 与 Index 通过的寻址领域递增 Quarter of Order Date ，然后 Department：

![img](../images/Image%20[140].jpg)

如果要选择Department和Year of Order Date 作为的地址 Index，则会看到一个由 Region 和 定义的分区Quarter，如下所示：

![img](../images/Image%20[141].jpg)

在此视图中，您会注意到，Index对于 Year 和 Department 的分区中的 Quarter 和的 每个组合，该值都会递增Region。

这些是处理寻址和分区时要考虑的其他一些事项：

- 您可以指定排序顺序。例如，如果您希望Index根据销售额的总和递增，则可以使用Table Calculation编辑器底部的下拉列表来定义默认排序。
- 在“编辑表计算”对话框中的“ 在级别上”选项允许您指定执行表计算的级别。在大多数情况下，您会将此设置保留为“ **最深”** （与将其设置为最底端的维度相同），但是有时，如果您需要将某些维度定义分区，但需要在更高级别应用表计算。您还可以通过在“ **特定尺寸** ”复选框中拖放来重新排列**尺寸**。
- 在重新启动每...选项有效地使所选择的领域，在这一领域中选择，该分区的一部分上面的寻址所有方面，但可以让你保持有序的微调。
- 尺寸是唯一可用于寻址的字段。但是，可以使用离散（蓝色）度量来划分表计算。要启用此功能，请使用字段上的下拉菜单，然后取消选中表计算中的忽略。

花一些时间尝试各种选项，并熟悉寻址和分区的工作方式。

### 自定义表格计算 <div id="page_130"></div>

在继续介绍一些实际示例之前，让我们简单地考虑一下如何编写自己的表计算，而不是使用快速表计算。通过创建新的计算并从“ 功能”下的下拉列表中选择“ 表计算”，可以看到可用的表计算功能的列表。

对于每个示例，我们将设置Compute Using |。类别。这意味着 Department将是分区。

您可以考虑将表计算分为几类。下表的计算可以像其他函数一样组合甚至嵌套。

#### 元表功能 <div id="page_131"></div>

这些功能可为您提供有关分区和寻址的信息。这些函数还包括**Index**，**First**，**Last**和**Size** ：

- **索引**沿分区内的地址*移动时*增加。
- **首先**给出与分区第一行的偏移量；因此每个分区的第一行为0。
- **Last**将偏移量分配给分区的最后一行；因此每个分区的最后一行是0。
- **大小**给出分区的大小。

下图显示了各种功能：

![img](../images/Image%20[142].jpg)

**Index**，**First**和**Last**都受范围/分区和方向/寻址的影响，而无论指定什么方向，**Size**都会在分区的每个地址上给出相同的结果。

#### 查找和以前的值 <div id="page_132"></div>

这两个函数中的第一个使您能够引用其他行中的值，而第二个函数使您能够结转值。从以下屏幕截图中注意到，方向对于这两个功能非常重要：

![img](../images/Image%20[143].jpg)

两种计算都使用寻址 Category （ 分区也是如此Department ）进行。

在这里，我们使用了代码Lookup(ATTR([Category]), -1)，该代码在-1与当前行相比偏移了行的行中查找类别的值。每个分区的第一行NULL从查找中获取结果（因为之前没有行）。

对于Previous_Value，我们使用了以下代码：

Previous_Value（“”）+“，” + ATTR（[类别]）

注意，在每个分区的第一行中，没有先前的值，因此Previous_Value()只需返回我们指定的默认值：一个空字符串。然后将其与逗号和该行中的类别连接在一起，为我们提供值**Bookcases**。

在第二行中，**Bookcases**是前一个值，该值与该行中的逗号和类别连接在一起，为我们提供值**Bookcases**，**Chairs和Chairmats**，它成为下一行中的前一个值。该模式在整个分区中继续，然后在**Office Supplies**部门定义的分区中重新启动。

#### 运行功能 <div id="page_133"></div>

这些函数沿着方向运行/寻址，并且包括 Running_Avg()，Running_Count()，Running_Sum()，Running_Min()，和Running_Max()，如下所示：

![img](../images/Image%20[144].jpg)

请注意， Running_Sum(SUM[Sales])) 该分区的每一行继续将销售总和添加到运行总计中。 保持销售总和的价值（如果它是沿着分区的行移动所遇到的最小值）。Running_Min()

#### 视窗功能 <div id="page_134"></div>

这些函数一次在分区中的所有行上运行，并且实质上聚合了聚合。它们包括Window_Sum，，Window_Avg和 Window_Max，Window_Min以及其他内容，如以下屏幕截图所示：

![img](../images/Image%20[145].jpg)

#### 等级函数 <div id="page_135"></div>

这些功能提供了各种基于汇总值进行排名的方法。等级有多种变化，可让您决定如何对待领带以及等级的密度，如以下屏幕截图所示：

![img](../images/Image%20[146].jpg)

#### 脚本功能 <div id="page_136"></div>

这些功能允许与R分析平台或Python集成，这两者都可以合并简单或复杂的脚本，以实现从高级统计到预测建模的所有功能。深入探讨所有可能的内容，这超出了本书的范围，但是在Tableau的网站上以及Tableau社区的各个成员中都可以轻松找到示例。

#### 总计功能 <div id="page_137"></div>

该Total功能应有其自己的类别，因为它的功能与其他功能略有不同。与在缓存中的聚合表上运行的其他函数不同，Total将重新查询基础源以获取组成给定分区的所有源数据行。在大多数情况下，这将产生与窗口函数相同的结果。

例如，Total(SUM([Sales])) 给出与相同的结果Window_Sum(SUM([Sales]))，但Total(AVG([Sales]))可能给出的结果与之不同，Window_AVG(SUM([Sales]))因为合计给出的是基础行的实际平均值，而Window函数是求和的平均值。

### 实际例子 <div id="page_138"></div>

看了表计算的一些基本概念之后，让我们考虑一些实际的例子。我们将看几个示例，尽管表计算的实际应用几乎是无止境的。您可以执行所有操作，包括累计总和，分析同比增长，查看类别之间的百分比差异等等。

#### 同比增长 <div id="page_139"></div>

通常，您可能需要比较年度值。去年我们的客户群增长了多少？与去年同期相比，每个季度的销售额如何？可以使用回答这些类型的问题Year over Year Growth。

Tableau Year over Year Growth在“快速表计算”中作为一个选项公开。这里，例如，是示范视图Sales通过QUARTER，在销售与上年相比四分之一的百分比差异一起：

![img](../images/Image%20[147].jpg)

第二个 Sum(Sales) 字段已 应用“ Year over Year Growth 快速表计算”（并且标记类型更改为bar）。您会注意到右下角的**> 4空值**指示符，提醒您至少有四个空值的事实（这很有意义，因为没有2015年可以与2016年的季度进行比较）。如果您滤除2015年，则空值将出现在2016年，因为“表计算”只能对缓存中聚合数据中存在的值进行运算。应用于数据的任何常规过滤器都将应用于源，被排除的数据永远不会进入缓存。

像构建本示例一样轻松创建视图，请当心，因为Tableau假定视图中的每一年都有相同的季度数。例如，如果不存在或未过滤出2015年**第一季度**的数据，则结果视图不一定代表您想要的视图。例如，考虑以下内容：

![img](../images/Image%20[148].jpg)

这里的问题是，的Tableau使用的寻址计算快速表计算年度和季度和 正处级的价值Year of Order Date。假设所有季度都在场，则此项工作有效。但是，这里的2016年第一季度与2015年现在的第一季度相匹配，实际上是第二季度。要解决此问题，您需要编辑表计算以仅将Year用于寻址。四分之一然后成为分区，因此将对正确的四分之一进行比较。

那么，如果您不想参加2015年该怎么办？对其进行过滤将在2016年引起问题。我们将在本节后面介绍“ *后期过滤”*。删除2015的另一种可能方法是在视图中右键单击2015标题，然后选择隐藏。**Hide**是一个特殊命令，即使在高速缓存中存在数据时，它也只能阻止Tableau呈现数据。如果您以后决定隐藏后要显示**2015**，则可以使用该字段的菜单，YEAR(Order Date) 然后选择显示隐藏数据。或者，您可以使用菜单选择分析 | 显示隐藏数据。

*您可能还希望* *在视图中**隐藏***null指示器***。**您可以通过右键单击指标并选择**隐藏指标**来执行此操作**。**单击指示器将显示用于过滤数据或将其显示为默认值（通常为0）的选项。*

#### 带标题的动态标题 <div id="page_140"></div>

您可能已经注意到为每个视图显示的标题。除非专门打开字幕，否则也不会显示字幕（要执行此操作，请从菜单中选择“ 工作表 | 显示字幕 ”）。

默认情况下，标题显示工作表名称，标题是隐藏的，但是您可以显示和修改每个标题。有时，您可能希望显示总计，以帮助最终用户了解广泛的背景或立即掌握其重要性。

这里，例如，是一个视图，它允许用户选择一个或多个Region ，然后看到Sales每State每个Region：

![img](../images/Image%20[149].jpg)

当用户选择不同的区域时，显示变化数量的状态可能很有用。您可能首先想到使用聚合 State，例如**Count Distinct**。但是，如果尝试在**标题中**显示该值，则将始终看到该值 1。为什么？因为视图详细程度 是 State 和国家的重复计数每状态1！

但是表计算中有一些选项可以让您进一步汇总聚合。或者，您可能会考虑根据窗口的大小确定表中值的数量。实际上，这里有几种可能性：

- 要获得总的非重复计数： TOTAL(COUNTD([State]))
- 在窗口中求和： WINDOW_SUM(SUM(1))
- 要获取窗口的大小： SIZE()

您可能还记得窗口定义为“范围”或“分区”确定的边界。无论选择哪种可能性，我们都希望将窗口定义为整个表格。可以通过Table Down的相对计算或使用所有维度的固定计算来实现。这是一个说明动态标题和标题中所有三个选项的视图：

![img](../images/Image%20[150].jpg)

#### 后期过滤 <div id="page_141"></div>

假设您已经建立了一个视图，可以查看每个部门的总销售额百分比。您已经在该Sales字段上使用了“快速表计算” 来得出总计的百分比。您还用作Department过滤器。但这是一个问题。

由于表计算是在将汇总数据返回到缓存之后执行的，因此部门的过滤器已经在数据源中进行了评估，并且汇总行不包括该过滤器排除的任何部门。因此，总数的百分比总和为100％；也就是说，它是过滤的总数的百分比，如以下屏幕截图所示：

![img](../images/Image%20[151].jpg)

如果您想查看所有部门在总销售额中所占的百分比，即使您希望从显示中排除一些，该怎么办？一种选择是使用表格计算作为过滤器。

如果您创建一个Department (late filter)使用代码调用的计算字段，LOOKUP(ATTR([Department]), 0)并将其放置在“ 筛选器”功能区而不是Department维度上，则该筛选器不会在源中应用，汇总数据对于其他“表计算”可见，并且“表计算”筛选器仅隐藏部门从最终视图开始，如以下屏幕截图所示：

![img](../images/Image%20[152].jpg)

*您可能已经注意到所**ATTR**使用**的**功能。**请记住，表计算需要汇总参数。**ATTR**（属性的缩写）是一种特殊的聚合，如果对于给定的详细程度仅存在该字段的单个值，则返回该字段的值；如果存在多个值，则返回*******。*

*要理解这一点，请尝试同时具有**Department**和**Category**在***Rows***上**的视图**。**使用视图中活动字段上的下拉菜单，更改**Category**为**Attribute**。**因为每个部门有多个类别，所以**它将显示为*******。**然后，撤消并更改**Department**为**Attribute**。**因为每个类别只有一个部门，所以它将显示部门名称。*

### 数据密集化 <div id="page_142"></div>

**数据密集化** 是一个广义术语，表示缺少的值或记录已“填写”。有时，使用特定的术语（例如*域填充*（填写缺失的日期或bin值）或*域完成*（填充缺失的相交或维值））来指定致密化的类型，但是在这里，我们仅使用术语数据致密化。

*值缺失的数据（例如，每个日期都没有记录的数据，或者仅包含已订购产品的记录的数据，而不是库存中的所有产品的***数据***）称为***稀疏数据***。*

在逐步掌握Tableau的过程中，了解Tableau何时使用数据致密化以及如何*打开*或*关闭它*非常重要。有时，Tableau会在您不希望进行数据浓缩时进行这种操作，您需要认识到这一点，并意识到将其关闭的选项。在其他时候，您将需要利用数据密集化来解决某些类型的问题或执行某些类型的分析。

#### 何时何地进行数据密集化 <div id="page_143"></div>

如果您选择使用某些联接，联合或自定义查询来填充丢失的数据，则可能在源中进行数据致密化。但是在这里，我们专注于从源返回汇总数据之后在Tableau中进行的数据浓缩。具体来说，在我们现在考虑的某些情况下，Tableau会在缓存的聚合数据中填充缺失值，如下图所示：

![img](../images/Image%20[153].jpg)

您将认识到该图与我们开始讨论表计算时所检查的图非常相似。实际上，数据密集化几乎与表计算同时发生，有时甚至可以由表计算触发。以下是启用数据密集化的一些时间示例：

- 当启用了“ 显示缺失值”选项时，日期或箱用作行或列的标题。在这里，Tableau将显示日期或bin值的标题（介于最小或最大日期/ bin值之间），即使它们没有出现在数据中（或被过滤器消除）也是如此。您可以通过选择所需的选项轻松地打开或关闭此密实度。
- 随着展会缺失值启用，在视图中使用某些表计算会额外失踪头的视图中添加标记。我们将在本节后面的示例中看到一个示例。
- 启用“ 显示空行 / 列”选项（为此，从菜单中选择“ 分析” |“ 表布局” |“ 显示空行 / C 列”。）这将使Tableau显示所有行/列标题，即使某些值通常无法正常显示也是如此。根据过滤器选择显示。此选项是特定于上下文的，因此显示的值的范围是针对整个数据集，还是针对上下文过滤器定义的上下文。观察显示的类别与未选中的类别之间的区别：

![img](../images/Image%20[154].jpg)

- 在行和列上使用具有离散尺寸的某些表计算，将导致Tableau *打开*  数据致密化。

让我们看一个示例，以及如何有选择地*关闭*  生成的致密化。 观察两个视图之间的差异，如下所示：

![img](../images/Image%20[155].jpg)

这种观点有**14马克**（你可以看到在状态栏中的计数），表明有十四有效的交叉 Container 和 Ship Modes。数据中根本不会出现某些组合（例如，**Express Air**从未发送过**巨型鼓**）。

但是将表计算（例如）添加Index() 到“ 明细”会导致Tableau填写丢失的相交，如下所示：

![img](../images/Image%20[156].jpg)

画面填补在组合Container 和 Ship Mode 现在有21马克。有时，这种行为可能有用（我们将在后面看到这样的示例），但是很多时候，您可能想要避免致密化。如何关闭它？

了解了Tableau由于行和列上的离散维而启用了致密化，您可以重新排列视图，以便行或列上仅保留一个维。该视图中，例如，保持 Ship Mode 在详细  的部分细节的视图级别，但使用特殊聚合 上的列，如图以下截图：ATTR

![img](../images/Image%20[157].jpg)

结果是没有数据致密化的视图仅显示**14个标记**。

*密切注意状态栏和标记计数。**这将帮助您确定数据密集化的可能情况。**然后，您将能够决定何时希望利用致密化或何时将其关闭有用。*

#### 利用数据致密化的示例 <div id="page_144"></div>

除了显示空行或缺少日期的简单示例外，在某些情况下，您还可以使用数据致密化来解决问题或解决数据的局限性，否则这将是非常困难的。

例如，考虑一下，如果您有指示打开或关闭某些生成器的日期的数据，例如以下内容：

| **发电机** | **日期**      | **行动** |
| ---------- | ------------- | -------- |
| 一种       | 1/13/2017     | 上       |
| 乙         | 2017年1月2日  | 上       |
| C          | 2017年1月25日 | 上       |
| d          | 2017年1月25日 | 上       |
| 乙         | 2017年1月7日  | 关       |
| Ë          | 1/29/2017     | 上       |
| 一种       | 1/30/2017     | 关       |
| C          | 1/30/2017     | 关       |

如果您想要可视化显示**在**给定日期有多少个发电机处于**打开状态**，该怎么办？挑战在于数据集稀疏。即，仅存在发生**开**或**关**操作的日期的记录。下面显示了在Tableau中进行可视化是多么容易：

![img](../images/Image%20[158].jpg)

我们只有八个标记可以使用。但是我们已经看到Tableau可以填写丢失的日期，此外，我们可以通过使用某些Table Calculations为每个日期的每个生成器填写一个值来进一步强制数据密化。

我们将用一个计算，它利用人的友好值开始On 或Off 将其更改为我们可以很容易地添加值。该计算名为Action 值，并通过以下代码与值一起使用：

如果[操作] =“开”，则1否则0结束

这将给我们一个1计数生成器的时间On，0否则为一个。

额外的计算，加上启用该 Date 字段 的“ **显示缺失值** ” ，使我们可以在每个日期中填写一个值。新的计算字段称为**“日期的操作值”，**并具有以下代码：

IF NOT ISNULL（MIN（[动作值]））

THEN MIN（[动作值]）

ELSE ZN（PREVIOUS_VALUE（MIN（[动作值]）））

结束

这实现了表格计算，我们将设置该表格计算来计算整个表格。如果 MIN([Action Value])不为null，那么我们已经到了数据给出实际值的日期，我们将保留该值。否则，我们将继续执行PREVIOUS_VALUE()（1如果发电机已打开，则为a；如果发电机已关闭，0则为a ）。该ZN()函数会将所有null值转换为0 （我们将假定生成器处于关闭状态，直到遇到On）。我们将遍历表格，结转值，直到遇到数据中存在的值。然后，我们将继续前进。结果是一个表，其中所有日期都填充有值，如下所示：

![img](../images/Image%20[159].jpg)

请注意，每个生成器在其打开的日期得到一个**1**，并且在表上携带**1**，直到关闭该生成器为止，此时我们得到**0**并携带它。

我们已经结束了，因为我们现在要做的就是对给定日期的所有发电机的值求和，以得出开启的发电机数量。例如，在第13天，只有一个。在第25天，共有四个。

我们可以使用嵌套现有计算的另一个计算来完成此操作。我们将命名此计算字段 Generators Operating并使用以下代码：

WINDOW_SUM（[日期的操作值]）

这里的关键是我们要对表中的所有值求和，但我们希望在表中计算这些值。使用**嵌套表计算**（其他表计算的代码中引用了表计算）时，可以为每个嵌套计算指定范围 / 方向或寻址 / 分区。

例如，在这里，我们将“ 发电机运行计算”字段添加到“ 行”，并使用下拉 菜单选择“ 编辑表计算”选项：

![img](../images/Image%20[160].jpg)

请注意，在“ 嵌套计算” 标题下，有一个下拉列表，您可以在其中更改每个嵌套计算的“ 使用计算”选项。在这里，我们将设置 Generators Operating 为Table（向下），并 Action Value 设置 Date 为Table（跨）。

经过一点清理后，我们的最终视图将如下所示：

![img](../images/Image%20[161].jpg)

最终视图清楚地表明了在给定日期有多少个生成器处于运行状态，即使这些日期中的许多都不存在于数据中，并且我们当然也没有每个日期的每个生成器都有记录。

我们通过执行以下操作对视图进行了一些清理：

- 我们添加了一个First() == 0 过滤器，该过滤器是通过Table（向下）计算的，因为我们可以获取每个生成器的操作值 总和，Date而只需要显示一组总计即可。
- 我们已经隐藏了的列标题 Generator，因为该字段需要在视图中才能定义视图的详细程度，但无需显示。
- 我们已将标记更改为Area。

通过将每个生成器与每个日期连接起来以获取每个组合的记录，在源头上更密集地加密数据会更容易还是更好？很有可能。如果有可能，在给定数据源的情况下，执行这样的连接，您可能会得到一个在Tableau中使用起来容易得多的数据集（而不必使用数据致密化或复杂的表计算）。

您必须根据数据量，数据库的基础功能以及完成转换的速度来评估在源处填充丢失数据的可行性。了解数据密度会为您提供一些选择，以供您考虑是否无法对源进行整形。

但是，使用Tableau Prep，通常很容易实现重塑数据的可能性。我们会考虑一些这些可能性的时候，我们在考察的Tableau准备[第10章](docs/Book.md#page_217)， *介绍的Tableau准备*。

### 总结 <div id="page_145"></div>

在本章中，我们涵盖了有关表计算的许多概念。现在，您有了一个坚实的基础，可以理解从快速表计算到高级表计算和数据浓缩的所有内容。我们所介绍的实际示例几乎没有触及任何可能的表面，但是应该使您对可以实现的目标有所了解。可以解决的问题种类和可以回答的问题种类几乎是无限的！

在接下来的两章中，我们将注意力转移到一些较轻的主题上，着眼于格式和设计，但是在完成之前，我们当然会看到另外一两个Table Calculation！

## 第六章 使外观看起来很棒并且工作良好 <div id="page_146"></div>

Tableau默认情况下会应用许多良好的视觉习惯，并且为了进行快速分析，您可能不必担心更改许多默认设置。但是，在考虑如何最好地交流发现的数据故事时，您将要考虑如何利用从字体和文本到颜色和设计的所有内容，以便可以与受众进行良好的交流。

Tableau的格式设置选项为您提供了很大的灵活性。字体，标题，标题，颜色，行和列带，标签，阴影，注释等等，都可以自定义，以使您的可视化效果令人印象深刻。

本章将涵盖以下主题：

- 可视化注意事项
- Tableau中的格式设置基础
- 为可视化增值

### 可视化注意事项 <div id="page_147"></div>

从您开始将字段放到架子上开始，Tableau就采用了良好的格式化和可视化做法。您会发现离散调色板使用易于区分的颜色，合适的字体，适当的网格线以及数字和日期遵循元数据中定义的默认格式设置。

默认格式足以进行发现和分析。如果您的重点是分析，那么在您进入分析周期之前，您可能不想花太多时间来微调格式。但是，当您考虑如何与他人交流数据时，您可能会考虑对格式的调整如何对数据故事的讲述方式产生重大影响。

*有时，您会牢记某些格式设置首选项或一组决定字体和颜色选择的公司准则。**在这些情况下，您可以在空白工作簿中设置格式选项并将其另存为模板。*

以下是您应考虑的一些事项：

- **听众**：谁是听众，听众有什么需求？
- **目标**：目标是唤起您的情感反应或为事实做出决定以做出热情洋溢的决定吗？您是要突出显示需要采取的行动，还是只是试图引起对某个话题的兴趣？
- **设置**：这是在其中交流数据故事的环境。它是正式的商务会议，其格式应反映出较高的专业水平？是否要在博客上非正式地共享？
- **模式**：如何呈现可视化效果？您需要确保行，列，字体和标记的大小足以容纳投影机，或者足够紧凑以容纳iPad。如果要发布到Tableau Server，Tableau Online或Tableau Public，那么您是否选择了对Web安全的字体？您是否需要使用设备设计器来创建仪表板的不同版本？
- **心情**：某些颜色，字体和布局可用于设置心情。数据是否讲了一个故事，应该引起听众一定的回应？数据故事是阴沉还是好玩？例如，红色可能表示危险，负面结果或表示需要采取措施。但是，您需要对受众和特定上下文保持敏感。颜色在不同的文化和环境中具有不同的含义。在某些文化中，红色可能表示喜悦或幸福。此外，如果红色是公司徽标的颜色，则红色不是传达负性的好选择。
- **一致性**：通常，在所有可视化中使用相同的字体，颜色，形状，线条粗细和行带。当它们在仪表板中一起显示甚至在同一工作簿中使用时，尤其如此。您还可以考虑如何在整个组织中保持一致而不过于僵化。

所有这些注意事项将为您的设计和格式化决策提供依据。与使用Tableau进行的其他所有操作一样，将设计视为迭代过程。经常从目标受众那里征求反馈意见，并根据需要调整自己的做法，以确保您的交流尽可能清晰有效。格式化的整个目标是更有效地传达数据。

### 利用Tableau中的格式 <div id="page_148"></div>

在本章中，我们将重点介绍工作表级别的格式，因为我们已经介绍了元数据，还将介绍仪表板和故事。但是，最好在**Tableau中**查看格式化的整体情况。

Tableau使用默认格式，包括默认字体，颜色，阴影和对齐方式。此外，您可以自定义几种格式设置，如下图所示：

![img](../images/Image%20[162].jpg)

- **数据源级别**： 我们已经了解了如何为数字和日期字段设置默认格式。其他默认值，例如颜色和形状，也可以使用 数据窗格下拉菜单中的**默认属性** 菜单进行设置。

- **工作簿级别**：可以设置各种全局格式设置选项。从菜单中，选择 格式 | 工作簿。

- **故事级别**：导航到故事选项卡，然后选择“ 格式”  |“故事”。 故事（或 Story | Format）可编辑特定于故事的元素的格式。其中包括用于自定义阴影，标题，导航器和描述的选项。

- **仪表板级别**：可以格式化仪表板特定的元素。查看仪表盘时，选择 格式 |格式。仪表板（或 Dashboard | Format）可指定仪表板标题，字幕，阴影和文本对象的格式。

- **工作表级别**：我们将考虑各种选项。以下格式可用于工作表：

- **图纸格式**：此格式包括字体，对齐方式，阴影，边框和线条。您可以覆盖整个工作表的格式，以实现行和列特定的格式。
- **字段级格式**：此格式包括字体，对齐方式，阴影以及数字和日期格式。此格式特定于字段在当前视图中的显示方式。您在字段级别设置的选项将覆盖在工作表级别设置的默认选项。数字和日期格式还将覆盖默认的字段格式。
- **附加格式**：附加格式可以应用于标题，标题，工具提示，标签，注释，参考线，字段标签等。

- **富文本格式**：  标题，标题，注释，标签和工具提示都包含可以用不同的字体，颜色和对齐方式进行格式化的文本。此格式特定于单个文本元素。

#### 工作簿级别的格式化 <div id="page_149"></div>

通过Tableau，您可以在工作簿级别设置某些格式默认设置。要查看选项并更改默认值，请单击“ 格式” |“ 格式”。工作簿...。现在，左窗格将显示工作簿的格式选项：

![img](../images/Image%20[163].jpg)

这些选项包括更改默认字体（可应用于视图或仪表板的各个部分）和默认线（可应用于可视化中使用的各种线型）的功能。如果您希望恢复为默认格式，也请注意“ 重置为默认值”按钮。

#### 工作表级格式 <div id="page_150"></div>

您已经在上一章中看到了如何编辑元数据，并且在以后的章节中将详细介绍仪表板和故事。因此，我们将注意力转移到 工作表级格式上。

在具体研究如何调整格式之前，请考虑与格式相关的视图的以下部分：

![img](../images/Image%20[164].jpg)

该视图包含以下部分，可以对其进行格式化：

1. **行的**字段标签：可以从菜单中设置字段标签的格式（“ 格式” |“ 字段标签...”），也可以在视图中右键单击它们，然后选择“ 格式...”。此外，您可以从菜单中隐藏字段标签（“ 分析” | 表布局，然后取消选中用于显示字段标签的选项）或通过在视图中右键单击它们并选择隐藏选项。您可以使用 分析 | 如果需要，可以使用顶部菜单上的“ 表格布局”选项再次显示它们。
2. **列的字段标签**：这些标签与行的标签具有相同的选项，但它们的格式或显示/隐藏可以独立于行字段标签。
3. **行标题**：除非您仅为行的标题指定不同的格式，否则它们通常遵循标题的格式。请注意，小计和盛大都有标头。标为a和b的小计和总计标题 是总行标题。
4. **列标题**：除非您仅为列的标题指定不同的格式，否则它们通常遵循标题的格式。请注意，小计和总计都有标题。上图中标记的总计标题 是列标题。
5. **窗格**：许多格式设置选项都包括与标题不同的格式化窗格的功能。
6. **总计（列）窗格**：这是可以在工作表或列级别设置格式的总计窗格。
7. **总计（行）窗格**：这是可以在工作表或行级别设置格式的总计的窗格。

工作表级别的格式化是使用“ 格式”窗口来完成的，该窗口将显示在左侧，而不是数据窗格。

要查看格式窗口，请从菜单中选择“ 格式 ”，然后选择“ 字体”，“ 对齐方式”，“ 阴影”，“ 边框 ”或“ 线条”：

![img](../images/000075.gif)

*您也可以右键单击视图中几乎所有元素，然后选择“* **格式”***。**这将打开特定于所选元素上下文的格式窗口。**只需确认格式窗口的标题与您期望的匹配即可。**进行更改时，您应该立即看到视图更新以反映您的格式。**如果不这样做，则可能是在格式设置窗口的错误选项卡中工作，或者您可能已在较低级别（例如***Rows***）**格式化了某些内容* *，而在较高级别（例如***Sheet***）上**进行了更改* *。*

现在，您应该在左侧看到格式窗口。它将类似于以下内容：

![img](../images/Image%20[165].jpg)

请注意格式化窗口的这些关键方面：

- 窗口标题将为您提供格式选择的上下文。
- 顶部的图标与“ **格式”**菜单的选择选项匹配。这使您可以轻松浏览这些选项，而无需每次都返回菜单。
- 三个选项卡： Sheet，Rows和Columns，使您可以在工作表级别指定选项，然后在行和列级别覆盖这些选项和默认值。例如，你可以使 **行**总计有比不同的窗格和标题的字体 **列**总计（虽然这个具体的选择很可能是不和谐的，并且不推荐！）
- 右上角的“ 字段”下拉列表使您可以在字段级别微调格式。
- 您所做的任何更改都将被预览并显示为粗体标签，以指示格式选项已从默认值更改（请注意，“ **Total”**下“ **Header** ”的字体是如何自定义的，导致“ **Header”**的标签文本显示在胆大）。

*清除格式的三个选项如下：*

- **清除单个选项***：在格式窗口中，右键单击标签或您已更改的任何单个选项的控件，然后**从弹出菜单中**选择“**清除* *”。*  
- **清除所有当前选项***：在格式窗口的底部，单击“**清除”**按钮以清除所有可见的更改。**这仅适用于您当前在格式窗口中看到的内容。**例如：如果您正在**“**行”**选项卡**上**查看“* *底纹* *”**，然后单击“**清除”**，则只会**清除* *“**行”**选项卡**上的底纹选项**。*
- **清除表***：从菜单中，选择**工作表* *|* *清除* *|* *格式化**。**您也可以使用工具栏上清除项目中的下拉菜单。**这将清除当前工作表上的所有自定义格式。*  

其他格式选项（例如，对齐方式和阴影）都与字体选项非常相似。仅需提及一些微妙之处：

- **对齐**包括用于水平和垂直对齐，文本方向和文本环绕的选项。
- **阴影**包括用于行和列条带的选项。条带允许交替使用不同的阴影图案，以帮助区分或分组行和列。默认情况下，文本表启用了行分隔带，但在其他可视化类型（如水平条形图）中也很有用。可以将行带设置为不同的级别，这些级别对应于行或列架子上存在的离散（蓝色）字段的数量。
- **边框**是指在单元格，窗格和标题周围绘制的边框。它包括行分隔符和列分隔符的选项。您可以在视图中看到部门之间的分隔线。默认情况下，边框级别是根据行或列中的倒数第二个字段设置的。
- **线**是指在可视化中使用轴绘制的线。这包括网格线，参考线，零线和轴标尺。您可以从菜单的“格式”选项访问参考线和下拉线的更完整的选项集。

#### 字段级格式化 <div id="page_151"></div>

在格式窗口的右上角是一个名为Fields的小下拉菜单。选择此下拉菜单可为您提供当前视图中的字段列表，选择一个字段将使用适合该字段的选项更新格式窗口。例如，这是该SUM(Sales)字段显示的窗口：

![img](../images/Image%20[166].jpg)

格式窗口的标题将提醒您要格式化的字段。为Font，Alignment等选择图标，将切换回图纸级格式。但是，您可以在**Axis** / **Header**和**Pane**的选项卡之间切换 。字段的选项包括“ 字体”，“ 对齐”，“ 阴影 ”以及“数字和 日期”格式。最后两个选项将覆盖任何默认的元数据格式。

##### 自定义数字格式 <div id="page_152"></div>

更改数字格式时，可以从几种标准格式和自定义格式中进行选择。自定义格式允许您输入Tableau用来格式化数字的格式字符串。您的格式字符串可以使用井号/井号（＃），逗号，负号和括号的组合，以及用引号引起来的文字字符串以指示数字的显示方式。

格式字符串最多允许三个条目，以分号分隔，以表示正，负和零格式。

以下是一些示例，假设正数为 34,331.336，负数为-8,156.7777：

![img](../images/000012.gif)

请注意，Tableau如何根据格式字符串四舍五入数字。始终请注意，由于格式的原因，您看到的作为文本，标签或标题的数字可能已经四舍五入。

还请注意如何将格式字符（如井号，逗号和小数点）与字符串混合使用。所示的第四个示例将给出相同的标签，其中通常会显示零值。

最后，请注意，最后一个示例使用Unicode字符，它为您提供了广泛的可能性，例如显示度数或其他度量单位。整个Tableau中，文本框，标题，字段名称和标签，别名等中都可以使用Unicode字符！

*选择接近所需格式的预定义格式，然后切换到自定义格式，将使您可以从接近的自定义格式字符串开始。*

##### 自定义日期格式 <div id="page_153"></div>

以类似的方式，您可以使用自定义字符串定义自定义日期格式。下表说明了基于各种格式字符串的日期值11/ 08/ **2018，1** : **30** **PM**的一些可能格式 ：

![img](../images/000255.gif)

这些仅是示例，您可以根据需要包含尽可能多的文字字符串。有关自定义日期格式字符串选项的完整列表，请访问 <https://onlinehelp.tableau.com/current/pro/desktop/en-us/dates_custom_date_formats.html。>

##### 空格式 <div id="page_154"></div>

格式化字段的另一个方面是专门格式化**NULL**值。格式化字段时，选择“ **窗格”**选项卡并找到“ **特殊值”**部分，如以下屏幕截图所示：

![img](../images/Image%20[167].jpg)

当字段的值为空时，输入要显示在窗格中的任何文本（在“ **文本”**字段中）。您也可以选择标记的显示位置。“ **标记”**下拉菜单提供了多个选项，这些选项定义了在使用轴时应在何处以及如何绘制空值标记。您有以下选择：

- 在“指示器处显示”将显示一个小的指示器，在视图的右下角具有空值数量。您可以单击指示符中的选项以过滤空值或将其显示为默认值。您可以右键单击指示器以将其隐藏。
- “显示为默认值”会在默认位置（通常为0）显示标记。
- 隐藏（连接线）不会为空值放置标记，但是会在所有非空值之间连接线。
- 隐藏（断裂线） 使行在不显示空值而创建间隙的地方断开。

您可以在下面的屏幕快照中看到这些选项，其中两个空值的位置由灰色带指示：

![img](../images/Image%20[168].jpg)

*您会注意到，前面的折线图在视图中绘制的每个标记的位置都带有小圆圈标记。**当标记类型为线时，单击**颜色**架子会打开一个菜单，其中提供了标记的选项。**所有标记类型都有标准选项，例如颜色和透明度。**某些标记类型支持其他选项，例如边框和/或光环，如下所示：*

![img](../images/Image%20[169].jpg)

在上述屏幕快照中，“ 隐藏（折线）”和“ 在指示器处显示”选项效果很好，因为这两个选项不会掩盖空值。但是，格式化仅对实际的空值有所帮助。这些是数据中存在的记录，但具有空值，表示没有值。

但是，没有12月某些日期的记录。在这些情况下，该值不为null，因为甚至没有数据记录。Tableau仍会在那些缺失的日子之间保持联系，可能难以区分是否存在差距。在这种情况下，考虑启用**数据致密化**（可以通过确保完成这个 小号怎么失踪的日期 选项，从下拉的菜单中选择 DAY(Order Date) 现场 栏目 ，然后添加某些表计算，例如 指数（） 的 详细信息 中的选项 风景）。这将导致Tableau生成缺少日期的数据记录，并将值视为空：

![img](../images/Image%20[170].jpg)

或者，也可以使用其他可视化类型，例如条形图，它可以更清楚地指示丢失的日期：

![img](../images/Image%20[171].jpg)

#### 其他格式选项 <div id="page_155"></div>

也可以从格式窗口访问其他格式选项。这些选项包括：

- **参考线**有多种选择
- **放置线的**行和文本选项
- **标题**和**标题的**阴影和边框选项
- **注释的**文本，框和行选项
- **字段标签的**字体，底纹，对齐方式和分隔符选项
- **图例**，**快速过滤器**和**参数的**标题和正文选项
- **单元格大小** 和**工作簿主题**选项

您会发现其中大多数都相当简单。一些选择可能不太明显：

- **垂直线**，其显示为从标记到轴线画出的线条，可以通过启用右键点击视图的窗格中的任何空白区域具有轴线并选择垂直线 | 显示放线。可以使用相同的右键菜单并选择编辑下拉线来访问其他选项。放线仅显示在Tableau Desktop和Reader中，但当视图发布到Tableau Server，Online或Public时当前不可用。

- 通过从菜单中选择“ 工作表 ”，然后选择所需的选项，可以为任何视图显示或隐藏**标题**和**标题**。除了可以应用于标题和标题的标准格式外，还可以编辑标题或标题的文本，并通过双击标题或标题，右键单击标题或标题并选择Edit或通过以下方式来专门设置其格式：使用标题或标题的下拉菜单（或仪表板上视图的下拉菜单）。标题和标题文本可以动态包括参数值，视图中任何字段的值以及某些其他数据和特定于工作表的值。

- **注释** 可以通过以下方式创建右击视图中的标记或者间隔，选择**注释**， 并选择以下三种类型的注解中的一种：

- **标记**注释与视图中的特定标记关联。如果该标记未显示（由于过滤器或轴范围），则注释也将不显示。标记注释可以包括定义标记或其位置的任何字段的值的显示。
- **点**注释被锚定到视图中的特定点。如果该点在视图中不可见，则注释将消失。点注释可以包括定义点位置（例如，轴的坐标）的任何字段值的显示。
- **区域**注释包含在一个矩形区域内。所有注释的文本可以动态包含参数的值以及某些其他数据和特定于工作表的值。

*您可以从一个工作表中选择复制格式到另一个（同一工作簿内或跨工作簿）**复制格式**从***格式***菜单，同时查看源工作表（或选择**复制格式**从右键菜单源工作表标签上的选项） 。**然后，**在查看目标工作表时**在“* *格式”**菜单**上**选择“* *粘贴格式* *”* *（或从“* **目标***工作表”选项卡**的右键单击菜单中选择**选项）。* *此选项会将源工作表上存在的所有自定义格式应用于目标。**但是，在标题，标题，标签和工具提示的文本编辑过程中应用的特定格式不会复制到目标工作表中。*

### 为可视化增值 <div id="page_156"></div>

现在，我们已经考虑了格式化在Tableau中的工作方式，下面让我们看一下格式化可以为可视化添加价值的一些方法。

应用自定义格式时，请始终问自己，格式化对理解数据有何帮助。它使可视化更加清晰和易于理解吗？还是只是增加混乱和噪音？

通常，尝试一种简约的方法。从可视化中删除所有不必要的内容。强调重要的价值，文字和标记，而不再强调仅提供支持或上下文的内容。

考虑以下可视化，全部使用默认格式：

![img](../images/Image%20[172].jpg)

默认格式效果很好。但是，将其与该可视化进行比较：

![img](../images/Image%20[173].jpg)

前面的两个图均按季度显示了销售额，并已过滤到办公用品部门。除了顶视图在“ **列** ”上具有“部门”字段以试图清楚地表明仅显示办公用品销售外，这两个视图的字段排列完全相同。第一个视图使用默认格式。

在第二个视图中考虑一些自定义项：

- 标题已调整为包括部门名称。
- 已将销售格式设置为使用具有两个小数位和百万个单位的自定义货币显示。轴和注解也是如此。通常，较高的精度可能会使可视化混乱。数据的初始视图为我们提供了趋势和足够的细节，以了解数量级。工具提示或其他视图可用于显示细节并提高精度。
- 通过右键单击轴，选择“ 编辑轴”，然后清除文本，可以删除轴标签。视图的标题清楚地表明您正在查看Sales。仅这些值就显示第二个轴是四分之一。如果数据中有多个日期，则可能需要指定使用哪个日期。根据您的目标，您可以考虑完全隐藏轴。
- 行上的网格线已被删除。网格线可以为视图添加值，尤其是在能够确定值的视图中。但是，它们也可能使混乱和分散注意力。您需要根据视图本身和要讲述的故事来确定网格线是否有用。
- 趋势线已经过格式化，以匹配该线的颜色（尽管它更浅更细），从而不再强调它。此外，置信带已被删除。您必须根据您的需求和受众来决定他们是添加上下文还是混乱。
- 线条，阴影和框已从注释中删除，以减少混乱。
- 注释的大小和颜色已更改，以使其脱颖而出。如果目标只是简单地突出显示行中的最小值和最大值，则标签可能是一个更好的选择，因为可以将标签设置为仅以**Min** / **Max**显示。但是，在这种情况下，较低的数字实际上是视图中的第二最低点。
- 轴标尺和刻度线已经过强调和着色，以与标记和参考线匹配（轴标尺在“ **格式”**窗口的“ **线”**选项下可用）。

格式化还可用于显着改变可视化外观。考虑以下图表：

![img](../images/Image%20[174].jpg)

此可视化几乎与以前的视图相同。但是，底纹已应用于工作表和标题。此外，根据需要将字体变暗或变暗，以在黑色背景上很好地显示。一些人发现这种格式更令人愉悦，尤其是在移动设备上。如果将视图嵌入具有深色主题的网站中，则可能需要这种格式。但是，您可能会发现在深色背景上更难以阅读某些文本。在考虑这种格式是否最适合您的情况时，您需要考虑受众，设置和投放方式。

*使用黑色背景时，应反转**顺序调色板**（基于连续字段的单一颜色渐变）。**这是因为在白色背景上，较浅（较低）到较深（较高）的默认设置效果很好，在深色背景上较暗的颜色突出，较浅的颜色逐渐淡入白色。**在黑色背景上，较浅的颜色更加突出，而较暗的颜色则逐渐变为黑色。**在使用下拉菜单上的调色板编辑调色板时，双击图例或右键单击图例**，然后**选择***Edit Colors ...***，然后选中***Reversed***，* *就会找到反向选项**。*

#### 工具提示 <div id="page_157"></div>

由于它们并不总是可见的，因此工具提示是可视化中容易被忽略的方面。但是，它们增加了微妙的专业性。考虑以下默认工具提示，当最终用户将鼠标悬停在上述屏幕快照中显示的标记之一上时显示：

![img](../images/Image%20[175].jpg)

将其与此工具提示进行比较：

![img](../images/Image%20[176].jpg)

通过单击 “ 标记”卡上的“工具提示”来编辑工具提示 ，这会弹出一个编辑器，可以对工具提示中的文本进行丰富的编辑：

![img](../images/Image%20[177].jpg)

该编辑器类似于用于编辑标签，标题，标题和注释的文本的编辑器。您可以输入文本并根据需要设置其格式。此外，“ 编辑工具提示”对话框还具有一些其他功能：

- 右上角的“ 插入”下拉菜单允许您插入图纸，字段，参数和其他动态值。这些特殊或动态文本对象作为标签包含在文本编辑器中（例如， <SUM(Sales)>）。我们稍后将介绍一下床单的特殊情况。
- 显示工具提示的复选框选项 和指示工具提示样式的下拉菜单（响应式-立即显示工具提示或悬停显示）。
- 包括命令按钮的复选框选项。这是默认设置，您可以在本节的第一个未经编辑的工具提示中观察命令按钮。命令按钮包括诸如Include，Exclude，**Create Sets**等选项。通过右键单击，最终用户仍然可以使用其中的许多选项，因此从工具提示中删除这些选项不会阻止用户完全访问它们。
- 允许按类别选择的复选框选项。启用后，此功能允许用户单击工具提示中显示的尺寸值，从而在视图中选择与该值关联的所有标记 。

*考虑取消选中“* *显示工具提示*  *”的任何视图，这些视图不会显着并有意为用户体验增加价值。*

##### 工具提示中的Viz <div id="page_158"></div>

通过Tableau，您可以将可视化效果嵌入到工具提示中，当您将鼠标悬停在不同的标记上时，这些提示将被动态过滤。通常**在工具提示中**称为**Viz**，这极大地扩展了最终用户可以使用的交互性，向下钻取详细信息的能力以及以不同方式快速查看数据的能力。

在前面的屏幕截图中，通过选择“ 插入” |“ 添加”，将以下标记添加到了工具提示中。床单 | 分类：

<Sheet name =“类别” maxwidth =“ 300” maxheight =“ 300” filter =“ <所有字段>”>

您可以编辑此标签，该标签告诉Tableau在“ 类别”表中显示可视化内容，作为工具提示的一部分。默认情况下，最大宽度和高度设置为300像素。该过滤器指示哪个字段（一个或多个）作为从片材到维兹在工具提示的过滤器。默认情况下，<All Fields>表示视图中的所有尺寸都将充当过滤器。但是，您可以指定一个字段列表，以按视图中存在的一个或多个维度（例如<Department>，<Category>）专门过滤 。

注意带有工具提示的最终视图：

![img](../images/Image%20[178].jpg)

考虑工具提示中Viz的多种可能性：

- 深入研究细节。

- 它可以显示数据的不同方面（例如：地理位置作为

  时间序列的工具提示）。

- 它允许最终用户在更广泛的上下文中查看整体的一部分。

- 多得多

*以下是一些提示，以总结我们在工具提示中对Viz的检查：*

- *一个工具提示中可能包含多个视点。*
- *将**工具提示中使用的工作表**的“* *适合”**选项**设置**为“* *整个视图”**，使其适合最大宽度和高度。*
- *您可以通过右键单击工作表的选项卡并选择**隐藏**来**隐藏**工具提示中使用的工作表**。**要恢复它们，请右键单击工具提示中正在使用的工作表的选项卡，然后选择**取消隐藏工作表**。*

### 总结 <div id="page_159"></div>

格式化的目的是增加手头数据的有效通信。在进行格式化的迭代过程时，请始终考虑受众，设置，模式，心情和一致性。寻找可为您的可视化增加价值的格式，并避免无用的混乱。了解格式在Tableau中的工作原理后，您将能够完善在发现和分析中创建的可视化效果，从而对数据故事进行非常有效的交流。

在下一章中，我们将研究如何在仪表板中将它们结合在一起。

## 第七章 使用仪表板讲述数据故事 <div id="page_160"></div>

在数据发现和分析中，您可能会创建许多数据可视化。这些可视化中的每一个都为您提供了数据中故事的快照。每次对数据的洞察都会回答一个或两个问题。有时，发现和分析阶段足以使您做出关键决定，并且周期已完成。在其他情况下，您需要将快照放在一起以向目标受众传达完整且引人入胜的故事。

通过Tableau，您可以将相关的数据可视化集成到单个仪表板中。该仪表板可以是数据各个方面的静态视图，也可以是完全交互的环境，从而允许用户动态过滤，深入查询数据可视化并与之交互。

在本章中，我们将在几个深入的示例的背景下看一看大多数这些概念，在这些示例中，我们将逐步介绍仪表盘的设计过程。和以前一样，不用担心记住指令列表。相反，应重点了解仪表板的组件和方面为何以及如何工作。

本章 将涵盖 以下主题：

- 仪表板介绍
- 仪表板示例
- 互动互动
- 为不同的显示器设计
- 故事点

对于本章中的示例，我们将返回Superstore Sales前几章中使用的示例数据。继续并创建一个与该数据集具有连接的新工作簿。

### 仪表板的关键概念 <div id="page_161"></div>

在研究一些实际示例之前，让我们花一些时间来了解什么是仪表板以及为什么要创建一个仪表板。

#### 仪表板定义 <div id="page_162"></div>

从Tableau的角度来看，**仪表板**是单个可视化文件的排列，以及布置在单个画布上的其他组件（例如图例，过滤器，参数，文本，容器，图像，扩展，按钮和Web对象）。理想情况下，可视化效果和组件应协同工作，以讲述一个完整而引人注目的数据故事。仪表板通常（但并非总是）是交互式的。

#### 仪表板目标 <div id="page_163"></div>

仪表板的主要目的是将数据传达给特定受众，并获得预期结果。通常，我们会谈论*讲数据故事*。也就是说，数据中包含一种叙述（或多种叙述），可以将其传递给他人。

尽管您可以通过单个可视化甚至一系列复杂的仪表板来讲述数据故事，但单个Tableau仪表板是传达单个故事的最常用方法。每个仪表板都试图通过清晰地显示某些信息来讲述一个故事。在构建故事之前，您应该了解数据所讲述的故事。您如何讲故事，取决于许多因素，例如您的听众，听众访问仪表板的方式以及您希望从听众中引起什么反应。

数据可视化领域的领先专家之一Stephen Few将仪表板定义*为实现一个或多个目标所需的最重要信息的可视显示，并将其合并并排列在一个屏幕上，以便可以在以下位置监视信息一眼*。考虑到此定义是很有帮助的，因为它在数据故事周围以及我们在Tableau中尝试讲述的方式放置了一些关键边界。通常，您的数据故事应遵循以下准则：

- 数据故事应重点关注最重要的信息。不能传达或支持主要故事的任何事物都应排除在外。您可能希望将该信息包含在其他仪表板中。
- 您讲述的数据故事必须满足您的关键目标。您的目标范围可能从提供信息到提供进一步探索的界面，到提示您的听众采取行动或做出关键决策。任何不符合您目标的内容都应保留给其他仪表板。
- 数据故事应易于访问，主要思想应明确。根据您的听众，您可能希望根据数据明确陈述您的结论，或者您可能希望指导听众，以便他们得出自己的结论。

着手构建仪表板时，您将需要仔细考虑自己的目标。您的发现和分析应该已经发现了有关数据及其故事的各种见解。现在，您有责任以符合您的目标和他们的需求的方式，将发现和分析打包为与特定受众的有意义的故事交流。

#### 仪表板方法 <div id="page_164"></div>

有多种方法可以根据您的目标构建仪表板。以下绝不是完整列表：

- **指导性分析**：您已经进行了分析，进行了发现，从而对数据故事的含义有了深刻的了解。通常，设计一个仪表板来指导您的听众完成类似的发现自己的过程通常会很有帮助，因此明确采取行动的必要性。例如，您可能在营销部门发现了浪费的支出，但是财务团队可能不准备接受您的结果，除非他们能够看到数据如何使您得出结论。
- **探索性的**：很多时候，您都不知道在下一小时，下一周或明年何时刷新数据时，数据将讲述什么故事。今天故事的重要方面可能不是将来的重要决策点。在这些情况下，您的目标是为受众提供一种分析工具，使他们能够自行探索数据的各个方面并与之交互。例如，今天，所有地区的客户满意度都很高。但是，您的仪表板需要使营销团队具有不断跟踪满意度的能力，按产品和价格动态过滤并观察与质量和交货时间等因素的任何关联。
- **记分卡/状态快照**：**关键绩效指标**（**KPI**）或衡量**绩效**好坏的度量标准可能已达成广泛共识。您无需通过发现来指导观众或强迫他们去探索。他们只需要一个顶级摘要和足够的细节，然后向下钻取即可快速发现并解决问题并奖励成功。例如，您可能有一个仪表板，该仪表板仅显示有多少尚未解决的支持凭单。管理者可以拉起移动设备上的仪表板，并在必要时立即采取措施。
- **叙述**：这种仪表板强调一个故事。可能会有一些探索，指导性分析或性能指标方面的内容，但主要是您从数据中讲出一个故事。例如，您可能希望讲述疾病爆发的故事，包括疾病的传播地点，时间和传播方式。仪表板以可视方式使用数据来讲述故事。

我们将看几个深入的示例，以更好地理解其中的一些不同方法。在此过程中，我们将吸收前几章介绍的许多技能，并介绍Tableau中设计仪表盘的关键方面。

*您的仪表板可能采用混合方法。**例如，您可能有一个探索性仪表板，突出显示一些KPI。**但是，请注意不要使仪表板超载。**试图通过任何一个仪表板实现一个或两个以上目标可能会导致压倒性的混乱。*

### 在Tableau中设计仪表板 <div id="page_165"></div>

无论您的目标或方法是什么，每次在Tableau中设计仪表板的实际任务都会看起来相似。在本节中，我们将介绍一些基本概念。

#### 对象 <div id="page_166"></div>

仪表板由布置在画布上的对象组成。您会在仪表板的左侧窗格中看到可以添加到仪表板的对象列表：

![img](../images/Image%20[179].jpg)

该窗格包括以下对象：

- 水平：一个布局容器，其他对象将在其中排成一排（水平）。
- 垂直：一个布局容器，其他对象将在其中排列（垂直）。
- 文本：允许您在仪表板中包含格式丰富的文本的对象。
- 图像：一个图像（例如， .gif，.png，.jpeg），其可以被定位和尺寸上的仪表板。（可选）您可以设置用户单击图像时用于浏览的URL。
- 网页：允许您将网页内容嵌入到仪表板中的对象。您可以在设计时设置URL。我们还将考虑如何使用操作来动态更改URL。
- Blank：一个空白对象，可用作占位符或提供间距选项。
- 按钮：提供导航到工作簿中其他仪表板和工作表的方法。
- 扩展：Tableau，第三方（甚至可能是您！）开发的越来越多的工具之一，它利用扩展API为仪表板提供扩展功能。这可以让您完成诸如收集大量使用数据，动态更新参数，合并来自其他平台（例如D3）的可视化等工作！

除了可以通过 边栏添加的对象之外，还有其他对象可能适用于给定的仪表板：

- **过滤器**：这些将作为最终用户的控件出现，以便他们可以选择要过滤的值
- **参数**：与过滤器类似，这些将显示为最终用户选择参数选项的控件
- **页面控件**：这些控件为最终用户提供用于翻阅数据的选项
- **图例**：包括颜色，大小和形状的图例，以帮助最终用户理解各种可视化效果
- **荧光笔**：这些使用户可以突出显示视图中的各种尺寸值
- **仪表板标题**：特殊文本对象，默认情况下显示仪表板工作表的名称

##### 平铺与浮动 <div id="page_167"></div>

对象是平铺的还是浮动的。如果是平铺对象，它将捕捉到放置它的仪表板或布局容器中。如果它是一个浮动对象，它将在仪表板上分层浮动。您可以更改浮动对象的图层顺序。

您会在前面的屏幕快照中的“ 对象”面板正下方看到“ 平铺”或“ 浮动”按钮。这些按钮定义了放置在仪表板上的对象的默认设置，但是您可以更改任何给定对象是平铺还是浮动的。

*拖动对象**时，**按住Shift**键可将其快速从平铺更改为浮动，或从浮动更改为平铺。*

随着您在设计仪表板方面的经验，您可能会倾向于使用主要是平铺方法或主要是浮动方法进行设计。（您可以在任何仪表板上混合平铺和浮动对象）。许多设计师发现一种设计方法或另一种适合他们的风格。以下是一些注意事项：

- **精度**：浮动对象的大小和位置可以精确到像素完美，而平铺对象在很大程度上取决于其容器的位置和大小。
- **速度**：许多设计师发现平铺布局的创建速度要快得多，因为他们不必担心精度或分层。
- **动态调整大小**：浮动对象在固定大小的仪表板上可以很好地工作，但是根据窗口大小动态调整大小的仪表板会将浮动对象移动到通常不希望的位置。平铺的对象可以更可靠地移动和调整大小（但并非总是完美！）。
- **灵活性**：某些设计技术可以通过一种方法来实现。例如，可以使用浮动技术在背景图像的顶部分层放置透明的可视化效果。然而，片交换（我们将在考虑[第11章](docs/Book.md#page_231)，*高级可视化，技术，技巧和窍门*）通常完成一个平铺的方式。

尝试各种设计技巧，并随时发展自己的风格！

##### 操作仪表板上的对象 <div id="page_168"></div>

您可能希望在对象成为仪表板的一部分后对其进行操作。每个对象都有某些控件，当您选择它们时这些控件将变为可见：

![img](../images/Image%20[180].jpg)

- 握：单击并拖动手柄来移动物体。
- 从仪表板上删除：单击此按钮可从仪表板上删除对象。
- 转到工作表：要在仪表板上编辑单个可视化文件，请使用此按钮导航到单个工作表。
- 用作过滤器：单击此处将视图用作过滤器。现在，在视图中选择一个标记将过滤仪表板中的其他视图。我们将在本章后面的内容中介绍过滤器操作的细节，以及如何更好地控制视图如何用作过滤器。
- 更多选项：此下拉箭头显示该对象的许多选项，包括参数和过滤器的控件显示选项；在视图上显示或隐藏标题或标题；向仪表板添加图例，参数和过滤器；格式，布局和大小选项；和更多。
- 对象大小调整边框：将鼠标悬停在边框上会导致光标更改为大小调整光标。您可以拖动边框以调整对象的大小。

*您可能会注意到不同的大小调整行为，具体取决于对象内部的容器类型以及对象是平铺还是浮动的。*

### 仪表板示例–利润最低的总是不盈利吗？ <div id="page_169"></div>

在涵盖了一些概念性主题以及与仪表板设计相关的实际问题之后，我们将深入探讨一个示例。

假设您的任务是帮助管理层找到利润最低的项目。管理层认为，应从其库存中剔除大部分利润最低的项目。但是，由于您已经进行了分析，因此您发现某些项目虽然总体上没有盈利，但有时会在各个位置获利。您的主要目标是使管理层能够快速查看利润最低的项目的分析，以识别某项项目是否始终没有利润。此示例将结合引导式分析仪表板和探索工具的各个方面。

#### 建立意见 <div id="page_170"></div>

使用Superstore Sales数据集并按照以下步骤构建将构成仪表板基础的单个视图：

1. 创建一个条形图，按类别显示利润。按利润的总和以降序对类别进行排序。
2. 将Department字段添加到“ 过滤器”并显示一个过滤器。为此，请使用Department数据窗格中字段的下拉菜单，然后选择显示过滤器。
3. 命名工作表Overall Profit by Category：

![img](../images/Image%20[181].jpg)

1. 创建另一个类似的视图，按项目显示利润。按利润的总和按降序对项目进行排序。

1. 您会注意到一次有太多物品要看。为了在此仪表板上实现目标，您可以将项目限制为利润最低的前10名。将项目字段添加到过滤器架子，选择顶部标签，然后调整设置以按字段过滤。通过以下指定底部10Sum(Profit)：

![img](../images/Image%20[182].jpg)

1. 将工作表重命名为Top 10 Least Profitable Items：

![img](../images/Image%20[183].jpg)

1. 创建另一个工作表，显示按州填充的利润图。您可以通过双击State数据窗口中的字段，然后将利润放在颜色架子上来相当快地完成此操作。

1. 将工作表重命名为Profit by State：

![img](../images/Image%20[184].jpg)

1. 创建一张最终表以显示何时获利或亏损。确保已将该Order Date字段添加为Quarter日期值，并且该 字段是连续的（绿色）。
2. 添加线性趋势线。为此，请切换到左侧边栏的“ 分析”选项卡，然后将“ 趋势线”从“ 模型”拖到视图中。或者，右键单击视图画布的空白区域，然后选择“ 趋势线”  |“ 趋势线”。 显示趋势线。
3. 将工作表重命名为Profit Trend：

![img](../images/Image%20[185].jpg)

#### 创建仪表板框架 <div id="page_171"></div>

此时，您已经具有实现仪表板目标的所有必要视图。现在，剩下的就是安排它们并实现有效讲述故事所需的交互性：

1. 通过单击所有现有工作表选项卡右侧的“ 新建仪表板”选项卡或选择“ 仪表板” | “ 新建”来创建新仪表板。菜单中的“ 新建仪表板 ”。
2. 将新的仪表板重命名为Is Least Profitable Always Unprofitable?。
3. 在左侧边栏底部，选中显示仪表板标题。
4. 通过将视图从左侧边栏的“ 仪表板”窗格中拖放到仪表板画布中，将其添加到仪表板中。安排如下：

![img](../images/Image%20[186].jpg)

在将视图添加到仪表板之后，您将需要一些时间来重新定位各种元素和视图并调整其大小。

1. 使用Department过滤器上的下拉菜单，然后将控件更改为“ 单个值”（下拉列表）。
2. 您会注意到，更改过滤器的值只会更改Overall Profit by Category视图。您可以使用下拉菜单调整过滤器适用于哪些视图。使用下拉菜单，选择“ 应用于工作表 | 全部使用此数据源。

*可以使用过滤器控件上的下拉菜单或**视图中**“* *过滤器”**架子**上的字段来设置应用过滤器的选项**。**这些选项包括：*

- **所有正在使用的相关数据源***：过滤器将应用于所有与数据源之间的字段相关的数据源。**关系可以从* *数据* *|* *在主菜单上**编辑关系**。*
- **全部使用此数据源***：筛选器将以该数据源作为主要数据源应用于任何视图。*
- **选定的工作表****...***：筛选器将应用于您选择的工作表。*
- **仅此工作表***：筛选器将仅应用于当前工作表。*

1. 从左侧边栏中，将Text对象拖放到上方， Overall Profit by Category然后输入以下说明：

1.从下拉列表中选择一个部门

2.在下面选择一个类别

3.在下面选择一个项目

1. 使用手柄，将Department过滤器移至Top 10 Least Profitable Items视图上方。
2. 调整文本对象的大小，以使“ 前10个”视图与“ 整体”视图对齐。
3. 将“ 利润”颜色图例移到Profit by State视图下方。
4. 使用的下拉菜单Overall Profit by Category，以适合 | 整个视图。这将确保不需要滚动条即可显示所有类别。
5. 另外，将调整Top 10 Least Profitable Items为整个视图。

此时，您的信息中心应类似于以下内容：

![img](../images/Image%20[187].jpg)

#### 采取行动指导故事 <div id="page_172"></div>

现在，您有了一个支持讲述数据故事的框架。您的受众群体将能够在所选类别的上下文中找到利润最低的商品。然后，选择一个项目将回答一个问题，即它是否在每个位置都一直无利可图。要启用此流程并满足您的目标，通常需要启用交互性。在这种情况下，我们将使用动作。我们将以一些具体步骤结束本示例，然后解开复杂的动作：

1. 单击视图上的用作过滤器按钮Overall Profit by Category。这将导致视图被用作整个仪表板的交互式过滤器。也就是说，当用户选择一个条形图时，所有其他视图将根据选择内容进行过滤：

![img](../images/Image%20[188].jpg)

1. 从主菜单中，选择“ 仪表板”。 动作。您会看到一个列表，其中包含一个名为的操作Filter 1 (generated)。这是您 先前选择用作过滤器时创建的操作：

![img](../images/Image%20[189].jpg)

1. 点击添加操作>按钮，然后选择过滤器。出现的对话框为您提供选择源和目标的选项，以及操作的其他选项。
2. 在这里，我们需要一个操作，当用户选择一个项目时，该操作可以过滤除“ 按类别的总体利润”视图以外的所有内容。在“ 添加过滤器操作”对话框中，将“ 原始图纸”设置 为“最赚钱的前10个项目”，将“ 目标图纸”设置为“ 按州和利润趋势划分的利润”。确保将操作设置为在Select上运行。将过滤器命名为“ 按项目过滤”，然后在此对话框上单击“ 确定 ”。在“ 动作”对话框上执行相同的操作：

![img](../images/Image%20[190].jpg)

现在，您具有驱动仪表板的三个过滤器（两个是动作）：

- 从下拉列表中选择一个部门将过滤整个仪表板（实际上是工作簿中的所有视图，因为您将其设置为使用数据源过滤每个视图）
- 选择一个类别（单击栏或标题）将过滤整个仪表板到该选择
- 选择一个项目（单击栏或标题）将按州和利润趋势仪表板过滤利润

*您可以通过单击空白区域或再次单击所选标记来清除视图中的选择。**例如，如果单击“* *书架* *”栏**以选择它（从而过滤仪表盘的其余部分），则可以再单击一次该栏以取消选择它。*

尝试使用过滤器和操作，以查看仪表板的功能。

#### 插曲–上下文过滤 <div id="page_173"></div>

您可能已经注意到，当您使用下拉过滤器选择一个部门或一个类别时，“ 前十名”视图中的项目少于10个。例如，从“ 部门”过滤器中选择“ 家具”，然后单击“ 表 ”栏，将仅显示三个项目。这是因为“  最重要项目”过滤器与操作过滤器同时评估。只有三类表的类别也位于前十名中。

如果要查看表格类别中的前10个项目怎么办？您可以使用上下文过滤器完成此操作。

**上下文过滤器***是Tableau中的一种特殊类型的过滤器，在其他过滤器之前应用。**然后在上下文过滤器的上下文中应用其他过滤器。**从概念上讲，上下文过滤器产生数据的子集，其他过滤器和计算将在该数据子集上进行操作。**除了***顶部过滤器之外***，**还可以在上下文过滤器定义的上下文内计算***计算集***和***固定详细程度的***计算。*

在这种情况下，请导航至“ 前10名”工作表，然后使用“ 过滤器 ”功能区上的字段的下拉菜单将Department过滤器和新添加的动作（Category）过滤器添加到上下文中。一旦添加到上下文中，这些字段在过滤器架子上将为灰色。现在，您将在所选内容和的上下文中看到前10个项目：DepartmentCategory

![img](../images/Image%20[191].jpg)

请注意，将过滤器添加到上下文会使字段在“ 过滤器”功能区上以灰色编码。

*如果您在仪表板上编辑操作，则过滤器可能会自动更新，您可能必须将其重新添加到上下文中。*

继续并通过选择几个不同的类别和几个不同的项目来逐步执行这些操作。通过讲故事来观察最终仪表板如何满足您的目标：

![img](../images/Image%20[192].jpg)

用户从“ 部门”下拉列表中选择了“ 技术 ” ，从类别列表中选择了“ 电话和通讯 ”，然后选择了10631项目，这是该类别中利润最低的项目。这揭示了该物品的销售状态（按利润进行颜色编码）和该物品的时间序列。

管理层应该从库存中删除物料10631吗？并非不首先考虑该项目仅在一次情况下损失了利润，而且这种趋势是朝着更大的获利趋势发展的。当然，最初的损失是巨大的损失，但这也是很久以前的事了，以后每次出售该物品都会产生收益。您的发现结果可能会导致进一步分析，以确定哪些因素在该项目的损益中起作用，并由管理层做出更好的决策。

*当您查看**Chapter 07 Completed**工作簿时，您只会在仪表板的底部看到一个选项卡。**各个视图已隐藏。**隐藏仪表板或故事中使用的工作表的选项卡是保持工作簿整洁并引导听众避免查看在仪表板或故事中可能看到的工作表的好方法。**要隐藏图纸，请右键单击选项卡，然后选择“* *隐藏图纸”**。**要取消隐藏工作表，请使用工作表导航至仪表板或故事，右键单击左侧窗格中的工作**表**，然后取消选中“* *隐藏工作表”**。**此外，通过右键单击仪表板选项卡并选择适当的选项，可以隐藏或取消隐藏仪表板中使用的所有工作表。**工具提示中使用的工作表可能以相同的方式隐藏或取消隐藏。*

### 为不同的显示器和设备设计 <div id="page_174"></div>

设计仪表盘时，您经常会问自己的一些第一个问题是：*我的听众将如何看待该仪表盘？**他们将使用哪种设备？* 随着移动设备的广泛采用，这个问题变得非常重要，因为在大尺寸平板显示器上看起来不错的东西并不总是在平板电脑或手机上看起来不错。

左侧边栏的“ 仪表板”选项卡的顶部 显示一个按钮，用于预览各种设备上的仪表板，以及“ 大小”选项的下拉列表：

![img](../images/Image%20[193].jpg)

单击设备预览按钮，不仅可以查看仪表盘在各种设备类型（甚至特定型号）下的外观，还可以为每种设备类型添加布局，您可以自定义以下布局：

![img](../images/Image%20[194].jpg)

您不仅可以查看仪表盘在各种设备和型号上的显示方式，还可以根据设备的方向以及是否使用Tableau Mobile应用程序（如果适用于所选设备）查看其外观。

单击“ 添加布局”按钮（即前面的屏幕快照中的“ 添加平板电脑布局”按钮）将在左侧边栏的“ 仪表板”选项卡下添加一个布局：

![img](../images/Image%20[195].jpg)

每个布局都可以有自己的大小和适合选项，并且布局选项使您可以从Default切换到Custom。这使您能够为任何给定的布局重新排列仪表板。您甚至可以删除特定布局的视图和对象。例如，您可以将仪表板简化为手机的一个或两个视图，同时保留三个或四个用于桌面显示的位置。

该Chapter 07 Completed工作簿包含利润分析仪表板的示例，并具有几个布局选项。例如，以下是设置为在手机上显示的仪表板，其中该仪表板将根据电话的宽度放置并允许上下滚动：

![img](../images/Image%20[196].jpg)

如您所见，电话仪表板的排列意味着按州  划分的利润和按利润划分的趋势不会出现在电话设备的预览范围内。但是，它们只需轻扫即可。

### 动作如何运作 <div id="page_175"></div>

在Tableau中，**操作**是用户启动的事件，可触发来自Tableau的响应。您已经看到了一些仪表板中正在使用的操作示例。现在，我们将考虑操作在Tableau中如何工作的一些细节。

Tableau支持五种操作：

- **过滤器操作**：用户的操作导致将一个或多个过滤器应用于一个或多个视图。
- **高亮显示操作**：用户的操作使特定的标记和标题在一个或多个视图中高亮显示。
- **URL操作**：用户的操作导致打开特定的URL（在浏览器，新选项卡或嵌入式Web对象中）。
- **设置动作**：用户的动作定义了一个设置。集合可用于计算，过滤器和架子上，以定义标记的视觉属性。这为复杂和创造性的交互提供了很多可能性。
- **参数操作**：用户的操作更改参数的值。这使用户可以通过新颖有趣的方式直观地与参数进行交互！（截至撰写本文时，参数操作尚未发布，但已计划在不久的将来进行）。

Tableau将根据快捷方式自动生成某些操作。例如，您可以从仪表板上视图的下拉菜单中选择“ 用作过滤器”，这将导致自动生成过滤器动作。使用离散色图例上的按钮或从工具栏中启用突出显示，将自动生成突出显示动作：

![img](../images/Image%20[197].jpg)

您还可以通过选择“ 仪表板” |“ 创建”或“仪表板”操作。菜单中的操作。让我们考虑每种动作的细节。

#### 筛选动作 <div id="page_176"></div>

**过滤器动作**由源表定义，这些源表将一个或多个维值作为过滤器传递给**目标**表。请记住，图纸上的每个标记都是由唯一的尺寸值交集定义的。当涉及其中一个或多个标记的动作发生时，可以将构成标记的尺寸值作为过滤器传递到一个或多个目标表。

创建或编辑过滤器操作时，您将看到与以下类似的选项：

![img](../images/Image%20[198].jpg)

该屏幕允许您执行以下操作：

- 命名过滤器。
- 选择**源**表和**目标**表。所述**源**片是用户将启动动作（悬停，选择，菜单），并且**目标**片材，其中将要应用的响应（在该示例过滤，而且突出显示）。
- 设置触发过滤器的动作，以及选择多个标记还是仅单个标记都会启动该动作。
- 选择清除选择后会发生什么。
- 指定用于将过滤器值传递到目标表的尺寸。

*尝试使用名称来命名您的动作，以帮助您区分仪表板中的多个动作。**此外，如果您将操作设置为在**Menu**上运行**，那么您使用的名称将在工具提示中显示为链接。**使用名称右侧的箭头插入特殊字段占位符。**当用户在工具提示中看到菜单选项时，这些内容将使用标记的字段值动态更新。*

您可以根据需要选择任意数量的源表和目标表。但是，如果您在底部指定了特定的“ 目标”过滤器，则所选字段必须出现在“源”表中（例如，在Rows，Columns和  Detail上）。如果一个字段对于一个或多个“源”工作表不可用，并且不会为这些工作表触发操作，您将收到警告。大多数情况下，您的源和目标将是同一仪表板。（可选）您可以指定其他“目标”工作表或仪表板，除了进行过滤外，这还将导致操作导航到目标。

*在工作表级别定义筛选器操作时（查看工作表时，**从菜单中**选择“* *工作表* *|* *操作* *”），该操作的菜单项将显示为使用相同数据源的每个工作表上每个标记的菜单项。**您可以使用它来快速创建工作表之间以及从仪表板到各个工作表的导航。*

可以将过滤器操作设置为发生在三种可能的操作中的任何一种上：

- **悬停**：用户将鼠标光标移到标记上（或在移动设备上点击标记）。
- **选择**：用户单击或点击一个标记，然后矩形/径向/套索通过单击并拖动它们周围的矩形来选择多个标记，然后单击标题（在这种情况下，将选择该标题的所有标记）。用户可以通过单击/轻击已选择的标记，单击/轻击视图中的空白或通过单击/轻击已选择的标题来**取消**选择。
- **菜单**：用户在工具提示上选择操作的菜单选项。

请考虑以下示例，该示例在源中选择一个条时触发的过滤器操作：

![img](../images/Image%20[199].jpg)

源中的每个条形标记均由“ 类别”  维度定义。选择表格栏时，将在目标上设置一个过滤器。

如果标记是由多个维度定义的（例如Category和Region），则目标表仍将具有单个过滤器，其中包含已选择的维度值的组合。在此示例中，过滤器包含Office Machines和West，它们与定义所选正方形的尺寸匹配：

![img](../images/Image%20[200].jpg)

默认情况下，源视图中存在的所有尺寸都在过滤器操作中使用。（可选）您可以指定应使用哪些字段。您可以使用“ 编辑过滤器操作”对话框中的“ 选定字段”选项来完成以下任务：

- 根据较少的尺寸进行过滤。例如，如果仅选择该Region字段，则选择前面的正方形只会将West区域作为过滤器传递到目标。
- 使用其他数据源过滤目标视图。通过“ 选定的字段”选项，您可以将源字段映射到目标字段（即使目标字段名称不同，尽管值仍必须匹配）。例如，如果目标使用的数据源中East是名为Area的字段的可能值，则可以Region从源映射到目标中的Area。

#### 突出动作 <div id="page_177"></div>

这种类型的操作不会过滤目标表。而是，**突出显示动作**会导致至少部分由所选尺寸值定义的标记在目标表中突出显示。高亮操作的选项与过滤器操作非常相似，源表和目标表以及触发事件的事件均相同。

考虑具有三个视图和基于Region字段的突出显示操作的仪表板。当触发东部区域的动作时，由东部定义的所有标记都会突出显示。用于突出显示的尺寸必须出现在要应用突出显示的所有视图中。无论是地图和散点图有Region对细节的的标志牌：

![img](../images/Image%20[201].jpg)

**荧光笔***（也称为***数据荧光笔***）显示为用户控件（类似于过滤器和参数），这些控件会基于用户交互而导致突出显示。**它们可以应用于一个或多个视图，并将突出显示这些视图的标记。**他们不创建动作。* *要添加* *荧光笔**，请在视图中选择任何离散（蓝色）字段，然后使用下拉菜单* *显示荧光笔**。**或者，您可以使用菜单并选择* *分析* *|* *荧光笔**。**在仪表板上，您可以使用视图的下拉菜单并选择* *突出**显示来添加突出**显示**。*

#### URL动作 <div id="page_178"></div>

**URL操作**允许您基于操作动态生成URL，并在仪表板或新的浏览器窗口或选项卡的Web对象中打开它。URL操作可以由与过滤器和突出显示操作相同的事件触发。URL操作的名称将其区别开来，用作菜单时将显示为链接。

该URL包括您输入的任何硬编码值以及可通过URL文本框右侧的箭头访问的占位符。这些占位符包括字段和参数。当根据构成所选标记的字段的值和参数的当前值触发操作时，这些值将动态插入URL字符串中。

如果您在仪表板中包含一个Web对象，则URL操作将自动将其用作目标。否则，该操作将打开一个新的浏览器窗口（在桌面或阅读器中查看仪表板时）或一个新的选项卡（在Web浏览器中查看仪表板时）。

*在iframe中查看某些网页时，行为会有所不同。**浏览器对象不在Tableau Desktop或Tableau Reader中使用iframe，但在将仪表板发布到Tableau Server，Tableau Online或Tableau Public时使用。**您将需要根据受众如何查看仪表板来测试URL操作。*

您可以在创建或编辑URL操作时为URL操作指定目标：

![img](../images/Image%20[202].jpg)

选项包括“ 新建浏览器”选项卡，“ 网页对象”（如果仪表板上有多个对象，则可以选择哪个对象），如果“不存在任何网页对象”，则可以选择“  浏览器选项卡”。如果仪表板上有多个网页对象，则可能希望给它们指定有意义的名称，以使选择更加容易。为此，请切换到左侧窗格上的“  布局”选项卡，然后展开“ 项目”层次结构，直到找到要重命名的对象。右键单击对象，然后选择“ 重命名仪表板项目”：

![img](../images/Image%20[203].jpg)

#### 设定动作 <div id="page_179"></div>

**设置操作**可让您使用一个或多个维度的一个或多个值填充集合。这是非常强大的功能，因为集可以在任何架子上使用以对任何可视元素进行编码，可以在计算中加以利用，并且可以用作过滤器。它们可以以所有这些方式（以及以不同的方式）在不同的视图中使用。这为您提供了难以置信的灵活性，可以通过设定的动作来完成。我们将先花一些时间来更清楚地定义集合，然后再看一个集合动作的示例。

##### 套装 <div id="page_180"></div>

甲**组**中的Tableau定义的来自数据源的记录的集合。在行级，每一个记录或者是 **在**  或**出**的一套。集合有两种类型：

- **动态集合**（有时称为**已计算** 或者 **计算值集**）
- **固定套**

甲**动态集合**计算基于你定义条件计算单个维度。随着数据的变化，该条件的结果可能会改变，记录可以切换 **在**给**出**该组。例如，如果要使用数据窗格中“ 客户名称”上的下拉菜单，然后选择“ 创建” |“ 创建”。Set，那么您可以规定一个条件，该条件定义哪些记录属于该集合：

![img](../images/Image%20[204].jpg)

在这个例子中，我们创建了一个名为一组动态的ç ustomers谁购买超过$ 100与同时通过设置条件求和的销售额大于100。您会注意到，还有一些用于按公式或Top  N计算的选项。所有这些条件都将处于汇总级别（如果使用上下文过滤器，则跨整个数据集或跨上下文），然后评估每个记录是否在集合中。在这种情况下，每个客户的总销售额将整个数据集来计算，然后将每个记录将被计算**在**或**出** 根据该记录的客户的总销售额是否大于$ 100来确定。

甲**组固定**为一个或多个维度的值的列表。如果单个记录的值匹配的集定义的列表中，则记录是**在**设定和**进行**其他方式。例如，您可以基于“ 客户名称” 字段创建另一个集合，这次使用“ 常规”选项卡：

![img](../images/Image%20[205].jpg)

在这里，你可以选择将定义什么是个人价值观**在**或**出**的一套。请注意排除而不是包括值的选项。在这种情况下，我们创建了一个名为的集合Customers with the first name of Aaron。具有“ 客户名称”与我们选择的6个值之一匹配的所有记录都将在集合中。所有其他人都会**出去**。因为这是一个固定集，所以永远不会计算或重新计算这些值。如果下周在数据集中出现了一个名为**Aaron Burr**的客户的记录，则它们仍将**超出**范围。

在下面的示例中，我们将看到set动作对固定集合起作用。

##### 设定动作示例 <div id="page_181"></div>

您将Chapter 7 Complete.twbx 在名为的仪表板的工作簿中 找到一个set动作的示例，Sales by Region and Category (set actions)如下所示：

![img](../images/Image%20[206].jpg)

仪表板包含两个视图：地图和条形图。在地图上选择一个区域会触发一个设置操作，该操作会更新条形图。过滤操作将过滤条形图，导致每个条形的长度仅显示所选区域的值。但是，此处的设置动作用于显示整个条形图属于该区域的部分，同时仍保留所有区域的条形图全长。

若要复制此交互，请按照下列步骤操作：

1. 使用数据窗格上“ 维度 ” Region下的字段上的下拉菜单，选择“ 创建” |“ 创建”。设置。将集合命名为Region Set。
2. 在出现的“ 创建集”对话框的“ 常规”选项卡下，检查一个或多个值。这将创建一个固定的集合。在此示例中，选择哪个值（如果有的话）都没有关系，因为您将配置set操作以立即更新这些值。
3. 创建条形图Sales by Category。
4. 将“ 区域集”从“数据集”上的数据窗格中拖放到“ 颜色”上：

![img](../images/Image%20[207].jpg)

您可以像其他任何领域一样在架子上使用套装。请注意，集合如何给出两个值，即 **In**和**Out**，它们定义了两种颜色。您可能希望调整颜色以强调**In**。

*您也可以在计算字段中使用集合。**例如，代码**[Region Set]**为每个记录给出布尔值true / false，指示它是否***在***集合中。*

通过创建区域地图，仪表板并实施设置动作来结束设置动作示例。

1. 使用在下拉菜单区域，选择地理角色 | 从创建... | 状态。这告诉Tableau根据**地区**与**州State的**关系将**Region**视为地区。
2. 在新的空白视图中，双击“ 区域”字段以创建地图视图。现在，“ **区域”**已被识别为地理区域，Tableau将生成纬度，经度和渲染形状所需的几何形状。
3. 将地图视图和条形图视图都添加到单个仪表板中。您可以根据需要放置它们。
4. 通过选择“ 仪表板” |“ 添加动作” 从菜单中选择“ 操作 ”，然后单击“添加操作”。在出现的对话框中更改设置值...。出现的对话框具有与其他操作类型类似的许多功能：

![img](../images/Image%20[208].jpg)

您会注意到为动作指定名称的选项；在以下位置执行操作： 悬停，选择或菜单；以及清除选择的选项。就像其他动作类型一样，您也可以指定触发动作的“ 源表 ”。该目标设置  允许你指定的数据源和固定在设置数据源将基于动作的更新值。在这种情况下，我们要在“ 按地区销售（设置操作）”视图上进行选择时更新“  地区集”。清除选择后，我们将选择从集合中删除所有值。

一旦创建了前面的动作，仪表板的功能应与本节开头所示的示例非常相似。在地图上选择一个区域会突出显示与该区域相对应的条形部分。这种技术称为**刷涂**或**比例刷涂**。

此技术只是设置动作的数百种可能应用中的一种。由于可以在任何架子上和计算中使用集合，因此通过集合操作更新值将为用户交互和分析提供几乎无限的可能性。

### 仪表板示例–区域记分卡 <div id="page_182"></div>

现在，我们将考虑另一个示例仪表板，该示例演示了稍微不同的目标。假设组织中的每个人都同意“ **利润率”**的关键绩效指标。此外，大家一致认为可接受的利润率与不良利润率之间的分界点是15％，但是管理层希望可以动态调整该值，以查看其他目标是否可能更好。

考虑以下仪表板：

![img](../images/Image%20[209].jpg)

该仪表板使您的听众可以非常迅速地评估过去六个月中每个区域的效果。行政管理人员可以非常迅速地在其移动设备上启用此仪表板，并根据需要采取适当的措施。

仪表板提供了与KPI目标参数的交互性。如果需要，可以提供对其他仪表板或视图的附加钻取。如果此视图在Tableau Server上发布，则认为区域经理可以订阅该视图并收到包含此仪表板的最新图像的计划电子邮件是合理的。

让我们考虑如何创建类似的仪表板：

1. 创建一个名为Profit Ratio KPI Targetset 的float类型参数，并将其设置为initial .15，格式为百分比。
2. 创建以Profit Ratio代码命名的计算SUM([Profit]) / SUM([Sales])。这是一个汇总计算，将利润总额除以视图中定义的详细程度的销售总额。
3. KPI - Profit Ratio用下面的代码创建第二个计算：

IF [利润率]> = [利润率KPI目标]

然后“可接受”

其他“可怜”

结束

该代码将利润率与参数化的临界值进行比较。等于或高于截止点的任何值Acceptable都将获得的值，低于等于截止点的所有值都将获得的值Poor。

1. 创建一个名为的新工作表Region Scorecard。该视图由Region上排，订购日期作为一个离散的日期部分的列，并且KPI - Profit Ratio在两个形状和颜色字段。您会发现形状已被编辑为使用复选标记和Xs，并且调色板使用的是色盲安全的蓝色和橙色。
2. 使用“ 分析”窗格添加“ 列总计”，并使用自定义标签“ 总体”，加粗字体和浅灰色阴影格式化总计。
3. 添加“ 订购日期”  作为过滤器，并将其设置为“ 前6名”字段（“ 订购日期”为“ 最小”）。这将动态过滤最近六个月的视图：

![img](../images/Image%20[210].jpg)

1. 创建另一个名为“ 按地区的利润率”的工作表。
2. 如果跳过了“设置操作”示例，请使用下拉菜单Region选择“ 地理角色” |“ 地理角色”。从创建... | 状态。这会告诉Tableau Region根据其与State地理字段的关系将其视为地理字段。
3. 双击Region数据窗格中的字段。Tableau将自动基于生成地理可视化Region。我们将在[第11章“](docs/Book.md#page_) *高级可视化，技术，技巧和窍门”*中更详细地研究自定义地理位置的创建。
4. 广场Profit Ratio上的颜色和 标签。您还将需要格式化Profit Ratio为百分比。您可以通过在此视图中专门设置字段的格式，或通过在数据窗格中设置字段的默认数字格式来这样做（后者可能是首选，因为您几乎总是希望将其显示为百分比）。
5. 另外，添加Region到Label。重新排列标记卡中的字段以重新排列标签，或单击“ 标签”架子以直接编辑标签文本。
6. 与对“ 地区记分卡”视图一样，对该视图应用相同的过滤器。您可能希望导航到“ 地区记分卡”工作表，并使用“ 过滤器”功能区上“ 订购日期 ”下拉菜单将现有过滤器应用于多个工作表：

![img](../images/Image%20[211].jpg)

一旦创建了两个视图，就可以通过适当安排两个工作表，参数控件和文本来构造仪表板。Chapter 07 Complete 工作簿中的示例已应用了电话布局。尝试各种元素的布局和位置。

*默认情况下，平铺添加到仪表板的所有对象。***平铺***对象会卡入到位并出现在***浮动***对象**下面**。**通过**在左侧窗口中的“* *新建对象”**下切换切换**，或**将对象拖动到仪表板时**按住**Shift**，**可以将任何对象作为浮动对象添加到仪表**板。*

*按住**Shift键，**可以在浮动对象和平铺对象之间切换现有对象**同时移动对象或使用下拉插入符号菜单。**下拉式插入符号菜单还提供用于调整对象的浮动顺序的选项。**此外，可以通过选择浮动对象并使用左下方的定位和大小调整控件来调整浮动对象的大小并以像素精度定位。*

*您可以混合使用平铺和浮动元素，但是许多仪表板作者更喜欢构建完全由一个或另一个组成的仪表板。**这样可确保不同的布局和屏幕尺寸之间的一致性（尤其是在仪表板设置为“* *自动”* *或“* *范围* *大小”选项时）。*

### 故事 <div id="page_183"></div>

该**故事**功能允许您使用诉说仪表板和意见的互动快照故事。快照成为故事中的重点。这使您可以构建引导性的叙述甚至整个演示文稿。

让我们考虑一个故事点可能有用的示例。执行经理对您先前开发的“ **区域记分卡”**仪表板感到满意。现在，他们希望您向董事会做一个介绍，并重点介绍南方地区的一些具体问题。只需花费很少的精力，您就可以制作简单的计分卡，添加一些其他视图并讲述整个故事：

1. 首先，我们将建立几个其他视图。创建一个名为的简单地理视图ProfitRatio KPI by State。使该KPI – Profit Ratio字段与填充的地图定义颜色。
2. 添加Profit Ratio到“ 标记的详细信息 ” 卡，以便以后使用：

![img](../images/Image%20[212].jpg)

1. 再创建一个名为的视图Profit Ratio by Quarter。使用订购日期作为一个连续的日期值列和利润率上的行。
2. 将标记类型设置为条形。为Profit Ratio KPI Target参数值添加参考线（您可以右键单击“ **获利比率”**轴并将其设置为“ 添加参考线...”）。
3. 添加KPI – Profit Ratio到颜色。您可能还希望单击“ 颜色”架子并添加边框。
4. 继续并向南过滤视图，Region并使用下拉菜单将该过滤器也应用于Profit Ratio KPI by State视图：

![img](../images/Image%20[213].jpg)

1. 创建一个新的仪表板，其两个新视图的排列方式与以下屏幕快照所示的排列方式相同。添加Profit Ratio KPI Target参数和Region过滤器（如果未显示）。

1. 使用下拉菜单Profit Ratio KPI by State将该视图用作过滤器：

![img](../images/Image%20[214].jpg)

1. 通过选择故事 | 创建**新故事** 新的故事从菜单中，或者通过使用在旁边的现有表底部的新的故事标签：

*该**故事**的接口包括了所有可见的仪表板和视图的侧边栏。**在顶部，您会看到**Story Title**，可以对其进行编辑。**故事中的每个新点将显示为带有文本的导航框，也可以对其进行编辑。**单击该框将使您可以访问故事点，然后可以在其中添加单个仪表板或视图。*

![img](../images/Image%20[215].jpg)

您可以使用“ 新建空白点” 按钮（用于新的故事点），“ 复制” 按钮（将创建当前所选故事点的副本快照）或“ 另存为新点” 按钮（用于捕获新的故事点）来创建新的故事点。仪表板的当前状态作为新的故事点）。

单击故事点导航框将调出该故事点的视图或仪表板的快照。您可以通过进行选择，更改过滤器，更改参数值和添加注释等操作与仪表板进行交互。更改仪表板的任何方面都会为您提供一个选项，可以将现有故事点更新为仪表板的当前状态。或者，您可以使用导航框上方的“ **还原”**按钮返回到仪表板的原始状态。单击X将删除故事点。

每个故事点都包含一个完全独立的仪表盘快照。将记住特定故事点的过滤器选择，参数值，选择和注释，但不会影响其他故事点或仪表板中的任何其他表。

您可以通过拖放导航框来重新排列故事点。

我们将通过完成以下步骤来构建故事：

1. 以南部地区分析为标题。
2. 将**区域记分卡**仪表板添加为第一个故事点。在地图上选择南部地区。给故事点以下文字：南部地区在过去6个月中表现不佳：

![img](../images/Image%20[216].jpg)

1. 单击“ 新建空白点”按钮以创建新的故事点，并将“ 利润率分析”仪表板添加到该点。
2. 给这个故事点一个标题：只有一个州总体上达到了15％的目标。
3. 右键点击地图上的Virginia，然后选择Annotate | 马克。将状态和利润率保留为注释的一部分：

![img](../images/Image%20[217].jpg)

1. 单击“ 复制”按钮以复制当前故事点。给这个新的故事点一个标题，三个州的字幕 将达到10％的目标。将“ 利润率KPI目标”设置为10.00%并更新该点。
2. 再次单击“ 复制”按钮，并为新创建的点提供某些状态的标题，这些标题在 历史上表现良好。
3. 右键单击“ 弗吉尼亚”的注释，选择“ 删除”将其删除，然后为“ 路易斯安那”添加一个类似的注释。然后，单击路易斯安那州以选择该州。
4. 确保单击“ 更新”按钮以捕获仪表板的状态。

在“ 演示模式”中，不显示用于添加，复制，更新或删除故事点的按钮。您的最终故事应类似于以下内容：

![img](../images/Image%20[218].jpg)

花一些时间来浏览演示文稿。单击导航框将显示该故事点。您可以在每个故事点与仪表板进行完全交互。这样，您可以即时回答问题并挖掘细节，然后继续讲故事。

*了解仪表板技术（以及通常的数据可视化技术）的一种好方法是订阅**“今日的Viz”**（*<http://www.tableau.com/public/community/viz-of-the-day>*）。**每天都会有一个新的可视化，仪表板或故事。**当您看到要理解的设计技术或可视化效果时，可以下载工作簿并浏览使用的各种技术。*

### 总结 <div id="page_184"></div>

准备好分享发现和分析时，您可能会使用仪表板将故事与听众联系起来。您讲故事的方式取决于您的目标，听众和传送方式。使用视图，对象，参数，过滤器和图例的组合，您可以创建一个令人难以置信的框架来讲述数据故事。通过Tableau，您可以为不同设备专门设计布局，以确保您的听众获得最佳体验。通过介绍动作和互动性，您可以邀请您的听众参与故事。故事点将使您可以汇集仪表板和视图的许多快照，以制作和呈现整个叙述。

在下一章中，我们将注意力转移到更深入的分析上，这些分析涉及趋势，分布，预测和聚类。

## 第八章 深入挖掘：趋势、聚类、分布和预测 <div id="page_185"></div>

使用Tableau进行快速的视觉分析对于回答众多问题和做出关键决策非常有用。但这只是勉强划清可能分析的表面。例如，一个简单的散点图可以显示离群值，但是通常，您想要了解分布或识别相似观测值的群集。一个简单的时间序列可以帮助您查看度量随时间的上升和下降，但是很多时候，您希望查看趋势或对未来值进行预测。

通过Tableau，您可以通过统计分析快速增强数据可视化。趋势模型，聚类，分布和预测等内置功能使您可以快速为可视化分析增加价值。此外，Tableau与R和Python平台集成，这为操作和分析数据打开了无穷的选择。

本章将介绍内置的统计模型和分析，包括以下主题：

- 趋向
- 聚类
- 预测
- 发行版

我们将在一些使用一些示例数据集的示例中介绍这些概念。您可以使用Chapter 8工作簿关注并重现这些示例。

### 发展趋势 <div id="page_186"></div>

World Population.xlsx包含在Chapter 08目录中。它包含每个国家从1960年到2015年每年的一项记录，用于衡量人口。使用此数据集，让我们看一下各个国家的历史趋势。创建类似于以下屏幕快照中所示的视图，该视图显示阿富汗和澳大利亚的人口随时间的变化。您会注意到，“ 国家名称”已被过滤为仅包括阿富汗和澳大利亚，并且该字段已另外添加到“ 颜色”和“ 标签”货架中：

![img](../images/Image%20[219].jpg)

单凭此可视化，您可以进行一些有趣的观察。到1980年，两国人口的增长相当相似。那时，阿富汗人口开始减少，直到1988年**阿富汗**人口开始增加。在1996年左右的某个时候，**阿富汗**的人口超过了**澳大利亚**。从那时起，差距进一步扩大。

尽管我们对这两种趋势有所了解，但是当我们看到趋势线时，它们会变得更加明显。Tableau提供了几种添加趋势线的方法：

- 从菜单中，选择分析 |。趋势线 | 显示趋势线。
- 右键单击视图窗格中的空白区域，然后选择显示趋势线。
- 单击左侧边栏上的“ 分析”选项卡以切换到“ 分析”窗格。
- 将趋势线拖放到您选择的趋势模型上（在本示例中，我们将使用线性，并在本章稍后讨论其他内容）：

![img](../images/Image%20[220].jpg)

将**趋势线**添加到视图后，它应包含两条趋势线，每个国家/地区一条。我们将看一下如何自定义显示。现在，您的视图应如下所示：

![img](../images/Image%20[221].jpg)

查询数据源后，Tableau会计算趋势。趋势线是根据视图中的各种元素绘制的：

- **定义X和Y坐标的两个领域**：田野里的行和列定义*X*和*Ÿ*轴坐标描述，允许的Tableau计算各种趋势的模型。为了显示趋势线，必须在行和列上都使用连续的（绿色）字段。该规则的唯一例外是您可以使用“ 离散”（蓝色）date字段。如果使用离散（蓝色）date字段定义标题，则另一个字段必须是连续（绿色）字段。
- **创建多个不同****趋势线的****其他字段**：行，列或颜色架子上的离散（蓝色）字段可用作将单个趋势线拆分为多个不同趋势线的因素。
- **选择的趋势模型**：下一节将检查模型之间的差异。

在交换中观察到有两条趋势线。由于国家/地区名称是Color上的离散（蓝色）字段，因此默认情况下它为每种颜色定义了一条趋势线。

先前，我们观察到阿富汗的人口在各个历史时期内都有所 增加和减少。请注意，趋势线是沿整个日期范围计算的。如果我们希望在那些时间段看到不同的趋势线怎么办？

一种选择是简单地在视图中选择感兴趣的时间段内的标记。Tableau默认情况下将为当前选择计算一条趋势线。这里，例如，对于点**阿富汗**从1980年的，以1988年被选中，并显示一个新的趋势：

![img](../images/Image%20[222].jpg)

另一个选择是指示Tableau 使用行，列或颜色上的离散字段绘制不同的趋势线。

继续并Period使用以下代码创建一个名为的计算字段，该字段定义不同历史时期的离散值：

如果[年份] <= 1979

然后“ 1960年至1979年”

ELSEIF [年份] <= 1988

然后“ 1980至1988”

ELSE“ 1988年至2015年”

结束

将其放在列上时，您将获得每个时间段的标题，该标题会折行并导致每个时间段显示单独的趋势。您还将观察到Tableau在每个期间的轴上保留了完整的日期范围。右键单击日期轴之一，选择“ 编辑轴”，然后选中每一行或每一列的“独立轴范围 ”选项，可以设置一个独立范围：

![img](../images/Image%20[223].jpg)

在此视图中，透明度已应用于颜色以帮助趋势线突出。此外，对于轴年度（经取消选中隐藏的显示表头在球场上的选项）。现在，您可以清楚地看到不同时间段内趋势的差异。在每个时期，澳大利亚的趋势仅略有变化。阿富汗的趋势差异很大。

#### 自定义趋势线 <div id="page_187"></div>

让我们看另一个示例，该示例使我们可以考虑趋势线的各种选项。使用Real Estate数据源，创建与此视图类似的视图：

![img](../images/Image%20[224].jpg)

在这里，我们已经创建了总和的散点图面积（平米）的列来定义*X*轴和的总和Price就行定义*Ÿ*轴。地址已添加到“ 标记的详细信息 ” 卡中，以定义汇总级别。因此，散点图上的每个标记都是由大小和价格定义的位置上的不同地址。已放置在Color上。趋势线已显示。根据Tableau的默认设置，共有三种：每种颜色一条趋势线。置信带已被隐藏。Type of Sale

假设一个很好的模式，该趋势线表明有多少，以及如何快速 的价格预计将在相关走高的增加尺寸为每种类型的销售。

*在此数据集中，我们有两个字段**Address**和**ID**，每个**字段**定义一个唯一的记录。**将这些字段之一添加到“* *详细程度”可以**有效地分解数据，并允许我们为每个属性绘制标记。**有时，数据中可能没有定义唯一性的维度。**在这种情况下，你可以通过解聚取消选中数据**汇总办法**从**分析**菜单。*

*或者，您可以使用“* *行”**和“* *列”**上每个度量字段的下拉菜单**将它们从度量更改为尺寸，同时保持其连续性。**作为尺寸，每个单独的值将定义一个标记。**保持它们连续将保留**趋势线**所需的轴**。*

让我们考虑趋势线可用的一些选项。您可以使用菜单并选择分析 | 编辑趋势线。趋势线 | 编辑趋势线...或通过在趋势线右击，然后选择编辑趋势线......。完成后，您将看到一个类似于以下对话框：

![img](../images/Image%20[225].jpg)

在这里，您可以选择模型类型；选择适用领域作为模型中的因素；允许离散颜色定义不同的趋势线 ; 显示置信带；将*y*截距强制为零；显示选定标记的重新计算趋势；并显示趋势线的工具提示。我们将更详细地研究这些选项。

现在，尝试这些选项。请注意，删除Type of Sale字段作为因素或取消选中“ 允许每种颜色显示趋势线”选项如何导致一条趋势线。

您还可以Type of Sale在添加到Rows的以下视图中查看将字段排除为因子的结果：

![img](../images/Image%20[226].jpg)

如前一个屏幕截图的左侧部分所示，它Type of Sale是一个因素。这导致每种销售类型都有独特的趋势线。如果Type of Sale不考虑作为因素，则绘制相同的趋势线（所有类型的总体趋势）三次。该技术对于将数据子集与总体趋势进行比较非常有用。

#### 趋势模型 <div id="page_188"></div>

考虑到Tableau中可用的趋势模型，让我们回到原始视图并坚持一条趋势线。可以从趋势线选项窗口中选择以下模型。

##### 线性的 <div id="page_189"></div>

如果我们假设随着大小的增加，价格将以恒定的速率增加，那么我们将使用线性模型。不管大小增加多大，我们都希望价格会增加，以便新数据点接近直线：

![img](../images/Image%20[227].jpg)

##### 对数 <div id="page_190"></div>

如果我们期望有一个有效*的收益递减规律，*那么我们将采用对数模型 -也就是说，在买方停止支付更多费用之前，规模只能增加太多：

![img](../images/Image%20[228].jpg)

##### 指数的 <div id="page_191"></div>

我们将使用指数模型来测试以下想法：大小每增加一次，价格就会急剧增加（指数！）：

![img](../images/Image%20[229].jpg)

##### 功率 <div id="page_192"></div>

如果我们认为大小与价格之间的关系是非线性的，并且在对数趋势减小与爆炸性指数趋势之间处于某种程度，则可以采用幂趋势模型。曲线将表明价格是大小与特定功效的函数。功率趋势可以很好地预测某些事件，例如车辆加速或病毒传播所覆盖的距离：

![img](../images/Image%20[230].jpg)

##### 多项式 <div id="page_193"></div>

如果我们认为大小和价格之间的关系很复杂，并且遵循了更多的**S**形曲线，则可以使用该模型，在这种曲线中，最初增大大小会极大地提高价格，但有时价格会趋于平稳。您可以在2到8之间的任意位置设置多项式模型的次数。此处显示的趋势线是3 次多项式：

![img](../images/Image%20[231].jpg)

#### 分析趋势模型 <div id="page_194"></div>

观察趋势线可能很有用，但是通常我们想了解我们选择的趋势模型是否具有统计意义。幸运的是，Tableau使我们对趋势模型和计算有了一定的了解。

只需将鼠标悬停在一条趋势线上，即可显示该公式以及该趋势线的r平方和P值：

![img](../images/Image%20[232].jpg)

*甲***P值***是描述假设值之间的（随机的机会）没有关系的结果是至少尽可能接近由趋势模型预测结果的概率的统计概念。**甲***P值***的5％（0.05）将指示至少描述以及潮流模型值之间的关系的随机机会的5％的机会。**这就是为什么**通常认为5％或以下的***P值***指示明显的趋势模型。**甲***P值***小于5％往往导致更高的统计人员质疑由趋势模型中描述的相关性。*

此外，通过选择Analysis | ，您可以查看趋势模型的详细说明。趋势线 | 从菜单或在视图窗格上单击鼠标右键使用类似菜单来描述趋势模型...。查看趋势模型时，将看到“ 描述趋势模型”窗口：

![img](../images/Image%20[233].jpg)

*您还可以在工作表描述中获得趋势模型描述，该描述可从**工作表**菜单中或通过按**Ctrl* *+* *E获得**。**工作表描述包括有关当前视图的大量其他有用的摘要信息。*

窗口中显示的大量统计信息包括趋势模型的描述，公式，观察**值的**数量以及整个模型以及每个趋势线的**P值**。请注意，在前面显示的屏幕快照中，“ 类型”字段作为定义三个趋势线的一个因素被包括在内。有时，您可能会注意到，即使一个或多个趋势线可能不是：

*附加摘要统计信息可以通过显示一个给定的视图被显示在桌面的Tableau* *摘要**。**从菜单中，选择“* *工作表”**。**显示摘要**。**可以使用“* *摘要”**卡**上的下拉菜单扩展摘要中显示的信息**。*

![img](../images/000020.gif)

##### 导出统计模型详细信息 <div id="page_195"></div>

Tableau还使您能够导出数据，包括与趋势模型有关的数据。这使您可以更深入地甚至直观地分析趋势模型本身。让我们分析一下3 次多项式趋势线的房地产价格和规模散点图上没有任何因素。要导出与当前视图相关的数据，请使用菜单并选择工作表 | 出口 |  数据。数据将导出为Microsoft Access数据库（.mdb）文件，并提示您将文件保存在何处。

*将数据导出到Access的能力仅限于PC。**如果您使用的是Macintosh，则将无法选择该选项，并且可能希望浏览此部分，但请继续前进。*

在“ 将数据导出到访问”屏幕上，指定访问表名称，然后选择是要从整个视图还是当前选择中导出数据。您还可以指定Tableau应该连接到数据。这将生成数据源，并使其在当前工作簿中以指定名称可用：

![img](../images/Image%20[234].jpg)

新的数据源连接将包含原始视图中的所有字段以及与趋势模型相关的其他字段。这使我们能够使用残差和预测来构建如下所示的视图：

![img](../images/Image%20[235].jpg)

预测（*x*轴）和残差（*y*轴）的散点图使您可以直观地看到每个标记距趋势线预测的位置有多远。它还使您可以查看残差是否在零的两侧均匀分布。分布不均可能表明趋势模型存在问题。

您可以将此新视图与原始视图一起包含在仪表板中，以可视化方式探索趋势模型。使用工具栏上的突出显示按钮以“ 地址”字段突出显示：

![img](../images/000356.gif)

定义了突出显示操作后，在一个视图中选择标记将使您能够在另一视图中看到它们。您可以扩展此技术以导出多个趋势模型和仪表板以同时评估多个趋势模型：

![img](../images/Image%20[236].jpg)

##### 使用R和Python进行高级统计（以及更多！） <div id="page_196"></div>

利用Tableau与R或Python集成的功能，您可以实现更复杂的统计分析。**R** 是一个开源统计分析平台和一种编程语言，您可以使用它定义高级统计模型。**Python**是一种高级编程语言，由于其易用性，尤其是在数据清洗和处理以及统计功能方面，已经在数据分析人员中迅速赢得了广泛的关注。

*要使用R或Python，您首先需要安装* **R Server** *或***TabPy** *（Tableau可提供的Python API），然后将Tableau配置为使用R Server或TabPy。* *要了解有关**安装R Server或TabPy的**更多信息**，请查看以下资源：*  

- **R***：*[https](https://www.tableau.com/solutions/r)*：* [//www.tableau.com/solutions/r](https://www.tableau.com/solutions/r)
- **Python***：*[https](https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916)*：* [//www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916](https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916)

一旦安装了R Server或TabPy，就可以配置Tableau与平台进行通信。从菜单中，选择帮助 | 设置和性能 | 管理外部服务连接。这将为您提供与R Server或TabPy建立连接的选项：

![img](../images/Image%20[237].jpg)

此时，您可以创建调用R和Python函数的计算字段。特殊的表格计算（全部以开头SCRIPT_）允许您传递以下内容：

- 表达式和值到运行中的R Server，R Server将使用内置库或自定义编写的R脚本评估表达式并将结果返回到Tableau
- 完整的Python脚本到TabPy以执行并将结果返回到Tableau

例如，您可以创建一个名为Book Title的计算字段，以使用Python脚本将title字段的值从小写转换为大写：

SCRIPT_STR（“ import re

exceptions = ['a'，'an'，'of'，'the'，'is'，'for'，'in'，'into'，'to']

return_list = []

标题在_arg1：

WORD_LIST = re.split（””，标题）

capitalized_title = [WORD_LIST [0] .capitalize（）]

为在WORD_LIST字[1：]：

capitalized_title.append（字如果字在例外其他word.capitalize（） ）

return_list.append（''.join（capitalized_title））

return return_list

“，ATTR（[title]））

整个Python脚本都包装在该SCRIPT_STR()函数中，该函数还接受了字段标题的属性，然后返回将其转换为标题大小写的字符串值。

R和Python都可以用于统计分析以外的领域。您可以实现预测模型，数据清理，空间转换等！可能性是无止境。

### 聚类 <div id="page_197"></div>

Tableau 10引入了在可视化文件中快速执行聚类分析的功能。这使您可以根据选择的任意数量查找相似的单个数据点的组或**群集**。如以下示例所示，这在许多不同的行业和研究领域中可能很有用：

- 市场营销可能会发现基于支出金额，购买频率或订单时间和订单天数来确定彼此相关的客户群很有用。
- 根据诊断，用药，住院时间和再入院次数，了解彼此相关的患者群体可能会使医院的患者护理主管受益。
- 免疫学家可以根据耐药性或遗传标记物寻找相关的细菌菌株。
- 可再生能源顾问希望根据能源生产来确定风车群，然后将其与地理位置相关联。

*Tableau使用标准的k均值聚类算法，每次渲染视图时都会产生一致的结果。**Tableau将自动分配群集数（k），但是您可以选择调整值以及分配任意数量的变量。*

在考虑聚类时，我们将再次转向房地产数据，以查看是否可以在市场上找到相关房屋的分组，然后根据找到的聚类确定是否存在任何地理格局。

尽管您可以将集群添加到任何可视化中，但我们将从散点图开始，因为散点图已经使我们能够看到两个变量之间的关系。这将使我们对群集的工作方式有一些了解，然后我们可以添加其他变量来查看如何重新定义群集。

从地址按大小和价格的基本散点图开始，切换到“ 分析”窗格，然后将“ 群集”拖动到视图中：

![img](../images/Image%20[238].jpg)

将“ 群集”放到视图上时，Tableau将生成一个新的“ 群集”字段（在此处自动放置在“ 颜色”上），并显示一个“ 群集”窗口，其中包含用作变量的字段和一个用于更改“ 群集数”的选项。默认情况下，变量将包含视图中已经存在的度量：

![img](../images/Image%20[239].jpg)

该变量是所有这一切的聚类算法的用途来确定相关的数据点的因素。该集群的数量决定到多少组数据进行分区。在前面的视图中，您将观察到三组房屋：

- 价格低，体积小
- 那些在中间
- 价格高，尺寸大的

因为用于群集的两个变量与用于散点图的变量相同，所以相对容易看到群集的边界（您可以想象两条对角线对数据进行分区）。

您可以将几乎所有字段拖放到变量部分中（从数据窗格或视图中），以添加和删除变量。群集将在您这样做时自动更新。通过将卧室添加到“ 变量”列表进行实验，观察到**群集1**和**群集2**之间存在一些重叠，因为一些较大的房屋只有两个或三个卧室，而一些较小的房屋可能有四个或五个。现在，卧室的数量有助于定义群集。删除卧室，并注意群集将立即再次更新。

一旦有了有意义的集群，就可以通过从视图中将它们拖放到数据窗格中来在数据源中将它们具体化为组：

![img](../images/Image%20[240].jpg)

将在渲染时重新计算群集组。使用群集组可以完成很多工作，包括以下内容：

- 群集组可用于多个可视化，并可用于仪表板中的操作。
- 如果需要，可以编辑群集组，并在组之间移动单个成员。
- 可以对集群组名称进行别名，从而允许使用比**集群1**和**集群2**更多的描述性名称。
- 群集组可以在计算字段中使用，而群集则不能。

在下面的示例中，上一个视图中的“ 地址（集群）”组已对属性的地图进行了颜色编码，以帮助我们根据价格和规模查看集群是否存在任何地理相关性。虽然可以在此可视化中直接创建集群，但是该组具有一些提及的优点：

![img](../images/Image%20[241].jpg)

在此视图中，每个原始群集现在都是一个已别名的组，以提供对该群集的更好描述。您可以使用数据窗格中组字段的下拉菜单，也可以右键单击颜色图例中的项目以编辑别名。

*有很多选项可用于编辑地图的显示方式。**您可以调整地图上显示的图层，以帮助为正在绘制的数据提供其他上下文。**在顶部菜单中，选择**地图* *|* *地图图层**。**图层选项将显示在左侧栏中。**前面的地图已启用了街道，高速公路，县界和邮政编码边界，以使每个地址的位置都更加精确。**可供选择的图层将取决于地图的缩放级别。*

在查看以前的视图时，您确实确实发现了几乎完全是低价格和规模的社区（**集群1**），而几乎是几乎中档的社区（**集群2**）。考虑一下房地产投资者如何使用这种可视化来寻找中端社区中低价房屋的良好购买。

### 发行版 <div id="page_198"></div>

分析分布可能非常有用。我们已经看到，某些计算可用于确定统计信息，例如平均值，百分位数和标准偏差。通过Tableau，还可以轻松快速地可视化各种分布，包括置信区间，百分比，百分位数，分位数和标准偏差。

您可以使用“  分析”窗格添加任何这些视觉分析功能（或者，您可以右键单击轴并选择添加参考线）。就像参考线和带一样，分布分析可以应用于表，窗格或单元格的范围内。拖放所需的视觉分析时，将具有用于选择范围和轴的选项。在以下示例中，我们已将“ 分配范围” 从“ 分析”窗格拖放到由Sum（Price）定义的轴的窗格范围内：

![img](../images/000201.gif)

选择范围和轴后，将为您提供更改设置的选项。您还可以通过右键单击视图中的分析特征或右键单击轴或参考线本身来编辑线，带，分布和箱形图。

例如，除了颜色以外，让我们使用价格和大小以及列上的销售类型来获取地址的散点图：

![img](../images/Image%20[242].jpg)

接下来，我们将“ 分配范围”从“ 分析”窗格拖放到“ 窗格”中，仅适用于Price定义的轴。完成后，将出现一个对话框来设置选项：

![img](../images/Image%20[243].jpg)

在“ 计算”下的“ 值”下拉菜单中指定的每个特定“ 分发”选项都有唯一的设置。例如，“ 置信区间”允许您指定间隔的百分比值。通过“标准偏差”，您可以输入以逗号分隔的值列表，这些值描述了多少个标准偏差以及什么时间间隔。前述设置反映指定标准偏差的**-2**，**-1**，**1**，和**2**。在如上屏幕截图所示调整标签和格式后，您应该看到如下结果：

![img](../images/Image%20[244].jpg)

由于您对每个窗格应用了标准差，因此每种销售类型都有不同的范围。每个轴可以支持多个分布，参考线和波段。例如，您可以在上一个视图中添加一条平均线，以帮助查看者了解标准偏差的中心。

在散点图中，使用每个轴的分布可以产生一种非常有用的分析异常值的方法。通过显示“ 面积”和“ 价格”的单个标准差，您可以轻松地看到属于，不属于或不属于这两个规范的属性（您可以考虑购买大小偏高但价格在正常价格范围内的房屋！） ：

![img](../images/Image%20[245].jpg)

### 预测 <div id="page_199"></div>

如我们所见，趋势模型可以做出预测。给定一个好的模型，您希望其他数据能跟随趋势。当趋势随时间变化时，您可以了解将来的价值可能会下降。但是，预测未来价值通常需要不同类型的模型。诸如季节性之类的因素可能会产生仅凭趋势无法预测的变化。从8.0版开始，Tableau包含内置的预测模型，可用于预测和可视化未来价值。

若要使用预测，您将需要一个视图，其中包含一个日期字段或足够的日期部分以供Tableau重构日期（例如，“ 年”和“ 月”字段）。Tableau 10还允许基于整数而不是日期进行预测。您可以从“ 分析”窗格中拖放“ 预测 ” ，选择“ 分析” |“  分析” 。预测  | 从菜单显示“预测 ”，或右键单击视图的窗格，然后从上下文菜单中选择选项。

例如，以下是阿富汗和澳大利亚随时间推移的人口增长视图，并显示了预测：

![img](../images/Image%20[246].jpg)

请注意，在显示预测时，Tableau将“预测”图标添加到“ 行”上的SUM(Population)字段以指示该度量正在被预测。此外，Tableau 在“ 颜色”中添加了一个新的特殊“ 预测指标”字段，以便将预测值与视图中的实际值区分开。

*您可以移动“* *预测指标”**字段，甚至将其复制（* *拖放时**按住* *Ctrl**键）到其他架子，以进一步自定义视图。*

当您通过选择分析 | 来编辑预测时 预测 | 从菜单中选择“预测选项... ”或使用视图上的右键单击上下文菜单，将为您提供用于自定义趋势模型的各种选项，如下所示：

![img](../images/Image%20[247].jpg)

在这里，您可以选择设置预测长度，确定汇总，自定义模型以及设置是否要显示预测间隔的选项。默认情况下，预测长度设置为“ 自动”，但是您可以通过自定义值扩展预测。

源数据下的选项允许您有选择地为模型指定不同的数据粒度。例如，您的视图可能按年份显示度量，但您可以允许Tableau查询源数据以按月检索值，并使用更细的粒度来潜在地获得更好的预测结果。

*Tableau能够分别查询数据源以获取更细粒度的数据以获得更精确的结果的功能与关系数据源配合得很好。**但是，OLAP数据源与这种方法不兼容，这就是使用多维数据集时无法进行预测的原因之一。*

默认情况下，最后一个值从模型中排除。当您使用最近时间段不完整的数据时，这很有用。例如，每天添加记录时，直到最后一个记录添加到该月的最后一天之前，最后一个（当前）月才完成。在最后一天之前，如果不忽略模型，则不完整的时间段可能会使模型产生偏差。

可以将模型本身设置为有或没有季节性的“ 自动”，也可以自定义以设置季节性和趋势的选项。要了解选项，请从Superstore样本数据考虑以下按月的销售视图：

![img](../images/Image%20[248].jpg)

数据显示出明显的周期性或季节性模式。对于零售而言，这是非常典型的。许多其他数据集将表现出相似的模式。以下是选择各种自定义选项的结果：

![img](../images/Image%20[249].jpg)

与趋势类似，可以使用菜单访问预测模型和摘要信息。选择分析 | 预测 | Describe Forecast将显示一个带有选项卡的窗口，其中包含有关模型的摘要和详细信息：

![img](../images/Image%20[250].jpg)

单击窗口底部的链接将为您提供有关Tableau中使用的预测模型的更多信息。

*仅在特定条件下启用预测模型。**如果禁用该选项，请确保您已连接到关系数据库而不是OLAP，并且没有使用表计算，并且至少有五个数据点。*

### 总结 <div id="page_200"></div>

Tableau提供了广泛的功能集，可为您的分析增加价值。趋势线使您可以更精确地识别异常值，确定哪些值属于某些模型的预测范围，甚至可以预测预期的测量范围。通过Tableau，您可以深入了解趋势模型，甚至可以导出包含趋势模型预测和残差的数据。群集使您可以根据各种因素查找相关数据点的组。分布对于理解值在数据集中的分布非常有用。预测允许使用复杂的趋势和季节性模型来预测未来的结果。对这些工具有充分的了解将使您能够澄清和验证您的初始视觉分析。

接下来，我们将注意力转向数据。我们很早就考虑了如何连接数据，从那时起我们一直在处理数据。但是，我们花费了大部分时间来处理干净，结构良好的数据。在下一章中，我们将考虑如何处理凌乱的数据。

------

# 第三部分：数据准备和结构化 <div id="page_201"></div>

本节演示清理和构建凌乱的真实数据以支持Tableau中的分析的技术。 它着重于使用Tableau Desktop和Tableau Prep解决数据挑战。

本节包括以下章节：

- [第9章](docs/Book.md#page_202)，*第九章 清理和构建混乱数据*
- [第10章](docs/Book.md#page_217)，*Tableau Prep介绍*

## 第九章 清理和构建混乱数据 <div id="page_202"></div>

到目前为止，我们在本书中看到的大多数示例都假定数据结构良好且相当干净。现实世界中的数据并不总是那么漂亮。可能是凌乱的或者结构不好。它可能缺少值或具有重复的值，或者细节级别错误。

您如何处理这些混乱的数据？在下一章中，我们将Tableau Prep Builder视为清理和构建数据的可靠方法。现在，让我们专注于Tableau  Desktop固有的功能，它本身提供了很多选项和灵活性来处理数据问题。我们将研究一些特性和技术，这些特性和技术将使您克服数据结构的障碍。我们还将为良好的数据结构打下坚实的基础。知道哪种数据结构可以与Tableau一起很好地工作是了解如何解决某些问题的关键。

在本章中，我们将重点介绍一些用于构造数据以使其与Tableau一起良好工作的原理，以及一些如何解决常见数据问题的特定示例。本章将涵盖以下主题：

- 为Tableau构建数据
- 联合和跨数据库联接
- 处理数据结构问题的技术
- 数据问题高级修复概述

### 为Tableau构建数据 <div id="page_203"></div>

我们已经看到Tableau可以连接到几乎任何数据源。无论是内置的直接连接，ODBC，还是使用Tableau数据提取API生成数据提取，都没有数据超出限制。但是，某些结构使数据在Tableau中更易于使用。

要确保与Tableau一起良好工作的数据结构，有两个关键：

- 源数据连接的每条记录都应具有有意义的详细程度
- 源中包含的每个度量都应与详细程度相匹配，或可能处于较高的详细程度，但绝对不应处于较低的详细程度

例如，假设您有一张考试成绩表，每所学校的每个教室都有一条记录。在记录中，您可能有三个度量：教室的平均GPA，班级学生人数和学校的平均GPA：

| **学校**   | **课堂** | **平均GPA** | **学生人数** | **学生人数（学校）** |
| ---------- | -------- | ----------- | ------------ | -------------------- |
| 皮卡小学   | 4 个等级 | 3.78        | 153          | 1,038                |
| 皮卡小学   | 5 个等级 | 3.73        | 227          | 1,038                |
| 皮卡小学   | 6 个等级 | 3.84        | 227          | 1,038                |
| 麦考德小学 | 4 个等级 | 3.82        | 94           | 915                  |
| 麦考德小学 | 5 个等级 | 3.77        | 89           | 915                  |
| 麦考德小学 | 6 个等级 | 3.84        | 122          | 915                  |

前两项指标（**平均GPA**和**学生人数**）与个人数据记录（学校中每个教室）的详细程度相同。**学生人数（学校）**的详细程度更高（每个学校）。只要您知道这一点，就可以进行仔细的分析。但是，如果您尝试将每个学生的GPA存储在班级记录中，则会出现数据结构问题。如果数据的结构是为了存储每个年级的所有学生的GPA（也许每个学生都有一列，或者包含用逗号分隔的学生分数列表的单个字段），那么我们需要做一些工作使数据在Tableau中更可用。

了解源**的详细**程度（通常称为**粒度**）至关重要。每次连接到数据源时，您首先要问和回答的问题是：一条记录代表什么？例如，如果您要将“记录数”字段拖放到视图中并观察到1,000条记录，那么您应该能够完成该语句，*我有1,000 _____*。可能是1,000名学生，1,000个测验分数或1,000所学校。很好地掌握数据的粒度将有助于您避免不良的分析，并让您确定您是否拥有分析所需的数据。

*查找数据详细程度的一种快速方法是将“* *记录数”**放在“* *文本”**架子上，然后在“* *行”**架子**上尝试不同的尺寸**。**当所有行均显示为**1**并且状态栏左下方显示的总数等于数据中的记录数时，则该维（或维的组合）将***唯一地标识***一条记录，并定义最低级别的详细信息数据。*

了解了有关数据粒度的总体原理之后，我们将继续学习某些数据结构，这些数据结构使您可以在Tableau中无缝高效地工作。有时，最好使用Alteryx或Tableau Prep  Builder之类的工具在源处重构数据。有时，重组源数据是不可能的或不可行的。在这些情况下，我们将看看Tableau中的一些选项。现在，让我们考虑一下哪种数据结构可以与Tableau一起使用。

#### 良好的结构 — 高而窄而不是短而宽 <div id="page_204"></div>

我们在上一节中提到的一个好的结构的两个关键应该导致一个数据结构，其中一个度量包含在单个列中。您可能有多个不同的度量，但是任何单个度量几乎都不应划分为多列。通常，差异被描述为**宽数据与高数据**。

##### 宽数据 <div id="page_205"></div>

**宽数据**描述了一种结构，其中单行中的度量分布在多列中。这些数据通常更*易于阅读*。宽数据通常导致更少的行和更多的列。

这是人口数表中的宽数据外观示例：

| **国家的名字** | **1960年** | **1961年** | **1962年** | **1963年** | **1964年** |
| -------------- | ---------- | ---------- | ---------- | ---------- | ---------- |
| 阿富汗         | 8,774,440  | 8,953,544  | 9,141,783  | 9,339,507  | 9,547,131  |
| 澳大利亚       | 10,276,477 | 10,483,000 | 10,742,000 | 10,950,000 | 11,167,000 |

请注意，此表的详细程度是每个国家/地区的一行。但是，单个度量（填充）未存储在单个列中。该数据之所以广泛，是因为它只有一个度量（人口），被分为多列（每年一列）。宽表违反了良好结构的第二个关键，因为该度量的详细程度低于单个记录（每个国家/每年，而不仅仅是每个国家/地区）。

##### 高数据 <div id="page_206"></div>

**高数据**描述了一种结构，其中行中的每个不同度量都包含在单个列中。高数据通常导致更多的行和更少的列。

考虑下表，该表代表与之前相同的数据，但结构较高：

| **国家的名字** | **年** | **人口**   |
| -------------- | ------ | ---------- |
| 阿富汗         | 1960年 | 8,774,440  |
| 阿富汗         | 1961年 | 8,953,544  |
| 阿富汗         | 1962年 | 9,141,783  |
| 阿富汗         | 1963年 | 9,339,507  |
| 阿富汗         | 1964年 | 9,547,131  |
| 澳大利亚       | 1960年 | 10,276,477 |
| 澳大利亚       | 1961年 | 10,483,000 |
| 澳大利亚       | 1962年 | 10,742,000 |
| 澳大利亚       | 1963年 | 10,950,000 |
| 澳大利亚       | 1964年 | 11,167,000 |

现在，我们有更多行（每个国家/地区每年都有一行）。个别年份不再是单独的列，总体测量也不再分散在这些列中。相反，一个单柱给我们的一个维度**年**和另一单栏给出的度量**人口**。行数增加而列数减少。现在，总体的度量与单个行的详细程度处于同一水平，因此Tableau中的可视化分析将更加容易。

##### 在Tableau中的宽与高 <div id="page_207"></div>

您可以在Tableau中轻松查看宽数据与高数据之间的区别。以下是左侧数据窗口中的**宽**数据**表**：

![img](../images/Image%20[251].jpg)

正如我们期望的那样，Tableau将表中的每一列都视为一个单独的字段。数据的广泛结构不利于我们。我们最终以每年单独的度量标准。如果您想绘制每年的人口折线图，则可能会遇到困难。什么维度代表日期？您可以对人口使用哪种单一度量？

这并不是说您不能在Tableau中使用宽数据。例如，您可以使用度量名称 / 度量值在单个视图中绘制所有**Year**度量，如下所示：

![img](../images/Image%20[252].jpg)

您会注意到，每年字段都放置在Measure Values架子上。好消息是您可以根据结构不良的数据创建可视化文件。坏消息是视图通常很难创建，某些高级功能可能不可用。由于以下原因，在前面的视图中可能会发生这种情况：

- 由于Tableau没有日期维度或整数，因此无法使用预测
- 由于Tableau在Columns上没有日期或连续字段，因此无法启用趋势线
- 因为每个度量都是一个单独的字段，所以您不能使用快速表计算（例如，运行总计，差异百分比等）
- 确定诸如多年平均人口之类的事情将需要繁琐的自定义计算，而不是简单地更改度量的汇总
- 您没有日期轴（度量值名称只有一堆标题），因此您将无法添加参考线

相反，**高数据**在数据窗格中如下所示：

![img](../images/Image%20[253].jpg)

该数据源更容易使用。只有一个度量（“ 人口”）和“ 年份”维度可以对度量进行切片。如果要按年绘制人口折线图，只需将“ 人口和年”字段拖放到“ 列和行”中。预测，趋势线，聚类，平均值，标准差和其他高级功能将按您期望的那样起作用。

#### 良好的结构 — 星型模式（数据集市/数据仓库） <div id="page_208"></div>

假设它们是经过精心设计的，星型模式数据模型与Tableau可以很好地一起工作，因为它们具有明确定义的粒度，度量和维。此外，如果实施得当，它们可以非常有效地进行查询。在Tableau中使用实时连接时，这可以提供良好的体验。

之所以这么**称呼星形模式，**是因为它们由单个事实表组成，并由相关的维表包围，从而形成星形模式。**事实表**包含有意义粒度的度量，而**维度表**包含各种相关实体的属性。下图说明了一个简单的星型方案，其中包含一个事实表（“ **医院就诊”**）和三个维度表（“ **患者”**，“ **主治医师** ”和“ **出院详细信息”**）：

![img](../images/000120.gif)

事实表使用引用单个维记录的通常称为**代理键**或**外键的**方式连接到相关维。事实表定义了粒度级别并包含度量。在这种情况下，“ 医院访问”的粒度为每次访问一个记录。在此简单示例中，每次访问都是针对一位看过一位主治医生并已出院的患者。“ 医院访问”表显式存储“  访问持续时间”的度量，并隐式定义“访问次数”的另一个度量（在本例中为“记录数”）。

*数据建模纯粹主义者会指出日期值已存储在事实表（甚至某些维）中，并且建议使用一个日期维表，该表具有每个日期的广泛属性，并且仅在其中存储一个替代（外键）事实表。*

*日期维度可能非常有益。**但是，Tableau的内置日期层次结构和广泛的日期选项使在事实表中存储日期成为可行的选择。**如果您需要Tableau中不可用的日期的特定属性（例如，哪些日子是公司假期），会计年度复杂，或者需要支持旧版BI报告工具，请考虑使用日期维度。*

设计良好的星型架构允许使用内部联接，因为每个代理键都应引用一个维记录。如果尺寸值未知或不适用，则使用特殊尺寸记录。例如，尚未完成的住院访问（患者仍在医院）可以参考出院明细表中标记为**尚未出院**的特殊记录。在Tableau中连接星型模式时，请从事实表开始，然后添加维度表，如下所示：

![img](../images/Image%20[254].jpg)

结果数据连接（作为示例显示，但未包含在Chapter 09工作簿中）使您可以按表查看尺寸属性。这些度量来自单个事实表：

![img](../images/Image%20[255].jpg)

*良好实现的星形架构特别适合在***实时连接中***使用，**因为Tableau可以通过实现***联接***剔除来提高性能。*

**联接剔除***是Tableau消除查询中不必要的联接的一种方法，因为它会将它们发送到数据源引擎。**例如，如果要**在行**上**放置“* *医师姓名”**，**在“* *列”**上**放置“* *平均**就诊持续时间”**，**以获得每个医生**的平均**就诊持续时间**的条形图，则可以加入“* *治疗**和**患者”**表可能不需要。**只要您使用简单的星形模式，并且联接仅来自中央事实表并在源中启用引用完整性，或者允许Tableau承担引用完整性，Tableau就会消除不必要的联接（从“* *数据”**菜单中**选择数据源连接）**或使用数据源连接中的上下文菜单，然后选择“* *假定参照* *完整性”**。*

考虑了一些结构良好的示例之后，让我们将注意力转向处理结构不良的数据。

### 处理数据结构问题 <div id="page_209"></div>

在某些情况下，在源处重组数据不是一种选择。源可能是安全的且是只读的，或者您甚至可能无法访问原始数据，而是定期接收特定格式的数据。在这种情况下，一旦您连接到Tableau中的数据，便可以使用一些技术来处理结构性问题。

我们将考虑一些数据结构问题的示例，以演示在Tableau中处理这些问题的各种技术。没有一种解决方案是解决给定问题的*唯一正确方法*。通常，有几种方法可能会起作用。此外，这些仅是您可能遇到的问题的示例。花一些时间来了解建议的解决方案如何基于我们在先前各章中已经考虑过的基本原理，以及如何使用类似的技术来解决数据问题。

#### 在Tableau连接中重组数据 <div id="page_210"></div>

Excel工作簿World Population Data.xlsx包含在Data本书随附的资源目录中，它是许多Excel文档的典型代表。看起来是这样的：

![img](../images/000100.gif)

这样的Excel文档通常更易于阅读，但在Tableau中包含多个数据分析问题。此特定文档中的问题包括以下内容：

- 不属于数据的过多标题（标题，注释和格式）
- 合并细胞
- 列中的国家/地区名称和代码
- 可能不必要的列（指标名称和指标代码）
- 数据范围很广，也就是说，每年都有一列，而人口测度分布在单个记录中的这些列中

最初连接到Tableau中的Excel文档时，连接屏幕将类似于以下内容：

![img](../images/Image%20[256].jpg)

数据预览揭示了结构不良导致的一些问题：

- 由于列标题不在第一个Excel行中，因此Tableau 为每个列提供了默认值F1，F2等
- 标题“ 世界人口数据”和有关样本数据的注释被解释为F1列中的值
- 实际的列标题被视为一行数据（第三行）

幸运的是，这些问题可以在连接窗口中解决。首先，我们可以通过打开**Tableau Data Interpreter**来纠正许多过多的标头问题，**Tableau Data Interpreter**是专门识别和解决Excel或Google Sheets文档中常见结构性问题的组件。选中“ 使用数据解释器”选项时，数据预览将显示更好的结果：

![img](../images/Image%20[257].jpg)

*单击**复选框下方显示**的“* *查看结果...”**链接，将使Tableau生成一个新的Excel文档，该文档以颜色进行编码，以指示数据解释器如何解析Excel文档。**使用此功能可以验证Tableau是否正确解释了Excel文档并保留了所需的数据。*

观察到消除了多余的标题和列的正确名称。还有一些其他问题需要纠正。

首先，如果我们认为指标名称和指标代码列对我们的分析无用，则可以将其隐藏。单击列标题上的下拉箭头将显示一个选项菜单。Hide将从连接中删除该字段，甚至阻止将其存储在摘录中：

![img](../images/Image%20[258].jpg)

其次，我们可以使用同一菜单上的选项将“ 国家/地区名称和代码”列分成两列，以便我们可以分别使用名称和代码。在这种情况下，菜单上的“  拆分”选项可以很好地工作，Tableau可以完美地拆分数据，甚至可以删除代码周围的括号。如果分割选项最初不起作用，请尝试“  自定义分割...”选项。我们也将使用重命名...选项来重命名分裂领域Country Name and Code - Split 1和Country Name and Code - Split 2以Country Name和Country Code分别。然后，我们将隐藏原始Country Name and Code字段。

至此，大多数数据结构问题已得到纠正。但是，您会认识到数据的格式很**宽**。我们已经看到了将要遇到的问题：

![img](../images/Image%20[259].jpg)

我们的最后一步是**转动**的**年度**列。这意味着我们将以一种方式重塑数据，以使每个国家/地区每年都有一行。通过单击1960列，滚动到最右边，并在单击2013列的同时按住*Shift*，选择所有年份列。最后，使用任何年份字段上的下拉菜单，然后选择“ 数据透视”选项。

结果是两列（Pivot field names和Pivot field values）代替所有年列。将两个新列重命名为Year和Population。您的数据集现在又窄又高，而不是宽而又短。

最后，从“ **年份”**列上的图标中注意到，Tableau将其识别为文本字段。单击该图标将允许您直接更改数据类型。在这种情况下，选择“ 日期”将得到NULL值，但是将数据类型更改为“ 数字（整个）”将为您提供整数值，该值在大多数情况下都可以正常使用：

![img](../images/Image%20[260].jpg)

*或者，您可以使用**Year**字段**上的第一个下拉菜单，**然后选择**Create Calculated Field ...，**这将允许您创建一个计算字段名称**Year（日期）**，该年份使用诸如的代码将年字符串解析为日期**DATE(DATEPARSE("yyyy", [Year]))**。*

*此代码将解析该字符串，然后将其转换为没有时间的简单日期。**然后，您可以隐藏原始的**Year**字段。**您可以隐藏任何字段，即使该字段用于计算中也是如此，只要该字段未在视图中使用即可。**这为您提供了一个非常干净的数据集。*

与原始数据集相比，最终数据集在Tableau中的使用要容易得多：

![img](../images/Image%20[261].jpg)

#### 将文件合并在一起 <div id="page_211"></div>

通常，您可能有多个单独的文件或表，它们一起代表了整个数据集。例如，您可能具有一个在特定目录中创建新的每月数据转储作为新文本文件的过程。或者，您可能有一个Excel文件，其中每个部门的数据都包含在单独的工作表中。

甲**联盟**是汇集了各表的行成单个数据源的数据表的串联。例如，考虑以下三个数据表：

**原稿：**

| **名称** | **占用** | **银行账户余额** |
| -------- | -------- | ---------------- |
| 路加     | 农民     | $ 2,000          |
| 莉亚     | 公主     | $ 50,000         |
| 韩       | 走私者   | -$ 20,000        |

**前传：**

| **名称**  | **占用**   | **银行账户余额** |
| --------- | ---------- | ---------------- |
| 瓦托      | 垃圾交易商 | $ 9,000          |
| 达斯·莫尔 | 脸画家     | $ 10,000         |
| 罐子      | 西斯领主   | -$ 100,000       |

**续集：**

| **名称** | **占用** | **银行账户余额** |
| -------- | -------- | ---------------- |
| 雷伊     | 清道夫   | $ 600            |
| 坡       | 飞行员   | $ 30,000         |
| 凯洛     | 待业     | $ 0              |

这些表的并集将给出一个包含每个单独表的行的表：

| **名称**  | **占用**   | **银行账户余额** |
| --------- | ---------- | ---------------- |
| 路加      | 农民       | $ 2,000          |
| 莉亚      | 公主       | $ 50,000         |
| 韩        | 走私者     | -$ 20,000        |
| 瓦托      | 垃圾交易商 | $ 9,000          |
| 达斯·莫尔 | 脸画家     | $ 10,000         |
| 罐子      | 西斯领主   | -$ 100,000       |
| 雷伊      | 清道夫     | $ 600            |
| 坡        | 飞行员     | $ 30,000         |
| 凯洛      | 待业       | $ 0              |

通过Tableau，可以将基于文件的数据源中的表合并在一起，包括以下内容：

- 文本文件（.csv，.txt和其他文本文件格式）
- Excel文档中的工作表（标签）
- Excel工作表中的子表
- 多个Excel文档
- Google表格
- 关系数据库表

*使用***数据解释器***功能可在Excel或Google表格中查找子表。**它们将显示为左侧边栏中的其他数据表。*

要在Tableau中创建联合，请按照下列步骤操作：

1. 从菜单，工具栏或“ 数据源”屏幕创建一个新的数据源，从您希望成为联合的文件之一开始。然后，将所有其他文件拖放到设计器中现有表下方的“ 将表拖放到并集”拖放区中：

![img](../images/Image%20[262].jpg)

1. 创建联合后，可以使用设计器中表格上的下拉菜单来配置联合选项。或者，您可以将 New Union 对象从左侧边栏拖到设计器中以替换现有表。这将显示用于创建和配置联合的选项：

![img](../images/Image%20[263].jpg)

“ 特定（手动）”选项卡允许您将表拖入或拖出并集。该通配符（自动）选项卡允许您指定的文件名和表（Excel文件和谷歌表）通配符，将自动包含在基于通配符匹配工会的文件和图纸。

*如果您预计将来会添加其他文件，**请使用**通配符（自动）**功能。**例如，如果您有一个特定目录，该目录会定期转储数据文件，那么通配符功能将确保您不必手动编辑连接。*

1. 一旦定义了并集，就可以使用结果数据源来可视化数据。此外，联合表可以与设计器窗口中的其他表结合在一起，为您提供处理数据时的很大灵活性：

*在联合中，Tableau将按名称匹配表之间的列。**一个文件/表中存在但其他**NULL**文件中不存在的列**将显示为联合表的一部分，但值将出现**在该列/文件不存在的文件/表中。**例如，如果文件之一包含一个名为***Job***的列**而不是***Occupation***，则最终的联合表将包含一个名为***Job***的列**和另一个名为***Occupation***NULL**的列**，其**值不存在该列。**您可以通过选择列并使用下拉菜单来合并不匹配的列。**这将***合并***（保留第一个非空值）单个新列中每行数据的值。*

![img](../images/Image%20[264].jpg)

创建联合时，Tableau将在数据源中包括一个或多个新字段，以帮助您识别数据的来源文件，工作表和表格。路径将包含文件路径（包括文件名），工作表将包含工作表名称（对于Excel或Google表格），表名称将包含子表或文本文件名。您可以使用这些字段来帮助您识别数据问题，并根据需要扩展数据集。例如，如果你有月度数据的目录转储命名的文件2018-01.txt，2018-02.txt，2018-03.txt，等等，但在文件中没有实际的日期字段，你可以得到使用之日起计算的与代码申请，如以下情况：

DATEPARSE（'yyyy-MM'，[表名]）

#### 跨数据库联接 <div id="page_212"></div>

Tableau使您能够跨数据连接联接数据。这意味着您可以联接来自完全不同的数据库和文件格式的数据表。例如，您可以在SQL Server中将表与文本文件的并集连接起来，然后将它们连接到Google表格文档中。

你会记得的概念连接和跨数据库的具体联接是在介绍[第2章](docs/Book.md#page_43)，*工作与数据中的Tableau*。尽管跨数据库联接对于将**不同的数据**源（包含在不同系统和格式中的数据）组合在一起非常有用，但是它们也可以用于解决其他数据问题，例如重塑数据以使其更轻松地满足Tableau中的目标。

*您可以在**Chapter 9**工作簿中**完成以下示例**，但是服务器数据库数据源是使用文本文件（**Patient Visits.txt**）**模拟的**。*

##### 一个实际的例子 — 填写缺少/稀疏的日期 <div id="page_213"></div>

假设您在服务器数据库（例如SQL Server或Oracle）中有一个表，该表每名住院患者包含一行，并且将“入院**日期”**和“ **出院日期”**作为每位患者的单独列：

![img](../images/000046.gif)

尽管此数据结构对于某些类型的分析非常有效，但是如果要直观显示12月份医院的每日患者数量，将会发现很难使用。

例如，您将哪个日期字段用作轴？即使您旋转表以使所有日期都集中在一个字段中，您也会发现数据中存在空白。**稀疏数据**（即对于某些值不存在记录的数据）在某些实际数据源中非常普遍。具体来说，在这种情况下，每个入学或出院日期只有一条记录，而中间没有记录。

有时，在源处重组数据可能是一种选择，但是如果数据库已锁定，则您可能没有该选择。您也可以使用Tableau的功能来填补数据中的空白（**数据密集化**）以解决问题。但是，该解决方案可能很复杂，并且可能很脆弱或难以维护。

一种替代方法是使用跨数据库联接为所有日期创建行。因此，您可以快速创建一个Excel工作表，其中包含要查看的日期列表，如下所示：

![img](../images/000223.gif)

Excel文件包含每个日期的记录。我们的目标是在数据库表和Excel表之间**交叉联接**（联接一个表中的每一行与另一表中的每一行）。完成此操作后，您将在每个日期为每个患者安排一行。

*将一个数据集中的每条记录与另一数据集中的每条记录连接在一起，就可以创建***笛卡尔乘积***。**结果数据集将具有N1 \* N2行（其中N1是第一个数据集中的行数，N2是第二个数据集中的行数）。**使用这种方法时要小心。**它适用于较小的数据集。**当您使用更大的数据集时，笛卡尔积可能会变得很大，以至于站不住脚。*

通常，您会在各个表中都有特定的字段，这些字段使您可以将数据连接在一起。但是，在这种情况下，我们没有任何定义联接的键。日期也不能使我们以一种可以为我们提供所需结构的方式来联接所有数据。为了实现交叉联接，我们将使用联接计算。一个**加入计算**可以专门写一个特殊的计算字段用于连接。

在这种情况下，我们将为两个表都选择Create Join Calculation ...，并1为左侧和右侧输入一个单独的硬编码值，即 ：

![img](../images/Image%20[265].jpg)

由于1左侧1的每一行都与右侧的每一行都匹配，因此我们得到的每一行都与每一行匹配，这是真正的交叉联接。

*作为替代方案，对于许多其他基于服务器的数据源，可以将“* **自定义SQL”***用作数据源。**在“* *数据源”**屏幕上，使用设计器中的“* *患者就诊”**表，可以使用顶部菜单选择“* *数据”* *|“* *数据”**。**转换为自定义SQL**以编辑Tableau用于源的SQL脚本。**或者，您可以使用**左侧栏中**的“* *新建自定义SQL”**对象**编写自己的自**定义SQL**。*

此替代示例中的脚本已被修改为包括 1 AS Join 创建一个名为 **Join** 的字段，每行的值为1。自定义SQL中定义的字段也可以在联接中使用：

![img](../images/Image%20[266].jpg)

基于联接计算，我们新的交叉联接数据集包含每个日期每个患者的记录，我们现在可以创建一个快速计算，以查看在任何给定日期是否应将患者算作医院人口的一部分。计算的字段名为Patients in Hospital，具有以下代码：

如果[录取日期] <= [日期]并且[出院日期]> = [日期]

然后1

其他0

结束

这使我们能够轻松地可视化患者的流向，甚至有可能基于平均值，趋势甚至预测来执行高级分析：

![img](../images/Image%20[267].jpg)

最终，对于长期解决方案，您可能需要考虑开发基于服务器的数据源，该数据源提供所需分析所需的结构。但是，跨数据库联接使我们无需等待较长的开发周期即可完成分析。

#### 处理不同级别的细节 <div id="page_214"></div>

请记住，good的两个关键如下：

- 具有有意义的细节水平
- 具有与详细程度相匹配的度量，或者可能具有更高的详细程度

较低级别的度量往往会导致获得宽数据，并且可能使某些分析变得困难甚至无法进行。有时，更高细节级别的措施可能会有用。只要我们知道如何正确处理它们，就可以避免一些陷阱。

例如，考虑以下数据（包含Apartment Rent.xlsx在Chapter 9目录中），这些数据为我们每个公寓每月提供一个记录：

![img](../images/Image%20[268].jpg)

这两项措施的详细程度确实不同：

- **收集的租金**与数据的详细程度相匹配，其中记录了每个公寓每个月收取了多少租金。
- 另一方面，**平方英尺**不会逐月变化。而是仅在较高的公寓级别。

当我们从视图中删除日期并查看公寓级别的所有内容时，可以观察到这一点：

![img](../images/Image%20[269].jpg)

注意，这Sum(Rent Collected)是很有意义的。您可以合计每月收取的租金，并获得每间公寓有意义的结果。但是，您无法Sum上班Square Feet并获得每间公寓有意义的结果。其他汇总，例如平均值，最小值和最大值，确实可以为每个公寓提供正确的结果。

但是，假设您被要求提出收取的总租金与每套公寓平方英尺的比率。您知道这将是一个汇总计算，因为您必须对除以之前收集的租金进行汇总。但是，其中哪一项是正确的计算？

- SUM([Rent Collected])/SUM([Square Feet])
- SUM([Rent Collected])/AVG([Square Feet])
- SUM([Rent Collected])/MIN([Square Feet])
- SUM([Rent Collected])/MAX([Square Feet])

第一个显然是错误的。我们已经看到不应每月增加平方英尺。如果我们确保**Apartment**继续定义视图的细节级别，则最后三个中的任何一个都是正确的。

但是，一旦我们查看了具有不同细节级别的视图（例如，所有公寓的总数或多套公寓的每月视图），则该计算将不起作用。要了解原因，请考虑打开列总计的情况（从菜单中选择“ 分析” |“ 总计” |“ 显示列总计”或从“ 分析”选项卡中拖放“ 总计 ” ）：

![img](../images/Image%20[270].jpg)

这里的问题是，总计总数线位于所有公寓（所有月份）的详细信息级别。我们真正想要的平方英尺总数是900 + 750 = **1,650**。但是这里的平方英尺总和是所有月份所有公寓的平方英尺总和。平均水平是行不通的。最小值找到值750，作为数据中所有公寓的最小度量。同样，最大值选择900作为单个最大值。因此，任何提议的计算都无法在不包含单个公寓的任何细节级别上发挥作用。

*您可以通过单击单个值并使用下拉菜单选择如何计算总计来调整小计和总计的计算方式。**或者，右键单击活动的度量字段，然后选择**总计使用**。**您可以通过选择**分析* *|* *从菜单中一次更改所有度量的总计方式。**总计* *|* *总计全部使用中**。**在前面的视图中，**使用这种***两次通过总***技术可能会得到正确的结果，但不能普遍解决该问题。**例如，如果您想显示每月的每平方英尺价格，则会遇到相同的问题。*

幸运的是，Tableau使我们能够在视图中处理不同级别的细节。使用**详细等级**（**LOD**）计算，这在我们以前遇到的[第4章](docs/Book.md#page_96)， *开始了冒险与计算*，我们可以每间公寓计算平方英尺。

在这里，我们将使用固定的LOD计算来保持公寓的固定细节级别。我们将创建一个Square Feet per Apartment使用以下代码命名的计算字段：

{包括[公寓]：MIN（[方脚]）}

花括号包围着LOD计算，并且关键字INCLUDE表示我们希望将**Apartment**包括在计算的细节级别中，即使它不在细节视图级别中也是如此。MIN可以在前面的代码中使用，但MAX也AVG可以使用，因为每个单元的结果相同。

如您所见，该计算在单元级别和总计级别的视图中返回正确的结果，其中Tableau包含要查找**900**（**A**的最小值）和**750**（**B**的最小值）的**Apartment**，然后对其求和得到**1,650**：

![img](../images/Image%20[271].jpg)

现在，我们可以在其他计算中使用LOD计算字段来确定所需的结果。我们将创建一个Rent Collected per Square Foot使用以下代码命名的计算字段：

总和（[已出租]）/总和（[每间公寓的平方英尺]

当将该字段添加到视图并设置格式以显示小数时，最终结果是正确的：

![img](../images/Image%20[272].jpg)

*或者，**INCLUDE**我们可以使用***FIXED***的细节级别**，而不是使用**，**它总是在**FIXED**关键字**后面的维度的细节级别执行**，而不管视图中定义了什么细节级别。**这将使Tableau始终计算每间公寓的最小平方英尺，而不管定义细节视图级别的尺寸如何。**尽管非常有用，但是请注意，**FIXED**详细程度计算是针对整个上下文（整个数据集或***上下文过滤器***定义的子集**）计算的。**在不理解的情况下使用它们可能会产生意外的结果。*

### 数据问题高级修复概述 <div id="page_215"></div>

除了本章前面提到的技术之外，还有一些其他可能性可以处理数据结构问题。完全开发这些概念超出了本书的范围。但是，通过对这些方法有所了解，您可以扩大应对挑战的能力：

- 可以在数据连接中使用**自定义SQL**来解决一些数据问题。如前所述，除了为跨数据库联接提供字段外，自定义SQL还可用于彻底重塑从源检索到的数据。自定义SQL并不是所有数据源的选项，而是许多关系数据库的选项。考虑一个自定义SQL脚本，该脚本采用了本章前面提到的广泛的国家/地区表，并将其重组为一个高表：

SELECT [国家名称]，[1960] AS人口，1960 AS年份

来自国家

全联盟

SELECT [国家名称]，[1961] AS人口，1961 AS年

来自国家

全联盟

SELECT [国家名称]，[1962] AS人口，1962 AS年

来自国家

...

...

等等。设置起来可能有些繁琐，但是它将使数据在Tableau中更容易使用！但是，出于性能原因，将需要提取许多使用复杂的自定义SQL的数据源。

- **工会**：Tableau的能力，工会的数据源，如Excel，文本文件，和谷歌表可以以类似于自定义SQL实例来重塑数据转换成高大的数据集的方式使用。您甚至可以将相同的文件或工作表合并到其自身。在某些可视化需要多个记录的情况下，这很有用。例如，使用具有源和目标列的单个记录很难（或不可能）显示从源到目标的路径。但是，将数据集还原成其自身会产生两行：可以可视化为源，另一行可视为目标。
- **表格计算**：表格计算可用于解决从查找和消除重复记录到处理多个详细信息级别的许多数据难题。由于表计算可以在更高详细级别的分区中工作，因此可以将多个表计算和聚合计算一起使用，以在单个视图中混合详细级别。一个简单的示例就是“总计百分比”表计算，该表将视图中详细级别的汇总计算与更高详细级别的总计进行比较。
- **数据混合**：数据混合可用于解决许多数据结构问题。因为您可以定义使用的链接字段，所以您可以控制混合的详细程度。例如，我们研究的公寓租金数据问题可以通过第二个来源来解决，该来源每个平方英尺的记录都只有一个记录。在公寓级别进行融合将使您获得所需的结果。
- **数据支架**：数据支架扩展了数据混合的概念。使用这种方法，您可以构建各种尺寸值的支架以用作主要来源，然后混合到一个或多个次要来源。这样，您可以控制主要来源的结构和粒度，同时仍然能够利用次要来源中包含的数据。

### 总结 <div id="page_216"></div>

在本章之前，我们主要研究结构合理且易于使用的数据。在本章中，我们考虑了什么构成良好的结构以及处理不良数据结构的方法。一个好的结构由具有有意义的详细程度并具有与该详细程度相匹配的度量的数据组成。当度量分布在多列中时，我们得到的是**宽**数据而不是**高数据**。

现在，您已经拥有运用各种技术来处理形状错误或细节级别错误的数据的经验。Tableau为我们提供了解决其中一些结构性问题的能力和灵活性，但是，最好在源头修复数据结构。

在下一章中，我们将暂停一下Tableau Desktop，以考虑解决挑战性数据的另一种方法– **Tableau Prep**！

## 第十章 介绍Tableau Prep <div id="page_217"></div>

在上一章中，我们考虑了一些在Tableau Desktop中构造数据的选项。关于结构化数据的许多概念都将在此处应用，因为我们现在将注意力转向Tableau的全新产品：**Tableau Prep**。Tableau Prep扩展了Tableau平台，提供了健壮的选项，可用于清洁和结构化Tableau中的分析数据。与Tableau  Desktop提供用于可视化和分析数据的动手视觉体验相同，Tableau Prep也提供了用于清洁和整形数据的动手视觉体验。

Tableau  Prep处于每月加速的发布周期，并且在平台继续增长和扩展的同时，存在一个基本的范例，为清理和整形数据奠定了基础。在本章中，我们将介绍很多基础知识。但是，我们的目标不是涵盖所有可能的功能。而是，我们将寻求了解潜在的范例和思想流程，使您能够应对Tableau Prep中的大量数据挑战。

在本章中，我们将通过一个实践示例来研究Tableau Prep的范例，了解基本转换，并了解Tableau Prep的许多特性和功能。

本章将涵盖很多主题，包括：

- 了解Tableau Prep Builder界面
- 顺应基本范式
- 使用计算和汇总
- 筛选数据
- 转换数据以进行自定义分析
- 流程自动化选项

*在本章中，我们将**广义地**使用术语* **Tableau Prep** *来表达Tableau为数据准备而开发的整个平台，有时还可以用作Tableau Prep Builder的简写，Tableau Prep Builder是用于连接数据，创建数据流和定义输出。**为了清楚起见，我们将使用以下特定名称：*

- **Tableau Prep Builder***：用于设计数据流，在本地运行它们并发布它们的客户端应用程序*
- **Tableau Prep Conductor***：Tableau Server的附加组件，用于调度和自动化已发布的数据流*

### 准备探索Tableau Prep <div id="page_218"></div>

**Tableau Prep Builder**可用于Windows和Mac。如果您当前尚未在计算机上安装Tableau Prep Builder，请花一点时间从<https://www.tableau.com/products/prep/download下载该应用程序。Tableau> Creator许可中包括Tableau Prep Builder的许可。如果您当前没有许可证，则可以试用该应用程序14天。请与您的Tableau代表交谈以确认许可和试用期。

本章中的示例使用目录中的\Learning Tableau\Chapter 10文件。具体说明将指导您何时以及如何使用各种文件。

### 了解Tableau Prep Builder界面 <div id="page_219"></div>

在Tableau Prep Builder和Tableau Desktop的界面中会发现很多相似之处。Tableau Prep Builder的主屏幕将类似于以下内容：

![img](../images/Image%20[273].jpg)

以下屏幕快照中已对以下组件进行编号：

1. 该菜单包括用于打开文件，编辑和运行流，登录Tableau Server以及各种**帮助**功能的选项。
2. 顶部的两个大按钮使您可以选择打开流程以打开现有作品，或选择连接到数据以使用初始数据连接来启动新流程。我们将在下一部分中定义一个流程。现在，以Tableau Prep等效于Tableau Desktop工作簿的方式考虑流程。
3. 最近的流程显示您最近保存的Tableau Prep数据流。您可以单击其中之一打开流程并进行编辑或运行。右侧的切换按钮可让您在缩略图和列表之间切换。
4. Sample Flows使您可以打开一些预构建的示例。
5. “ 连接”窗格以**+**按钮开头，可让您添加新的数据连接。添加连接时，这些连接以及相关的表，视图，文件和其他选项将在此窗格中列出。
6. 当您了解有关Tableau Prep的更多信息时，“ 发现”窗格为您提供了培训和资源的选项。

打开或启动新流程后，主屏幕将替换为新界面，该界面将有助于设计和运行流程：

![img](../images/Image%20[274].jpg)

该界面包含以下内容，这些内容在前面的屏幕快照中已编号：

1. 该**流程窗格**，在那里你会在逻辑上建立数据流与步骤，这将从清洁到计算，转型和重塑做任何事情。选择任何单个步骤将显示该步骤特定的其余界面。
2. “ 更改”窗格列出了该步骤中所做的所有更改，从计算到重命名或删除字段，再到更改数据类型或分组值。
3. 该**资料窗格**让你在步骤每个字段的轮廓。您可以看到每个字段的值的类型和分布。单击一个字段将突出显示流程窗格中的沿袭，使用笔刷单击一个或多个字段的值将突出显示其他字段的相关值。
4. 该**数据网格**显示数据的单个记录，因为他们在这一步存在。在“ **更改”**网格中选择一个更改将显示基于直至（包括）所选更改的更改的数据。在配置文件窗格中选择一个值将过滤数据网格以仅显示包含该值的记录。例如，在配置文件窗格中的“ 运送模式”字段中选择“ 第一类 ” 将对数据网格进行过滤，以仅显示“ 第一类运送模式”的记录。这使您可以浏览数据，但是只有执行特定操作才能导致更改，然后才能更改数据。

您还将注意到工具栏，该工具栏允许您撤消或重做操作，刷新数据或运行流。此外，还会根据所选步骤或字段的类型显示其他选项或控件。稍后我们将深入研究范式和实际示例时，将考虑这些细节。

### 顺应基本范式 <div id="page_220"></div>

Tableau Prep的整体范例是通过流程发现，清理和整形数据的动手式视觉体验。甲**流**（有时也被称为**数据流**）是一个逻辑一系列被从输入端（S）施加到数据输出（多个）步骤和变化。在Tableau Prep的流程窗格中，流程如下所示：

![img](../images/Image%20[275].jpg)

该流程的每个单独组成部分都称为“ **步骤”**，这些**步骤**由指示数据的逻辑流程（从左到右）的线连接起来。这些线称为流的**连接器**或**分支**。请注意，此处的“ 聚合步骤”有一个连接器从左侧进入，三个分支向右侧延伸。任何步骤都可以具有多个输出分支，并且流的每个分支可以终止于单独的输出，或者可以随后合并或合并回该流的另一部分。

在通读本章中的流程示例时，我们将更仔细地研究每种步骤。现在，请考虑Tableau Prep中主要步骤的以下初步定义：

- **输入步骤**：输入步骤从文件，表，视图或自定义SQL的数据开始流程。它提供了用于定义文件定界符，多个表或文件的并集以及要采样的数据量（对于较大的记录集）的选项。

- **清理步骤**：清理步骤使您可以对数据执行多种功能，包括计算，过滤，调整数据类型，删除和合并字段，分组和清理等等。

- **总结步**：一个聚合步骤允许您汇总值（例如，获取MIN，MAX，SUM，AVG）在细节层次指定。

- **连接步骤**：连接步骤使您可以将流的两个分支放在一起，它们代表可以在一个或多个关键字段上连接的数据集。您将具有用于选择连接类型以及连接字段的选项。

- 合并**步骤**：合并步骤使您可以将两个或多个代表要合并在一起的数据集的分支放在一起。您将具有用于合并或删除不匹配字段的选项。

  *在此示例中**，“* *联合步骤”**和“* *加入步骤”**都具有错误图标，指示在流程中未正确配置某些内容。**将鼠标悬停在图标上会提供错误的工具提示说明。**在这种情况下，错误是由于只有一个输入连接而引起的，而联合和联接都需要至少两个输入。**通常，选择带有错误图标的步骤可能会在“* **更改”***窗格或配置步骤中的其他位置**显示有关错误的详细信息**。*

- **枢轴步骤**：枢轴步骤使您可以将数据列转换为行或将数据行转换为列。您将具有选择枢轴类型以及字段本身的选项。有时，您可能会听到术语“转置”代替“透视”。

- **输出步骤**：输出步骤定义了清理和转换后的数据的最终目标。这可以是文本文件（.csv），提取（.hyper或.tde），也可以是将提取的数据源发布到Tableau Server。您将具有选择输出类型的选项，以及路径和文件名或Tableau Server和项目。

*右键单击步骤或连接器将显示各种选项。**您也可以将步骤拖放到其他步骤上以显示选项，例如将步骤结合或结合在一起。**如果要替换流程的早期部分以换出输入步骤，则可以右键单击连接器并选择**Remove**，然后将新的输入步骤拖到流程中所需的下一步上，以将其添加为新的步骤。输入。*

除了使用术语“ *流”*来指代定义逻辑流和数据转换的步骤和连接之外，我们还将使用术语“ *流”*来指代Tableau Prep用来存储步骤和步骤定义的文件。流的变化。Tableau Prep流文件具有.tfl（**未打包流**）或.tflx（**打包流**）扩展名。

Tableau Prep的范例远远超出了任何单个步骤的功能。在构建和修改流程时，您将收到即时反馈，以便您可以看到每个步骤和更改的影响。这使得迭代发现数据并进行必要的更改相对容易（而且很有趣！）。

*在构建流程，添加步骤，进行更改以及与数据交互时，您将处于***设计模式***。**Tableau Prep将Hyper引擎的缓存与数据库的直接查询结合使用，以在您进行更改时提供近乎即时的反馈。**运行流时，您正在使用***批处理模式***。**Tableau Prep将运行优化的查询和操作，这些查询和操作可能与在设计模式下运行的查询稍有不同。*

在本章的其余部分中，我们将考虑一个示例，以帮助我们讨论Tableau Prep范例并突出一些重要的功能和注意事项。该示例将有机地展开，这将使我们看到Tableau  Prep如何为您提供令人难以置信的灵活性，以应对出现的数据挑战并在发现数据的新方面时进行更改。

我们将让您担任组织的分析师角色，以分析员工的航空旅行。这将包括机票价格，航空公司，甚至是行程本身的一些地理空间分析。需要从多个系统整合数据，并且需要进行一些清理和整形以进行分析。

开放**的Tableau准备生成器**，去家里画面' w ^ e'll开始通过连接到一些数据！

#### 连接数据 <div id="page_221"></div>

在Tableau Prep中连接数据与在Tableau Desktop中连接数据非常相似。在主屏幕上，您可以单击“ 连接到数据”或展开的“ 连接”窗格上的**+** 按钮：

![img](../images/Image%20[276].jpg)

*与Tableau Desktop一样，对于基于文件的数据源，您可以将文件从***Windows资源管理器***或***Finder***拖到Tableau Prep窗口中，以快速创建连接。*

Tableau Prep支持数十种文件类型和数据库，并且列表继续增长。您将认识到Tableau Desktop中存在的许多相同类型的连接可能性。但是，在编写本书时，Tableau Prep不支持Tableau Desktop中可用的所有连接。

您可以创建任意数量的连接，并且“ **连接”**窗格将分别列出每个连接以及任何关联的文件，表，视图和存储过程，或者适用于该数据源的其他选项。您将能够在流中使用数据源的任何组合。

现在，让我们从以下步骤开始我们的示例：

1. 单击“ 连接到数据”。
2. 从显示的可能连接的扩展列表中，选择Microsoft Excel。
3. 您将看到一个名为Employee Flights的主表和一个名为Employee Flights Table 1的子表。将Employee Flights表拖到**Profile**窗格中。将创建一个输入步骤，为您提供数据和其他选项的预览。
4. 输入步骤显示一个字段网格和这些字段的选项。您会注意到，Employee Flights表中的许多字段都被命名为F2，F3，F4，依此类推。这是由于Excel文件的格式，该文件具有合并的单元格和摘要子表。选中“ 连接”窗格上的“ 使用数据解释器”选项，Tableau Prep将正确解析文件。它看起来应该像这样：

![img](../images/Image%20[277].jpg)

选择输入步骤时，Tableau Prep将显示数据中的字段网格。您可以使用网格来取消选中您不希望包括的任何字段，通过单击相关符号来编辑数据类型（例如，将字符串更改为日期），并通过双击字段来编辑字段名称本身名称值。

*如果Tableau Prep Builder检测到数据源包含大量记录，则可能会打开数据采样。***数据采样***使用较小的记录子集，以在设计模式下提供快速反馈和配置文件。**但是，当您以批处理模式运行整个流时，它将使用全部数据集。**您可以控制数据通过点击选择采样**数据采样**的输入窗格。**如果***数据采样***出现在流中的任何地方，**您将收到一个***数据采样***指示符**。*

现在，我们将继续探索数据并解决一些问题。

1. 将鼠标悬停在“ 员工飞行”输入步骤上时，单击出现的**+**按钮。这将通过添加一个称为Clean 1的清洁步骤来扩展流程。

2. 花一点时间使用“ **配置文件”**窗格浏览数据。观察在配置文件窗格中为字段选择单个值如何突出显示其他字段的相关值的一部分。这可以让您深入了解自己的数据，例如根据票证类型查看不同的价格范围：

![img](../images/Image%20[278].jpg)

在“ **纵断面”**窗格中跨字段突出显示条形段，这是由于选择了一个字段值而导致的，这称为**brushing**。您还可以通过配置文件窗格顶部的工具栏或右键单击字段值来对选定的值执行操作。这些操作包括过滤，编辑值或替换为null。但是，在进行任何更改或清除任何数据之前，让我们连接一些其他数据。

事实证明，大多数机票预订数据都在一个由Excel文件表示的数据库中，而另一家航空公司的预订数据则存储在定期添加到目录的文件中。这些文件在\Learning Tableau\Chapter 10\目录中。这些文件以惯例命名Southwest YYYY.csv（其中YYYY表示年份）。

我们将连接到所有现有文件，并确保为将来的其他文件做准备：

1. 单击“ 连接”窗格上的**+**图标，将新连接添加到文本文件。
2. 导航到\Learning Tableau\Chapter 10\目录并选择任何文件以启动连接。查看“ 输入”设置，您应该看到Tableau Prep正确标识了字段分隔符，字段名称和类型：Southwest *YYYY*.csv

![img](../images/Image%20[279].jpg)

1. 在“ 输入”窗格中，选择“ 多个文件”选项卡，然后从“ 单个表”切换到“ 通配符并集”。将匹配模式设置为Southwest*，然后单击应用。这告诉Tableau Prep Southwest合并目录中所有以在一起开头的文本文件：

![img](../images/Image%20[280].jpg)

1. 使用流程窗格中“ 西南”输入步骤上的**+**图标添加一个新步骤。默认情况下，此步骤将命名为Clean 2。再次探索数据，但是在将两个源合并到流中之前，不要采取任何措施。您可能会在“ 清理2” 步骤中注意到一个称为“ 文件路径”的新字段，该字段用通配符联合中适用文件的名称标记每个记录。

#### 清理数据 <div id="page_222"></div>

构造流程的过程非常反复，您经常会发现有关数据的信息，这将有助于您清理和转换数据。为了参考起见，我们将这个示例分成几部分，但不要让这偏离建立流程应该是*思想流程的想法*。该示例是无缝的！

##### 合并，合并不匹配的字段并删除不必要的字段 <div id="page_223"></div>

我们知道我们希望将所有航空公司的预订数据汇总在一起，因此我们将流程中的两条路径结合在一起：

1. 将“ 清洁2”步骤拖到“ 清洁1”步骤上，然后将其拖放到出现的“ **联合”**框中。这将创建一个新的Union步骤，其中包含来自两个干净步骤的输入连接：

![img](../images/Image%20[281].jpg)

1. 该联盟面板，以显示当了联盟选择一步会告诉你错配的领域，指示相关的输入，并给你删除或合并域选项。例如，“ 票价类型”和“ 机票类型”在Excel文件和文本文件中的命名不同，但是指示相同的数据。按住*Ctrl*键，然后选择两个字段。然后，从窗格顶部的工具栏或右键单击菜单中选择“ 合并字段”：

![img](../images/000212.gif)

1. 另外，合并Row ID和Row_ID。
2. 文件路径仅适用Southwest于在“ 输入”步骤中合并在一起的文件。尽管此自动生成的字段有时可能非常有用，但在此示例中它不会向数据添加任何内容。选择字段，然后从菜单中单击“ 删除字段 ”。
3. 同样，旅游保险？和乘客ID仅适用于其中一种输入，在我们的分析中将很少使用。还要删除这些字段。
4. 剩下的单个不匹配字段Airline很有用。现在将其保留，并在流程窗格中的“并集1”步骤上单击**+**图标，然后通过选择“ 添加步骤”来扩展流程。此时，您的流程应如下所示：

![img](../images/000165.gif)

*流程中**“* *联合1”**步骤**上方有一个图标**，指示在此步骤中所做的更改。**在这种情况下，更改是删除了几个字段。**进行更改的每个步骤都将具有相似的图标，当您将鼠标悬停在它们上时，它们将显示工具提示详细信息，并允许您与更改进行交互。**通过单击步骤并打开“* *更改”**窗格**，可以查看更改的完整列表，对其进行编辑，对其进行重新排序以及将其删除**。**根据步骤类型，**可以通过展开或选择“* *更改”**选项卡**来使用**“* *更改”**窗格**。*

##### 分组和清洁 <div id="page_224"></div>

现在，我们将花费一些时间来清理来自两个输入源的数据。选择“ 清理3”步骤后，使用“ **配置文件”**窗格检查数据并继续我们的流程。前两个字段指示一些需要解决的问题：

![img](../images/Image%20[282].jpg)

的表名称被的Tableau制备产生的场作为其一部分联盟1，以指示记录的源。该航空公司外地赶来只从Excel文件（你可以在个人资料窗格中选择它，并观察在流动面板领域的突出路径证实了这一点）。单击“ 航空公司”的空值，然后观察刷牙情况：这可以证明“  航空公司”中的值全部来自西南航空公司文件，因为这些文件不包含表示航空公司的字段。我们将处理这些值并进行一些其他清理：NULLNULL

1. 双击空值，然后键入Southwest以替换NULL为您知道代表正确航空公司的值。Tableau Prep将使用回形针图标指示发生了**分组和替换**操作。

1. 我们将进行其他分组以清理**American**的变体。使用“ 航空公司”字段上的“ **选项”**按钮，选择“ 分组并替换” |“ 替换”。发音：

![img](../images/Image%20[283].jpg)

几乎所有的变化都归为美国 价值。仅保留AA。

1. 在出现的“ 分组和替换”窗格中，*按住Ctrl*并单击“ AA和American”，然后选择“ 组值”：

![img](../images/Image%20[284].jpg)

1. 接下来，选择不再需要的“ 表名”字段。使用工具栏选项，右键单击该字段的菜单或使用选项按钮，选择“ 删除字段”。
2. “配置文件”窗格中的某些字段在右上角具有“ 建议”图标。单击此作为“ 乘客电子邮件”，然后应用建议以分配电子邮件的数据角色：

![img](../images/Image%20[285].jpg)

**数据角色***使您可以根据期望的值的模式或范围快速识别有效或无效值。**分配数据角色后，您可能会收到其他建议，以筛选或替换无效值。*

1. 再次单击“ 建议”按钮，然后将该选项应用到“ 分组和替换无效值” NULL。
2. 其余大多数字段看起来都不错，但票价类型除外，其中包含值1st Class和First Class。选择这两个值，然后将它们与First Class值组合在一起。
3. 至此，我们有了一个包含所有主要数据的干净数据集。我们已经可以做很多分析了。实际上，让我们花点时间预览数据。右键单击Clean 3步骤，然后选择Tableau Desktop中的Preview：

![img](../images/Image%20[286].jpg)

将建立新的数据连接并在Tableau Desktop中打开。您可以预览流程中任何步骤的数据。花一些时间在Tableau Desktop中浏览数据，然后返回Tableau Prep。现在，我们将注意力转向通过一些计算，补充数据和一些重组来扩展数据集。

#### Tableau Prep中的计算和聚合 <div id="page_225"></div>

Tableau Prep中的计算遵循的语法几乎与Tableau Desktop相同。但是，您会注意到只有行级函数可用。这是因为Tableau Prep中的所有计算都是在行级别完成的。聚合是通过一个**聚合步骤**执行的，稍后我们将介绍该**步骤**。

计算和聚合可以大大扩展我们的分析能力。在我们当前的示例中，有机会分析购票与实际旅行之间的时间长度。我们可能还希望在每条记录上标记一个旅客整体出行的频率。在继续执行示例时，请按以下步骤深入研究这些计算：

1. 我们将从计算开始，以确定购票到旅行当天的时间长度。选择Clean 3步骤，然后单击Create Calculated Field。命名计算Days from Purchase to Travel并输入

   DATEDIFF('day', [Purchase Date], [Travel Date])。

2. 在“ **配置文件”**窗格中检查结果。新字段应如下所示：

![img](../images/000260.gif)

此处的默认视图（在许多情况下为数字字段）是汇总的直方图。您可以通过选择字段右上角的“ **选项”**按钮并切换到“ 细节”来更改视图以查看其详细信息，该视图将显示该字段的每个值：

![img](../images/Image%20[287].jpg)

默认的“ 摘要”直方图指示的数据形状与大多数人在旅行日期（但不是紧接之前）购买机票时所期望的形状接近。可能有一些机会可以通过提前购买更多商品来获得更好的交易，因此确定这种模式（然后在Tableau Desktop中进行更充分的研究）将是我们分析的关键。

我们可能还希望能够根据旅客旅行的频率对其进行分组。我们将使用一些聚合和计算来完成此任务。

1. 将鼠标悬停在“ 清理3”步骤上并选择“ 添加聚合 ”时，单击出现的**+**图标。名为Aggregate 1的新步骤将添加到流中。
2. 双击新步骤下的文本“ 聚合1 ”。这使您可以编辑名称。将名称从“ 聚合1”更改为Trips per person。

*为有意义的名称指定步骤，以自记录流程。**当您将来再次编辑流程时，这将对您和其他人有很大帮助。**此外，当您编辑步骤的名称时，“* *添加描述”**文本将出现在名称下方。*

参考前面的提示，您可以双击该区域以添加更长的描述以提供进一步的文档：

![img](../images/000170.gif)

选择聚合步骤将显示一个窗格，其中包含用于对流中的字段进行分组和聚合的选项：

![img](../images/Image%20[288].jpg)

您可以将字段从左侧拖放到“ 分组的字段”或“ 聚合的字段”部分，并可以通过单击聚合文本（例如SUM）并从结果下拉列表中选择其他聚合来更改聚合的类型。

在前面的屏幕截图中，您可以看到我们已经按Person分组，并将Number of  Rows作为SUM添加到了聚合字段中。“行数”是“聚合”步骤中可用的特殊字段。我们在这里使用它是因为每条记录都代表一个单独的旅程，因此，对每人的记录进行计数可以让我们知道他们进行了多少次旅程。在继续我们的示例时，我们将使用这些信息。

1. 将鼠标悬停在“ 总计每人行程”上，然后选择“ 添加步骤 ”，请点击出现的**+**图标。该流程的新步骤名为Clean 4。
2. 选择此新的**Clean**步骤，然后在**Profile**窗格中，双击Number of Rows字段的名称，将其重命名为Trips。
3. 创建一个新的计算字段Type of Traveler，其名称如下：

如果[Trips]> 15然后“极端”

ELSEIF [Trips]> 10然后“ Frequent”

ELSEIF [Trips]> 4然后“休闲”

ELSE“不常发生”

结束

此计算字段现在将标签每个人作为一个要么Extreme，Frequent，Casual，或Infrequent旅行者的基础上，他们有多少总行程做。此时，您可能会注意到该流仅包含“聚合”步骤中的字段（加上刚刚创建的计算字段）：

![img](../images/Image%20[289].jpg)

这是预期的，因为“聚合”步骤仅保留已分组或聚合的字段。有时，聚合的结果正是您要分析的结果。

但是，在这种情况下，我们希望补充原始数据集，以便我们可以将每个人标记为某种类型的旅行者。接下来，我们将完成该操作。

1. 拖动“ 清洁4”步骤并将鼠标悬停在“ 清洁3”步骤上。
2. 将“ 清理4”步骤放到出现的“ 连接”选项上。将显示“加入”步骤的设置窗格，允许您根据需要配置加入。请注意，Tableau Prep已根据名称和类型自动选择了最可能的联接字段：

![img](../images/Image%20[290].jpg)

花点时间检查“ **联接”**窗格的独特功能：

- Applied Join子句：在这里，您可以选择向Join子句添加条件，并确定应将哪些字段用作定义联接的键。您可以根据需要添加任意多个子句。
- 联接类型：您可以在此处定义联接的类型（内部，左侧，左侧内部，右侧，右侧内部或外部）。通过单击Venn图的各个部分以选择或取消选择要保留的联接部分来完成此操作。
- 连接结果摘要：条形图表示流的每个输入有多少条记录，有多少条匹配或不匹配，以及是否根据所选的连接类型将它们保留在结果数据集中。您可以单击一个条形段以在数据网格中查看过滤的结果。
- 连接条款建议：如果适用，Tableau Prep将显示可能的连接条款，然后单击即可添加。
- Join子句：Tableau Prep在此处显示Join子句中使用的字段和相应的值。任何不匹配的值将具有红色字体颜色。您可以通过双击来编辑值。这使您可以根据需要修复单个不匹配的值。

在我们的示例中，Tableau Prep自动将Person确定为联接输入和所有值之间的匹配字段，以按预期方式找到匹配项。此示例不需要采取进一步的措施，但是在某些情况下，您可能需要调整“连接子句”或修复不匹配的值。

*小心可能由于不正确的连接而创建的重复记录。**例如，您可能希望左连接保留左侧的所有记录，而只匹配右侧的某些记录。**确实如此，如果左侧的记录与右侧的多个记录匹配，则可以重复这些记录。**使用**联接结果摘要**来注意意外的结果。**请注意，数据采样还可能极大地影响摘要编号。*

通过添加另一个清洁步骤来扩展流程，该步骤应自动命名为Clean 5。此时，流程应类似于以下内容：

![img](../images/Image%20[291].jpg)

将聚合联接回原始数据集的结果与FIXED在Tableau Desktop中创建详细程度表达式非常相似。例如，在Tableau Desktop中，我们可能编写了如下表达式：

{FIXED [Person]：SUM（1）}

在桌面环境中，此表达式给出人员级别的记录数，并将该值返回到每一行。尽管无法在Tableau Prep中以相同的方式编写LOD计算，但我们通过聚合然后再加入流来完成相同的操作。我们将通过考虑过滤然后重塑数据以进行非常具体的视觉分析来结束我们的示例。

#### 在Tableau Prep中过滤 <div id="page_226"></div>

在Tableau Prep中有几种过滤方法：

- 过滤输入
- 流程内过滤

过滤输入可能是有效的，因为发送到数据源的查询将返回较少的记录。要过滤输入，请选择输入步骤，然后在输入窗格中单击“ 过滤值...”按钮：

![img](../images/Image%20[292].jpg)

弹出的“ 添加过滤器”对话框使您可以编写带有布尔（真/假）结果的计算。仅保留真值。

过滤还可以在流程中任何地方的干净步骤中完成。有几种应用过滤器的方法：

- 为给定字段选择一个或多个值，然后使用“ 仅保留”或“ 排除”选项。
- 使用字段上的“ **选项”**按钮可显示基于字段类型的多个过滤器选项。例如，可以通过计算，范围，相对值或空值来过滤日期：

![img](../images/Image%20[293].jpg)

- 选择一个字段，然后从工具栏中选择过滤值。与“ **输入”**窗格中过滤器的工作方式类似，系统将提示您编写代码，以对要保留的记录返回true。例如，如果您想保留在2016年1月1日或之后购买的记录，则可以编写如下代码：

[购买日期]> MAKEDATE（2016，1，1）

尽管在我们的示例中数据集不需要过滤，但是您可能希望尝试各种过滤技术。

#### 转换数据进行分析 <div id="page_227"></div>

此时，我们有一个非常有用的数据集可用于Tableau Desktop中的分析，但是我们可能还需要进行一些其他转换。如果我们想在地图上将此数据集中的飞行路径渲染出来怎么办？Tableau  Desktop中的一种方法需要一个数据集，该数据集的每个路径具有两个记录：一个记录的纬度和经度为起点，而另一个记录的纬度和经度为目的地点。

我们的数据集当前包含该路径的一条记录。我们有一个名为Route的字段，其中包含DAL-PHX和DFW-JFK之类的值。这些值对为我们提供了始发机场代码和目的地机场代码。借助一些补充数据和数据的转换，我们最终可以得到一种形状的数据，该形状可以使我们可视化机场之间的路径。

使用以下步骤结束本章的示例：

1. 在“ 清理5”步骤中找到“ 路由”字段，然后选择它。
2. 选择“ 路由”字段后，在窗格的工具栏上单击“ 自动拆分 ”。结果显示在这里：

![img](../images/Image%20[294].jpg)

该分段自动评估基于一个共同的分隔符领域，试图分裂。在这种情况下，破折号被标识为可能的值定界符，并且“ 自动拆分”将在另外两个字段中产生结果。

*配置文件窗格右上方的**“* **搜索”***框使您可以快速在配置文件窗格中查找字段。**route**在前面的示例中**键入**将找到原始**Route**字段以及两个拆分字段。*

1. 分别将Route-Split 1和Route-Split 2分别重命名为**Origin**和**Destination**。

我们仍然在同一记录中同时包含起点和终点，并且我们的目标是为起点和终点都有一条记录。幸运的是，通过Tableau Prep，可以轻松地将数据从列重整为行（或者，如果需要，也可以将行重整为列）。您将通过枢轴完成此任务。

1. 使用“ 清理5”步骤上的**+**图标，选择添加枢轴。
2. 枢轴窗格为您提供了将行转换为列或将列转换为行的选项。我们将保留默认选项。将Origin和Destination字段都拖到窗格的Pivot 1 Values区域中：

*对于列到行，“* *透视值”**将是一列，其中包含**透视**字段的所有值。**“* *数据透视名称”**将是一列，其中包含原始列的名称。*

![img](../images/Image%20[295].jpg)

1. 双击“ 数据透视1值”的文本，然后将该字段重命名为Airport Code。该字段将包含始发地和目的地记录的所有机场代码。
2. 双击“ 数据透视1名称”的文本，然后将该字段重命名为Route Point。此字段会将每个记录标记为Origin或Destination。

至此，我们有了一个数据集，其中包含旅程的每个终点（起点或终点）的一条记录。

*注意，数据透视导致重复的数据。**曾经是一个字段（原点和目的地一起）的现在是两个字段。**记录数增加了一倍，因此我们无法再对记录数进行计数来确定行程数。**我们也无法**SUM**支付机票费用，因为它将使机票重复计算。**我们需要使用**MIN**/* *MAX**/* *AVG**或某种看只有起点或目的地的细节表达或过滤的水平。**尽管许多转换允许我们实现某些目标，但我们必须意识到它们可能会带来其他复杂性。*

我们目前唯一的位置信息是机场代码。尽管Tableau Desktop包含机场代码的地理编码，但我们将为每个点补充实际的纬度和经度值：

1. 添加一个新的数据连接，选择Tableau Extract作为类型。
2. 找到并US Airports.hyper在\Learning Tableau\Chapter 10目录中选择。此文件包含许多美国机场代码的地理编码。
3. 输入步骤应自动添加，因为摘录仅包含一个数据表。将此新输入拖动到“ 数据透视1”步骤中，并将其放在“ 联接”选项上。Tableau Prep将创建一个新的联接步骤，并应自动将“ 机场代码”检测为联接两侧之间匹配的字段。
4. 现在，我们的数据集包含所有必需的数据。通过添加最终输出来完成流程。将类型设置为.csv，浏览到\Learning Tableau\Chapter 10目录，然后为文件命名Employee Flights.csv。

*输出步骤可以被配置为作为的Tableau服务器的数据连接或以输出此发布所产生的数据到文件的类型**.csv**，**.tde**（的Tableau数据提取物），或**.hyper**（超数据提取物）。*

现在，您可以通过使用工具栏顶部的“运行”按钮或单击输出步骤上的“运行”按钮来运行流程。一旦执行了流程，请打开目录中的Employee Travel.twb工作簿，\Learning Tableau\Chapter 10以查看如何使用数据并自行进行研究：

![img](../images/Image%20[296].jpg)

*与**文件**.tde**或**.hyper**文件**不同**.csv**，即使文件已在Tableau Desktop中作为数据源打开，也可能会写入文件。**如果您运行试图覆盖**正在使用**的**.tde**或**.hyper**文件**的流，则会收到错误消息**。**此外，您可以**.csv**通过在输出之前将字段拖放到干净步骤的配置文件窗格中**来重新排列**文件**的字段顺序**。*

#### 流程自动化选项 <div id="page_228"></div>

Tableau Prep  Builder允许您使用应用程序设计和运行流程。有时，数据清理和准备将是一次性的操作，以支持即席分析。但是，您通常会希望随后运行一个流程来捕获新数据或更改过的数据，并根据相同的模式对其进行清理和整形。在这些情况下，您将需要考虑一些用于使流程自动化的选项：

- **Tableau Prep Builder**可以通过命令行运行。您可以提供JSON文件来定义用于输入或输出数据连接的凭据。这使您可以使用脚本编制和调度实用程序来运行流，而无需手动打开和运行Tableau Prep界面。有关此选项的详细信息，请参见Tableau帮助：[https](https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line) : [//onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line](https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line)。
- **Tableau Prep Conductor**（Tableau Server的一项附加功能）使您能够将整个流从Tableau Prep Builder发行到Tableau Server，然后按需或按自定义计划运行它们。它还提供监视和故障排除功能。

### 总结 <div id="page_229"></div>

Tableau Prep具有即时反馈的动手数据清理和整形的创新范例极大地扩展了Tableau平台，并为您提供了对数据的不可思议的控制。在本章中，我们考虑了整个界面以及它如何允许您迭代快速地构建逻辑流程，以清理和整形数据以进行所需的分析或可视化。

通过贯穿本章的复杂而又实用的示例，我们探索了Tableau Prep中的每个重大转变，从输入到联合，联接，集合和枢轴，再到输出。在此过程中，我们还检查了其他转换和功能，例如计算，拆分，合并和值分组。这为您以任何需要的方式成型和成形数据奠定了基础。

在下一章中，我们将再次返回Tableau Desktop，以探索一些高级技术和可视化类型！

------

# 第四部分：先进技术和与他人共享 <div id="page_230"></div>

本节演示了各种高级可视化和技术，并以与他人共享数据故事的选项作为结束。

本节包括以下章节：

- [第11章](docs/Book.md#page_231)，*高级可视化，技术，技巧和窍门*
- [第12章](docs/Book.md#page_255)，*共享数据故事*

## 第十一章 高级可视化，技巧，技巧和窍门 <div id="page_231"></div>

通过对基本原理有深入的了解，可以使用Tableau突破极限。除了探索，发现，分析和交流数据外，Tableau社区的成员还使用该软件来创建和完成令人惊奇的事情，例如模拟一个谜机，玩井字游戏或战舰，仅用两个就可以生成分形数据记录，还有更多！在业务环境中创建任何如此复杂的内容都不会感到压力，但是知道Tableau确实是一块空白画布总是很高兴的。唯一的限制是您的创造力和想象力。

在本章中，我们将在实际环境中介绍一些高级技术。您将学习诸如创建高级可视化，使用自定义图像动态交换仪表板上的视图，使用高级地理可视化等内容。本章的目的不是提供每种可能技术的完整列表。取而代之的是，我们将看几个不同的示例，这些示例演示了一些可能性。许多示例旨在扩展您的知识并挑战您。

我们将在本章中介绍以下高级技术：

- 高级可视化
- 图纸交换和动态仪表板
- 先进的制图技术
- 使用背景图片
- 动画
- 透明度

### 高级可视化 <div id="page_232"></div>

我们观察了一下在[第3章](docs/Book.md#page_70)， *冒险到高级可视化*，在一些基本的可视化变体，如柱状图，时间序列，分布和散点图。现在，我们将考虑一些非标准的可视化类型。这些只是Tableau惊人的灵活性的示例，旨在激发您通过查看，理解和交流数据的新方式进行思考。这些不是为了复杂而设计成复杂的图表，而是激发创意和兴趣以有效地传达数据。

使用提供的Superstore数据创建以下每个可视化文件。除了提供分步说明之外，我们将指出用于创建每种图表类型的特定高级技术。目的不是要记住步骤，而是要了解如何创造性地利用Tableau的功能。

您可以在Chapter 11 Complete工作簿中找到完整的示例，或者通过使用Chapter 11 Starter 工作簿从头开始构建所有内容来测试您不断发展的Tableau技能。

#### 坡度图 <div id="page_233"></div>

斜率图显示值从一个期间或状态到另一期间或状态的变化。例如，下面的坡度图显示了**2016年**至**2017年****南部**地区每个州的销售排名变化：

![img](../images/Image%20[297].jpg)

以下是用于创建上述坡度图的一些功能和技术：

- 表格计算Rank(Sum(Sales))是通过State来寻址的（状态），这意味着每个州都在单个Year的分区内排名。
- 网格线和零线的行已设置为无。
- 轴已反转（右键单击轴并选择Edit，然后选中要反转的选项）。这使等级**1**出现在顶部，而等级3则以降序出现。
- 该轴已隐藏（右键单击该轴，然后取消选中Show Header）。
- 标签已被编辑（通过单击Label）以显示在行的两端，垂直居中以及将等级号放置在状态名称旁边。
- 该年度列标题已经从视图的底部到顶部移动（从顶部的菜单中，选择分析 | 表布局 | 先进，并取消选项，以显示在底部最里面的级别）。
- 一个**数据标注**已添加（使用上下拉**状态**的视野中，选择显示荧光笔）给最终用户的能力突出一个或多个状态。

*数据突出显示功能使用户能够通过从下拉列表中选择值或通过键入来突出显示视图中的标记（值的任何部分上的任何匹配项都将突出显示该标记；因此，例如，键入**Carolina**将突出显示***北卡罗来纳州***和***上图中的南卡罗来纳州***）。* *数据突出显示可以显示为您在视图中用作离散（蓝色）的任何字段，并且只要在这些视图中使用了相同的字段，它们就会在仪表板的多个视图中起作用。*

斜率图可以使用绝对值（例如的实际值Sales）或相对值（例如Sales本示例中所示的的等级）。如果要显示超过2年的时间来观察多个时间段内排名的变化，则所得到的可视化效果可以称为**凹凸图表**，如下所示：

![img](../images/Image%20[298].jpg)

#### 棒棒糖图表 <div id="page_234"></div>

甲**棒棒糖图表**是非常相似的条形图，但是通常使用在一个圆圈结束较细的线。这允许一些样式上的兴趣以及显示值或其他标签的位置。这里，例如，是一个**棒棒糖图表**用于销售的类别在技术部门：

![img](../images/Image%20[299].jpg)

用于创建此图表的功能和技术包括：

- 甲*同步* **双轴**用于SUM(Sales)与一个标记类型设置为**酒吧**和其他标记类型设定为**圆**。
- 条形和圆形的大小已调整（单击“ 标记”卡上的“ 大小 ” ）。条形图已设置为非常细，而圆圈大到足以容纳标签。
- 销售  已添加到圈子的标签中，并使用自定义货币进行了格式化。
- 轴已隐藏（右键单击并取消选中Show Header）。
- 网格线已隐藏（使用从菜单Format | Lines打开的格式选项）。

您可以尝试一些变体，例如：

- 交换行和列以翻转方向
- 排序**类别**
- 使用颜色或高亮显示某些值

#### 瀑布图 <div id="page_235"></div>

一个**瀑布图**，当你想展示如何零部件先后建立一个整体是非常有用的。在下面的截图，例如，是一个**瀑布图**显示利润横跨如何累积达到总计Departments和Categories产品。有时利润为负，因此，**瀑布图**会有所下降，而正值会朝着总值累积：

![img](../images/Image%20[300].jpg)

以下是用于构建图表的功能和技术：

- “ 行 ”上的SUM(Profit)字段是“ 运行总计”表计算（使用下拉菜单中的“ 快速表计算” 创建），并在整个表中进行计算。
- 已将“ 行总计”添加到视图中（从 “ 分析”窗格中拖放并拖放）。
- 标记类型设置为“ 甘特栏”，并使用代码临时计算SUM(Profit)。这允许将甘特图条向上一个标记的结尾处向下拉（或向上拉以获取负利润）。
- Category已排序升序由总和的利润，这样的瀑布图建立缓慢（或负）在左侧每个Department。您可能要尝试使用排序选项来发现对演示文稿的影响。

#### 步线和跳线 <div id="page_236"></div>

当您要显示随时间变化的离散变化时，通常使用步进线是很有用的，这与标准折线图不同，在标准折线图中，斜线可能意味着逐渐变化。例如，在任何给定时间运行的发电机数量是一个离散的整数，您可能希望通过“ **步线**图” 来强调这一事实。

在以下示例中，我们采用了先前通过**瀑布图**演示的利润积累，并使用“分**步线”**显示了每个连续的利润步骤：

![img](../images/Image%20[301].jpg)

总体而言，“ **阶梯线”**图表非常易于创建。只需单击“ 路径”架子，然后 从“ **线型”中**选择“ **步线”**，如以下屏幕截图所示。请注意，您还可以选择线性和**跳跃线**：

![img](../images/Image%20[302].jpg)

**线性**是默认值：强调值之间移动的斜线。当您要显示表示在跳转到另一个状态之前的给定时间段内可能存在的特定状态的值时，**跳转行** 很有用。例如，您可能希望显示一段时间内陈列室地板上有多少种产品，或者每天有多少张病床。

#### 火花线 <div id="page_237"></div>

**“火花线”**是指使用多个细线图的可视化效果，这些线图旨在快速读取和比较。Spark Lines的目标是使可视化效果一目了然。您并不是要传达确切的价值，而是要让观众能够快速了解趋势，运动和模式。

在这种类型的可视化的各种用法中，您可能已经看到金融出版物中使用了“ **火花线** ”来比较股票价格的变动。回想一下，在[第1章](docs/Book.md#page_21)，*以砍掉的Tableau*，我们认为是的初始启动**星火线**可视化，因为我们看线图的迭代。这是一个更加完善的示例：

![img](../images/Image%20[303].jpg)

该图表是使用以下功能和技术构建的：

- 开始的简单视图Sum(Sales)通过Quarter的Order Date（作为date与值）Category上的行。
- 已创建两个计算字段，以显示每个类别的最小和最大季度销售额。Min Sales有代码WINDOW_MIN(SUM(Sales))，Max Sales也有代码WINDOW_MAX(SUM(Sales))。两者都已作为离散（蓝色）字段添加到“ 行”中。
- 已将带有代码的Last Sales计算IF LAST() == 0 THEN SUM([Sales]) END放置在Rows上，并使用带有圆圈标记类型的*同步*双轴来强调每个时间轴的最终销售价值。
- 该轴SUM(Sales)被编辑成具有为每一行或列的独立轴范围和轴都被隐藏。这样可以强调线条的移动。请记住：目标不是显示确切的值，而是让观众看到模式和动作。
- 网格线已为Rows隐藏。
- 视图已调整大小（水平压缩并设置为Fit Height）。这样可以使火花线适合较小的空间，从而有助于快速了解样式和运动。

#### 哑铃图 <div id="page_238"></div>

甲**哑铃图表**是，对数据的每一切片比较两个值，强调这两个值之间的距离的圆的情节的变化。

例如，以下图表显示了Difference in Profit between East and West每种Category产品的区域：

![img](../images/Image%20[304].jpg)

该图表是使用以下功能和技术构建的：

- 甲*同步*的双轴SUM(Profit)已被用于使用一组标记的类型圈，而另一组，以线。
- Region已将其放置在该路径的“路径”架子上，以告诉Tableau在两者之间画一条线Regions。

*该***路径***货架适用于***线***和***多边形***标记类型。**当您将一个字段上的**P* *ATH**架子，它告诉的Tableau的顺序连接点（以下放置在球场上的排序顺序**路径**）。**路径通常与地理可视化结合使用，以连接路线上的起点和目的地，但也可以与其他可视化类型一起使用。*

- Region放置在“ 颜色 ”上作为圆形标记类型。

#### 单位图/符号图 <div id="page_239"></div>

甲**单元图表**可用于显示各个项目，通常使用的形状或符号来表示每个个体。这些图表可以引起强烈的情感反应，因为数据的表示方式不太抽象，更容易识别为*真实*事物。例如，以下图表显示了每个客户有多少客户延迟发货Region：

![img](../images/Image%20[305].jpg)

该视图是使用以下技术创建的：

- 过滤的视图，其中Late Shipping是True。Late Shipping是一个计算字段，用于确定是否花费了超过14几天的时间进行发货和订购。代码如下：

DATEDIFF（'day'，[订购日期]，[发货日期]）> 14

- 区域按客户ID的不重复计数降序排列。
- 客户ID已放置在“ 详细信息”上，因此每个不同的客户都有一个标记。
- 标记类型已更改为“ 形状”，并且形状已更改为“ 性别”形状调色板中包含的人形。要更改形状，请单击“ 形状”架子并选择所需的形状，如以下屏幕截图所示：

![img](../images/Image%20[306].jpg)

当轻轻地提醒他们糟糕的客户服务会影响真实的人时，前面的单元图可能会比标准条形图引起更多的区域经理响应。当然，形状仍然是抽象的，但更能代表实际的人。您也可以考虑使用客户名称标记商标，或使用其他方法进一步吸引受众。

*请记住，通常在Tableau中，会为尺寸值的每个不同交点绘制一个标记。**因此，很难为单行数据（例如仅包含一个字段的值10）绘制10个单独的形状。**这意味着您将需要考虑数据的形状，并包括足够的行以绘制要表示的单位。*

在任何形式的可视化中，混凝土形状也可以大大减少理解数据所需的时间。对比在这两个散点图中识别部门所需的工作量：

![img](../images/Image%20[307].jpg)

一旦知道了形状的含义，就不再需要引用图例。

在“ 形状”架子上放置离散字段，可以将形状分配给字段的各个值。

*形状是位于**My Tableau Repository\Shapes**目录**中的图像**。**您可以在该目录的子文件夹中包含自己的自定义形状。*

#### Marimekko图表 <div id="page_240"></div>

甲**Marimekko的图表**（有时也被称为**美康图表**）类似于堆积条形图，但另外使用条的宽度变化进行通信有关数据的附加信息。例如，这里是一个**Marimekko图表，**显示了按地区和部门划分的销售明细。条形图的宽度传达了该**地区**的总销售额，而每个细分的高度则为您提供了该地区内部门的销售额百分比：

![img](../images/Image%20[308].jpg)

在Tableau中创建Marimekko图表利用了根据轴单位固定条形宽度的功能。

*当“连续”（绿色）字段位于“* *列”**（因此定义水平轴）并且标记类型设置为“* *条形”**时，**单击“* *大小”**架子，将* *显示固定大小的选项。**您可以手动输入“* *大小**和**对齐方式”，**也可以**在“* *大小”功能**区上放置一个字段**来更改条形的宽度。*

以下是一些详细信息：

- 标记类型已专门设置为Bar。
- Region 并 Department分别放置在Color和Detail上。它们是视图中唯一的尺寸，因此它们定义了**视图的详细程度**。
- Sales已放置在“ 行”上，并应用了Percent of Total快速表计算。已将“ 计算使用（寻址）”设置为，Department以便我们在的分区中获得每个部门的销售百分比Region。
- 计算字段Sales for Region计算每个条形图右侧位置的*x*轴位置。代码如下：

如果FIRST（）= 0

THEN MIN（{EXCLUDE [部门]：SUM（销售）}）

ELSEIF LOOKUP（MIN（[Region]），-1）<> MIN（[Region]）

THEN PREVIOUS_VALUE（0）+ MIN（{EXCLUDE [部门]：SUM（销售）}）

其他

PREVIOUS_VALUE（0）

结束

尽管此代码乍看之下令人生畏，但它遵循逻辑上的进展。具体来说，如果这是第一个条形图，我们将要知道Sales整个区域的总和（这就是为什么我们以内Department联详细级别计算将其排除在外）。当计算移至新的时Region，我们需要将先前的Region总数添加到新的Region总数中。否则，计算是针对同一内的另一个细分Region，因此区域总数与上一个细分相同。

最后，对该视图进行了一些其他调整：

- “ 大小 ”字段是带有代码的临时详细信息计算级别{EXCLUDE [Department] : SUM(Sales)}。正如我们前面提到的，这排除Department并允许我们获得一定Region水平的销售额。这意味着，根据给定的总销售额，每个条形的大小都将确定Region。
- 单击“ 大小”架子可提供将条形的“ 对齐 ” 设置为“ 右”的选项。由于前面的计算给出了条形图的正确位置，因此我们需要确保从该起点绘制条形图。
- 各种字段已复制到“ 标签”架子，以便每个条形图段都更清楚地向查看者传达含义。

*要将标签添加到每一**Region* *列，您可以考虑创建第二个视图，并将两者都放置在仪表板上。**或者，您可以使用注释。*

除了允许您创建Marimekko图表外，还可以控制轴单位中的条形尺寸，从而为创建其他可视化效果提供了各种可能性，例如级联图或阶梯状面积图。该技术与此处使用的技术相似。您还可以将大小调整功能与**连续的**合并**箱结合**使用（使用下拉菜单将视图中的合并**箱**字段从离散更改为连续）。这样可以使直方图在条形之间没有大的间距。

*有关* *Marimekko图表**的更全面讨论**以及适用于稀疏数据的方法，请参阅Jonathan Drummey的博客文章，*[网址](https://www.tableau.com/about/blog/2016/8/how-build-marimekko-chart-tableau-58153)*为**：*[https](https://www.tableau.com/about/blog/2016/8/how-build-marimekko-chart-tableau-58153) *:* *//www.tableau.com/about/blog/2016/8/how-build-marimekko-chart* [-tableau-58153](https://www.tableau.com/about/blog/2016/8/how-build-marimekko-chart-tableau-58153)*。*

### 图纸交换和动态仪表板 <div id="page_241"></div>

**工作表交换**（有时也称为工作**表选择**）是一种在视图上动态显示和隐藏视图的技术，通常以将一个视图交换为另一个视图的形式出现。在仪表板上动态隐藏和显示视图的应用更加广泛。与浮动对象和布局容器结合使用时，此技术可让您创建丰富且动态的仪表板。

基本原理很简单：

- 当**行**或**列**上至少有一个字段且过滤器或隐藏的组合阻止呈现任何标记时，视图在仪表板上崩溃
- 标题和标题不会折叠，但可以隐藏，以便视图完全折叠

让我们考虑用表示利润视图一个简单的例子Department，并Category有Department快速的过滤器。仪表板已格式化（从菜单中选择Format | Dashboard），带有灰色阴影以帮助我们查看效果：

![img](../images/Image%20[309].jpg)

观察过滤掉所有部门如何导致视图崩溃。标题仍然保留，但可能已隐藏。

为了交换两个不同的图纸，我们仅利用折叠行为以及布局容器的属性。我们将从创建两个通过 参数和计算字段过滤的不同视图开始。该参数将使我们能够确定显示哪个工作表。执行以下步骤：

1. 创建一个整数参数Show Sheet，该参数的字符串值列表设置为Bar Chart和Map：

![img](../images/Image%20[310].jpg)

1. 由于我们要基于参数选择进行过滤，并且不能将参数直接添加到“ **过滤器”功能区**，因此，我们将创建一个计算字段Show Sheet Filter，该字段名为返回参数的选定值。代码简单地是[Show Sheet]，它是参数名称，并返回参数的当前值。
2. 创建一个名为的新工作表Bar Chart，类似于之前的屏幕快照中的Profit by Departmentand Category视图。
3. 显示参数控件（在数据窗口中右键单击该参数，然后选择Show Parameter Control）。确保选择了“ 条形图”选项。
4. 将“ 显示图纸过滤器”字段添加到“ 过滤器”架子，然后选中“ 条形图”以保留该值。
5. 创建另一个名为工作表Map，显示按利润填充的州地图：

![img](../images/Image%20[311].jpg)

1. 在此视图上显示参数，并将选择更改为Map。请记住，参数选择对于工作表是通用的。如果要切换回条形图视图，则由于使用了过滤器，它不应再显示任何数据。
2. 添加显示表过滤领域的过滤器架，并检查地图，以保持该值。
3. 创建一个名为的新仪表板Sheet Swap。
4. 从左侧窗口中的对象向仪表板添加“ **水平”**布局容器：

![img](../images/Image%20[312].jpg)

*一个***垂直***布局容器将在这种情况下很好的工作。**关键在于，当视图设置为适合整个视图，或适合宽度（对于水平容器）或适合高度（对于垂直容器）时，布局容器将允许每个内部视图展开以填充该容器。**当一个视图折叠时，可见视图将扩大以填充容器的其余部分。*

1. 将每个工作表添加到仪表板中的布局容器。参数控件应该自动添加，因为它在每个视图中都是可见的。
2. 使用“ 条形图”视图上的下拉菜单，确保将视图设置为填充容器（“ 适合” |“ 整个视图”）。您无需设置地图的填充，因为地图可视化会自动填充容器。
3. 隐藏每个视图的标题（右键单击标题，然后选择“ 隐藏标题”）。

现在，您有了一个仪表板，在该仪表板上更改参数将导致显示一个视图或另一个视图。当地图选择，筛选结果中没有数据的条形图，所以它崩溃和 地图填充容器：

![img](../images/Image%20[313].jpg)

或者，选择“ 条形图”时，由于过滤器，“ 地图”折叠，并且“ 条形图”填充了容器：

![img](../images/Image%20[314].jpg)

*折叠视图的关键是要有一个过滤器或一组过滤器，以确保不显示任何数据行。**您不必使用参数来控制过滤。**您可以使用常规过滤器或动作过滤器来达到相同的效果。**这为仪表板中的动态行为打开了各种可能性。*

#### 动态显示和隐藏其他控件 <div id="page_242"></div>

过滤掉所有数据后，视图将折叠。但是，其他控件（如快速过滤器，参数，图像，图例和文本框）将不会折叠，并且无法动态显示或隐藏。但是，通常在动态仪表板中，您可能想要显示或隐藏这些对象。有时，在进行其他选择时，参数不适用。看上一节中的简单示例。Tableau自动将其添加到仪表板的颜色图例适用于地图。但是当显示条形图时，图例不再适用。

幸运的是，我们可以扩展在上一节中使用的技术，以扩展视图以将要显示的项目从浮动对象下推入，然后折叠视图以允许我们要隐藏的项目返回到以下位置。漂浮物。

让我们扩展前面的工作表交换示例，以显示如何显示和隐藏颜色图例：

1. 创建一个名为Show / Hide Legend的新表。此视图仅用于显示和隐藏颜色图例。
2. 双击Rows并输入，创建一个临时计算MIN(1)。我们必须在“ 行”或“ 列”上有一个字段才能使视图折叠，因此我们将使用该字段为行提供一个单轴，为列提供一个单轴而没有其他标题。
3. 复制Columns的ad hoc计算。您现在应该有一个带有一个标记的简单散点图。
4. 因为这是一个帮助表，而不是我们希望用户看到的任何内容，所以我们不希望它显示任何标记或线条。使用格式 | 格式化视图 行删除网格线的行和列，沿轴标尺。此外，隐藏轴（右键单击每个轴或字段，然后取消选中“ 显示标题”）。另外，将“ 颜色”设置为完全透明以隐藏标记。
5. 我们将希望在选择Map选项时显示此视图，因此显示参数控件并确保将其设置为Map，然后将Show Sheet Filter添加到过滤器并选中Map：

![img](../images/Image%20[315].jpg)

1. 在“ 图纸 交换仪表板”上，将“ 显示/隐藏图例”表添加到“ 显示表”参数下拉列表和颜色图例之间的**布局容器中**。隐藏“ 显示/隐藏图例”工作表的标题。
2. 确保选择了地图。颜色图例应一直推到底。
3. 将布局容器添加为浮动对象。调整大小和位置，使其完全覆盖以前颜色图例的区域。它应覆盖“ 显示/隐藏图例”工作表的标题，但不覆盖参数下拉列表。

*可以通过以下方式将对象和图纸添加为浮动对象：**拖动时**按住**Shift键**，将“* *新建对象”**选项**设置为**“* *浮动”**，或使用对象上的下拉菜单。**您还可以**在仪表板窗格中将**新对象的默认行为从“* *平铺”**更改为“* *浮动* *”。*

1. 该布局容器是默认透明的，但我们希望它隐藏的是下面。使用下拉菜单设置**布局容器的**格式，并添加白色阴影，以使其与背景无法区分。

此时，您将拥有一个动态的仪表板，在其中显示图例时会显示图例，在条形图可见时它会适用并隐藏。当地图被选择时，显示/隐藏图例片被示出并且推动图例至底部**布局容器**：

![img](../images/Image%20[316].jpg)

当条形图被选择时，显示/隐藏图例片折叠和图例，这是不再适用于视图中，在后面的/隐藏落入**浮动布局容器**：

![img](../images/Image%20[317].jpg)

您可以在仪表板上使用的此技术有多少种形式没有限制。您可以根据需要设置任意多个图层。您甚至可以结合使用这些技术来在仪表板上打开和关闭视图和对象。创建丰富的交互式用户体验的可能性令人难以置信。

### 映射技术 <div id="page_243"></div>

我们在整本书中都谈到了地理可视化。您已经看到了符号图和填充图。在这里，我们将介绍提供您自己的地理编码数据以及创建自定义地区。

#### 补充地理数据标准 <div id="page_244"></div>

我们在看到[第1章](docs/Book.md#page_21)， *以砍掉的Tableau*，那产生的Tableau  纬度和经度字段时数据源中包含地理字段画面可以用它的内部地理数据库匹配。Tableau的内部地理环境包含国家，州，邮政编码，MSA和国会区等字段。随着Tableau继续添加地理功能，您将需要查阅文档以确定内部数据库所包含内容的详细信息。

但是，如果数据集中具有经度或纬度，或者可以用该数据补充数据源，则可以非常精确地创建地理可视化。提供供Tableau使用的纬度和经度有几种选择：

- 在数据源中包含Latitude和Longitude作为字段。如果可能的话，这个选项会提供最简单的方法来创建自定义地理可视化，因为你可以简单地Latitude对行  和Longitude在列获得地理情节。
- Latitude 使用IF / THEN逻辑或case语句根据数据中的其他值分配Latitude 和Longitude值，为经度创建一个计算字段，为经度创建另一个字段。这在许多地方也将是乏味且难以维护的。
- 导入自定义地理文件。在菜单中，选择地图 | 地理编码 | 导入自定义地理编码...。导入对话框包含指向文档的链接，该文档进一步详细描述了该选项。

- 连接到包含纬度和经度的数据作为辅助数据源，并使用跨数据库联接或数据混合来实现地理可视化。例如，以下是通过加入一个文件创建的可视化文件，该文件包含每个地址的确切纬度和经度：

![img](../images/Image%20[318].jpg)

- 一个字段中指定的地理角色，并指定无法识别的值，以期望Latitude 和Longitude位置。此选项最常用于校正标准地理字段中无法识别的位置，例如城市或邮政编码，但也可以用于创建自定义地理位置，尽管在多个位置进行维护很繁琐且困难。您可以分配未知的地理位置，如下节所述。

#### 手动分配地理位置 <div id="page_245"></div>

通过单击地理可视化效果右下角的未知指示器来分配未知位置，如下所示：

![img](../images/Image%20[319].jpg)

这将为您提供以下选项：

- 编辑位置
- 筛选出未知位置
- 剧情在默认位置（Latitude 和Longitude的**0**，即有时幽默被称为位置**空岛**，刚好位于西海岸**非洲**）。

上一个屏幕截图中的指示器显示336个未知位置。单击指示器并选择“ 编辑位置”选项，可以通过选择已知位置或输入自己的**纬度** 和**经度**信息来更正不匹配的位置，如下所示：

![img](../images/Image%20[320].jpg)

前三个选项允许您指定地理环境，Tableau通过该地理环境确定字段值的位置。您可以指定国家，州和/或县。

例如，画面可能无法识别该城市**曼斯菲尔德**，直到您指定的国家（在美国合众国就有一个**曼斯菲尔德**，**得克萨斯州**，**曼斯菲尔德**，**俄亥俄州**，**曼斯菲尔德**，**堪萨斯州**和十几更多！）在这个例子中，你可以具体选择一个常量State或让Tableau知道数据集中定义State的字段。

您还可以通过单击表格中的“ 无法识别”标签并匹配到已知位置来设置各个位置，或者通过输入特定的Latitude和来设置各个位置Longitude。

#### 创建自定义地区 <div id="page_246"></div>

**自定义地区**是您创建（或数据定义）的地理区域或地区，而不是内置的地理区域或地区（例如国家或地区代码）。Tableau为您提供了两个用于创建自定义地区的选项：

- 特殊的自定义地区
- 字段定义的自定义地区

##### 特殊的自定义地区 <div id="page_247"></div>

您可以通过在地图上选择和分组标记来临时创建自定义地区。只需选择一个或多个标记，将鼠标悬停在一个标记上，然后使用“ **组”**图标即可。或者，右键单击标记之一以找到选项。如果您在数据中具有经度和纬度，则可以按任何维度分组来创建自定义地区，如果使用Tableau生成的纬度和经度，则可以通过地理维度进行分组。在这里，我们将考虑一个使用邮政编码的示例：

![img](../images/Image%20[321].jpg)

您会注意到，在此示例中，Tableau创建了一个新字段，邮政编码（组）。新字段在数据窗格中具有一个回形针和地球图标，表明它是一个组和一个地理字段。Tableau会自动在颜色上包括组字段。

您可以继续选择标记并对其进行分组，直到拥有所需的所有自定义地区。在邮政编码仍是详细视图级别的一部分的情况下，您将在每个**邮政编码上**都有一个标记（并且所有度量都将通过**邮政编码**进行切片）。但是，当您从视图中删除邮政编码时，仅保留邮政编码（组）字段，Tableau将基于新组绘制标记：

![img](../images/Image%20[322].jpg)

在这里，组字段已重命名为“ 自定义领地”，并且组名已别名为East，West和Central。

*使用填充的地图，Tableau将连接所有连续的区域，并且仍然包括未连接的区域作为选择和突出显示的一部分。**借助符号地图，Tableau将在所有分组区域的地理中心绘制标记。*

##### 字段定义的自定义地区 <div id="page_248"></div>

有时，您的数据包括自定义地区的定义。例如，假设您的数据有一个名为的字段Region ，该字段已将邮政编码分组为各个区域。即，每个邮政编码仅包含在一个区域中。您可能不想花时间选择标记并对其进行手动分组。

相反，您可以告诉Tableau数据中已经存在该关系。在此示例中，您将使用Region数据窗格中字段的下拉菜单，然后选择“ 地理角色 | 地理角色”。创建从... | 邮编。Region现在是定义自定义地区的地理字段：

![img](../images/Image%20[323].jpg)

*使用临时自定义区域来执行快速分析，但是考虑将字段定义的自定义区域用于长期解决方案，因为这样您便可以在无需手动编辑Tableau数据源中的任何组的情况下重新定义数据中的区域。*

#### 利用空间对象 <div id="page_249"></div>

空间对象定义的地理区域可以像点一样简单，也可以像多面多边形一样复杂。这使您可以渲染从自定义贸易区到河流，道路以及县和国家/地区的历史边界的所有内容。空间对象可以存储在空间文件中，并且也受某些关系数据库的支持。

Tableau支持多种空间文件格式，例如ESRI，MapInfo，KML，GeoJSON和TopoJSON。此外，您可以直接连接到ESRI数据库以及具有地理空间支持的关系数据库，例如SQL Server。如果创建提取，则空间对象将包含在提取中。

许多应用程序（例如Alteryx，Google Earth和ArcGIS）可用于生成空间文件。空间文件也很容易从许多组织下载。在地理空间分析方面，这为您提供了很大的灵活性。

例如，下面是美国铁路地图：

![img](../images/Image%20[324].jpg)

要复制此示例，请从此处下载Shapefile：[https](https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile) : [//catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-us-rails-national-shapefile](https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile)。

下载并解压缩文件后，请连接到该tl_2015_us_rails.shp文件。在预览中，您将看到带有ID字段和铁路名称的数据记录。的几何字段是定义铁路段的直线形状的空间对象：

![img](../images/Image%20[325].jpg)

在空白纸上，只需双击几何字段。Tableau将在详细信息中包括地理收集，并引入自动生成的纬度和经度字段以完成渲染。尝试在细节中包括ID字段，并基于Fullname进行过滤。

*考虑使用跨数据库联接以使用自定义空间数据补充现有数据。**此外，Tableau支持空间联接，即使没有其他关系，也可以将空间上仅相关的数据组合在一起。*

#### 最后的地图提示 <div id="page_250"></div>

有许多方法可以自定义地理可视化效果，并且需要注意一些选项。首先，您可能会注意到将鼠标悬停在地图上时出现的控件：

![img](../images/Image%20[326].jpg)

这些控件使您可以搜索地图，放大和缩小，将地图固定到当前位置以及使用各种类型的选择。

选择“ 地图” |“ 其他”时，将显示其他选项。顶部菜单中的“ 地图选项 ”：

![img](../images/Image%20[327].jpg)

这些选项使您能够设置允许最终用户执行哪些地图操作以及是否显示比例尺。此外，您可以设置比例尺和**径向选择的**显示单位。选项包括自动（基于系统配置），公制（米和公里）和美国（英尺和英里）。

使用地理可视化时，还需要考虑其他一些技巧：

- 使用顶部菜单选择地图 | “地图图层”提供了许多选项，可用于显示背景的哪些图层作为地图的一部分。
- 其他缩放选项包括使用鼠标滚轮，双击，*Shift* + *Alt* +单击和*Shift* + *Alt* + *Ctrl* +单击。
- 您可以单击并按住几秒钟以切换到平移模式。
- 您可以通过右键单击地图并选择适当的选项来显示或隐藏缩放控件和/或地图搜索。
- 缩放控件可以显示在使用轴的任何可视化类型上。
- 缩放控件上的图钉交替将地图恢复为最适合可见数据的状态，或锁定当前的缩放和位置。
- 您可以通过复制（创建双轴地图*按Ctrl*要么+拖/放）Latitude在列或Longitude对行，然后使用该字段的下拉菜单中选择双轴。您可以使用此技术在单个地图上组合多种标记类型：

![img](../images/Image%20[328].jpg)

- 使用填充的地图时，请考虑在“ 地图图层”窗口中将“ 冲洗”设置为100％，以获取外观清晰的地图。但是，只会显示填充的形状，因此不会绘制任何缺失的州（或县，国家和其他州）：

![img](../images/Image%20[329].jpg)

- 您可以使用菜单并选择地图 | 来更改背景地图图像图块的来源。背景图。这样，您就可以在“ 无”，“ 脱机”（当您没有Internet连接，但限于显示的详细信息时很有用）或Tableau（默认值）之间进行选择。
- 此外，从同一菜单选项，您可以指定Map Services ...以使用**WMS服务器**或**Mapbox**。

### 使用背景图片 <div id="page_251"></div>

背景图像使您可以在任何图像之上绘制数据。考虑可能性！您可以按体育场图像上的座位，办公楼平面图上的房间占用，网络图上每个设备的错误数量或流星对月球表面的影响来绘制门票销售情况。

在此示例中，我们将绘制医院各个房间每月的患者人数。我们将使用医院平面图和二楼的两个平面图图像。数据源位于Chapter 11目录中，名为Hospital.xlsx。它由两个选项卡组成：一个选项卡用于患者计数，另一个选项卡基于映射到图像的*x* / *y*坐标用于房间位置。我们将尽快考虑其工作原理。您可以在Chapter 11 Complete.twbx工作簿中查看完整的示例，也可以使用从头开始Chapter 11 Starter.twbx。

要指定背景图片，请使用顶部菜单选择地图 | 单击背景图像，然后单击图像所适用的数据源（在本示例中为Hospitals）。在“ 背景图像 ”屏幕上，您可以添加一个或多个图像。

在这里，我们从Hospital - Ground Floor.png位于Chapter 11目录中的开始，

![img](../images/Image%20[330].jpg)

你会发现，我们映射域X和Y ^（从位置选项卡）和规定的权利在800和底部在700。这基于图像的大小（以像素为单位）。

*您不必使用像素，但是在大多数情况下，它可以更轻松地映射数据位置。**在这种情况下，我们有一个Excel文件的选项卡，其位置已经映射到**图像上的**X**和**Y**坐标（以像素为单位）。**使用跨数据库联接，您可以创建一个简单的文本或Excel文件，其中包含图像映射，并将它们映射到现有数据源。**您可以手动绘制点（使用图形应用程序），也可以使用许多免费的在线工具之一，这些工具可以快速在图像上绘制坐标。*

我们只想显示此底层的蓝图，因此切换到“ 选项”选项卡，我们将确保根据数据设置条件。我们还将确保选中“ 始终显示整个图像”：

![img](../images/Image%20[331].jpg)

接下来，重复前面的步骤，我们将第二个图像（Hospital - 2nd Floor.png）添加到数据源，确保仅显示2nd Floor。

定义并映射图像后，就可以建立可视化了。基本思想是使用X和Y字段来创建散点图。但是，我们必须确保X，并Y没有因为总结，如果它们是为多个记录加在一起，我们将不再有正确的映射到像素位置。有两种选择：

- 使用X和Y作为连续尺寸。
- 使用MIN，MAX或AVG代替SUM，并确保Location用于定义视图的详细程度。
- 此外，图像从顶部的**0**Y到底部进行测量，但散点图从底部的**0**开始并且值向上增加。因此，最初，您可能会看到背景图像上下颠倒。为了解决这个问题，我们将编辑*y*轴（右键单击并选择Edit Axis），然后选中Reversed选项。

我们还需要确保在视图中使用了地板字段。告诉Tableau应该显示哪个图像是必要的。在这一点上，我们应该能够得到这样的可视化效果：

![img](../images/Image%20[332].jpg)

在这里，我们根据每个房间的患者人数绘制了带有大小的圆圈。我们可以通过多种方式清理和修改可视化文件：

- 隐藏*x*和*y*轴（右键单击该轴，然后取消选中Show Header）
- 隐藏的标题Floor，因为图像已包含标签
- 添加Floor到“ 过滤器”架子上，以便最终用户可以选择一次查看一个楼层

### 动画 <div id="page_252"></div>

**动画可视化**可以通过揭示随时间推移发生的模式或强调戏剧性事件而使数据讲故事栩栩如生。在“ 页面”架子中添加一个字段将显示播放控件，使您可以分页浏览该字段的每个值。您可以手动执行此操作，也可以单击“ **播放”**按钮以观看可视化效果，因为值会自动更改。

该Chapter 11 Completed工作簿包含一个示例，可以对前面显示的医院平面图进行动画处理。您可以通过将Month字段添加到Pages架子（作为月**日期值**）来创建相同的效果。然后观察圆圈逐月变化的大小。

尝试使用“ 显示历史记录”选项，以查看如何查看上一页的标记。

*当您在仪表板上使用多个视图时，每个视图在“* *页面”**架子**上具有相同的字段组合**，您可以同步播放控件（使用播放控件上的插入符号下拉菜单）以创建完全动画的仪表板。*

可以与Tableau Desktop或Tableau Reader的其他用户共享动画。在撰写本文时，自动播放控件不适用于Tableau Server，Tableau Online或Tableau Public。但是，最终用户可以手动分页显示这些值。

### 透明度 <div id="page_253"></div>

在较新版本的Tableau中，您可以为仪表板上使用的可视化设置透明度。这可以实现各种创新方法，例如将可视化效果彼此叠加或覆盖背景图像。

您将在Chapter 11 Complete工作簿中找到以下示例：

![img](../images/Image%20[333].jpg)

仪表板由图像，图像上的透明图表和标题组成。

为了使可视化透明，请转到“ 格式底纹”并将“ 工作表”底纹设置为“ 无”：

![img](../images/Image%20[334].jpg)

将阴影设置为**None后**，可视化在仪表板上使用时将是透明的。在这一点上，您还可以通过选择仪表板上的可视化效果，切换到“ 布局”选项卡并调整背景以使其具有不透明度来实现半透明效果：

![img](../images/Image%20[335].jpg)

*请注意，透明性的使用不会影响数据故事。**背景图像和重叠的可视化效果可能会增加趣味性和趣味性，但也很容易增加干扰和混乱感。*

### 总结 <div id="page_254"></div>

在本章中，我们涵盖了各种各样的技术！我们研究了高级可视化，图纸交换，动态仪表板，一些高级映射技术，包括补充地理数据，自定义区域，空间对象以及使用自定义背景图像。最后，我们考虑了动画和透明度的可能性。

无法涵盖所有可能的可视化类型或技术或解决问题的方法。取而代之的是，我们的想法是证明可以使用一些先进的技术来完成一些工作。本章中的示例建立在前几章的基础上。从这里，您将能够以创新的方式创造性地修改和组合技术，以解决问题并取得令人难以置信的结果！接下来，我们将重点放在如何共享这些结果上。

## 第十二章 分享您的数据故事 <div id="page_255"></div>

在本书中，我们一直专注于Tableau Desktop，并学习了如何以可视化方式和仪表板直观地浏览和交流数据。进行发现，设计有洞察力的可视化并构建出色的仪表板后，就可以共享数据了。

通过Tableau，您可以使用多种方法共享您的工作。在本章中，我们将介绍共享可视化内容和仪表板的各种方法，以及在决定如何共享时应考虑的因素。

具体来说，我们将研究以下主题：

- 展示，打印和导出
- 与Tableau Desktop和Tableau Reader共享
- 与Tableau Server，Tableau Online和Tableau Public共享
- 呈现数据故事的选项
- Tableau Server的其他分发选项

### 展示，打印和导出 <div id="page_256"></div>

Tableau的主要目的是构建丰富的交互式可视化效果和仪表板，以便在屏幕上使用。通常，您希望用户与您的仪表板和可视化进行交互。但是，有多种显示，打印和导出格式的不错选择。

#### 呈现 <div id="page_257"></div>

Tableau为您提供了多种个人呈现数据故事的选项。您可以引导观众浏览单个仪表板或视图的演示，也可以创建整个演示。尽管可以采用多种方式来组织演示文稿，但请考虑以下选项：

- 导出到**PowerPoint**
- **简报模式**

较新的Tableau Desktop和Server版本允许您直接导出到**PowerPoint**。在Tableau Desktop中，选择“ 文件” |“表”。导出为PowerPoint ...。选择位置和文件名后，Tableau将生成PowerPoint文件（.pptx），将Tableau工作簿中的每个选项卡转换为PowerPoint 中的单个幻灯片。每张幻灯片都将包含视图和仪表板在导出时存在的静态图像。

如果您希望获得更动态的演示体验，请考虑使用“ 演示模式”。 **演示模式**可全屏显示所有仪表板和视图。它隐藏了所有 工具栏，窗格和创作对象。 要激活**演示模式**，请 从顶部菜单中选择“ 窗口”，或者按 **F7**或顶部工具栏上的选项。按**F7**或*Esc*键退出**演示模式**。在“ **演示模式”下**，您仍可以使用操作，突出显示，过滤和其他选项与仪表板和视图进行交互。 这丰富了演示文稿，并使您能够即时回答问题。 与引人注目的仪表板和故事一起使用时，“ **演示模式”**提供了一种有效的 方式来亲自引导观众了解数据故事。

*如果**在* **演示模式下***按**Ctrl* *+* *S**保存工作簿**，则**默认情况***下***，该工作簿将在***演示模式***下**打开**。*

#### 列印 <div id="page_258"></div>

通过Tableau，可以打印各个可视化效果，仪表板和故事。从“ 文件”菜单中，可以选择“ 打印”以将工作簿中的当前活动工作表发送到打印机，或者选择“  打印为PDF”选项以导出为PDF。使用这两个选项，您都可以将活动工作表，所选工作表或整个工作簿导出为PDF。要选择多个工作表，请按住*Ctrl*键并单击各个选项卡。

打印时，您还可以选择显示选择。选中此选项后，在视图或仪表板上被交互式选择或突出显示的标记将被打印为选中状态。否则，将打印标记，好像没有选择。在以下仪表盘的地图有针对西部半月痕**美国**选择：

![img](../images/Image%20[336].jpg)

以下是一些打印注意事项，技巧和建议：

- 如果将仪表板设计用于打印，请选择预定义的纸张尺寸作为仪表板的固定尺寸，或使用与相同长宽比匹配的自定义尺寸。
- 使用“ 页面设置”屏幕（可从“ 文件”菜单获得）定义特定的打印选项，例如将包括哪些元素（图例，标题，标题），布局（包括边距和居中）以及视图或仪表板的显示方式缩放以匹配纸张尺寸。该页面设置选项是具体到每一个视图。复制或复制工作表将包括对“ 页面设置”设置的任何更改：

*如果要设计多张纸或要打印的仪表板，请考虑将其中一张作为模板，设置所有所需的打印设置，然后为每张新纸复制它。*

![img](../images/Image%20[337].jpg)

- “ 页面”架子上使用的字段将定义打印时的分页符（对于单张纸，但不适用于仪表板或故事）。“ 页面”架子定义的页面数不一定等于打印的页面数。这是因为“ 页面”架子定义的单个页面可能需要多个打印页面。
- 故事中的每个故事点将被打印在新页面上。
- 打印整个工作簿可能是生成单个PDF文档进行分发的有效方法。每个*可见工作*表将按选项卡的顺序从左到右包含在PDF中。您可以隐藏表格以防止包含在PDF中，也可以重新排列表格以调整生成文档的顺序。还考虑创建带有标题页，目录，页码和注释的图像和文本的仪表板。
- 避免在仪表板上使用滚动条，因为它们将作为滚动条进行打印，并且不会打印可见窗口之外的任何内容。
- 您还可以在工作簿中选择多个工作表（ 单击每个选项卡时按住 *Ctrl*键），然后仅打印选定的工作表。

*如果工作表是一个或多个仪表板或工具提示中使用的视图，或者如果它们是一个或多个故事中使用的仪表板，则可以隐藏工作表。**要隐藏视图，请右键单击底部条或仪表板或故事工作区左侧窗格中的选项卡或缩略图，然后选择“* *隐藏工作表”**。**要显示工作表，请在仪表板或故事工作区的左侧窗格中找到它，右键单击它，然后取消选中“* *隐藏工作表”**。**您也可以右键单击仪表板或故事选项卡，然后隐藏或显示所有使用的工作表。*

*如果您没有看到“* *隐藏工作表”**选项，则表示该工作表未在任何仪表板中使用，然后可以删除。*

#### 出口 <div id="page_259"></div>

通过Tableau，还可以轻松导出视图，仪表板和故事的图像，以用于文档，文档甚至是此类书！图像可导出为.png，.emf，.jpg，或.bmp。您也可以将图像复制到剪贴板以粘贴到其他应用程序中。您也可以将数据导出为交叉表（Excel）.csv或Access数据库（在PC上）。

要复制图像或导出图像或数据，请使用Worksheet，Dashboard或Story的菜单选项。

我们将在短期内详细介绍如何使用Tableau Server，Tableau Online和Tableau Public。现在，让我们考虑一下这些平台上可用的一些导出功能。与Tableau  Server，Online或Public上的视图进行交互时，除非没有必需的权限或Tableau  Server管理员专门禁用了该工具栏，否则您将看到一个工具栏：

![img](../images/Image%20[338].jpg)

工具栏中的“ 下载”选项使您可以下载**图像**，**数据**，**交叉表**（Excel），**PDF**，**PowerPoint**或**Tableau Workbook**。图像以.png格式导出，并以当前状态呈现仪表板。导出.pdf文档将为用户提供许多选项，包括布局，缩放比例以及是否打印当前仪表板，工作簿中的所有工作表还是当前仪表板中的所有工作表。

*导出***数据***或***交叉表***将为仪表板中的活动视图导出，即，如果您单击仪表板上的视图，则该视图将变为活动状态，并且可以**为该特定视图**导出数据或***交叉***表。*

还可以从Tableau Server导出其他选项：

- **Tabcmd** 使您能够通过命令行或脚本以多种格式导出数据，图像或文档 。
- **REST API** 使您能够以编程方式导出各种格式的数据，图像或文档。
- 您可以将扩展名附加到Tableau Server或Online上托管的视图的URL上，以按链接定义的格式查看或下载。例如，附加.pdf URL ，使之类似于 <https://tableauserver/#/views/Dashboard/View.pdf> 在浏览器中将视图呈现为PDF文档。

### 与Tableau Desktop或Tableau Reader的用户共享 <div id="page_260"></div>

您可以与Tableau Desktop和Tableau Reader的其他用户共享工作簿。我们将考虑这些选项，并在以下各节中指出一些差异。

#### 与Tableau Desktop用户共享 <div id="page_261"></div>

与其他Tableau Desktop用户共享工作簿非常简单，但是需要考虑一些事项。

主要考虑因素之一是您将共享打包的工作簿（.twbx）还是未打包的工作簿（.twb）。打包工作簿包含工作簿（单个文件.twb），提取物（.hyper），尚未提取（基于文件的数据源.xls，.xlsx，.txt，.cub，.mdb，等），自定义图像，以及其他各种相关文件。

要与Tableau Desktop用户共享，您可以使用多种选择：

- 您可以通过与具有相同或更新版本的Tableau Desktop的另一个用户共享文件来共享打包（.twbx）或未打包（.twb）的工作簿。

*当保存在更新版本的Tableau Desktop中时，工作簿文件将更新。**您无法打开使用较新版本的Tableau和较旧版本保存的工作簿。**首次打开工作簿时，系统将提示您有关更新，并在尝试保存工作簿时再次提示您。* *您可以选择从“* *文件”* *菜单**中将工作簿导出为以前的版本* *。*

- 如果您共享封装的（.twb）的工作簿，然后其他人使用它必须能够访问任何数据源和任何引用的图片必须是可见在用户*同*在原始文件被引用的目录。例如，如果工作簿使用到.xlsx网络路径上的Excel（）文件的实时连接，并且位于中的仪表板上包含图像C:\Images，则所有用户必须能够访问网络路径上的Excel文件并具有本地C:\Images目录，相同名称的图像文件。

*\\servername\directory\file.xlsx**如果使用此方法**，请考虑**对通用文件**使用UNC（例如* *）路径。*

同样，如果您共享.twbx使用实时连接的打包工作簿（），则使用该工作簿的任何人都必须能够访问实时连接数据源并具有适当的权限。

#### 与Tableau Reader用户共享 <div id="page_262"></div>

**Tableau Reader**是Tableau Software提供的免费应用程序，允许用户与在Tableau Desktop中创建的可视化效果，仪表板和故事进行交互。与Tableau  Desktop不同，它不允许创作可视化或仪表板。但是，最终用户可以使用所有交互性，例如过滤，下钻，操作和突出显示。

*Tableau Reader与许多PDF阅读器相似，后者使您可以阅读和浏览文档，但不允许创作或保存更改。*

要与Tableau Reader的用户共享，请考虑以下事项：

- Reader仅打开打包的（.twbx）工作簿。
- 打包的工作簿可能不包含与服务器或基于云的数据源的实时连接。这些连接必须被提取。

*共享打包的工作簿（**.twbx**）**时，一定要考虑安全性问题**。**由于打包的工作簿通常包含数据，因此必须确保数据不敏感。**即使数据未显示在任何视图或仪表板上，仍可以在打包的摘录（**.hyper**）或基于文件的数据源中进行访问。*

### 与Tableau Server，Tableau Online和Tableau Public的用户共享 <div id="page_263"></div>

**Tableau Server**，**Tableau Online**和**Tableau Public**都是同一概念的变体：在服务器上托管可视化内容和仪表板，并允许用户通过Web浏览器访问它们。

下表提供了产品之间的某些异同，但由于详细信息可能会发生变化，请在做出任何购买决定之前咨询Tableau代表：

| **产品**   | **Tableau服务器**                                            | **Tableau Online**                                           | **Tableau Public**                                           |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 描述       | 一种安装在一台或多台服务器计算机上的服务器应用程序，用于承载使用Tableau Desktop创建的视图和仪表板。 | 由Tableau Software维护的基于云的服务，托管通过Tableau Desktop创建的视图和仪表板。 | 由Tableau Software维护的基于云的服务，该服务承载使用Tableau Desktop或免费的Tableau Public客户端创建的视图和仪表板。 |
| 许可费用   | 是                                                           | 是                                                           | 自由                                                         |
| 管理       | 由购买许可证的个人或组织完全维护，管理和管理。               | 由Tableau Software管理和维护，并具有一些由用户进行项目和用户管理的选项。 | 由Tableau Software管理和维护。                               |
| 创作与出版 | Tableau Desktop的用户可以创作工作簿并将其发布到Tableau Server。通过Web创作，Tableau Server用户可以在Web浏览器中编辑和创建可视化效果和仪表板。 | Tableau Desktop的用户可以创作工作簿并将其发布到Tableau Online。通过Web创作，Tableau Online用户可以在Web浏览器中编辑和创建可视化效果和仪表板。 | Tableau Desktop或免费的Tableau Public客户端的用户可以将工作簿发布到Tableau Public。 |
| 相互作用   | 获得许可的Tableau Server用户可以与托管视图进行交互。视图也可以嵌入Intranet网站，SharePoint和自定义门户中。 | 许可的Tableau Online用户可以与托管视图进行交互。视图也可以嵌入Intranet网站，SharePoint和自定义门户中。 | 一切都是面向公众的。任何人都可以与托管视图进行交互。视图可以嵌入公共网站和博客中。 |
| 局限性     | 没有。                                                       | 必须先提取大多数数据源，然后才能发布工作簿。大多数非基于云的数据源必须在本地机器上，或者使用的Tableau桌面刷新的提取物通过 的**的Tableau在线同步客户端**。 | 必须提取所有数据，每个数据源限制为1500万行。                 |
| 安全       | Tableau Server管理员可以创建站点，项目和用户，并调整每个站点的权限。可以限制对基础数据的访问，并且可以限制工作簿或数据的下载。 | Tableau Server管理员可以创建项目和用户，并调整每个项目的权限。可以限制对基础数据的访问，并且可以限制工作簿或数据的下载。 | 默认情况下，任何人都可以下载和查看数据。但是，作者可能会限制对这些选项的访问。 |
| 善用       | 内部仪表板和分析和/或通过 多租户站点跨部门/部门/客户使用。   | 内部仪表板和分析。与远程用户共享和协作。                     | 使用面向公众的网站或博客上的嵌入式视图共享可视化效果和仪表板。 |

#### 向Tableau Public发布 <div id="page_264"></div>

您可以打开工作簿，然后使用Tableau Desktop或免费的Tableau Public客户端应用程序将其保存 到Tableau Public。请记住以下几点：

- 为了使用Tableau Public，您需要注册一个帐户。
- 有了Tableau Desktop并具有适当的权限，您可以使用“ 服务器”菜单并选择“ Tableau Public”下的选项，在Tableau Public中进行工作簿的保存和打开。
- 使用免费的Tableau Public客户端，您只能在Web上和从Web上保存工作簿。世界上任何人都可以查看您发布的内容。
- 选择“ 管理工作簿 ”选项将打开浏览器，以便您可以登录到Tableau Public帐户并在线管理所有工作簿。
- 保存到Tableau Public的工作簿可以包含任意数量的数据源连接，但必须全部提取它们，并且每个提取的数据行不得超过1500万行。

#### 发布到Tableau Server和Tableau Online <div id="page_265"></div>

发布到Tableau Server和Tableau Online的过程与此类似。要发布到Tableau Server或Tableau Online，请从菜单中选择“ 服务器” |“发布”。发布工作簿。如果您尚未登录服务器，系统将提示您登录：

![img](../images/Image%20[339].jpg)

您必须拥有一个用户帐户，该用户帐户具有一个或多个项目的发布权限。输入Tableau服务器的URL或IP地址或Tableau联机URL，您的用户名和密码。登录后，如果您有权访问多个站点，则会提示您选择一个站点。最后，您将看到“发布”屏幕：

![img](../images/Image%20[340].jpg)

发布时有多个选项：

- 选择您要发布到的项目并命名您的工作簿。如果已经使用与所选项目相同的名称发布了工作簿，则系统将提示您覆盖它。
- 您可以为工作簿提供一个描述，并使用添加标签使搜索和查找工作簿更加容易。
- 您还可以指定要包含在已发布工作簿中的表格 。您检查的所有表都将包括在内；您取消选中的任何内容都不会。
- 您可以 编辑 用户和组 权限 来定义谁有权查看，交互和更改您的工作簿。默认情况下，使用项目设置。
- 您可以编辑数据源的属性。下一节将详细介绍这些选项。
- 您还可以选择将工作表显示为选项卡。选中后，Tableau Server上的用户将能够使用类似于Tableau Desktop底部显示的选项卡在工作表之间导航。如果您打算让操作在视图之间导航，则必须选中此选项。
- 显示选择 表示您希望标记的任何有效选择都保留在发布的视图中。

编辑数据源  为您提供了用于身份验证和计划的选项：

- 对于工作簿中使用的每个数据连接，您可以确定如何验证数据库连接。这些选项将取决于数据源以及Tableau Server的配置。各种选项包括嵌入密码，模拟用户或提示Tableau Server用户输入凭据。
- 您可以为Tableau Server指定运行任何数据提取刷新的计划。

*将在服务器上刷新的所有活动连接或提取的连接必须定义在服务器上有效的连接。**这意味着必须在服务器上安装所有适用的数据库驱动程序。**访问数据库服务器和基于云的数据所需的所有网络，Internet连接和端口必须打开。*

*此外，必须使用Tableau Server可以访问的位置引用工作簿引用的任何外部文件（例如，图像文件和非提取的基于文件的数据源）在发布工作簿时不包括在内。具有安全设置的网络路径，允许Tableau Server进程进行读取访问。*

#### 与Tableau Server进行交互 <div id="page_266"></div>

将工作簿发布到Tableau Server之后，其他用户将能够使用Web浏览器查看可视化效果和仪表板并与之交互。登录到Tableau  Server之后，他们将能够浏览具有适当权限的内容。这些用户将能够使用仪表板中内置的任何功能，例如快速过滤器，参数，操作或向下钻取。一切都呈现为HTML 5，因此用户查看和与视图和仪表板进行交互的唯一要求是具有HTML 5功能的Web浏览器。

*适用于iOS和Android设备**的***Tableau Mobile***应用程序可以增强移动用户的体验。**使用Tableau的设备设计器来定位特定设备的布局。*

在大多数情况下，与Server或Online上的工作簿进行交互与与Tableau Desktop或Reader中的工作簿进行交互非常相似。快速过滤器，参数，操作和工具提示的外观和行为均相似。

您会发现一些附加功能：

- 顶部菜单为您提供了与Tableau Server的管理和导航有关的各种选项。
- 在其下，您会找到一条面包屑痕迹，通知您当前正在查看的工作簿和视图。
- 在其下，您将找到一个包含以下功能的工具栏：

![img](../images/Image%20[341].jpg)

- 撤消和重做使您能够通过交互来前进和后退。
- 还原使您能够撤消所有更改并还原到原始仪表板。
- 刷新将重新加载仪表板并刷新数据。但是，这不会刷新任何数据提取。
- 暂停使您可以根据操作，过滤器选择或参数值更改来暂停刷新仪表板，直到完成所有需要的更改为止。
- 视图 允许您基于选择，过滤器和参数值保存仪表板的当前状态，以便稍后可以快速返回到它。您还可以在此处找到保存的视图。
- 警报允许您设置条件警报。当视图中的标记达到您定义的阈值时，您将通过电子邮件收到警报。
- 订阅 可让您安排仪表盘屏幕截图的定期电子邮件。管理员还可以订阅其他用户。
- 编辑 允许您编辑仪表板。该界面与Tableau Desktop非常相似。Tableau Administrator可以按用户或组启用或禁用Web编辑，还可以控制用于保存已编辑视图的权限。
- 共享 为您提供了共享工作簿的选项。这些选项包括可分发给其他许可用户的URL，以及用于将仪表板嵌入网页的代码。
- 如前所述，“ 下载” 按钮使您可以下载数据，仪表板，或工作簿的图像 。  .pdf
- 注释使您能够通过在视图上进行注释并响应其他用户的注释来与其他Tableau Server用户进行协作。
- 全屏允许您查看仪表板或以全屏模式查看。

#### 使用Tableau Server的其他分发选项 <div id="page_267"></div>

Tableau Server提供了其他几个选项来共享视图，仪表板和数据。除了允许用户登录到Tableau Server之外，您还可以考虑以下选项：

- 仪表板，视图和故事点可以嵌入网站，门户和SharePoint中。单点登录选项可以使您的网站身份验证与Tableau Server无缝集成。
- Tableau Server允许用户订阅视图和仪表板并安排电子邮件传递。该电子邮件将包含该视图的最新图像以及到Tableau Server上的仪表板的链接。
- 该**tabcmd**实用程序提供的Tableau服务器，并可以在其他计算机上安装。该实用程序提供了自动执行Tableau Server的许多功能的功能，包括导出功能，发布以及用户和安全管理。这为自动化交付开辟了很多可能性。
- 该**REST API**允许使用的Tableau服务器编程交互。

### 总结 <div id="page_268"></div>

Tableau是一个了不起的平台，可在您创建有用且有意义的可视化效果和仪表板以了解和传达关键见解时探索，准备和清理数据。我们已经考虑了如何连接数据，编写计算字段和设计仪表板。在本章中，我们考虑了如何与他人共享结果。

您现在已经有了坚实的基础。Tableau的核心是直观，透明且易于使用。随着潜水的深入，简单性变得越来越美丽。当您发现理解数据，解决复杂问题，提出新问题以及在数据中找到新答案的新方法时，Tableau的新技能将帮助您发现隐藏在数据中的新见解。

------

# 您可能喜欢的其他书籍 <div id="page_269"></div>

如果您喜欢这本书，您可能会对Packt的其他这些书感兴趣：

[![img](../images/Image%20[342].jpg)](https://www.packtpub.com/big-data-and-business-intelligence/tableau-2019x-cookbook)

《Tableau 2019.x Cookbook》

Dmitry Anoshin

书号：9781789533385

- 了解Tableau Desktop的基本和高级技能
- 实施可视化，仪表板和讲故事的最佳实践
- 使用内置统计信息学习高级分析
- 在Linux和Windows上部署多节点服务器
- 将Tableau与Hadoop，Athena和Spectrum等大数据源结合使用
- 涵盖Tableau内置函数，以使用R包进行预测
- 使用Tableau Prep合并，整形和清理数据以进行分析
- 使用REST API和R / Python扩展Tableau的功能

[![img](../images/Image%20[343].jpg)](https://www.packtpub.com/big-data-and-business-intelligence/mastering-tableau-20191-second-edition)

《Mastering Tableau 2019.1 第二版》

Marleen Meier，David Baldwin

书号：9781789533880

- 掌握各种Tableau组件的最新知识
- 使用Tableau Prep的主数据准备技术
- 探索如何使用Tableau创建类似PowerPoint的演示文稿
- 了解不同的Tableau可视化技术和仪表板设计
- 与Tableau Server进行交互以了解其架构和功能
- 研究高级可视化和仪表板创建技术
- 重新学习功能强大的自助服务分析，时间序列分析和地理空间分析

## 发表评论 — 让其他读者知道您的想法 <div id="page_270"></div>

请在购买书的网站上留下评论，与他人分享您对这本书的看法。如果您从亚马逊购买了这本书，请在本书的亚马逊页面上给我们诚实的评论。这非常重要，以便其他潜在读者可以看到并使用您的公正意见来做出购买决定，我们可以了解客户对我们产品的看法，我们的作者可以看到您对与Packt合作创建的书名的反馈。只需花费您几分钟的时间，但对其他潜在客户，我们的作者和Packt来说却很有价值。谢谢！
