<!-- markdownlint-disable-file MD033 -->

# 第一部分：Tableau基础 <div id="page_20"></div>

本节为Tableau中的数据可视化奠定了基础。它概述了界面和术语，解释了数据连接，并涵盖了多种可视化类型。

本节包括以下章节：

- [第1章](docs/Book.md#page_21)，*第一章 与Tableau一起起飞*
- [第2章](docs/Book.md#page_43)，*第二章 在Tableau中处理数据*
- [第3章](docs/Book.md#page_70)，*尝试高级可视化*

## 第一章 与Tableau一起起飞 <div id="page_21"></div>

初次遇到数据集时，通常首先看到的是原始数据-数字，日期，文本，字段名称和数据类型。几乎可以肯定的是，需要发现和讲述一些见解和故事，做出决定并采取行动。但是您如何找到意义呢？您如何发现含义并讲出数据中隐藏的故事？

**Tableau**是一个了不起的平台，可用于根据您的数据查看，理解和做出关键决策！有了它，您将能够实现令人难以置信的数据发现，数据分析和数据讲故事。您将使用为自然而无缝地思考和工作而设计的界面，以可视方式完成这些任务和目标。

要利用Tableau的功能，您无需编写复杂的脚本或查询。取而代之的是，您将在可视环境中与数据进行交互，在该环境中，您拖放的所有内容都将转换为适合您的必要查询，然后以可视方式显示。您将实时工作，因此您将立即看到结果，可以提问题就尽快获得答案，并能够通过潜在的数十种方法进行迭代以可视化数据以找到关键的见解或告诉您故事。

本章介绍Tableau的基本原理。我们将介绍一系列示例，这些示例将介绍连接到数据，以可视方式探索和分析数据以及最终将它们全部放到一个完全交互式的仪表板中的基础知识。这些概念将在后续章节中进行更广泛的开发。但是请不要跳过本章，因为它介绍了关键术语和关键概念，包括以下内容：

- 分析周期
- 连接数据
- 构建可视化的基础
- 创建条形图
- 创建折线图
- 创建地理可视化
- 使用“向我展示”
- 通过仪表板将所有内容整合在一起

### 分析周期 <div id="page_22"></div>

作为致力于并理解数据的人，您会发现自己正在分析周期内工作。此周期可能如下所示：

![img](../images/000291.gif)

通过Tableau，您可以跳至循环的任何步骤，在各步骤之间自由移动，并非常快速地循环浏览循环。使用Tableau，您可以执行以下操作：

- **数据** **发现**：您可以使用Tableau轻松浏览数据集，并开始直观地了解您拥有哪些数据。
- **数据准备**：通过Tableau，您可以连接来自许多不同来源的数据，并在必要时创建最适合您的分析的结构。在大多数情况下，这就像将Tableau指向数据库或打开文件一样容易，但是Tableau为您提供了将来自多个来源的复杂数据和混乱数据组合在一起的工具。
- **数据分析**：Tableau可以轻松地可视化数据，因此您可以查看和了解趋势，异常值和关系。除此之外，Tableau还具有不断增长的一组分析功能，使您可以深入了解数据中的复杂关系，模式和相关性。
- **数据叙事**：Tableau允许您使用可视化和见解构建完全交互式的仪表板和故事，以便与他人共享数据故事。

所有这些都是通过视觉完成的。**数据可视化**是Tableau的核心。您可以通过无数种可视化数据的方式进行迭代，以提出和回答问题，提出新问题并获得新见解。并且您将通过思想流程完成此操作。

### 连接数据 <div id="page_23"></div>

Tableau连接到存储在各种文件和数据库中的数据。其中包括平面文件，例如Excel文档，空间文件和文本文件；关系数据库，例如SQL Server和Oracle；基于云的数据源，例如Google Analytics（分析）和Amazon  Redshift；和OLAP数据源，例如Microsoft Analysis  Services。除了极少数例外，无论您使用什么数据源，分析和创建可视化的过程都是相同的。

我们将讨论连接到不同类型的数据源的详细信息[第2章](docs/Book.md#page_43)， *在的Tableau使用数据*。在其他章节中，我们将涵盖跨多个行业的数据。现在，我们将连接到文本文件，特别是**逗号分隔的值**文件（.csv）。数据是Tableau：Superstore附带的样本的一种变体，这是一个虚构的零售连锁店，向美国各地的客户销售各种产品。请使用提供的数据文件代替Tableau示例数据，因为变化会导致可视化效果有所不同。

Chapter 1代码文件捆绑包中包含的工作簿已经与该文件建立了连接，但是在此示例中，我们将逐步完成在新工作簿中创建连接的步骤：

1. 打开Tableau。您应该看到主屏幕，左侧有一个连接选项列表，并且在中心处（如果有）还有最近编辑的工作簿的缩略图预览，而在底部则有示例工作簿。
2. 在“ 连接并到文件”下，单击“ 文本文件”。
3. 在“ 打开”对话框中，导航到\Learning Tableau\Chapter 01目录并选择Superstore.csv文件。
4.现在，您将看到“数据连接”屏幕，该屏幕使您可以直观地创建与数据源的连接。我们将在详细检查该屏幕的功能*连接到数据*的部分[第2章](docs/Book.md#page_43)， *在工作与数据的Tableau*。目前，Tableau已经添加并提供了用于连接的文件的预览：

![img](../images/Image%20[2].jpg)

对于此连接，不需要其他配置，因此只需单击底部的Sheet 1选项卡即可开始可视化数据！现在，您应该看到Tableau中的主要工作区域，如下所示：

![img](../images/Image%20[3].jpg)

在本书中，我们将使用特定的术语来引用界面的元素，因此请花一些时间熟悉一下前面屏幕截图中编号的各个组件所使用的术语：

[1] 该**菜单**中包含用于执行多种功能的各种菜单项目。

[2] 该**工具栏**允许常见功能，例如撤消，重做，保存，添加一个数据源，等等。

[3] 该**边栏**包含标签数据和分析。当“ 数据”选项卡处于活动状态时，我们将侧栏称为“数据”窗格。当“ 分析”标签处于活动状态时，我们将侧栏称为“分析”窗格。我们将在本章稍后详细介绍，但现在请注意，数据窗格在顶部显示数据源，并在下面包含来自数据源的字段列表，分为维度和度量。

[4] 各种架子（例如Columns，Rows，Pages和Filters）用作从数据窗格拖放字段的区域。该**标志**卡包含附加板，如颜色，大小，文字，详细介绍和工具提示。Tableau将根据您放在架子上的字段来可视化数据。

> 数据窗格中的数据字段可用于添加到视图。放置在架子上的字段在**视图**或**活动字段**中称为，因为它们在Tableau绘制可视化文件的方式中起着积极的作用。

[5] 所述**canvas**或**视图**是其中的Tableau将绘制数据可视化。您也可以将字段直接放在视图上。您会在画布顶部找到无缝标题。默认情况下，它将显示工作表的名称，但是可以对其进行编辑甚至隐藏。

[6] Show Me是一项功能，使您可以根据感兴趣的数据字段快速迭代各种类型的可视化。我们将在本章结尾处查看“向我展示”。

[7] 窗口底部的选项卡为您提供了编辑数据源的选项，以及在任意数量的工作表，仪表板或故事之间导航和添加的选项。很多时候，任何标签（无论是工作表，仪表板还是故事）都通常称为工作**sheet**。

 > Tableau工作簿是数据源，工作表，仪表板和故事的集合。所有这些都保存为单个Tableau工作簿文件（*.twb*或*.twbx*）。在后面的章节中，我们将研究文件类型的差异，并详细探讨另存为工作簿的内容。一个工作簿被组织成各种类型的选项卡的集合：
 >
 > 1. 工作表是单个数据可视化，例如条形图或折线图。由于工作表也是任何选项卡的通用术语，因此我们经常将工作表称为**视图**，因为它是数据的单个视图。  
 > 2. **仪表盘**是任何数量的相关的视图和其他元素（例如文本或图像）的呈现排列在一起作为一个整体的信息传达给观众。**仪表板通常设计为交互式的。
 > 3. **故事***是仪表板或配置成从所述数据通信的叙述单个视图的集合。故事也可能是互动的。

[8] 工作时，状态栏将显示重要信息以及有关视图，选择和用户的详细信息。

[9] 各种控件使您可以在工作表，仪表板和故事之间导航，以及使用“ **显示胶片”**查看选项卡， 或切换到工作表分类器，以显示工作簿中所有工作表的交互式缩略图。现在，您已经连接到文本文件中的数据，我们将探索一些示例，这些示例为数据可视化奠定了基础，然后继续构建一些基础的可视化类型。为此，请执行以下操作：

1. 从菜单中，选择文件| 退出。
2. 当提示您保存更改时，选择否。
3. 在\learning Tableau\Chapter 01 目录中，打开文件 Chapter 01 Starter.twbx。该文件包含与 数据文件的连接，Superstore 旨在帮助您逐步阅读本章中的示例。

> 每章的文件都包含一个**Starter**工作簿，使您可以阅读本书中给出的示例。如果您想随时查看完整的示例，请打开**Complete**本章的工作簿。

连接到数据后，就可以开始可视化和分析数据了。当您开始这样做时，您将在零售链中担当分析师的角色。您将提出有关数据的问题，构建可视化工具来回答这些问题，并最终设计一个仪表板以共享结果。首先，为了解Tableau如何可视化数据奠定基础。

### 构建可视化的基础 <div id="page_24"></div>

首次连接到Superstore文件等数据源时，Tableau将在左侧边栏的数据窗格中显示数据连接和字段。可以将字段从数据窗格拖动到画布区域或各种架子上，例如“ 行”，“ 列”，“ 颜色 ”或“ 大小”。正如我们将看到的，基于字段的类型，字段的放置将导致数据的不同编码。

#### 度量和维度 <div id="page_25"></div>

数据源中的字段在数据窗格中可见，并分为**“度量”**和“ **维”**。度量和尺寸之间的差异是使用Tableau时要理解的基本概念：

- 度量 是汇总的值。例如，它们被求和，平均，计数或具有最小值或最大值。
- 维度 是确定汇总度量的详细程度的值。您可以将它们视为对度量进行切片或创建适合度量的组。视图中使用的尺寸组合定义了视图的基本详细程度。

作为一个示例（可以Chapter 01 Starter 在“ 度量和维”表的工作簿中查看），请考虑使用这些Region 字段 并Sales通过Superstore连接创建的视图：

![img](../images/Image%20[4].jpg)

该 Sales 字段在此视图中用作度量。具体来说，它被汇总为一个总和。当在该视图使用一个场作为一个措施，型聚集（例如， SUM，MIN，MAX，和AVG）将在活动字段示出。请注意，在前面的示例中，行上的活动字段清楚地指示了Sales：的总和SUM(Sales)。

该 Region 字段是一个维，其中包含每个数据记录的四个值之一：**Central**，**East**，**South**或**West**。当将该字段用作视图中的维时，它将对度量进行切片。因此，前面的视图显示了每个区域的销售总和，而不是总的销售总和。

#### 离散场和连续场 <div id="page_26"></div>

使用字段的另一个重要区别是字段是**离散的**还是**连续的。**字段是离散字段还是连续字段，取决于Tableau在视图中使用的位置，确定Tableau如何可视化该字段*。*Tableau将直观显示字段的默认值（数据窗格中图标的颜色）以及视图中如何使用该字段（架子上活动字段的颜色）。离散域（例如Region上一个示例）为蓝色。诸如的连续字段为Sales绿色。

*在本书印刷版的屏幕截图中，您应该能够区分离散字段（蓝色）和连续字段（绿色）之间的阴影略有不同，但是在使用Tableau时，请特别注意界面。**您可能还希望从Packt Publishing下载彩色图像包，*[网址](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf)*为：*[https](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf) *:* [//www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf](https://www.packtpub.com/sites/default/files/downloads/9781788839525_ColorImages.pdf)

##### 离散字段 <div id="page_27"></div>

离散 （蓝色）字段的值显示为不同且彼此分开。离散值可以重新排序，但仍然有意义。例如，您可以轻松地将的值重新排列Region为 **East**， **South**， **West**和 **Central**，而不是前面的屏幕快照中的默认顺序。

在“ 行” 或“ 列” 架子上使用离散字段时 ，该字段定义标题。在这里，离散字段Region定义列标题：

![img](../images/Image%20[5].jpg)

在这里，它定义了行标题：

![img](../images/Image%20[6].jpg)

当用于颜色时，“ 离散”字段定义离散的调色板，其中每种颜色与该字段的不同值对齐：

![img](../images/Image%20[7].jpg)

##### 连续场 <div id="page_28"></div>

连续（绿色）字段具有从第一个到最后一个连续流的值。在视图中，数字和日期字段经常（尽管并非总是）用作连续字段。这些字段的值具有更改几乎没有意义的顺序。

在“ 行”或“ 列”上使用时，连续字段定义轴：

![img](../images/Image%20[8].jpg)

当用于颜色时，连续字段定义渐变：

![img](../images/Image%20[9].jpg)

请务必注意，*连续* 和*离散* 是与**Measure** 和**Dimension**不同的概念。虽然大多数尺寸默认情况下是离散的，而大多数度量默认情况下是连续的，但可以将任何度量用作离散字段，而某些尺寸用作视图中的连续字段。

*要更改字段的默认值，请在数据窗格中右键单击该字段，然后选择“* *转换为离散”* *或“* *转换为连续”**。*

*要更改视图中字段的使用方式，请右键单击视图中的字段，然后选择“* *离散”* *或“* *连续”**。* *或者，您可以* *在数据窗格中的“* *维度”* *和* *“度量”* *之间拖放字段**。*

通常，您可以想到字段类型之间的差异，如下所示：

- 在维度和度量之间进行选择可以告诉Tableau *如何切片* *或* *聚合*数据
- 在d增量和连续之间进行选择可以告诉Tableau *如何显示* 带有标题或轴的数据，以及如何定义单独的颜色或渐变。

在阅读本书中的示例时，请注意用于创建可视化的字段，无论这些字段是尺寸还是度量，以及它们是离散的还是连续的。尝试将视图中的字段从连续更改为离散，反之亦然，以了解可视化中的差异。

### 可视化数据 <div id="page_29"></div>

与数据源的新连接是探索和发现的邀请！有时，您可能会遇到非常明确定义的问题，并且对所要查找的内容有很强的理解力。有时，您会遇到一些一般性问题，而对所发现的内容却一无所知。Tableau的可视化分析功能使您能够快速迭代地探索数据，提出新问题并做出新发现。

以下可视化示例涵盖了一些最基础的可视化类型。在研究示例时，请记住，目标不仅仅是学习如何创建特定的图表。相反，这些示例旨在帮助您思考数据问题并通过可视化迭代获得答案的过程。Tableau旨在使该过程直观，快速和透明。

*与记住创建特定图表类型的步骤相比，重要的是要了解如何以及为何使用Tableau来创建条形图，并在提出新问题时调整可视化以获取新见解。*

#### 条形图 <div id="page_30"></div>

**条形图**以一种直观的方式表示数据，可以轻松比较不同类别中的值。条的长度是您直观地了解数据的主要方法。您还可以合并颜色，大小，堆叠和顺序以传达其他属性和值。

在Tableau中创建条形图非常容易。只需将要查看的度量拖放到“ 行”或“ 列”架子上，然后将定义类别的维拖放到相对的“ 行”或“ 列”架子上。

作为的分析师Superstore，您准备好开始针对销售（尤其是销售的美元价值）的发现过程。当您按照示例操作时，请逐步完成Chapter 01 Starter 工作簿中的表单。该Chapter 01 Complete 工作簿包含完整的示例，因此您可以随时比较结果：

1. 单击“ 按部门销售”选项卡以查看该工作表。
2. 将Sales字段从“数据”窗格中的“度量 ”拖放到“ 列”架子上。现在，您有了一个带有单个条形图的条形图，代表数据源中所有数据的销售总额。
3. 将Department字段从数据窗格的“ 维度 ”拖放到“ 行”架子。这将对数据进行切片，以提供三个条形，每个条形的长度对应于每个部门的销售总额：

![img](../images/Image%20[10].jpg)

您现在有了一个水平条形图。这使得比较部门之间的销售变得容易。在上的标记类型下拉菜单标志卡被设置为自动，并显示一个指示的Tableau已确定条是给你放置在视场中最好的可视化。作为维度，Department 切片数据。由于是离散的，因此为数据中的每个部门定义行标题。作为度量，该Sales字段是聚合的。连续时，它定义了一个轴。条形标记的标记类型导致每个部门的单个条形从0该部门的销售额总和中得出。

*通常，Tableau为视图中尺寸值的每个交集绘制一个标记（例如，条，圆，正方形）。**在这种简单情况下，Tableau将为***Department的***每个尺寸值（***家具***，***办公用品***和***技术***）**绘制单个条形标记**。**标出了标记的类型，可以在**标记**卡**的下拉菜单中更改标记的类型**。**在视图的左下角状态栏中可以看到标记的数量。*

Tableau以不同的方式绘制不同的标记；例如，沿着轴从0开始绘制条（如果堆叠，则从前一条的末端开始绘制）。在由定义轴的字段的值所定义的位置处绘制圆形和其他形状。花一点时间尝试从“ 标记” 卡上的下拉菜单中选择不同的标记类型 。了解Tableau如何绘制不同标记类型将有助于您掌握该工具。

##### 条形图的迭代以进行更深入的分析 <div id="page_31"></div>

使用前面的条形图，您可以轻松地看到技术部门的总销售额比家具部门或办公用品部门多。如果您想进一步了解各个地区部门的销售额，该怎么办？请遵循以下两个步骤：

1. 导航至工作Bar Chart (two levels)表，您将在其中找到与之前创建的视图相同的初始视图。
2. 将Region字段从数据窗格中的“ 维度 ”拖到“ 行”架子，并将其拖放到Department已在视图中的字段的左侧

您现在应该拥有一个如下所示的视图：

![img](../images/Image%20[11].jpg)

您仍然有一个水平条形图，但是现在您已经引入Region了另一个维度，它可以更改视图中的详细程度并进一步分割销售总额。通过在Region之前放置Department，您可以轻松比较给定区域内每个部门的销售额。

现在您开始发现一些东西。例如：技术部门在每一个地区最具销售力，除了在东方，在那里家具有较高的销售额。办公用品从未在任何地区拥有最高的销售额。

让我们看一下使用不同排列的相同字段的不同视图：

1. 导航到“ 条形图（堆叠）”表，您将在其中找到与原始条形图相同的视图。
2. 将Region字段从“ 行”架子拖放到“ 颜色”架子上：

![img](../images/Image%20[12].jpg)

您现在有了**堆叠的条形图**，而不是**并排的**条形图。条形图的每个部分均按字段进行颜色编码。此外，颜色图例已添加到工作区。您尚未更改视图中的详细程度，因此仍然可以对区域和部门的每个组合进行销售汇总：Region

*使用Tableau时，**“* **查看** **详细级别”***是一个关键概念。**在大多数基本的可视化中，视图中所有维度的值的组合定义了该视图的最低详细级别。**所有度量将按最低详细级别汇总或划分。**在最简单的视图中，标记的数量（在左下方的状态栏中指示）对应于尺寸值的相交数量。**也就是说，尺寸值的每种组合都会有一个标记。*

- 如果 Department 是用作维度的唯一字段，则将在部门详细信息级别具有一个视图，并且视图中的所有度量将按部门汇总。
- 如果 Region 是唯一用作维度的字段，则将在区域详细信息级别具有一个视图，并且该视图中的所有度量将按区域汇总。
- 如果 在视图中同时使用 Department 和 Region作为维，则将在部门和区域级别拥有一个视图。所有度量将按部门和地区的唯一组合进行汇总，并且每个部门和地区的组合均会有一个标记。

当您想了解零件与整体之间的关系时，堆叠的钢筋会很有用。现在可以很容易地看出每个部门在每个地区的总销售额中有哪一部分。但是，很难比较部门之间大多数地区的销售额。例如，您能否轻易分辨出哪个部门在东部地区的销售额最高？这很困难，因为除West之外，酒吧的每个部分都有不同的起点。

现在花一些时间试验条形图，看看可以创建哪些变体：

1. 导航到“ 条形图（实验）”表。
2. 尝试将Region字段从Color拖到 Marks卡上的其他各个架子上，例如Size，Label和Detail。请注意，在每种情况下，这些条都保持堆叠状态，但会根据Region字段定义的视觉编码进行重绘。
3. 使用工具栏上的“ **交换”**按钮交换行和列上的字段。这使您可以轻松地从水平条形图更改为垂直条形图（反之亦然）：

![img](../images/000115.gif)

1. 将“ 销售”从“数据” 卡的“度量”部分拖放到“ 标记”卡上“ 区域”字段顶部的位置以进行替换。如有必要，将“ 销售”字段拖到“颜色”，并注意颜色图例如何成为连续字段的渐变。
2. 通过将其他字段拖放到各个架子上，进一步进行实验。注意您执行的每个操作的Tableau行为。
3. 从文件菜单中，选择保存。

*Tableau具有自动保存功能！**如果您的计算机崩溃了，那么下次您打开Tableau时，系统将提示您打开任何以前未保存的工作簿。**不过，您仍然应该养成一种习惯，即尽早且经常保存您的工作，并维护适当的备份。*

#### 折线图 <div id="page_32"></div>

**折线图**连接可视化中的相关标记，以显示这些连接的标记之间的运动或关系。标记的位置和连接标记的线是传递数据的主要方法。此外，您可以使用大小和颜色来传达其他信息。

折线图最常见的一种是**时间序列**。时间序列显示值随时间的移动。在Tableau中创建一个只需要一个日期和一个度量。

使用Chapter 01 Starter您刚刚保存的工作簿继续对Superstore销售进行分析：

[1] 导航到销售 随着时间的推移表。

[2] 拖动Sales领域的措施，以行。这为您提供了一个垂直的竖线，表示数据源中所有销售额的总和。

[3] 要将其转换为时间序列，必须引入一个日期。将Order Date字段从左侧数据窗格中的“ 维度”拖放到“ 列”中。Tableau具有内置的日期层次结构，默认的Year年为您提供了连接四年的折线图。请注意，您可以清楚地看到年复一年的销售增长：

![img](../images/Image%20[13].jpg)

[4] 使用“ 列 ” YEAR(Order Date)字段上的下拉菜单（或右键单击该字段），然后将日期字段切换为使用“ 季度”。您可能会注意到在下拉菜单中两次列出了Quarter。我们将探索日期部分，价值观和层次的各种选项在 *可视化日期和时间*  的部分 [第3章](docs/Book.md#page_70)， *冒险到高级可视化*。现在，选择第二个选项：

![img](../images/Image%20[14].jpg)

请注意，按季度查看销售额时，周期性模式非常明显：

![img](../images/Image%20[15].jpg)

##### 折线图迭代可进行更深入的分析 <div id="page_33"></div>

现在，您正在查看一段时间内的总体销售额。让我们在更深层次上进行一些分析：

1. 导航到“ 随时间推移的销售” （重叠线）表，您将在其中找到与您刚刚创建的视图相同的视图。
2. 拖动Region从外地尺寸到颜色。现在，每个区域都有一行，每行都有不同的颜色，还有一个图例指示用于该区域的颜色。与条形图一样，为颜色添加尺寸会拆分标记。但是，与条形段堆叠在一起的条不同，这些线没有堆叠。取而代之的是，按照每个区域和每个季度的销售总和的确切值绘制线。这样可以轻松而准确地进行比较。有趣的是，可以观察到每个区域的周期性模式：

![img](../images/Image%20[16].jpg)

只有四个区域，将线条分开很容易。但是，具有更独特价值的维度又如何呢？步骤如下：

1. 导航到“ 随时间推移销售 （多行）”工作表，您将在其中找到与刚创建的视图相同的视图。
2. Category从“ 维度”中拖动字段，然后将其直接Region放在“ 标记”卡上当前字段的顶部。这将Region字段替换为Category。现在，您有17条重叠的线。通常，您将需要避免多于两行或三行重叠的行。但是，您也可以考虑使用颜色或大小来展示其他线条中的重要线条。另请注意，单击颜色图例中的项目将在视图中突出显示关联的行。突出显示是挑选单个项目并将其与所有其他项目进行比较的有效方法。
3. 将Category字段从“ 标记”卡上的“ 颜色 ” 拖放到“ 行”中。现在，每个类别都有一个折线图。现在，您可以比较一段时间内的每个产品，而不会产生过多的重叠，并且仍然可以比较一段时间内的趋势和模式。这是将在更充分地开发出了火花线可视化的开始*高级可视化*的部分[第11章](docs/Book.md#page_231)， *高级可视化，技术，技巧，和技巧*。

#### 地理可视化 <div id="page_34"></div>

在画面，内置的地理数据库认识到地理领域的角色，比如Country，State，City，Airport，Congressional District，或Zip Code。即使您的数据不包含纬度和经度值，您也可以简单地使用地理字段在地图上绘制位置。如果您的数据确实包含纬度和经度字段，则可以使用这些字段代替生成的值。

*Tableau将根据字段名称和数据中的值采样自动将地理角色分配给某些字段。**您可以通过右键单击数据窗格中的字段并使用“* *地理角色”**选项**来将**地理角色**分配或重新分配给任何字段**。**这也是查看可用的内置地理角色的好方法。*

Tableau还可以从某些数据库读取形状文件和几何形状。这些和其他地理能力将在更详细的覆盖*映射技术*的部分[第11章](docs/Book.md#page_231)， *高级Visuali* *zations，技术，技巧，和技巧。*在以下示例中，我们将考虑一些地理可视化的关键概念。

当您需要了解事情发生在哪里以及数据中是否存在任何空间关系时，地理可视化非常有用。Tableau提供了三种主要的地理可视化类型：

- 填充地图（在Tableau界面中简称为*地图*）
- 符号图
- 密度图

##### 填满的地图 <div id="page_35"></div>

填充的地图会填充国家/地区，州/县或邮政编码等区域，以显示位置。填充区域的颜色可用于编码值，大多数情况下是汇总度量值，有时还包括尺寸。这些地图也称为“ **choropleth地图”**。

假设您想了解销售情况，Superstore并查看地理上是否存在任何模式。您可能会采用类似于以下方法：

1. 导航到按州销售表。
2. 双击State数据窗格中的字段。画面自动创建使用地理可视化Latitude (generated)，Longitude (generated)和State字段。
3. 将Sales字段从数据窗格中拖放到Marks卡的Color架子上。根据您使用的字段和架子，Tableau已将自动标记类型切换为Map：

![img](../images/Image%20[17].jpg)

填充的地图用一种颜色填充每个州，以指示该州的相对销售额。现在在视图中可见的颜色图例给出了值的范围，并表示销售额最低的州总计**3,543**，销售额最高的州总计**1,090,616**。

当您查看底部状态栏中显示的标记数时，您会看到它是49。仔细检查后发现，标记由较低的48个州和华盛顿特区组成。没有显示夏威夷和阿拉斯加。如果Tableau存在于数据中并且未被过滤器排除，则Tableau仅会绘制地理标记，例如填充状态。

请注意，地图确实显示了加拿大，墨西哥和数据中未包括的其他位置。这些是从在线地图服务检索到的背景图像的一部分。然后将状态标记绘制在背景图像的顶部。我们来看看如何自定义地图，甚至在使用其他地图服务*测绘技术*的部分[第11章](docs/Book.md#page_231)， *高级Visualizations，技术，技巧，和技巧*。

填充的地图可以在交互式仪表板中很好地工作，并且具有相当的美学价值。但是，使用填充图很难进行某些类型的分析。与其他可视化类型不同，在其他可视化类型中，可以使用大小来传达数据的各个方面，填充的地理区域的大小仅与地理大小有关，并且可能使比较变得困难。例如：哪个州的销售额最高？您可能会想说德克萨斯州或加利福尼亚州，因为它们看上去更大，但是您会猜到马萨诸塞州吗？与较大的区域相比，某些位置可能足够小，甚至无法显示。请谨慎使用已填充的地图，并考虑将其与仪表板上的其他可视化文件配对以进行清晰的通信。

##### 符号图 <div id="page_36"></div>

对于符号地图，地图上的标记不会绘制为填充区域。相反，标记是放置在特定地理位置的形状或符号。大小，颜色和形状也可以用于编码其他尺寸和度量。

请Superstore按照以下步骤继续进行销售分析：

1. 导航到“ 按邮政编码销售”表。
2. Postal Code在尺寸下双击。画面会自动添加Postal Code到详细的的标志牌，并Longitude (generated)和Latitude (generated)以列和行。默认情况下，标记类型设置为圆形，并以正确的纬度和经度为每个邮政编码绘制一个圆圈。
3. 将“ 销售”从“度量 ” 拖到“ 标记”卡上的“ 大小”架子。这将使每个圆圈根据该邮政编码的销售总额确定大小。
4. 将利润从度量拖动到标记卡上的颜色架子。这会将标记颜色编码为与利润之和相对应。现在，您可以同时查看利润和销售的地理位置。这很有用，因为您会看到一些销售量高，利润低的位置，这可能需要采取一些措施。

对尺寸和颜色进行一些微调后，最终视图应如下所示：

![img](../images/Image%20[18].jpg)

有时，您需要调整符号图上的标记以使其更明显。一些选项包括：

- 如果标记重叠，请单击“ 颜色”架子，然后将透明度设置为50%和之间的某个位置75%。此外，添加深色边框。这样可以使标记脱颖而出，并且您通常可以更好地识别任何重叠的标记。
- 如果标记太小，请单击“ 尺寸”架子并调整滑块。您也可以双击尺寸图例，然后编辑有关Tableau分配尺寸的详细信息。
- 如果标记太淡，请双击颜色图例，然后编辑Tableau分配颜色的详细信息。当您使用定义颜色渐变的连续字段时，此功能特别有用。

调整大小并使用“分步颜色”和“ 使用全色范围”（如下所示）相结合，产生了此示例的最终结果：

![img](../images/Image%20[19].jpg)

与填充图不同，符号图使您可以使用大小以可视方式对数据的各个方面进行编码。符号映射也允许更高的精度。实际上，如果数据中包含经度和纬度，则可以在街道地址详细级别上非常精确地绘制标记。这种类型的可视化还允许您映射没有明确定义的边界的位置。

有时，当您在“ **标记”**卡下拉菜单中手动选择“ **地图”**时，会收到一条错误消息，指示视图的详细信息级别不支持填充的地图。在这些情况下，Tableau将呈现没有内置形状的地理位置。除了无法填充地图的情况以外，您需要确定哪种类型最能满足您的需求。在后面的章节中，我们还将考虑在单个视图中组合填充图和符号图的可能性。

##### 密度图 <div id="page_37"></div>

密度图显示值在一个地理区域内的分布和集中。这些标记代替了单个的点或符号，融合在一起，显示出高浓度区域的强度。您可以控制颜色，大小和强度。

假设您想了解订单的地理位置集中。您可以使用以下步骤创建密度图：

1. 导航到“ 订单密度” 表。
2. 双击Postal Code 数据窗格中的 字段。正如前，画面自动创建一个使用一个符号地图地理可视化 Latitude (generated)， Longitude (generated)以及 State 多个领域。
3. 使用标记 卡上的下拉菜单，将标记类型更改为密度。现在，各个圆圈融合在一起，显示出浓度：

![img](../images/Image%20[20].jpg)

尝试尝试使用 颜色 和 尺寸 选项。例如，单击颜色，将显示一些特定于密度标记类型的选项：

![img](../images/Image%20[21].jpg)

可以使用几种调色板来很好地处理浓度标记（默认调色板可以在浅色背景下很好地工作，但是还有其他一些调色板可以在深色背景下工作）。强度滑块可让您根据浓度确定标记绘制的强度。

该密度图显示了来自东海岸的大量订单。有时，您会看到仅反映人口密度的模式-在这种情况下，您的分析可能没有特别的意义。在这种情况下，与西海岸缺乏密度相比，东海岸的集中度令人着迷。

#### 使用“向我展示” <div id="page_38"></div>

Show Me是Tableau的强大组件，可将所选字段和活动字段排列到所选可视化类型所需的位置。“  显示我”工具栏显示了不同类型的可视化效果的小缩略图图像，使您只需单击即可创建可视化效果。根据您在数据窗格中选择的字段以及已经在视图中的字段，“  显示我”将启用可能的可视化并突出显示推荐的可视化。

请按照以下步骤探索“ 向我展示 ”功能：

1. 导航到“ 向我显示”工作 表。
2. 如果“ 显示我”窗格没有展开，请单击工具栏右上方的“ 显示我”按钮以展开该窗格。
3. 在数据窗格中单击“ 邮政编码”，“ 州 ”和“ 利润”字段时，按住*Ctrl*键，以选择每个字段。在突出显示这些字段的情况下，“ 向我显示”应如下所示：

![img](../images/Image%20[22].jpg)

请注意，“ 显示我”窗口已启用某些可视化类型，例如**文本表**，**热图**，**符号图**，**填充图**和**条形图**。除了在数据窗格中选择的任何字段外，这些视图还可以在视图中已有字段的情况下提供。“向我展示”突出显示了所选字段的推荐可视化效果，并提供了将鼠标悬停在每种可视化类型上时需要哪些字段的描述。例如，符号地图需要一个地理维度和0到2个度量。

其他可视化显示为灰色，例如折线图，面积图和直方图。Show Me不会使用视图中当前在数据窗格中选择的字段来创建这些可视化类型。将鼠标悬停在“ 向我展示”中的灰色折线图选项上。它表示折线图需要一个或多个度量（已选择），但还需要一个日期字段（尚未选择）。

*Tableau将使用日期以外的其他字段绘制折线图。**Show Me**为您提供了通常被视为可视化的良好做法的选项。**但是，有时候您知道折线图可以**更好地代表您的数据**。**了解Tableau如何基于字段和架子来呈现可视化效果，而不是始终依赖于**Show Me，**将为您提供更大的可视化灵活性，并允许您在**Show Me**无法提供所需的确切结果**时重新排列内容**。**同时，您将需要培养良好的可视化实践意识。*

当您搜索数据的见解时，“ 显示我”可能是一种快速迭代不同可视化类型的有效方法。但是，作为数据浏览器，分析师和讲故事的人，您应该考虑“ 向我展示”  作为提供建议的有用指南。您可能知道某种可视化类型比“向我展示”的建议会更有效地回答您的问题。您也可能有一个可视化类型的计划，该计划可以很好地用作仪表板的一部分，但甚至不包含在Show Me中。

如果可以有效地使用Show Me，那么您将很好地学习和掌握Tableau ，但如果没有它，也可以轻松构建可视化效果。Show Me功能强大，可以在您寻找见解并提出新问题时快速迭代可视化。这对于从您进一步自定义的标准可视化开始很有用。作为教学工具，它很棒。

但是，请注意不要在不了解如何从数据实际构建可视化的情况下将其用作拐杖。花时间评估为什么某些可视化是可行的还是不可能的。暂停查看在选择某种可视化类型时使用了哪些字段和架子。

通过单击各种可视化类型尝试“ 演示”，结束“ 演示我”示例，以基于可视化类型寻找对数据可能或多或少显而易见的见解。**圆形视图**和**箱须图**显示了每个州的邮政编码分布。条形图容易暴露一些邮政编码为负的邮政编码。

现在您已经熟悉了如何创建数据的各个视图，现在让我们将注意力转移到仪表板上。

### 将所有内容放到仪表板中 <div id="page_39"></div>

通常，您不仅仅需要一个可视化文件来传达数据的全部内容。在这些情况下，Tableau使您非常轻松地在仪表板上一起使用多个可视化文件。在Tableau中，*仪表板*是视图，过滤器，参数，图像和其他对象的集合，这些对象一起工作以传达数据故事。仪表板通常是交互式的，并允许最终用户浏览数据的不同方面。

仪表板有多种用途，可以量身定制以适合各种受众。考虑以下可能的仪表板：

- 利润和销售的摘要级别视图，使高管可以快速了解公司的当前状态
- 交互式仪表板，允许销售经理深入研究销售区域以识别威胁或机会
- 仪表板可让医生跟踪患者的再入院，诊断和程序，从而做出有关患者护理的更好决策
- 仪表板，可让房地产公司的主管确定趋势并为各种公寓大楼做出决策
- 一个交互式的仪表板，供信贷员根据信用等级和地理位置细分的投资组合做出贷款决策

为不同的受众和先进技术方面的考虑进行详细覆盖 [第7章](docs/Book.md#page_160) ， *讲述与仪表板数据的故事*.

#### 仪表板界面 <div id="page_40"></div>

创建新的仪表板时，界面将与设计单个视图时稍有不同。在简要了解界面之后，我们将开始设计您的第一个仪表板。您可能会导航到“ Superstore Sales”表，然后自己快速浏览一下。

仪表板窗口由几个关键组件组成。使用这些对象的技术将在[第7章](docs/Book.md#page_160)*“用仪表板讲述数据故事”中*详细介绍*。* 目前，重点关注对可用选项的一些熟悉。您会注意到的一件事是，左侧边栏已替换为特定于仪表板的内容：

![img](../images/Image%20[23].jpg)

左侧栏包含两个选项卡：

- 甲仪表板标签，上浆选项和添加表和对象到仪表板
- 甲布局选项卡，用于调节各种对象的布局仪表盘上的

“ 仪表板”窗格包含用于基于目标设备进行预览的选项以及几个部分：

- 一个**面积**部分，仪表盘大小的选项
- 甲**表**部分中，包含在仪表盘上的所有片材（视图）提供给处
- 具有可添加到仪表板的其他对象的“ **对象”**部分

您可以通过拖放将工作表和对象添加到仪表板。拖动视图时，一旦放下工作表，浅灰色阴影将指示工作表在仪表板上的位置。您也可以双击任何工作表，它将自动添加。

除了添加工作表之外，还可以将以下对象添加到仪表板：

- **水平**和**垂直**布局容器可让您更好地控制布局
- **文字**可让您添加文字标签和标题
- 的**图像**  ，甚至嵌入**网页**内容可以加
- 使用**Blank**对象可以保留仪表板中的空白，也可以用作占位符，直到设计了其他内容
- 甲**按钮**是一个对象，允许用户仪表板之间导航
- 一个**扩展**  让你添加控件的能力和对象，你或者第三方已开发与仪表板进行交互，并提供扩展功能

使用切换按钮，您可以选择是否将新对象添加为平铺或浮动。平铺对象将对齐到其他平铺对象旁边或布局容器内的平铺布局中。浮动对象将在连续的图层中浮动在仪表板上。

第一次将工作表添加到仪表板时，在工作表视图中可见的所有图例，过滤器或参数都将添加到仪表板。如果您希望稍后添加它们，请在仪表板中选择工作表，然后单击右上角的小下拉记号。几乎每个对象都具有下拉符号，提供许多选项来微调外观和控制行为。

请注意对于仪表板上的所选对象可见的各种**用户界面**（**UI**）元素：

![img](../images/Image%20[24].jpg)

您可以使用边框在仪表板上调整对象的大小。屏幕快照中标记的**Grip**允许您在放置对象后移动它。我们将考虑其他选择。

#### 建立仪表板 <div id="page_41"></div>

有了界面概述，您现在可以按照以下步骤来构建仪表板：

[1] 导航到“ 超级市场销售”表。您应该看到一个空白的仪表板。  

[2] 先后双击每个中列出的后页纸张的仪表盘左侧部分：由销售部，随着时间的推移销售，并通过邮编销售。请注意，双击对象会将其添加到仪表板的布局。  

[3] 通过选中边栏左下角的“ 显示仪表板标题”，向仪表板添加标题。  

[4] 在仪表板上选择“ 按部门销售”表，然后单击下拉箭头以显示菜单。  

[5] 选择适合 | 整个视图。本**飞度**选项描述的可视化应该如何填充任何可用空间。  

> 使用各种**适合**选项**时要小心**。**如果您使用的大小不固定的仪表板，或者您的视图根据交互性动态更改显示的项目数，那么曾经看起来不错的视图可能不太适合该视图。*

[6] 通过单击选择销售规模图例。使用**Remove UI**元素从仪表板中删除图例。

[7] 通过单击选择“ 利润”颜色图例。使用握柄拖动图例，并将其放置在地图下。

[8] 对于每个视图（由部门销售，通过邮政编码销售，并且销售一段时间内），选择通过单击视图的空白区域的观点。然后，单击用作筛选器**UI**元素以使该视图成为仪表板的交互式筛选器。您的仪表板应类似于以下内容：

![img](../images/Image%20[25].jpg)

[9] 花一点时间与仪表板进行交互。单击各种标记，例如线条，状态和线的点。请注意，每个选择都会过滤仪表板的其余部分。单击所选标记将取消选择它并清除过滤器。还要注意，在多个视图中选择标记会使过滤器一起工作。例如，选择在酒吧家具在由部销售和2016年第一季度在一段时间的销售  可以让你看到所有的邮政编码是曾在2016年第一季度家具销售。

恭喜你！现在，您已经创建了一个可以进行交互式分析的仪表板！

作为超市连锁店的分析师，您的可视化效果使您可以浏览和分析数据。您创建的仪表板可以与管理人员共享，并且可以用作帮助他们查看和理解数据以做出更好决策的工具。当经理选择家具部门时，很明显，有些地方的销售额很高，但利润实际上很低。这可能会导致做出决定，例如更改该位置的行销或新的销售重点。最有可能的是，这将需要进行额外的分析，以确定最佳的行动方案。在这种情况下，Tableau将使您能够继续发现，分析和讲故事的周期。

### 总结 <div id="page_42"></div>

Tableau的视觉环境允许视觉上快速探索和分析数据的迭代过程。您已迈出了了解如何使用该平台的第一步。您连接到数据，然后使用一些关键的可视化类型（例如条形图，折线图和地理可视化）来浏览和分析数据。在此过程中，您专注于学习技术和理解关键概念，例如度量和维度之间的差异以及离散和连续的字段。最后，您将所有部分放在一起以创建功能全面的仪表板，最终用户可以通过该仪表板了解您的分析并发现自己的发现。

在下一章中，我们将探讨Tableau如何处理数据。您将了解如何连接各种数据源的基本概念和实际示例。结合您刚刚学习的有关构建可视化的关键概念，您将有能力继续进行更高级的可视化，更深入的分析以及讲述完全交互式的数据故事。

## 第二章 在Tableau中处理数据 <div id="page_43"></div>

Tableau提供了连接到几乎所有数据源的功能。它使用独特的范例来做到这一点，从而使其能够利用现有数据库引擎的功能和效率，并可以选择在本地提取数据。本章重点介绍Tableau如何处理数据的基本概念，包括以下主题：

- Tableau范例
- 连接数据
- 使用抽取而不是实时连接
- Tableau文件类型
- 元数据和共享连接
- 连接和融合
- 筛选数据

### Tableau范例 <div id="page_44"></div>

（**VizQL** **可视查询语言**）的结果是第二章 在Tableau中处理数据的独特而令人兴奋的体验。

VizQL是作为斯坦福大学的一个研究项目而开发的，专注于人类视觉感知世界的自然方式以及如何将其应用于数据可视化。我们自然会察觉到大小，形状，空间位置和颜色的差异。当您在可视环境中拖放数据字段时，通过VizQL，Tableau可以将您的操作转换为查询语言，该查询语言定义了数据如何编码这些可视元素。您将不需要读取，写入或调试VizQL。在将字段拖放到定义大小，颜色，形状和空间位置的各个架子上时，Tableau将在后台生成VizQL。这使您可以专注于可视化数据，而不是编写代码！

VizQL的优点之一是它提供了一种通用的方式来描述视图中各个字段的排列方式如何定义与数据相关的查询。然后可以将此通用基准转换为SQL，MDX和**TQL**（**Tableau Query Language的**缩写，用于提取数据）的**多种形式**。Tableau将自动将VizQL转换为由源数据引擎运行的本机查询。

以最简单的形式，Tableau处理数据的范例如下图所示：

![img](../images/Image%20[26].jpg)

#### 一个简单的例子 <div id="page_45"></div>

继续并打开目录中的Chapter 02 Starter.twbx工作簿\Learning Tableau\Chapter 02，然后导航到Tableau Paradigm表。看一下下面的屏幕快照，该屏幕快照是通过将ColumnsRegion  上的维度和Rows上的 measure 拖放到屏幕上而创建的 ：Sales

![img](../images/Image%20[27].jpg)

该 Region 字段在视图中用作离散（蓝色）字段，因此定义了列标题。作为维度，它定义了视图中的详细程度，并对度量进行切片，以便每个区域获得一个条形图。该 Sales 字段是通过汇总每个区域内的每个销售而汇总的度量。作为连续（绿色）字段，Sales定义一个轴。

就本示例而言（尽管主体适用于任何数据源），假设您使用Superstore存储在表中的数据实时连接到SQL Server数据库。首次创建上述屏幕截图时，Tableau会生成一个VizQL脚本，该脚本会转换为SQL脚本并发送到SQL  Server。SQL  Server数据库引擎评估查询并将汇总结果返回给Tableau，然后将其可视化呈现。整个过程类似于Tableau范例中的下图：

![img](../images/Image%20[28].jpg)

SQL Server中可能有成百上千，甚至上百万的销售数据行。但是，当SQL Server处理查询时，它将返回聚合结果。在这种情况下，SQL Server仅将四行汇总数据返回到Tableau，每个区域一行。

要查看Tableau用来绘制视图的聚合数据，请按*Ctrl* *+* *A*选择所有条，然后右键单击它们之一，然后选择“ 查看数据”。

*有时，数据库管理员可能希望找出针对某个数据库运行的脚本，以调试性能问题，或确定更有效的索引或数据结构。**许多数据库提供概要分析实用程序或查询的日志执行。**此外，您可以在**My Tableau RepositoryLogs**目录**中的日志中找到Tableau生成的SQL或MDX* *。*

*您也可以使用Tableau的内置***Performance Recorder***查找已执行的查询。**在顶部菜单中，选择**帮助* *|。**设置和性能* *|* *开始演奏记录**，然后与视图进行交互，最后从菜单中停止录制。**Tableau将打开一个仪表板，使您可以查看在录制会话期间执行的任务，性能和查询。*

通过执行以下步骤，您实际上可以查看Tableau用于渲染条形图和基础记录的聚合数据：

1. 导航到 工作簿中的“ Tableau范例”表Chapter 02 Starter。
2. 按*Ctrl* *+* *A*选择所有四个栏。
3. 右键单击这些条之一，然后从上下文菜单中选择“ 查看数据... ”，如下所示：

![img](../images/Image%20[29].jpg)

“ 查看数据”屏幕使您可以观察视图中的数据。“ 摘要”选项卡显示用于渲染视图的聚合级别数据。Sales此处的值是每个地区的销售额总和。单击“ 基础”选项卡时，Tableau将查询数据源以检索构成聚合记录的所有记录。在这种情况下，有9,426条基础记录，如以下屏幕快照右下角的状态栏所示：

![img](../images/Image%20[30].jpg)

Tableau不需要9,426条记录来绘制视图，并且直到单击“ 基础数据”选项卡之前才从数据源请求它们。

数据库引擎经过优化，可以对数据执行聚合。通常，这些数据库引擎也位于功能强大的服务器上。Tableau利用了基础数据源的优化和功能。通过这种方式，Tableau可以可视化大量数据集，而对数据的本地处理相对较少。

此外，Tableau仅在您进行更改时需要查询新查询或刷新视图时才查询数据源。否则，它将使用存储在本地缓存中的聚合结果，如下所示：

![img](../images/Image%20[31].jpg)

在前面的示例中，基于视图中字段的查询（即，区域作为维度，销售总额作为度量）将仅向数据源发出一次。当返回四行聚合结果时，它们将存储在缓存中。然后，如果要移到Region另一个视觉编码架子（例如颜色），或Sales另一个视觉编码架子（例如大小），Tableau将从缓存中检索聚合行，并简单地重新渲染视图。

*您可以通过按**F5键**或从“* *数据”**菜单中选择**数据源**并选择“* *刷新”**来强制Tableau绕过缓存并刷新**数据源中的**数据**。**只要您希望视图反映实时数据源中的最新更改，就可以执行此操作。*

当然，如果要向视图中引入没有缓存结果的新字段，则Tableau会将新查询发送到数据源，检索汇总结果，然后将这些结果添加到缓存中。

### 连接数据 <div id="page_46"></div>

Tableau可视化的数据几乎没有限制！几乎每个新版本的Tableau都添加了新的本机连接。Tableau继续为基于云的数据添加本机连接器。该**网络的数据连接器**允许你写一个连接器，你想检索任何在线数据。此外，对于任何没有本机连接的数据库，Tableau都可以使用通用的ODBC连接。通过**Extract API**，您可以以编程方式提取和组合任何数据源，以供Tableau使用。

您可能在同一工作簿中具有到不同源的多个数据源连接。每个连接将显示在左侧栏的“ 数据”选项卡下。

本节将重点介绍一些连接到各种数据源的实际示例。我们不会介绍所有可能的连接，但是会介绍几个代表其他连接的地方。在以下示例中，您可能会或可能不会访问某些数据源。*如果您无法遵循每个示例，请不要担心*。仅观察差异。

*从Tableau 10开始，***连接从***技术上讲是指对单个数据集（例如，单个数据库中的表或目录中的文件）的连接。**甲***数据源***可包含一个以上的连接，可以连接在一起，如在SQL Server加入到Excel表的表。**您可能经常听到这些术语可以互换使用。*

#### 连接到文件中的数据 <div id="page_47"></div>

基于文件的数据包括将数据存储在文件中的所有数据源。基于文件的数据源包括以下内容：

- **提取物**：.hyper 包含从原始来源提取的数据的文件或.tde 文件。
- **Microsoft Access中**：一个.mdb或.accdb数据库文件在Access中创建。
- **Microsoft Excel中****：**一个.xls，.xlsx或.xlsm在Excel中创建的电子表格。多个Excel工作表或子表可以在单个连接中联接或结合在一起。
- **文本文件**：分隔的文本文件，最常见的.txt，.csv或.tab。单个目录中的多个文本文件可以在单个连接中合并或合并在一起。
- **本地多维数据集文件**：.cub包含**多维数据的文件**。这些文件通常是从OLAP数据库中导出的。
- **Adobe PDF**： .pdf可能包含Tableau可以解析的数据表的文件。
- **空间文件**：甲.kml，.shp，.tab，.mif，或.geojson文件，它包含可通过的Tableau呈现空间对象。
- **统计文件**：一个.sav，.sas7bdat，.rda，或.rdata文件通过统计工具，如SAS或R.产生
- **JSON** **文件**：.json包含JSON格式的数据的文件。

除了前面提到的那些连接，您还可以连接到Tableau文件，以导入保存在另一个Tableau工作簿（.twb或.twbx）中的连接。连接将被导入，更改将仅影响当前工作簿。

请按照以下示例查看与Excel文件的连接：

1. 导航到工作簿中的“ 连接到Excel”表Chapter 02 Starter.twbx。
2. 从菜单中，选择数据 | 创建新的数据源，然后从可能的连接列表中选择Excel。
3. 在打开的对话框中，Superstore.xlsx从\Learning Tableau\Chapter 02目录中打开文件。Tableau将打开“ 数据源”屏幕。您应该看到左侧列出的两张Excel文档。
4. 双击订单表，然后双击退货表。您的数据源屏幕应类似于以下屏幕截图：

![img](../images/Image%20[32].jpg)

花一些时间来熟悉“ **数据源”**屏幕界面，该界面具有以下功能（在前面的屏幕快照中编号）：

1. 工具栏：工具栏具有一些熟悉的控件，包括撤消，重做和保存。它还包括刷新当前数据源的选项。
2. 连接：当前数据源中的所有连接。单击“ 添加”将新连接添加到当前数据源。这使您可以跨不同的连接类型联接数据。每个连接都将使用颜色编码，以便您可以区分来自哪个连接的数据。
3. 表格（或表格）：列出了可用于给定连接的所有数据表格。其中包括Excel的工作表，子表和命名范围；关系数据库的表，视图和存储过程；以及其他依赖于连接的选项，例如New Union或Custom SQL。
4. 数据源名称：这是当前所选数据源的名称。您可以使用数据库图标旁边的下拉箭头选择其他数据源。您可以单击数据源的名称进行编辑。
5. 连接编辑器：将表格和表格从左侧拖放到该区域中，以使它们成为连接的一部分。对于许多连接，您可以添加将联接或联合在一起的多个表。在本章的后面，我们将看一些选项的高级示例。现在，请注意，您可以将鼠标悬停在该空间中的表上，并通过下拉菜单获取选项。
6. 实时或提取选项：对于许多数据源，您可以选择是要保持实时连接还是提取连接。我们将在本章后面详细介绍这些内容。
7. 数据源过滤器：您可以将过滤器添加到数据源。这些将应用于数据源级别，因此将应用于工作簿中使用此数据源的数据的所有视图。
8. 预览窗格选项：这些选项使您可以指定是要查看数据预览还是元数据列表，以及要如何预览数据（示例包括别名值，显示的隐藏字段以及多少个）您要预览的行）。
9. 预览窗格/元数据视图：根据您在选项中的选择，此空间将显示数据预览或包含附加元数据的所有字段的列表。请注意，这些视图为您提供了广泛的选择，例如更改数据类型，隐藏或重命名字段以及应用各种数据转换功能。我们将在本章和后续章节中考虑其中一些选项。

*创建并配置数据源后，您可以单击任意工作表以开始使用它。*

通过以下步骤结束本练习：

1. 单击数据源名称以编辑文本，然后将数据源重命名为 Orders and Returns。
2. 导航到连接到Excel片，并使用订单和返回数据源，创建一个时间序列示出了**记录数**由**退货原因**。您的视图应类似于以下屏幕截图：

![img](../images/Image%20[33].jpg)

1. 由于您创建的连接基于Orders和Returns的内部联接，因此该视图显示每个原因码的退货数。

如果你需要编辑在任何时候连接，选择数据从菜单中，找到您的连接，然后选择编辑数据  源......。或者，您可以右键单击左侧边栏“ 数据”选项卡下的任何数据源，然后选择“ 编辑数据源...”，或单击左下方的“  数据源”选项卡。您可以随时通过单击Tableau Desktop左下角的“ 数据源”选项卡来访问数据源屏幕。

#### 连接到服务器上的数据 <div id="page_48"></div>

SQL  Server，MySQL，Vertica和Oracle等数据库服务器将数据托管在一台或多台服务器计算机上，并使用强大的数据库引擎根据来自客户端应用程序的查询来存储，聚集，排序和提供数据。Tableau可以利用这些服务器的功能来检索数据以进行可视化和分析。或者，可以从这些来源中提取数据并将其存储在提取物中（.hyper或.tde）。

作为连接到服务器数据源的示例，我们将演示连接到SQL  Server。如果您有权访问基于服务器的数据源，则可能希望创建一个新的数据源并浏览详细信息。但是，本章的工作簿中没有具体的示例可以遵循。一旦选择了Microsoft SQL Server连接，该界面就会显示一些初始配置的选项，如下所示：

![img](../images/Image%20[34].jpg)

与SQL Server的连接需要服务器名称以及身份验证信息。

数据库管理员可以将SQL Server配置为使用Windows身份验证或SQL Server用户名和密码。使用SQL  Server，您还可以选择允许读取未提交的数据。这可能会提高性能，但如果在查询Tableau的同时插入，更新或删除数据，也可能导致不可预测的结果。另外，您可以使用左下角的Initial SQL ...链接指定要在连接时运行的SQL。

*为了维持高标准的安全性，Tableau不会将密码保存为数据源连接的一部分。**这意味着，如果您使用实时连接与他人共享工作簿，则他们将需要具有凭据才能访问数据。**这也意味着，首次打开工作簿时，对于需要密码的任何连接，您都需要重新输入密码。*

单击橙色的“ 登录”按钮后，您将看到一个非常类似于您在Excel中看到的连接屏幕的屏幕。主要区别在左侧，您可以在其中选择数据库，如以下屏幕快照所示：

![img](../images/Image%20[35].jpg)

选择数据库后，将看到以下内容：

- 表格：显示所选数据库中包含的所有数据表或视图。
- 新的自定义SQL：您可以编写自己的自定义SQL脚本并将其添加为表。您可以像加入其他任何表或视图一样将它们加入。
- 新建联合：您可以将数据库中的表联合在一起。Tableau将根据名称和数据类型匹配字段，并且您还可以根据需要合并字段。
- 存储过程：您可以使用存储过程来返回数据表。您可以选择设置存储过程参数的值，或者使用或创建Tableau参数来传递值。

配置完连接后，单击任意工作表的选项卡即可开始可视化数据。

#### 连接到云中的数据 <div id="page_49"></div>

与云中托管的数据建立了某些数据连接。这些包括**Amazon Redshift**，**Google Analytics（分析）**，**Google Sheets**，**Salesforce**等。深入讨论每个连接都超出了本书的范围，但是作为云数据源的示例，我们将考虑连接到Google表格。

Google表格允许用户在线创建和维护数据电子表格。表单可以由许多不同的用户共享和协作。在这里，我们将通过一个示例链接到通过链接共享的工作表。

要遵循该示例，您需要一个免费的Google帐户。使用您的凭据，请按照下列步骤操作：

1. 单击工具栏上的“ 添加新数据源”按钮，如下所示：

![img](../images/000133.gif)

1. 从可能的数据源列表中选择Google表格。您可以使用搜索框快速缩小列表的范围。
2. 在接下来的屏幕上，登录您的Google帐户，并授予Tableau Desktop适当的权限。然后，将向您显示所有Google表格的列表以及预览和搜索功能，如以下屏幕截图所示：

![img](../images/Image%20[36].jpg)

1. 在搜索框中输入此URL（为方便起见，该URL包含在Chapter 02 Starter工作簿的“ 连接到Google表格”标签中，并且可以复制和粘贴），然后单击“ **搜索”**按钮：[https](https://docs.google.com/spreadsheets/d/1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A/edit?usp=sharing) : [//docs.google.com/spreadsheets/ d / 1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A / edit？usp = sharing](https://docs.google.com/spreadsheets/d/1fWMGkPt0o7sdbW50tG4QLSZDwkjNO9X0mCkw-LKYu1A/edit?usp=sharing)。
2. Superstore在列表中选择结果表，然后单击“ 连接”按钮。现在，您应该看到“ **数据源”**屏幕。
3. 将数据源重命名为 Superstore (Google Sheets)。
4. 就本示例而言，请将连接选项从实时切换为提取。连接到自己的Google表格数据时，您可以选择实时或提取。
5. 导航到“ 连接到Google表格”工作表。应在几秒钟内提取数据。
6. 创建一个按**州**划分的**利润**图填充图，其中**利润**定义**颜色**和**标签**。

#### 连接数据的快捷方式 <div id="page_50"></div>

您可以非常快速地建立某些连接。这些选项使您可以更快地开始分析：

- **从剪贴板粘贴数据**。如果您从电子表格，网页上的表格或文本文件中复制了数据，则通常可以将数据直接粘贴到Tableau中。可以使用*Ctrl* *+* *V*或Data | 从菜单粘贴数据。数据将存储为文件，并且在保存工作簿时会提示您其位置。
- **选择****文件** **|** **从菜单中****打开**。这将允许您打开Tableau支持的任何数据文件，例如文本文件，Excel文件，Access文件（在macOS上不可用），空间文件，统计文件，JSON甚至是脱机多维数据集（.cub）文件。
- **将文件从Windows资源管理器或Finder拖放到Tableau工作区中**。任何有效的基于文件的数据源都可以拖放到Tableau工作区上，甚至可以放到桌面或任务栏上的Tableau快捷方式上。
- **复制现有连接**。您可以通过右键单击并选择Duplicate来复制现有的数据源连接。

### 管理数据源元数据 <div id="page_51"></div>

Tableau中的数据源存储有关连接的信息。除了连接本身（例如，数据库服务器名称，数据库和/或文件名）之外，数据源还包含有关所有可用字段的信息（例如字段名称，数据类型，默认格式，注释和别名） 。通常，*有关该数据的该数据*称为**元数据**。

右键单击数据窗格中的字段会显示一个元数据选项菜单。其中一些选项将在以后的练习中进行演示；其他内容将在整本书中进行说明。这些是通过右键单击可用的一些选项：

- 重命名领域
- 隐藏领域
- 更改尺寸值的别名（日期字段除外）
- 创建计算的字段，组，集，箱或参数
- 分裂领域
- 将日期或数字字段的默认用法更改为离散或连续
- 将字段重新定义为维度或度量
- 更改字段的数据类型
- 分配领域的地理角色
- 更改字段在可视化中的显示方式的默认值，例如默认的颜色和形状，数字或日期格式，排序顺序（用于尺寸）或聚合类型（用于度量）
- 为字段添加默认注释（将鼠标悬停在数据窗格中的字段时将显示为工具提示，或者从菜单中选择“ 描述...”时将显示为说明的一部分）
- 在层次结构中添加或删除字段

*与字段的可视显示相关的元数据选项（例如默认排序顺序或默认数字格式）定义了字段的整体默认值。**但是，可以通过右键单击架子上的活动字段并选择所需的选项来覆盖任何单个视图中的默认设置。*

要查看其工作原理，请使用在“ 连接到Google表格”视图中创建的“ 按**州**划分的**利润** ”填充地图视图。如果未创建此视图，则可以使用“ 订单和退货”数据源，尽管结果视图将略有不同。将填充的地图摆在您面前，请按照以下步骤操作：

1. 右键单击Profit数据窗格中的字段，然后选择默认属性 | 数字格式...。出现的对话框为您提供了许多数字格式选项。
2. 将数字格式设置为使用小数位数的货币（自定义）。单击“ 确定”后，您应该注意到地图上的标签已更新为包括货币符号。0
3. Profit再次右键单击该字段，然后选择默认属性 |。颜色...。出现的对话框为您提供了选择和自定义Profit字段默认颜色编码的选项。试用各种调色板和设置。请注意，每次单击“ 应用”按钮，可视化都会更新。

*分散调色板（从一种颜色混合到另一种颜色的调色板）特别适合诸如的字段**Profit**，该**字段* *可以具有负值和正值。**默认中心为**0**，您可以根据显示的颜色轻松判断正值或负值。*

![img](../images/Image%20[37].jpg)

由于您已在数据源级别为该字段设置了默认格式，因此您使用创建的任何其他视图Profit将包括您指定的默认格式。

*考虑在可视化中使用色盲安全色。**通常认为橙色和蓝色是红色和绿色的一种色盲安全替代品。**Tableau还包括一个离散的色盲安全调色板。**此外，请考虑调整颜色的强度。*

### 使用抽取而不是实时连接 <div id="page_52"></div>

大多数数据源都允许连接实时数据或提取数据。但是，某些基于云的数据源需要提取。相反，无法提取OLAP数据源并且需要实时连接。

使用实时连接时，Tableau会直接向数据源发出查询（或在可能的情况下使用缓存中的数据）。提取数据时，Tableau将从原始源中提取部分或全部数据并将其存储在提取文件中。在10.5版之前，Tableau使用Tableau数据提取（.tde）文件。从版本10.5开始，Tableau使用超级提取（.hyper），并在您更新较旧的工作簿时将.tde文件转换.hyper为。

摘录扩展了Tableau处理数据的方式。考虑下图：

![img](../images/Image%20[38].jpg)

Tableau如何处理数据的基本范例没有改变，但是您会注意到Tableau现在正在从提取中查询并获取结果。可以再次从源中检索数据以刷新提取。因此，每个提取都是最新刷新时数据源的快照。提取物具有便携性和高效性的优点。

#### 创建抽取 <div id="page_53"></div>

提取可以通过多种方式创建，如下所示：

- 如下所示在“ 数据源”屏幕上选择“ 提取 ” 。该编辑...链接将允许您配置的摘录：

![img](../images/000321.gif)

- 从“ 数据”菜单中选择数据源，或在数据窗格上右键单击数据源，然后选择“ 提取数据...”。如下面的屏幕快照所示，您将有机会设置摘录的配置选项：

![img](../images/Image%20[39].jpg)

- 开发人员可以使用Tableau Data Extract API创建抽取。该API允许您使用Python或C / C ++以编程方式创建提取文件。这种方法的详细信息超出了本书的范围，但是可以在Tableau的网站上随时获得文档。
- 某些工具（例如Alteryx或Tableau Prep）能够输出Tableau提取。

首次创建或随后配置提取时，将提示您选择某些选项，如下所示：

![img](../images/Image%20[40].jpg)

配置摘录时，您具有很多控制权。以下是各种选项，以及您的选择将对性能和灵活性产生影响：

- 您可以选择添加**提取**过滤器，以将**提取**限制为原始源的子集。只有在这个例子中，记录，其中Region为**中央**或**南**哪里Category是**办公设备**将被列入提取物。
- 您可以通过选中复选框来汇总摘录。这意味着数据将被汇总到可见维度的级别，并可选地汇总到指定的日期级别，例如年或月。

**可见** **字段***是数据窗格中显示的***字段***。**您可以**通过右键单击字段并选择**隐藏，**从***数据源***屏幕或数据窗格中**隐藏**字段**。**如果在工作簿的任何视图中使用了该字段，则将禁用此选项。**Hidden**字段不可用于视图中。**Hidden**只要在创建或优化提取之前将其隐藏，字段就不会包含在提取中。*

- 在前面的示例中，如果只有Region和Category维度可见，则所得提取将仅包含两行数据（一行用于**Central**，另一行用于**South**）。此外，任何度量都将在Region/ Category级别汇总，并将针对“ **提取”**  过滤器进行。例如，Sales将被卷起来销售的总和**Ç** **entral** / **办公设备**和**南** / **办公设备**。所有度量均根据其默认聚合进行聚合。
- 您可以通过包含数据集中的所有行或对前**N**行的采样来调整摘录中的行数。如果选择所有行，则可以指示增量刷新。如果源数据以增量方式添加记录，并且您具有诸如身份列或日期字段之类的字段，可在添加新记录时可靠地用来标识新记录，则增量提取可以使您将这些记录添加到提取中而无需重新创建整个提取物。在前面的示例中，**行ID**高于上一次提取刷新的最大值的所有新行将包含在下一个增量刷新中。

*增量刷新可能是处理随时间增长的大量数据的好方法。**但是，请谨慎使用增量刷新，因为增量刷新只会根据您指定的字段添加新的数据行。**您将不会对现有行进行任何更改，如果在源中删除了行，也不会删除它们。**如果增量字段的值小于现有提取中的最大值，那么您还将错过任何新行。*

#### 使用抽取 <div id="page_54"></div>

使用提取的任何数据源都将带有一个独特的图标，指示数据已从原始源提取到提取中，如以下屏幕截图所示：

![img](../images/Image%20[41].jpg)

提取前一个数据窗格中的第一个数据连接，而不提取第二个。创建抽取后，您可以选择是否使用抽取。当你右键点击（或数据源的数据从菜单，然后将数据源），你会看到下面的菜单选项，在这个截图所示：

![img](../images/Image%20[42].jpg)

1. 刷新：数据源下的“ 刷新”选项只是告诉Tableau刷新本地数据缓存。使用实时数据源，这将重新查询基础数据。使用提取的源时，将清除缓存并重新查询提取，但是此“ 刷新”选项不会更新原始源中的提取。为此，请使用“ 提取”子菜单下的“ 刷新 ” （请参阅此列表中的第4步）。
2. 提取数据...：这将从数据源中创建新的提取（如果存在，则替换现有的提取）。
3. 使用提取：如果有给定数据源的提取，则启用此选项。取消选中该选项将告诉Tableau使用实时连接而不是数据提取。摘录将不会被删除，可以随时通过选中此选项来再次使用。如果原始数据源不可用于该工作簿，则Tableau将询问在哪里找到它。
4. 刷新：此“ 刷新”选项使用原始来源的数据刷新提取。对于您所做的某些更改（例如隐藏字段或创建新的计算），它不会优化提取。
5. 从文件追加数据...：：如果其他文件具有与原始源相同的确切数据结构，则此选项允许您将其他文件追加到现有提取中。这会将行添加到现有的摘录中；它不会添加新列。
6. 优化：这将根据您自最初创建提取文件以来所做的更改重新构造提取文件，以使其尽可能高效。例如，某些计算字段可能会**实现**（即计算一次，以便可以存储结果值），并且将从提取中删除新隐藏的列或删除的计算。
7. 删除：这将删除提取的定义，可以选择删除提取文件，并恢复到原始数据源的实时连接。
8. 历史记录：这使您可以查看摘录和刷新的历史记录。
9. 属性：这使您可以查看提取的属性，例如位置，基础源，过滤器和行限制。

#### 性能 <div id="page_55"></div>

在10.5之前，Tableau Data Extracts（.tde 文件）是非常高效的柱状数据库，在Tableau数据引擎中运行良好。在Tableau 10.5中，Tableau引入了Hyper数据引擎，该引擎显示出显着的性能提升，尤其是对于大型数据集。无论.tde和.hyper提取将执行比大多数传统的现场数据库连接速度更快。这是基于以下几个因素：

- 超提取利用OLTP和OLAP模型的混合，引擎确定最佳查询。Tableau数据提取是纵栏式的，而且查询效率很高。
- 提取程序具有结构性，因此可以将它们快速加载到内存中，而无需进行其他处理，并且可以在内存和磁盘存储之间移动，因此其大小不受可用RAM数量的限制。
- 在摘录中实现了许多计算字段。与每次执行查询时执行计算相比，通常可以更快地读取提取物中存储的预计算值。超提取通过潜在地实现许多聚合来扩展此范围。

您可以选择使用提取来提高传统数据库的性能。为了最大程度地提高性能，请考虑以下操作：

- 在创建提取之前，隐藏未使用的字段。如果创建了所有所需的可视化，则可以单击提取对话框上的“ 隐藏未使用的字段”按钮以隐藏所有视图或计算中未使用的所有字段。
- 如果可能，请使用原始来源的数据子集。例如，如果您具有最近10年的历史数据，但仅需要最近两年进行分析，则可以按“ 日期”字段过滤提取的数据。
- 在创建或编辑计算所得的字段，或删除或隐藏字段之后优化提取。
- 将提取程序存储在固态驱动器上。

#### 便携性和安全性 <div id="page_56"></div>

假设您的数据托管在只能从办公室网络内部访问的数据库服务器上。通常，您必须在现场或使用VPN来处理数据。通过摘录，您可以随身携带数据并脱机工作。

提取文件包含从源提取的数据。保存工作簿时，可以将其另存为Tableau工作簿（.twb）文件或Tableau打包工作簿（.twbx）文件。工作簿（.twb）包含所有连接，字段，可视化文件和仪表板的定义，但不包含任何数据或外部文件，例如图像。保存打包的工作簿（.twbx）时，所有摘录和外部文件都与工作簿一起打包在一个文件中。

可以使用Tableau Desktop，Tableau Reader打开使用抽取打包的工作簿，并将其发布到Tableau Public或Tableau Online。

*打包的工作簿文件（**.twbx**）实际上只是一个压缩**.zip**文件。**如果将扩展名从重命名**.twbx**为**.zip**，则可以像访问其他任何**.zip**文件**一样访问内容**。**您也可以考虑将**.twbx**扩展名与ZIP实用程序**相关联，**这样就不必重命名文件。*

使用抽取时，需要牢记两个安全注意事项：

- 提取使用一组凭据进行。创建抽取后，任何根据使用的凭据限制可以访问哪些数据的安全层都将无效。摘录不需要用户名或密码。任何人都可以读取摘录中的所有数据。
- 即使在可视化文件中未显示数据，也可以访问提取文件（.hyper或.tde）或打包的工作簿（.twbx）中包含的可见（非隐藏）字段的任何数据。请特别注意限制对包含敏感或专有数据的摘录或打包工作簿的访问。

故事讲述了一位员工向公司中的其他人发送了包含人力资源数据的打包工作簿。即使所有仪表板都未显示敏感数据，但摘录仍包含其中。不久，公司中的每个人都知道了其他人的薪水，原来的个人不再是雇员。

#### 何时使用抽取 <div id="page_57"></div>

在确定是否使用提取物时，应考虑各种因素。在某些情况下，您将没有选择（例如，OLAP需要实时连接，而某些基于云的数据源则需要摘录）。在其他情况下，您将需要评估您的选择。

通常，在以下情况下使用抽取：

- 与实时连接相比，您需要更好的性能。
- 您需要数据是可移植的。
- 您需要使用数据库数据引擎不支持的功能（例如， MEDIAN与SQL Server的实时连接不支持这些功能）。
- 您要共享打包的工作簿。如果要与使用免费Tableau Reader的人共享打包的工作簿，则尤其如此，后者只能读取提取了数据的打包的工作簿。

通常，当您具有以下任何一种使用情况时，请不要使用抽取：

- 您拥有某些用户不应该访问的敏感数据，或者您无法控制谁可以访问摘录。但是，您可以在创建提取之前隐藏敏感字段，在这种情况下，它们不再是提取的一部分。
- 您需要基于登录凭据来管理安全性。（但是，如果您使用的是Tableau Server，则仍可以使用Tableau Server上托管的提取连接，这些连接通过登录进行保护。我们将在[第12章](docs/Book.md#page_255)， *共享数据故事中*考虑与Tableau Server共享您的工作）。
- 您需要查看实时更新的源数据中的更改。
- 大量的数据使构建提取所需的时间变得不切实际。在合理的时间内可以提取的记录数取决于诸如字段的数据类型，字段数，数据源的速度和网络带宽之类的因素。超级引擎通常.hyper比旧.tde文件的生成速度快得多。

### Tableau文件类型 <div id="page_58"></div>

除了前面提到的文件类型之外，还有许多其他与Tableau相关的文件类型。以下是一些Tableau文件类型：

- .tbm：一个Tableau书签文件-一个XML文件，其中包含单个视图的静态快照和相关数据源的定义。现在可以将工作表从一个工作簿复制并粘贴到另一个工作簿，因此基本上不需要此文件类型。您可以创建书签并将其从“ 窗口”菜单导入到其他工作簿中。
- .hyper：超级提取—一个二进制文件，其中包含从其他来源提取的数据。这是Tableau 10.5和更高版本使用的提取格式，该格式利用了速度更快且可伸缩的超级引擎。
- .tde：Tableau数据提取—一个二进制文件，其中包含从其他来源提取的数据。该.tde文件本身不包含有关原始数据源的信息。10.5之前的版本使用Tableau Data Extract。Tableau 10.5和更高版本可以读取.tde文件，但是在大多数情况下，它们会将它们更新为新.hyper格式。
- .tds：Tableau数据源文件-一个XML文件，其中包含数据源的定义（服务器名称，文件路径等），但不包含数据。您可以.tds通过右键单击数据源并选择添加到保存的数据源来将数据源导出为文件。目录中的所有.tds文件My Tableau Repository Data Sources都会在主屏幕上显示为数据连接快捷方式。
- **.**tfl：Tableau Flow文件-定义Tableau Prep流的文件。Tableau Desktop无法读取此文件类型。
- .tflx：打包的Tableau Flow文件-一个压缩.zip文件，包含该.tfl 文件以及该流的基于文件的数据源的摘要。Tableau Desktop无法读取此文件类型。
- .tdsx：Tableau数据源提取的文件-一个压缩文件，其中包含数据源的定义以及数据的提取。您可以使用与创建.tds文件相同的方式来创建打包数据源，选择.tdsx作为文件类型。
- .tld/.tlf/.tlq/.tlr：一个Tableau许可证文件—Disconnected / File/ Request/ Return/ Response文件类型用于许可证激活。
- .tms：Tableau Map Source文件-一种XML文件类型，用于指定Tableau可用的地图服务和配置。
- .tmsd：Tableau Map Source Defaults文件-一个XML文件，其中包含地图服务的默认值
- .tps：Tableau首选项-一个XML文件，其中包含Tableau Desktop的首选项默认值，包括UI元素和调色板。
- .tsvc：Tableau Atom服务文件类型。
- .twb：阿的Tableau工作簿-包含所有片材的定义，数据源，偏好和格式化的XML文件。它不包含任何数据。
- .twbx：Tableau打包的工作簿-一个压缩文件，其中包含Tableau工作簿（.twb）文件以及所有数据提取（.tde）和任何其他外部文件（例如，未提取数据源的图像或文本/ Excel文件）。

### 连接和融合 <div id="page_59"></div>

联接表和混合数据源是在Tableau中将相关数据链接在一起的两种不同方式。执行**联接**以逐行将数据表链接在一起。**共混物**被执行以在一起的多个数据源在总体水平联系起来。

#### 联接表 <div id="page_60"></div>

大多数数据库都有多个以某种方式相关的数据表。此外，使用Tableau 10及更高版本，您可以跨许多数据源的各种数据连接将数据表连接在一起。正如我们将看到的，Tableau相对容易地使将数据表联接在一起非常容易。

例如，考虑如下表：

![img](../images/000065.gif)

主表是“ **医院就诊”**表，该表记录了患者每次去**医院**的记录，并包含诸如入院类型（例如住院，门诊和急诊室）等详细信息。它还包含将访问链接到**主治医师**，**患者**和**出院详细信息的**关键字段。

当您连接到Tableau中的数据库时，您将看到左侧列出的表，并且可以选择将它们拖放到数据源设计器中。

*通常，您首先需要将主表拖到设计器中。**在这种情况下，“* **医院访问”***包含用于联接其他表的键。**这些表应拖放到主表之后。*

如果在数据库中定义了关键字段和关系，则当您添加其他表时，Tableau将自动创建联接。否则，它将尝试匹配字段名称。无论如何，您都可以根据需要调整连接。当放到设计器中时，上述表格将与下图相似：

![img](../images/Image%20[43].jpg)

您可以通过单击表之间的小图来调整连接。该图指示使用哪种连接。例如，“ **医院就诊”**和“ **患者”**之间的**联接**是“ **内部联接”，**因为假定每次访问都将有一个患者，每个患者都将有一个**就诊**。但是，“ **医院就诊”**与“ **出院详细信息”**之间的连接是左连接，因为“ **医院就诊”中的**某些记录可能是针对仍在医院中的患者（因此他们尚未出院）。

单击该图将允许您选择其他类型的联接，并定义哪些字段是联接的一部分。

您可以指定以下类型的联接：

- **内部**：仅保留左侧表和右侧表中符合连接条件的记录。在以下示例中，结果中仅保留三个匹配行：

![img](../images/Image%20[44].jpg)

- **左**：将保留左侧表中的所有记录。右侧表中的匹配记录将在结果表中具有值，而不匹配的记录将包含NULL右侧表的所有字段的值。在以下示例中，左侧表的五行保留了NULL不匹配的右侧值的结果：

![img](../images/000143.gif)

- **右**：将保留右表中的所有记录。左侧表中的匹配记录将产生值，而不匹配的记录中将包含NULL左侧表的所有字段的值。并非每个数据源都支持右连接。如果不支持，则该选项将被禁用。在以下示例中，右侧表的五行保留了NULL不匹配的左侧值的结果：

![img](../images/000098.gif)

- **全部外部**：将保留双方表中的所有记录。匹配的记录将具有左右两边的值。不匹配的记录将具有NULL未找到左侧或右侧匹配记录的值。并非每个数据源都支持完整的外部联接。如果不支持，则该选项将被禁用。在以下示例中，所有行都从两侧保留NULL有未找到匹配项的值：

![img](../images/000053.gif)

#### 跨数据库联接 <div id="page_61"></div>

使用Tableau，您可以跨多个不同的数据连接（在行级别）联接。跨不同数据连接的联接称为**跨数据库**联接。例如，您可以将SQL Server表与文本文件或Excel文件联接，或者将一个数据库中的表与另一个数据库中的表联接，即使这些表位于不同的服务器上。这为补充数据或分析来自不同来源的数据提供了各种可能性。

考虑前面提到的医院数据。计费数据与患者护理数据位于不同的系统中并不少见。假设您有一个用于患者账单的文件，其中包含要包含在对医院就诊分析中的数据。您可以通过将文本文件添加为数据连接，然后将其连接到现有表来完成此操作，如下所示：

![img](../images/Image%20[45].jpg)

您会注意到，“ 数据源”屏幕上的界面包含一个“ 添加”链接，该链接可让您向数据源添加数据连接。单击每个连接将允许您将表从该连接拖放到数据源设计器中，并根据需要指定连接。每个数据连接都将进行颜色编码，以便您可以立即在设计器中识别各种表的来源。

在前面的示例中，该 Patient Billing.txt 文本文件 已从SQL Server 连接到Patient表。

*对于所有联接，包括跨数据连接联接，您将需要确保表之间具有相同的共享字段。**例如，加入**Patient Billing.txt**到**Patient**表中，将需要某种形式的患者ID或可匹配账号。**跨数据库联接还要求数据类型相同。**如果需要，**可以使用***联接计算***来更改类型。*

#### 混合数据源 <div id="page_62"></div>

数据混合是Tableau中的强大功能和创新功能。它允许您在同一视图中使用来自多个数据源的数据。通常，这些来源可能是不同的类型。例如，您可以将Oracle中的数据与Excel中的数据混合。您可以将Google Analytics（分析）数据与空间文件混合。数据混合还允许您比较不同详细程度的数据。数据混合的一些先进的应用将覆盖[第8章](docs/Book.md#page_185)，*深入研究：趋势，聚类，分布和预测*。现在，让我们考虑基础知识和简单示例。

数据混合是在聚合级别完成的，涉及到发送到每个数据源的不同查询，与联接不同，联接是在行级别完成的，并且涉及到对单个数据源的单个查询。一个简单的数据混合过程涉及几个步骤，如下图所示：

![img](../images/Image%20[46].jpg)

从上图可以看到以下内容：

- Tableau向主数据源发出查询。
- 基础数据引擎返回汇总结果。
- Tableau向辅助数据源发出另一个查询。该查询是根据从主数据源返回的用于链接两个数据源的维的值集进行过滤的。
- 基础数据引擎从辅助数据源返回汇总结果。
- 来自主数据源的汇总结果和来自辅助数据源的汇总结果在缓存中混合在一起。

重要的是要注意数据混合与联接有何不同。联接在单个查询中完成，结果逐行匹配。数据混合是通过发出两个单独的查询，然后将汇总结果混合在一起而发生的。

只能有一个主要来源，但可以有任意多个次要来源。对于每个辅助来源，将重复步骤3和步骤4。返回所有聚合结果后，Tableau将基于链接字段匹配聚合行。

*当您在Tableau工作簿中有多个数据源时，在视图中首先使用的那个数据源将成为该视图的主要源。*

*混合是特定于视图的。**您可以在一个视图中将一个数据源作为主数据源，而在另一个视图中将其作为辅助数据源。**可以在混合中使用任何数据源，但是必须使用OLAP多维数据集（例如SSAS）作为主要源。*

**链接字段**是用于匹配主要和次要数据源之间混合的数据的维。链接字段定义了辅助来源的详细程度。如果字段在数据源之间按名称和类型匹配，则将自动分配链接字段。否则，您可以通过从菜单中选择数据 |手动分配字段之间的关系。 编辑关系，如下所示：

![img](../images/Image%20[47].jpg)

“ 关系”窗口将显示不同数据源之间识别的关系。您可以从“ 自动”切换到“ 自定义”以定义自己的链接字段。

可以激活或禁用链接字段以在视图中进行融合。默认情况下，视图中使用的链接字段通常会处于活动状态，而其他字段则不会。但是，您可以通过单击“ 数据”窗格中链接字段旁边的链接图标来更改链接字段是否处于活动状态。

*此外，使用“* *编辑数据关系”**屏幕来定义将用于***跨数据源过滤器***的字段，这些字段将**在下一节（“* *过滤”**）中**进行讨论**。*

##### 一个混合的例子 <div id="page_63"></div>

以下屏幕截图显示了一个实际的数据混合示例：

![img](../images/Image%20[48].jpg)

在此工作簿中定义了两个数据源连接，一个用于Superstore数据，另一个用于Superstore Sales Goals。所述Superstore数据源是在此视图（用蓝色勾选指示）主数据源和Superstore Sales Goals是第二源（由橙色复选标记指示）。来自辅助数据源的视图中的活动字段也用橙色的选中标记图标指示。

该Sales度量已从主要来源和Goals次要来源使用。在这两种情况下，该值都是合计的。的State尺寸是活动的链接字段中，由橙链节图标表示旁边的数据窗格中的字段。两种度量都在州一级汇总（按州划分的销售额，按州划分的Superstore Sales目标Superstore Sales Goals），然后由Tableau根据链接字段的值进行匹配State。

*数据混合将基于链接字段的尺寸值的精确匹配进行。**请小心，因为这可能导致错过一些比赛。**您会在前面的屏幕截图的右下方注意到该指示器，该指示器指示**> 1个null**（至少一个**null**值）。*

*数据的检查表明，**State**在价值**Superstore Sales**是**哥伦比亚特区**，而这是**DC*  *的**Superstore Sales Goals**数据源。**您将需要修复数据源中的值，创建一个计算字段以更改值，或者更改一个数据源中值的别名以匹配另一个数据源中的值。**例如，您可以* *在行标题中**右键单击**“哥伦比亚特区* *”，然后选择**编辑别名...**，并将值设置为**DC。*

我们将在整本书中看到一些编辑别名的示例。请注意以下定义：

*一个***别名***为将被用于显示和数据混合的尺寸值的替代值。**可以通过右键单击行标题或使用视图或“* *数据窗格* *”中字段上的菜单**，然后选择用于编辑别名的选项**来更改尺寸的**别名。*

### 筛选数据 <div id="page_64"></div>

通常，您将需要在Tableau中过滤数据，以便对数据的子集进行分析，缩小焦点或深入研究细节。Tableau提供了多种过滤数据的方法。

如果要将分析范围限制为数据子集，则可以使用以下一种技术在源处过滤数据：

- **数据源过滤器**在所有其他过滤器之前应用，并且在您希望将分析范围限制为数据的子集时很有用。这些过滤器先于其他过滤器应用。
- **提取过滤器**限制提取（.tde或.hyper）中存储的数据。如果提取数据时存在数据源过滤器，则通常会将它们转换为提取过滤器。
- 可以使用与自定义SQL的实时连接来完成**自定义SQL筛选器**，该WHERE子句中具有Tableau参数。我们将在检查参数[第4章](docs/Book.md#page_96)， *启动和冒险计算*。

此外，您可以使用以下一种技术将过滤器应用于一个或多个视图：

- 将字段从数据窗格拖放到“ 过滤器”架子。
- 在视图中选择一个或多个标记或标题，然后选择“仅保留”或“ 排除”，如下所示：

![img](../images/000192.gif)。

- 右键点击数据窗格或视图中的任何字段，然后选择显示过滤器。过滤器将显示为控件（示例包括下拉列表和复选框），以允许视图或仪表板的最终用户更改过滤器。
- 使用动作过滤器。我们将在仪表板的上下文中进一步介绍过滤器和操作过滤器。

每个选项都将一个或多个字段添加到视图的“ 过滤器”功能区。将字段放到“ 过滤器”架子上时，将提示您定义过滤器的选项。取决于字段是离散的还是连续的，过滤器选项的差异将最为明显。将字段作为维度还是作为度量进行过滤将极大地影响过滤器的应用方式和结果。

#### 过滤离散（蓝色）字段 <div id="page_65"></div>

使用离散字段进行过滤时，将为您提供选择保留或排除单个值的选项。例如，当您将不连续的 部门  维度放到“ 过滤器”架子上时，Tableau将为您提供以下选项：

![img](../images/Image%20[49].jpg)

该过滤器选项包括通用，通配符，条件，以及顶部的标签。您的过滤器可以包含每个选项卡中的选项。在总结了上一节常规选项卡将显示选择的所有选项：

- “ 常规”选项卡允许您从列表中选择项目（如果维度包含大量需要长时间加载的值，则可以使用自定义列表手动添加项目。）您可以使用“ 排除”选项排除所选项目。
- 该通配符选项卡允许您匹配字符串值包含，首先，以结束，或完全匹配给定值。
- 使用“ 条件”选项卡，您可以根据满足条件的其他字段的汇总来指定条件（例如，保留任何部门  的总销售额大于$ 1,000,000的条件）。此外，您可以编写自定义计算以形成复杂条件。我们将更多的覆盖计算在[第4章](docs/Book.md#page_96)，*潜水深度与表计算*。
- “ 顶部”选项卡允许您将过滤器限制为仅顶部或底部。例如，您可能决定只保留销售总额中的前五项。

*离散量度（使用表计算的计算字段除外）无法添加到“* *过滤器”功能区**。**如果该字段包含日期或数字值，则可以在过滤之前将其转换为连续字段。**其他数据类型将需要创建一个计算字段，以将您希望过滤的值转换为连续的数值。*

#### 过滤连续（绿色）字段 <div id="page_66"></div>

如果将连续尺寸放置到“ 过滤器”架子上，则会得到不同的选项集。通常，首先会提示您如何过滤字段，如下所示：

![img](../images/Image%20[50].jpg)

这里的选项分为两个主要类别：

- 所有值：过滤器将基于字段的每个单独值。例如，仅使销售额保持在$ 100以上的“ 全值”过滤器将评估基础数据的每条记录，并仅使个体销售额保持在$ 100以上。
- **聚合**：过滤器将基于指定的聚合（例如， 萨姆，平均，最小，最大，标准 偏差， 和 方差）和聚合将在视图的细节水平来执行。例如，一个过滤器仅在类别级别的视图上将销售总额保持在100,000美元以上，则将仅保留总销售额至少100,000美元的类别。

做出选择后（或者如果选择不适用于所选字段），将为您提供另一个界面，用于设置实际过滤器，如下所示：

![img](../images/Image%20[51].jpg)

在这里，您将看到用于基于具有开始和/或结束的范围过滤连续值的选项。“ 特殊”选项卡提供用于显示所有值，NULL值或非NULL值的选项。

#### 筛选日期 <div id="page_67"></div>

我们就来看看特殊的方式在经济表处理日期*可视化日期和时间*的部分[第3章](docs/Book.md#page_70)， *冒险到高级可视化*。现在，请考虑将Order Date字段放到“ 过滤器”架子上时可用的选项 ，如下所示：

![img](../images/Image%20[52].jpg)

这里的选项包括：

- 相对日期：此选项可让您根据特定日期过滤日期（例如，保留从今天开始的最后三周，或从1月1日开始的最后六个月）。
- 日期范围：此选项可让您根据包含开始日期和/或结束日期或两者兼有的范围来过滤日期。
- **日期部分**：此选项可让您根据日期的离散部分（例如年，月，日或部分组合，例如月/年）进行过滤。
- 单个日期：此选项使您可以基于数据中日期字段的每个单独值进行过滤。
- 计数 或计数（不重复）：此选项可让您根据数据中日期值的计数或不重复计数进行过滤。

#### 其他过滤选项 <div id="page_68"></div>

在进行过滤时，您还需要注意以下选项：

- 通过右键单击并选择显示过滤器，可以显示几乎所有字段的过滤器控件。控件的类型取决于字段的类型，无论它是离散的还是连续的，都可以使用过滤器控件右上角的小下拉箭头进行自定义。
- 可以将过滤器添加到**Context中**。首先评估添加到上下文中的所有过滤器，然后将其视为数据的子集。其他过滤器和计算（例如，计算集和固定的详细程度计算）基于数据的子集。例如，如果您希望过滤到前五名客户，但又希望能够首先过滤到特定区域，这将很有用。将Region设置为上下文过滤器可确保在Region过滤器的上下文中计算前五个过滤器。
- 可以设置过滤器以显示数据库中的所有值，上下文中的所有值，层次结构中的所有值或仅基于其他过滤器相关的值。这些选项可通过“ 过滤器”控件上的下拉菜单使用。
- 默认情况下，“ 过滤器”功能区上放置的任何字段都定义特定于当前视图的过滤器。但是，您可以使用“ 筛选器 ”功能区上的字段菜单来指定范围。选择“ 应用于”，然后选择以下选项之一：

- 所有相关的数据源：所有数据源将按指定的值进行过滤。字段的关系与混合相同（即，默认名称和类型匹配，或通过“ 数据” |“ 编辑关系...”菜单选项自定义）。使用任何相关数据源的所有视图都将受到过滤器的影响。此选项有时称为**跨数据源过滤**。
- 当前数据源：该字段的数据源将被过滤。使用该数据源的任何视图都将受到过滤器的影响。
- 选定的工作表：使用该字段的数据源选择的任何工作表都将受到过滤器的影响。
- 当前工作表：仅当前视图将受到过滤器的影响。

- 使用Tableau Server时，您可以定义用户过滤器，以通过基于用户凭据的过滤来提供行级安全性。

### 总结 <div id="page_69"></div>

本章介绍了Tableau如何处理数据的关键概念。尽管您通常不会担心Tableau会生成什么查询来查询基础数据引擎，但是对Tableau的范例有深入的了解将在您分析数据时极大地帮助您。

我们查看了到不同数据源的不同连接的多个示例，考虑了使用数据提取的好处和潜在的弊端，考虑了如何管理元数据，深入研究了联接和混合的细节，最后介绍了过滤数据的选项。

处理数据对于您在Tableau中所做的一切至关重要。当您开始进行更深入的分析和更复杂的可视化时（例如下一章中介绍的内容），了解连接到各种数据源，使用提取，自定义元数据以及联接和混合之间的区别将是关键。

## 第三章 冒险进入高级可视化 <div id="page_70"></div>

现在，您就可以着手设计高级可视化了！Advanced不一定意味着困难，因为Tableau使许多可视化易于创建。高级也不一定意味着复杂。目的是传达数据，而不是使数据不必要地复杂。

而是，这些可视化在某种意义上是高级的，您需要了解何时应使用它们，它们为何有用以及如何利用Tableau的功能来创建它们。另外，我们将看到的许多示例将介绍一些高级技术，例如计算，以扩展基础可视化的实用性。这些技术中有许多将在以后的章节中进行全面开发，因此不必担心现在就尝试吸收每个细节。

本章中的大多数示例都是经过精心设计的，以便您可以继续学习。但是，不要简单地记住一组说明。相反，请花一些时间来了解您放置在不同架子上的不同字段类型的组合如何改变标题，轴和标记的呈现方式。尝试甚至不时偏离说明，只是想看看还有什么可能。您始终可以使用Tableau的后退按钮再次遵循该示例！

在本章中，可视化将分为以下主要类别：

- 比较方式
- 日期和时间
- 整体的一部分
- 发行版
- 多轴

您可能已经注意到前面的列表中缺少空间位置或地理类别。映射年推出的 [第1章](docs/Book.md#page_21)，*高级可视化，技术，技巧，和技巧*。

您可以使用Chapter 03 Starter.twbx工作簿来重新创建本章中找到的示例，甚至可以使用空白工作簿并连接到Hospital Visits.csv文件Learning Tableau/Chapter 03夹中的文件从头开始。完整的示例可以在Chapter 03 Complete.twbx工作簿中找到。

### 比较值 <div id="page_71"></div>

通常，您将需要比较不同类别的测量值之间的差异。您可能会发现自己在问以下问题：

- 每家商店为多少客户提供服务？
- 每个风电场产生多少能量？
- 每位医生看了多少患者？

在每种情况下，您都希望在一些定量测量（客户数量，兆瓦电和患者数量）方面进行比较（在商店，风电场或医生之间）。

#### 条形图 <div id="page_72"></div>

下面是一个简单的柱状图，类似于我们建在一个[第1章](docs/Book.md#page_21)，*以砍掉的Tableau*：

![img](../images/Image%20[53].jpg)

此条形图使您可以轻松比较医院各个部门之间的患者就诊次数。作为维度，Department根据每个不同的值如切片数据ER，ICU或Cardiology。它为这些值创建标题，因为它是离散的（蓝色）。作为一种度量，Number of Patient Visits给出每个部门的患者就诊总数。因为它是一个连续的（绿色）字段，所以它定义了一个轴，并渲染了条形图以使值可视化。

请注意，条形图是按部门进行排序的，患者就诊的总数最高，而底部最低。对条形图进行排序通常会为分析增加很多价值，因为它使进行比较和查看排名顺序变得更加容易。例如，很容易看出**微生物****科比营养**科有更多的患者就诊。如果未对图表进行排序，则可能不那么明显。

您可以通过多种方式对视图进行排序，如下所示：

- **单击工具栏上的排序图标之一**：这将根据定义轴的度量对尺寸进行自动排序。导致新顺序的数据更改或筛选将反映在视图中：

![img](../images/000289.gif)

- **单击轴上的排序图标**：当您将鼠标悬停在轴上时，选项图标将变为可见，然后在启用排序时保留在原处。这也将导致自动排序：

![img](../images/Image%20[54].jpg)

- **使用活动维度字段上的下拉列表，** 然后选择排序以查看和编辑排序选项。您也可以选择清除排序以删除任何排序：

![img](../images/Image%20[55].jpg)

- **拖放行标题**以手动重新排列它们。这将导致无法通过数据刷新来进行手动排序。

这些排序方法中的任何一种都特定于视图，并且将覆盖您在元数据中定义的任何默认排序。

#### 条形图变化 <div id="page_73"></div>

基本条形图可以通过多种方式扩展以实现各种目标。考虑以下变化：

- 项目符号图显示实现目标，指标或阈值的进度
- 条形图显示目标的进度或比较类别中的两个特定值
- 突出兴趣类别

##### 项目符号图与目标，目标或阈值进行比较 <div id="page_74"></div>

甲**子弹图形**（有时也称为**子弹图表**）是一个伟大的方式直观地比较与一个目标，目标，或阈值的量度。条形表示测量值，而线形表示目标。Tableau还默认设置为阴影以指示距目标或阈值的距离的**60％**和**80％**。该线和阴影是可以调整的参考线（我们将在以后的章节中详细探讨）：

![img](../images/000149.gif)

假设医院管理部门已经设定了一些服务时间目标，即患者到达医院与开始接受护理之间的分钟数。主管部门知道每个部门都有独特的功能和要求，因此他们为每个部门定义了不同的目标，如下所示：

![img](../images/Image%20[56].jpg)

您可以在电子表格中维护这些目标（此处Hospital Goals.xlsx位于Chapter 03 文件夹中）。您的目标是创建一个可视化文件，以显示每个部门的实际平均水平，并将其与管理部门设定的目标进行比较。

我们将使用Chapter 3工作簿构建项目符号图，该工作簿包含“ 医院就诊” 和“ 医院目标” 电子表格数据源。按照以下步骤，我们将使用这两个数据源来可视化实际和目标服务分钟之间的关系：

1. 导航至“ 平均 服务时间”（子弹图）表。
2. 使用 Hospital Visits 数据源，创建平均的基本条形图 Minutes to Service 每 Department。（提示：使用“ 行 ” 字段上的下拉箭头选择“ 度量 | 平均”。这将设置适当的聚合）。Minutes to Service
3. Department 从最高到最低 排序。此时，您的视图应如下所示：

![img](../images/Image%20[57].jpg)

1. 在左侧数据窗格中，选择Hospital Goals数据源，然后单击以Minutes to Service Goal在“度量”下的数据窗格中选择字段。

1. 打开“ 向我显示”，然后选择项目符号图。此时，Tableau将使用视图中的Minutes to Service Goal字段和您选择的字段创建项目符号图。您将观察到该Department字段已在数据混合中用于链接两个数据源，并且已启用该Department字段，因为在视图中使用了该字段：

![img](../images/Image%20[58].jpg)

*当您使用“* *向我展示”**来创建项目符号图表时，有时您可能会发现Tableau使用的字段与期望的使用顺序相反（错误的度量定义了坐标轴和条形图，而其他定义了参考线）。**如果发生这种情况，只需右键单击轴并选择“* *交换参考线字段”**。*

使用项目符号图表，可视地标注超出阈值的条形会很有帮助。我们将在下一章中深入研究计算，但是现在，您可以通过以下步骤完成此示例：

1. 单击 Hospital Visits 数据源以将其选中。
2. 在根据数据窗格中右键单击空白处尺寸或措施，并选择创建计算领域。
3. Over Service Time Goal?使用以下代码命名计算字段：

AVG（[服务时数]）> SUM（[医院目标]。[服务时数]）

1. 单击确定并拖动新的Over Service Time Goal？数据窗格中的字段，然后将其放在Col 或上。

如果Average Minutes to Service值大于目标值，则计算返回true ，否则返回false。使用Color上的计算字段，可以很容易地看到哪些部门超出阈值。项目符号图使您可以轻松查看哪些部门已超过了管理部门设置的阈值：

![img](../images/Image%20[59].jpg)

##### 条形图 <div id="page_75"></div>

显示每个类别的两个值之间的关系的另一种可能性是条形图。像项目符号图一样，条形图可以显示实现目标的进度，但也可以用于比较任何两个值。例如，您可以将收入与目标进行比较，或者可以将本年度与上一年的收入进行比较：

![img](../images/Image%20[60].jpg)

若要创建此视图，请在同一工作簿中继续并按照以下步骤操作：

1. 导航到“按年收入”（Bar-in-Bar）表。
2. Revenue 从 数据源拖放到视图中的水平轴上（其结果与将其拖放到“ 列”架子上的结果相同）。Hospital Visits
3. 拖放 Department Type 到Rows上。
4. 拖放 Date of Admit 到Color上。我们将在下一节中更详细地讨论日期，但是您会注意到Tableau使用日期的年份为您提供了一个堆积的条形图，如下所示：

![img](../images/Image%20[61].jpg)

1. 对于条形图，我们不希望将标记堆叠在一起。要关闭堆栈，请使用顶部菜单选择Analysis | 堆叠标记 | 关。
2. 现在，所有条形图段都从**0**开始，但是有些可能会完全重叠。要查看每个栏，我们需要调整另一个视觉元素。在这种情况下，按住*Ctrl*键的同时将“ 标记”卡中“ 颜色”YEAR(Date of Admit) 上当前 的字段拖到“ 大小”中。

*按住**Ctrl键**键，同时从一个货架移动领域到另一个创建领域的复印件。*

完成上一步后，将出现一个图例。条形将根据年份进行大小调整，即使它们重叠，我们也将看到所有可用的细分。

1. 我们希望2018年在前，而 2017  年在背景中，因此在大小图例中拖放2018以重新排列值，以便2017年在2018 年之后：

![img](../images/Image%20[62].jpg)

1. 双击**颜色**图例以编辑颜色，以便强调2018。2018年的橙色或蓝色和2019年的浅灰色将很好地达到此目的（尽管您可能会找到其他喜欢的颜色组合！）。

此时，您的视图应类似于本节开头显示的条形图。您可能希望通过执行以下操作来进一步增强可视化效果：

- 在栏上添加边框。通过单击“ **颜色”**架子并使用“ 边框”选项来完成此操作。
- 调整大小范围以减小大极端与小极端之间的差异。通过双击大小图例（或使用插入符号下拉菜单，然后从菜单中选择编辑）来完成此操作。
- 调整视图的大小。通过将鼠标悬停在画布上的底部边框上方，直到鼠标光标变为大小光标，然后单击并拖动以调整视图大小，即可完成此操作。
- 隐藏大小图例。您可能会决定尺寸图例不向该特定视图添加任何内容，因为尺寸仅用于允许重叠的条形。要隐藏任何图例，请使用图例上的下拉箭头，然后选择“ 隐藏卡片”：

![img](../images/Image%20[63].jpg)

##### 突出兴趣类别 <div id="page_76"></div>

假设您在医院的主要职责之一是监视ICU和新生儿科的患者就诊次数。您不一定要关心其他部门的细节，但是您确实想跟踪两个部门与其他部门的比较情况。您可以设计如下：

![img](../images/Image%20[64].jpg)

现在，随着时间的推移刷新数据，您将能够立即查看您感兴趣的两个部门与其他部门相比的情况。要创建此视图，请按照下列步骤操作：

[1] 导航至ICU和新生儿表。
[2] 广场 Department 上的行和 Number of Patient Visits 在列。将条形图按降序排序。
[3] 单击ICU视图中的栏，然后在*按住Ctrl*键的同时单击Neonatal栏。
[4] 将光标悬停在选定的条形上几秒钟，然后从出现的菜单中单击“ 创建组”按钮（看起来像回形针）：

![img](../images/Image%20[65].jpg)

[5] 这将创建一个组，从而Department (group)在左侧数据窗格中产生一个名为的新维度。Tableau会自动将此字段分配给Color。

> 临时组在Tableau中功能强大。您可以在视图中创建组（如前所述），也可以使用数据窗格中维的菜单并选择创建|创建。组**。**您可以像使用其他任何维度一样使用它们。

[6] 要仅将标签添加到这两个部门的条形图中，请右键单击每个条形，然后选择“ 标记标签 | 总是显示。即使为视图关闭了其他标签，或者标签与标记或其他标签重叠，也始终会显示该标签的标签。

### 可视化日期和时间 <div id="page_77"></div>

在分析中，您通常会希望了解何时发生了什么。您会问如下问题：

- 我们什么时候获得了新客户？
- 一天中什么时候通话量最高？
- 我们在销售和利润中看到哪些季节性趋势？

幸运的是，Tableau简化了这种可视化发现和分析。

#### 日期部分，日期值和确切日期 <div id="page_78"></div>

连接到平面文件，关系或提取的数据源时，Tableau可为任何日期字段提供可靠的内置日期层次结构。

*多维数据集/ OLAP连接不允许使用Tableau层次结构。**您将要确保在多维数据集中定义了所需的所有日期层次结构和日期值。*

看到这个动作，继续与Chapter 3工作簿，导航到内置日期层次 片，并产生类似于这是通过拖放所示的一个视图 Number of Patient Visits ，以行和 Date of Admit 对列。 **列**上的YEAR(Date of Admit) 字段将带有加号指示符，如下所示：

![img](../images/Image%20[66].jpg)

当您单击它时，层次结构将通过 QUARTER(Date of Admit) 在 on Columns的右侧添加来扩展，并且视图将扩展到层次结构的新级别：YEAR(Date of Admit)

![img](../images/Image%20[67].jpg)

YEAR(Date of Admit) 现在， 该字段具有减号指示符，使您可以将层次结构折叠回年份级别。该QUARTER 字段也带有加号，表示您可以进一步扩展层次结构。与今年起，层次流向如下： **年** | **季度** | **月** | **天**。当该字段是日期和时间时，您可以进一步向下钻取到**Hour** | **分钟** | **第二**。层次结构的任何部分都可以在视图内移动或完全从视图中删除。

层次结构由**日期部分**组成，**日期部分**是使用日期字段的三种方式之一。在视图中右键单击日期字段或使用下拉菜单时，您将看到多个日期选项，如下所示：

![img](../images/Image%20[68].jpg)

在菜单中可以看到三种主要的日期类型，尽管没有明确标记：

- **日期部分**：此字段将代表日期的特定部分，例如季度或月份。日期的一部分将单独使用，而不参考日期的任何其他部分。这意味着1980年11月8日的日期（用作月份日期的一部分）就是**11月**。在此处的视图中选择的**11月**代表数据集中的所有11月，而患者就诊次数是2017年和2018年的总数：

![img](../images/Image%20[69].jpg)

- **日期值**：此字段将代表日期值，但会向上滚动或截断为您选择的级别。例如，如果选择月的日期值，则2018年11月8日将被截断为月和年，即**2018年11月**。您会注意到，**2017** **年****11月**和**2018年****11月**在标题和单独的栏中分别具有单独的值：

![img](../images/Image%20[70].jpg)

- **确切日期**：此字段表示数据中的确切日期值（包括时间，如果适用）。这意味着将1980年11月8日上午2:01与1980年11月8日下午3:08区别开来。

重要的是要注意，几乎所有这些选项都可以用作离散或连续字段。日期部分 默认情况下是离散的。 默认情况下，日期值和确切日期 是连续的。但是，您可以根据需要在离散和连续之间切换，以实现可视化的灵活性。

例如，您必须具有一条轴（需要一个连续字段）才能创建参考线。此外，Tableau仅连接行或列标题最低级别的行。使用连续的日期值而不是多个离散的日期部分，将使您可以连接跨越多年，季度和月份的行。

*作为一种快捷方式，您可以右键单击日期字段，然后将其拖放到视图中，以获取选项菜单，以获取在绘制视图之前应如何使用日期字段的选项。*

#### 日期和时间可视化的变化 <div id="page_79"></div>

使用日期的各个部分和值，甚至混合和匹配它们的能力，使您在创建独特而有用的可视化文件时具有很大的灵活性。

例如，对于列使用月日期部分，而对于颜色使用年日期部分，则会得到一个时间序列，这使得逐年分析非常容易。年日期部分已复制到标签，以便可以标记行：

![img](../images/Image%20[71].jpg)

*单击***Marks***卡**上的任何架子，**将为您提供选项菜单。**在这里，* **标签***被点击，标签调整仅在每个行的末尾显示。*

以下热图是使用不同货架上的日期零件来进行有用分析的另一个示例。当查看时间的不同部分（例如一天中的小时或一个月中的几周）的模式时，这种可视化功能非常有用。在这里，我们正在按月和日查看有多少患者入院：

![img](../images/Image%20[72].jpg)

该视图未包括年份，因此这是对数据中所有年份的分析，使我们能够查看是否存在任何季节性模式或热点。我们可能会注意到与流行病，医生的日程安排或保险福利时间有关的模式。也许2月患者入院强度的增加与流感季节相对应。

请注意，在“ **颜色”**架子上放置“ **连续”**字段会导致Tableau 用编码患者访问总和的颜色阴影完全填充“ **行”**和“ **列”的**每个交点。单击**颜色**架子会为我们提供一些微调选项，包括为标记添加边框的选项。此处，添加了黑色边框以帮助区分每个单元格。

#### 甘特图 <div id="page_80"></div>

甘特图对于理解具有持续时间的一系列事件特别有用，尤其是在那些事件具有某种关系的情况下。在视觉上，它们对于确定某些事件是否比其他事件重叠，具有依赖性或花费的时间长或短非常有用。

以下**甘特图**显示了启动应用程序时运行的一系列过程。这些过程中的某些并行运行，而某些显然依赖于其他进程。在**甘特图**，使这些依赖明显：

![img](../images/Image%20[73].jpg)

要在Tableau中创建**甘特图**，可以在标记卡下拉列表中选择甘特标记类型。这将放置一个甘特条形标记，该标记从定义轴的字段所定义的值开始。然后，由**尺寸**卡上的字段定义甘特图条的长度，其中正值向右延伸，负值向左延伸。

在医院，您可能希望查看2018年每位患者去急诊室的情况，并了解每次就诊持续了多长时间，是否有患者返回医院，以及两次就诊之间的间隔时间。以下步骤提供了一个示例，说明如何创建**甘特图**以观察这些模式：

1. 将部门放在过滤器上，仅保留ER。
2. 将准入日期置于过滤器上，选择Years作为过滤选项，并仅保留2018。
3. 将准入日期作为连续的“ 确切日期”或“ 天”值（不是天部分）放置在列上。请注意，Tableau标记类型的自动默认值为甘特线：

![img](../images/Image%20[74].jpg)

1. 将患者姓名放在行上。结果是每个患者一行。甘特图条显示订单日期。在大多数情况下，我们还希望向视图添加唯一的标识符，例如s Patient ID，以确保在可视化中区分碰巧共享相同名称的患者。对于该数据集，这不是必须的，因为所有名称恰好都是唯一的，但是在处理数据时，这可能至关重要。
2. 甘特栏的长度是通过在“ 大小”架子上放置一个具有持续时间值的字段来设置的。此数据集中没有此类字段。但是，我们有排放日期，我们可以为持续时间创建一个计算字段。在下一章中，我们将更详细地介绍计算。现在，从菜单中选择“ 分析 ”，然后单击“ 创建计算字段...”。命名字段 Days in the Hospital并输入以下代码：

DATEDIFF（'day'，[录取日期]，[出院日期]）

1. 新的计算字段将出现在数据窗格的“度量”下。将字段拖放到“ 尺寸”架子上。现在，您将有一个**甘特图，**显示患者入院的时间以及每次就诊的时间。
2. 通过从视图中“ 行”上的字段的下拉菜单中选择“ 排序”，对“ 患者姓名”字段进行排序。选择以下选项：

- **排序依据**：字段
- **排序顺序**：升序
- **字段名称**：录取日期
- **汇总**：最低：

![img](../images/000297.gif)

指定这些选项后，关闭“ 排序[患者名称]”对话框。

通过排序，您可以查看较早入院的患者和较晚入院的患者。即使患者多次入院，也是基于患者的最早（最短）入院日期。排序是查看**甘特图中的**模式的非常有用的技术。您的最终视图应如下所示：

![img](../images/Image%20[75].jpg)

>在日期轴上绘制时，定义甘特图条长的字段始终需要以天为单位。如果要使用以小时或秒为单位的持续时间来可视化事件，请避免使用参数，因为该参数会计算整天，并且会损失小时和秒的精度。而是，以小时或秒为单位计算差异，然后转换回天。以下代码转换开始日期和结束日期之间的秒数，然后除以86,400，将结果转换为天，包括一天中的小数部分：

```Tableau
DATEDIFF('second', [Start Date], [End Date]) / 86400
```

### 将部分数据关联到整体 <div id="page_81"></div>

在浏览和分析数据时，您通常会想要了解各个部分如何加起来成为一个整体。例如，您将询问以下问题：

- 每种发电方式（风能，太阳能，煤炭和核能）对产生的能源总量有多少贡献？
- 每个州赚取的总利润的百分比是多少？
- 每个文件，子目录和目录在硬盘上占用多少空间？

这些类型的问题询问的是零件（生产方法，状态，文件/目录）与整体（能源总量，国内销售和硬盘）之间的关系。有几种类型的可视化和变体可以帮助您进行分析。

#### 堆积条 <div id="page_82"></div>

我们看一看在堆积条形图中[第1章](docs/Book.md#page_21)，*以砍掉的Tableau*，我们注意到一个显著的缺点：它是很难在大多数类别的比较值。除了最左侧（或最底部）的条形以外，其他条形段的起点都不同，因此长度比较起来比较困难。这并不意味着绝不能使用堆叠的条形，但应谨慎操作以确保沟通的清晰度。

在这里，我们使用堆叠的条形图来可视化整体外观。我们不太关注视觉上跨类别的比较，而更关注查看组成一个类别的部分。

例如，在医院，我们可能想知道每种类型的科室中患者的状况。也许每个患者在入院时都被分配了风险简介。我们可以将通过风险概况细分的访问次数可视化为堆积条形，如下所示：

![img](../images/Image%20[76].jpg)

这样可以很好地了解每种部门类型的访问情况。我们可以知道，访问普通科之一的人越来越多，普通科和专科门诊的高危患者数量大致相同。实验室和重症监护室发现高危患者减少，总体患者减少。但这只是故事的一部分。

考虑一个没有给出绝对值，但给出每种部门类型的百分比的堆叠条形：

![img](../images/Image%20[77].jpg)

比较前两个堆叠的条形图。从两个图表中可以明显看出，将近50％的**重症监护**患者被视为**高风险**。但是，第二张图立即使这一点显而易见。

两个图表之间的数据没有任何变化，但是第二个图表中的条形代表每种类型部门的总数百分比。您不再能够比较绝对值，但是比较每种部门类型的相对细分将变得更加容易。尽管**重症监护病房**的患者较少，但高危人群的比例更高。

让我们考虑如何在Tableau中创建上述图表，甚至将其组合为一个可视化文件。我们将使用一个快速的表计算，这将在深度覆盖在[第5章](docs/Book.md#page_121)，*潜水深度与表计算*。在这里，只需点击几下即可实现。

继续Chapter 03 工作簿，请按照下列步骤操作：

1. 通过将创建一个堆积条形图 Department Type 上的行， Number of Patient Visits 上柱，并 Patient Risk Profile 在颜色。现在，您将获得一个堆积的条形图。
2. 将条形图按降序排序。
3. 重复 Number of Patient Visits 实地列按住 *Ctrl键*的同时拖动该 Number of Patient Visits 领域的视图中的一个点上列，应立即到其当前位置的右边。或者，您可以将字段从数据窗格拖放到Columns。在这一点上，您有两个 Number of Patient Visits 轴，实际上是复制堆积的条形图：

![img](../images/Image%20[78].jpg)

1. 使用第二个 Number of Patient Visits 字段 的下拉菜单，选择快速表计算 | 占总额的百分比。该表计算对从数据源返回的值进行辅助计算，以计算总数的百分比。在这里，您将需要进一步指定应如何计算总数。
2. 使用相同的下拉菜单，选择“ 计算使用 | |”。患者风险简介。这会告诉Tableau计算给定部门内每个患者风险状况的百分比。这意味着每个部门的价值总计为100％。
3. 通过单击顶部工具栏上的T按钮打开标签。这将打开每个标记的默认标签：

![img](../images/Image%20[79].jpg)

完成上述步骤后，完成的堆叠条形图应显示如下：

![img](../images/Image%20[80].jpg)

*在单个视图中同时使用绝对值和百分比可以揭示重要的方面和细节，只有其中一个图表可能会掩盖这些方面和细节。*

#### 树状图 <div id="page_83"></div>

树图使用一系列嵌套的矩形来显示整体的一部分，尤其是在层次关系中。当您具有具有**高基数**（大量不同值）的层次结构和维度时，树图特别有用。

这是一个树形图的示例，该树形图显示了患者在医院度过的天数。最大的矩形截面显示Department Type。其中包括科室和患者：

![img](../images/Image%20[81].jpg)

要创建树形图，您只需要在“ 尺寸”架子上放置一个度量，在“  细节”架子上放置一个尺寸。您可以在细节级别添加其他尺寸以增加视图的细节。Tableau将添加不同厚度的边框，以分隔由多个尺寸创建的细节级别。请注意，在前面的视图中，您可以轻松地看到部门类型的划分，然后是部门，然后是医生，最后是个别患者。您可以通过单击颜色架子来调整最低级别的边框。

标记卡上的尺寸顺序定义了树形图对矩形进行分组的方式。此外，您可以向行或列添加尺寸，以将树图切成多个树图。最终结果实际上是树状图的条形图：

![img](../images/Image%20[82].jpg)

前面的树图不仅展示了具有多行（或列）树图的能力，还展示了在“ 颜色”架子上放置多个字段的技术。这只能通过离散字段完成。您可以在*按住Shift*键的同时将第二个字段放在颜色上来分配两种或更多种颜色。或者，可以单击Marks卡上每个字段左侧的图标或空格，以更改用于该字段的架子：

![img](../images/Image%20[83].jpg)

*树形图**以及**填充的气泡**，**词云**和其他一些图表类型被称为***非笛卡尔***图表类型。**这意味着它们绘制时没有**x**轴**或**y**轴，甚至不需要行或列标题。**要创建任何这些图表类型，请执行以下操作：*

- *确保**在行**或**列**上不使用连续字段*  
- *使用任何字段作为***大小***的度量*
- *根据所需的图表类型更改标记类型：用于树形图的正方形，用于填充气泡的圆形或用于词云的文本（在**Label**上具有所需字段**）*

#### 面积图 <div id="page_84"></div>

绘制折线图，然后填写折线下方的区域。如果有多行，则将填充区域彼此堆叠。这就是您可能想到的面积图。

事实上，在画面，你会发现很容易地创建一个折线图，就像你以前做的，然后更改的标记类型标记卡区。Color，Label或Detail架子上的任何尺寸 都将创建一片区域，这些区域将相互堆叠。“ 大小”架子不适用于面积图。

例如，考虑按时间划分的患者就诊可视化图，按医院分支细分：

![img](../images/Image%20[84].jpg)

每个频段代表一个不同的医院分支机构位置。在许多方面，该视图在美学上令人愉悦，并且确实突出了数据中的某些模式。但是，它具有与堆积条形图相同的缺点。根据轴上的值，只能读取底部带（**South**）。

其他频段则堆叠在顶部，很难进行比较。例如，很明显，每年的**2月**都有一个峰值。但是在每个分公司吗？还是较低的频段之一将较高的频段向上推？哪个频段的峰值最大？

现在，考虑以下视图：

![img](../images/Image%20[85].jpg)

此视图使用快速表格计算，类似于堆叠的条形示例。如第一个图表所示，不再可能看到峰值。但是，很容易看到，**东**分行（中带）在2018年**2月**前后看到的患者百分比急剧增加，并且直到该分行结束时，该分行继续看到大量患者。年。

通过选择其他图表类型，了解强调（或隐藏）数据故事的哪些方面非常重要。您甚至可以Chapter 3通过将第一个面积图更改为折线图来在工作簿中进行实验。您可能会注意到，您可以看到峰值，以及每个分支机构的患者访视的绝对增加和减少。每种图表类型都有助于数据故事的某个方面。

*您可以通过更改**Marks* *卡**架子上尺寸的排序顺序来定义区域的堆叠顺序**。**此外，您可以通过在“* **颜色图例”中***拖放它们来重新排列它们，**以进一步调整顺序。*

#### 饼状图 <div id="page_85"></div>

饼图也可以用于显示零件之间的整体关系。要在Tableau中创建饼图，请将标记类型更改为Pie。这将为您提供一个角度架，可用于对度量进行编码。无论您在标记卡上放置的尺寸（通常在**颜色**架子上）如何，都将定义饼图的切片：

![img](../images/Image%20[86].jpg)

观察前面的饼图使用收益之和定义每个切片的角度；总和越高，切分越宽。该**医院分院**维度切片的措施和规定的馅饼切片。此视图还演示了在“ **标签”**架子上放置多个字段的能力。第二个 SUM(Revenue) 字段是您之前看到的总表计算的百分比。这使您可以查看收入的绝对值以及全部收入的百分比。

*饼图可以很好地配合使用。**在大多数情况下，很难看到和理解超过两个或三个。**同样，作为一种好习惯，请通过对定义切片的维进行排序来对切片进行排序。**在前面的示例中，“* **医院分支”***维度按**SUM**收入递减的**排序* *。**这是通过使用下拉菜单选项完成的。**这将导致切片按从最大到最小的顺序排列，并且即使在大小和角度几乎相同的情况下，任何阅读图表的人都可以轻松查看哪些切片更大。*

### 可视化分布 <div id="page_86"></div>

通常，仅了解总数，总和，甚至是零件之间的细分，也只能提供整体情况。大多数时候，您会希望了解单个项目在所有相似项目的分布中的位置。

您可能会发现自己在问如下问题：

- 每个客户在我们的商店花多少钱，与所有其他客户相比如何？
- 我们大多数患者在医院待多长时间？哪些患者不在正常范围内？
- 机器中组件的平均预期寿命是多少？哪些组件高于或低于该平均值？是否有寿命极长或极短的组件？
- 学生的考试成绩是高于还是低于及格？

这些问题都有相似之处。在每种情况下，您都希望了解个人（患者，组成部分，学生）与小组的关系。在每种情况下，您最有可能拥有相对较高的人数。用数据的术语来说，您有一个维度（客户，患者，组成部分和学生）代表相对较大的一群人，并且要比较一些度量（花费的金额，停留的时间，预期寿命，测试分数）。使用以下一种或多种可视化效果可能是实现此目的的好方法。

#### 圆图 <div id="page_87"></div>

圆图是一种可视化分布的方法。考虑以下视图，该视图显示了根据开始治疗患者所需的平均分钟数，每个医生与同类部门内其他医生的比较：

![img](../images/Image%20[87].jpg)

在这里，您可以很容易地看出，就开始治疗病人而言，某些医生的平均表现要好于或差于其他人。还有趣的是，某些类型的部门平均需要花费更多或更少的时间。这很有意义，因为每种类型的部门都有不同的约束条件和操作程序。在某些部门，时间比其他部门更为关键。能够评估其所属部门中的医生，使比较变得更加有意义。

要创建前面的圆形图，您需要将字段放在显示的架子上，然后将标记类型从“ 自动”（以前是条形标记）更改为Circle。Department Type定义行，并在Doctor级别（在Marks卡上的Detail级别）上绘制每个圆圈。最后，要添加平均线，只需切换到左侧边栏的“ 分析”选项卡，然后将“ **平均线”**拖动到视图，特别是将其拖放到“ 单元格”选项上：

![img](../images/Image%20[88].jpg)

您也可以单击所得平均线之一，然后选择“ 编辑”以找到微调选项，例如标签。

##### 抖动 <div id="page_88"></div>

当使用圆形图或其他类似的可视化类型的视图时，您经常会看到标记重叠，这可能导致掩盖真实故事的一部分。仅通过观察，您是否可以肯定地知道，只有重症监护中的医生高于平均水平，而只有两名低于平均水平？还是可能存在两个或多个完全重叠的圆圈？最小化此方法的一种方法是单击“ 颜色”架子，并为每个圆添加一些透明度和边框。另一种方法是称为**抖动**的技术。

**抖动***是数据可视化中的一种常见技术，该技术涉及在可视化中添加一些有意的噪声，以避免重叠而又不损害通信内容的完整性。**艾伦·艾德里奇（Alan Eldridge）和史蒂夫·韦克斯勒（Steve Wexler）都是开创Tableau抖动技术的先锋。**通过在**Tableau论坛上**搜索**抖动**或**使用搜索引擎进行**Tableau抖动**，可以找到*

*各种抖动技术，例如使用**Index()* *或**Random()**功能**。*

这是一种使用Index()沿着Doctor计算的函数作为Rows上连续字段的方法。由于索引是连续的（绿色），因此它定义了一个轴并导致圆垂直展开。现在，您可以更清楚地看到每个单独的标记，并更有把握地确信重叠不会遮盖数据的真实图像。您可以在多种可视化中使用抖动技术：

![img](../images/Image%20[89].jpg)

*在上一个视图中，“* *索引”**字段**创建的垂直轴被**隐藏。**您可以通过使用定义轴或标题的字段的下拉菜单并取消选中“* *显示标题”**来隐藏轴或标题**。**或者，您可以右键单击视图中的任何轴或标题，然后选择相同的选项。*

#### 箱须图 <div id="page_89"></div>

箱形图和 晶须 图（有时也称为**箱形图**）为分布增加了额外的统计上下文。要了解箱形图和晶须图，请考虑下图：

![img](../images/Image%20[90].jpg)

此处，箱形图已添加到圆形图中。该框除以中位数，这意味着一半的值在上方，另一半在以下。该框还指示了上下四分位数，每个四分位数都包含值的四分之一。框的跨度构成了**四分位间距**（**IQR**）。晶须延伸到IQR值的1.5倍（或数据的最大范围）。晶须以外的任何痕迹都是异常值。

要添加箱形图和晶须图，请使用左侧边栏上的“ 分析”选项卡，然后将“ **箱形图”**拖到视图中。对我们之前考虑的圆形图执行此操作，将产生以下图表：

![img](../images/Image%20[91].jpg)

箱形图帮助我们查看和比较中位数，数据范围，值的集中度以及任何离群值。您可以通过单击或右键单击方框或晶须并选择编辑来编辑方框图。这将显示多个选项，包括应如何绘制晶须，是否仅显示异常值以及其他格式设置可能性。

#### 直方图 <div id="page_90"></div>

显示分布的另一种可能性是使用直方图。一个柱状图类似于条形图，但是条显示的值发生计数。例如，寻找成绩篡改证据的标准化考试审核员可能会构建学生考试成绩的直方图。通常，分布可能如下所示：

![img](../images/Image%20[92].jpg)

测试成绩显示在*x*轴上，每个横条的高度显示做出该特定成绩的学生人数。一个典型的分布应该具有相当容易辨认的钟形曲线，其中一些学生表现不佳，一些学生表现极好，而大多数则跌落到中间。

如果审计师看到这样的事情怎么办？

![img](../images/Image%20[93].jpg)

显然是错误的。也许是一年级生把那些不及格的学生丢给了勉强及格的学生。这也可能表明主观评分存在偏差，而不是公然篡改。我们不应该得出结论，但是这种模式是不正常的，需要进行调查。直方图对于捕获这样的异常非常有用。

假设您想查看开始患者治疗所需时间的直方图。您可能从空白视图开始，并遵循以下步骤：

1. 单击以选中 数据窗格中“度量”下的Minutes to Service 字段。
2. 如有必要，展开显示我，然后选择直方图。

选择直方图后，Tableau会通过创建Minutes to Service (bin)视图中使用的新维度以及来渲染视图的COUNTof Minutes to Service来构建统计图：

![img](../images/Image%20[94].jpg)

您可以看到曲线，该曲线仅在40分钟以上达到峰值，然后逐渐变细，一些患者不得不等待长达110分钟。直方图的关键是bin。

**Bin***是度量值范围，可用作维度以切片数据。**您可以将垃圾箱视为水桶。**例如，您可能以0-5％，5-10％等的方式查看测试分数，或者以0-10、10-20等的方式查看人们的年龄。**您可以在创建垃圾箱时设置其大小或范围，并可以随时对其进行编辑。**Tableau还将根据查看数据中存在的值的算法来建议垃圾箱的大小。**Tableau将对所有垃圾箱使用统一的垃圾箱大小。*

您可以通过右键单击一个数字字段并选择“ 创建” |“  自己”来创建新的垃圾箱。垃圾箱。您也可以通过右键单击bin字段本身并选择Edit来编辑现有的bin字段。首次创建垃圾箱（或Tableau基于Show Me创建一个垃圾箱）时，Tableau使用一种算法来确定垃圾箱的最佳大小。

对于您之前创建的直方图，大小设置为6.5分钟。在这种情况下，这可能不是最有助于理解数据的方法，因此您可能希望通过以下方法来编辑箱的大小：右键单击数据窗格中“ 维度”Minutes to Service (bin)下的字段，选择“ 编辑”，然后将大小调整为更直观的方式，如：5

![img](../images/Image%20[95].jpg)

您还需要确定要为每个bin计数的数量并将其放在Rows上。当您使用Show Me时，Tableau将 COUNT of Minutes to Service 放在on Rows上，这只是该值不为null的每条记录的计数。在这种情况下，这相当于患者就诊次数。但是，如果您要计算不重复患者的数量，则可以考虑使用替换视图中的字段 COUNTD([Patient ID])。

就像日期一样，当视图中的bin字段是离散的时，下拉菜单包括一个用于显示缺失值的选项。如果使用离散的bin字段，则可能希望使用此选项以避免扭曲可视化效果并确定数据中未出现哪些值。

### 可视化多个轴以比较不同的度量 <div id="page_91"></div>

通常，您需要使用多个轴来比较不同的度量，了解相关性或以不同的详细程度分析同一度量。在这些情况下，您将使用不止一个轴的可视化。

#### 散点图 <div id="page_92"></div>

一个散点图是理解两项措施之间的关系的极其重要的可视化类型。当您发现自己提出如下问题时，请考虑一个散点图：

- 我在营销上花了多少钱才能真正改变销售量？
- 每种加热/冷却方式的功耗会增加多少？
- 学习时间与考试成绩之间是否有相关性？

这些问题中的每一个都试图了解两个度量之间的相关性（如果有）。散点图非常适合查看这些关系以及查找异常值。

考虑以下散点图，该散点图用于查找平均服务时间与医院平均停留天数之间的关系，并按部门类型和医生细分：

![img](../images/Image%20[96].jpg)

的尺寸 Department Type 和 Doctor 所述上标记卡定义详细的视图级别。已使用颜色来轻松查看每个医生所执业的科室类型。视图中的每个标记代表部门类型的医生所见患者的平均服务时间和平均住院天数。每个圆圈的大小表示该医生看过的患者总数。

每位医生的服务时间和住院天数之间似乎没有太多相关性。但是，散点图对于查看某些部门内医生的某些分组模式很有用，并且还说明了重症监护（右上角的标记）可能是异常值。

#### 双轴和组合图 <div id="page_93"></div>

Tableau中的一个非常重要的功能是使用双轴的功能。散点图使用两个轴，但他们是X和Y ^。您还在堆叠的条形示例中观察到，在行或列上彼此相邻放置多个连续（绿色）字段会导致多个并排的轴。另一方面，双轴意味着视图使用的两个轴彼此相反，且具有共同的窗格。

这是对Sales和使用双轴的示例视图Profit：

![img](../images/Image%20[97].jpg)

该视图有几个关键功能，如下所示：

- 行上的Sales 和 Profit 字段通过共享展平的一面表示它们具有双轴。
- Sales 和 定义的轴Profit 位于视图的相对侧。另外，请注意它们不同步，这在许多情况下会导致数据视图失真。如果利润接近总销售额，那就太好了！但事实并非如此。要同步轴，请右键单击右轴，然后选择“ 同步轴”。如果该选项显示为灰色，则可能其中一个值是整数类型，而另一个值是十进制类型。您可以通过在数据窗格中右键单击并选择Change Data Type |来更改字段之一的数据类型。数字（整个）或数字（十进制）。
- 该标志卡现在是一个手风琴状与控制的所有部分以及一个用于 Sales 和 Profit。你可以用它来定制的所有措施商标或专门定制标记的两种 Sales 或 Profit。

要创建双轴，请将两个连续的（绿色）字段拖放到“ 行”或“ 列”上，然后使用第二个下拉菜单，然后选择“ 双轴”。或者，您可以将第二个字段放到画布上与现有轴相反的位置。

*双轴可与**定义轴的**任何***连续***字段**一起使用**。**这包括定义地理可视化的数字字段，日期字段以及纬度或经度字段。**如果是经度或纬度，只需复制一个字段并将其紧挨着放在“* *行”**或“* *列”**架子上即可。**然后，**使用下拉菜单**选择“* *双轴”**。*

甲组合图表延伸使用双轴的叠加不同类型的标记。这是可能的，因为“ 标记”卡将提供用于编辑所有标记或为每个轴定制标记的选项。

*每当“* *行”**或“* *列”**上两个或多个连续字段彼此相邻时，就可以使用多种标记类型**。*

作为组合双轴图表的示例，请考虑以下可视化：

![img](../images/Image%20[98].jpg)

该图表使用条形和线条组合来显示一段时间内的患者就诊总数（使用条形图）以及医院分支机构随时间推移的患者就诊细目（使用线）。这种可视化可以非常有效地为细节提供额外的上下文。

关于此视图，需要注意几件事：

- “ 颜色”架子上的字段在 标记卡上列出为，Multiple Fields 并且为灰色。这表明在Marks上每个轴的Color都使用了不同的字段。
- 该视图演示了在同一视图中混合细节级别的能力。条形图是在最高级别绘制的（每个月的病人拜访），而线形图是在较低级别绘制的（每个月每个分支的病人拜访）。
- 该视图演示了在同一架子（本例中为Rows）上多次使用同一字段（本例中为Patient Visits）的能力。
- 第二个轴（右侧的Patient Visits字段）具有隐藏的标题，以从视图中删除冗余。您可以通过取消选中做这个展会Header在视图上的字段从下拉菜单或右键单击轴或头要隐藏。

双轴和组合图为混合标记类型和详细程度提供了广泛的可能性，对于生成独特的见解非常有用。在本书的其余部分中，我们将看到更多这些示例，但是绝对可以尝试使用此功能，并让您的想象力随处可见。

### 总结 <div id="page_94"></div>

在本章中，我们已经介绍了很多内容！现在，您应该掌握何时使用某些类型的可视化效果。您对数据提出的问题类型通常会导致您进入某种类型的视图。您已经探索了如何创建这些各种类型，以及如何使用各种高级技术来扩展基本的可视化效果，例如计算字段，抖动，多种标记类型和双轴。在此过程中，我们还介绍了有关Tableau中日期如何工作的一些细节。

希望本章中使用计算的示例激发您学习更多有关创建计算字段的兴趣。在Tableau中创建计算的能力为扩展对数据的分析，计算结果，自定义可视化以及创建丰富的用户交互性开辟了无限的可能性。在接下来的两章中，我们将深入计算，以了解它们是如何工作的以及它们可以做什么令人惊奇的事情。

