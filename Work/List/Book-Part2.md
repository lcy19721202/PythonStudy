<!-- markdownlint-disable-file MD033 -->

# 第二部分：充分利用Tableau的强大功能 <div id="page_95"></div>

本节说明如何使用Tableau的高级功能。 您将学习使用计算来解决挑战，设计交互式仪表板以及利用强大的视觉和统计功能。

本节包括以下章节：

- [第4章](docs/Book.md#page_96)，*第四章 通过计算开始冒险*
- [第5章](docs/Book.md#page_121)，*深入探讨表计算*
- [第6章](docs/Book.md#page_146)，*使视觉效果看起来不错并且工作良好*
- [第7章](docs/Book.md#page_160)，*第七章 使用仪表板讲述数据故事*
- [第8章](docs/Book.md#page_185)，*深入挖掘–趋势，聚类，分布和预测*

## 第四章 通过计算开始冒险 <div id="page_96"></div>

我们已经了解到，只需连接到数据并拖放字段，Tableau就能实现惊人的发现，分析和数据故事讲述。现在，我们将第四章 通过计算开始冒险。

计算极大地扩展了Tableau中分析，设计和交互性的可能性。在本章中，我们将看到如何以多种不同方式使用计算。我们将看到如何使用计算来解决数据的常见问题，如何通过添加新的维度和度量来扩展数据以及在交互性方面提供更多的灵活性。

同时，尽管计算提供了难以置信的功能和灵活性，但它们却带来了一定程度的复杂性和复杂性。在学习本章时，请尝试了解Tableau中计算工作原理背后的关键概念。像往常一样，跟随示例，但随时可以进行探索和实验。目标不仅是提供可复制的计算列表，而且还应了解如何使用计算来解决问题并向可视化和仪表板添加创意功能。

本章的前半部分着重于奠定基础，而后者则提供了许多实际示例。我们将在这里研究的主题如下：

- 创建计算
- 四种主要计算类型概述
- 行级示例
- 聚合级别的示例
- 详细程度示例
- 参量
- 实际例子
- 性能考量

在下一章中，我们将检查表的计算。

### 计算导论 <div id="page_97"></div>

在Tableau中，计算通常被称为“ **计算字段”**，因为在大多数情况下，创建计算时，它将在数据窗格中显示为新度量或维。计算由代码，功能，操作以及对其他字段，参数，常量，组或集合的引用组成。此代码返回一个值。有时，此结果是每行数据，有时是在聚合级别完成。我们将尽快考虑差异。

#### 创建和编辑计算 <div id="page_98"></div>

有多种方法可在Tableau中创建计算字段：

- 选择分析 | 从菜单中创建计算字段...。
- 使用数据窗格中“ 维度”旁边的下拉菜单：

![img](../images/Image%20[99].jpg)

- 在数据窗格中右键单击空白区域，然后选择创建计算域...。
- 使用数据窗格中字段，集合或参数上的下拉菜单，然后选择“ 创建” |“设置”。计算字段...。
- 双击“ 行”，“ 列 ”或“ 度量值”架子上的空白区域，或在“ 标记”卡上的空白区域中双击以创建临时计算。

从现有字段或参数开始计算时，该计算将作为对该字段的引用而开始。您创建的计算字段将成为创建时当前选定的数据源的一部分。您可以使用下拉菜单并选择编辑...在数据窗格中编辑现有的计算字段。

用于创建和编辑计算的界面如下所示：

![img](../images/Image%20[100].jpg)

该窗口具有几个主要功能：

- **计算字段名称**：在此处输入**计算字段的名称**。创建后，计算所得的字段将在数据窗格中显示为字段，并带有您在此文本框中输入的名称。
- **代码编辑器**：在此文本区域中输入代码以执行计算。该编辑器包括已识别字段和功能的自动完成功能。此外，您可以将字段，集合和参数从数据窗格中拖动或查看到代码编辑器中，以将它们插入代码中。

*您也可以在代码编辑器窗口中选择代码片段，然后将所选文本拖放到数据窗格中以创建其他计算字段。**您也可以将选定的代码段从“代码”窗口拖放到视图中的架子上，以进行**临时计算。**这**是测试复杂计算部分的有效方法。*

- 编辑器底部的指示器将警告您代码中的错误。此外，如果在视图或其他计算字段中使用了计算，您将看到一个下拉指示器，可让您查看相关性。单击“ 应用”按钮，将更改应用于整个工作簿，同时保持计算编辑器处于打开状态。“ 确定”按钮将保存代码更改并关闭编辑器。如果您希望放弃所做的任何更改，请单击右上角的X按钮以取消更改。

- 函数列表包含您可以在代码中使用的所有函数。其中许多功能将在示例中使用或在本章中讨论。Tableau根据其总体用途将各种功能分组：

  - **Number**：数学函数，例如舍入，绝对值，trig函数，平方根和指数。
  - **字符串**：对字符串操作有用的函数，例如获取子字符串，在字符串中查找匹配项，替换字符串的一部分以及将字符串值转换为大写或小写。
  - **日期**：对日期处理有用的功能，例如查找两个日期之间的差，为日期添加间隔，获取当前日期以及将非标准格式的字符串转换为日期。
  - **类型转换**：可用于将一种类型的字段转换为另一种类型的函数，例如将整数转换为字符串，将浮点小数转换为整数或将字符串转换为日期。
  - **逻辑**：决策功能，例如if then else逻辑或case语句。
  - **聚合**：用于**聚合的**函数，例如求和，获取最小值或最大值或计算标准差或方差。
  - **传递**：（仅在实时连接到某些数据库（例如SQL Server）时可用）：这些函数使您可以将原始SQL代码传递给基础数据库，并在行级别或聚合级别检索返回的值。
  - **用户**：用于获取用户名并检查当前用户是否为组成员的功能。这些功能通常与逻辑功能结合使用，以自定义用户的体验或在发布到Tableau Server或Tableau Online时实现基于用户的安全性。
  - **表格计算**：这些功能彼此不同。在从基础数据源返回聚合数据*之后*以及在呈现视图之前，它们对聚合数据*进行*操作。这些是Tableau中一些最强大的功能。我们将为他们专门写一整章，以便我们涵盖它们。

- 在列表中选择一个功能或单击代码中的字段，参数或功能将在右侧显示有关选择的详细信息。当在代码中嵌套其他计算字段时，当您想要查看该特定计算字段的代码时，或者当您想要了解函数的语法时，这将非常有用。

#### 附加功能和运算符 <div id="page_99"></div>

Tableau支持许多功能和运算符。除了计算屏幕上列出的功能之外，Tableau还支持以下运算符，关键字和语法约定：

- **AND**：逻辑*和*  两个布尔（true/ false）值或语句之间
- **OR**：逻辑*或*  两个布尔值或语句之间
- **NOT**：逻辑上*不*  取反布尔值或语句
- **=**或**==**：逻辑*相等以*测试两个语句或值是否相等（单或双等号在Tableau语法中等效）
- **+**：数字或日期值的附加或字符串的并置
- **-**：减去数字或日期值
- *****：数值相乘
- **/**：数值的除法
- **^**：用数值提高到幂
- **（）**：括号定义操作顺序或包含函数参数
- **[]**：方括号括起来的字段名称
- **{}**：花括号括起来的详细程度计算
- **//**：双斜线开始评论

*在计算中使用时，可以将单个单词的字段名称括在方括号中。**带有空格，特殊字符或来自辅助数据源的字段名称必须放在方括号中。*

#### 四种主要计算类型 <div id="page_100"></div>

我们前面提到的功能分组对于理解哪种功能是重要的。但是，了解Tableau中的计算的最基本方法是考虑四种主要类型的计算：

- **行级计算**：这些计算是针对基础数据的每一行执行的。
- **聚合级计算**：这些计算是在聚合级执行的，聚合级通常由视图中使用的维定义。
- **详细级别计算**：这些特殊计算是在指定的详细级别执行的聚合，结果在行级别可用。我们将在本章后面详细介绍这些内容。
- **表格计算**：这些计算是在数据源已返回Tableau的汇总数据表上的汇总级别上执行的。

*了解和认识四种主要计算类型将使您能够利用Tableau中的计算能力和潜力。*

在本章中，我们将仔细研究Tableau中四种主要的计算类型中的三种：行级别，聚合级别和明细级别。我们将深入到表计算 在下一章中，详细 [第5章](docs/Book.md#page_121) ， *潜水深度与表计算*。

#### 示例数据 <div id="page_101"></div>

在开始一些示例之前，让我们考虑一个示例数据集，该数据集将用于本章中的示例。它既简单又小巧，这意味着我们将能够轻松地看到计算是如何完成的。

此数据集包含Vacation Rentals.csv在\Learning Tableau\Chapter 04本书资源的目录中，也包含在 Chapter 4工作簿中作为名为的数据源Vacation Rentals：

| **出租物业**   | **名字** | **姓**   | **开始** | **结束** | **折扣** | **出租** |
| -------------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 112-阿瓦隆海岸 | 玛丽     | 里瑟     | 十二月2  | 12月9    | $ 150    | $ 1,500  |
| 112-阿瓦隆海岸 | 艾米     | 卡迈克尔 | 12月9    | 十二月15 | $ 0      | $ 1,500  |
| 155海滩微风    | 查尔斯   | 雷里     | 十二月2  | 12月9    | $ 260    | $ 1,300  |
| 155海滩微风    | 德怀特   | 五旬节   | 十二月16 | 十二月23 | $ 280    | $ 1,400  |
| 207-海滩微风   | 刘易斯   | 金龟子   | 12月9    | 十二月23 | $ 280    | $ 2,800  |
| 207-海滩微风   | 约翰     | 沃尔沃德 | 十二月2  | 12月9    | 0        | $ 1,500  |

数据集描述了几个度假出租物业，出租人，出租期的开始和结束日期，折扣和租金。

### 行级计算 <div id="page_102"></div>

我们可能知道，假期出租数据中出租单元的命名约定实际上为我们提供了房间号和建筑物名称。例如，名为**207-Beach Breeze**的单元是Beach Breeze公寓大楼的207室。

在Chapter 04工作簿中，创建几个计算字段。

Room用以下代码命名第一个：

SPLIT（[出租物业]，“-”，1）

然后，创建另一个Building使用以下代码命名的计算字段：

SPLIT（[出租物业]，“-”，2）

这两个函数都使用该Split()函数，该函数将字符串拆分为多个值并保留其中一个值。此函数采用三个参数：**字符串**，**定界符**（用于分隔值的字符或字符集）和令**牌号**（要保留在拆分中的值，即1st，2nd，3rd等）。使用- （破折号）作为分隔符，则Room是第一个值，Building而第二个是值。

使用两个计算出的字段，创建一个Revenueper Building和的条形图Room，类似于此：

![img](../images/Image%20[101].jpg)

在Building和Room下数据窗格中的字段显示尺寸。所计算的尺寸可以像其他尺寸一样使用。他们可以对数据进行切片，定义详细程度以及对度量进行分组。

行级计算是在行级计算的，但是您可以选择汇总结果。例如，您可以合计找到最高的Room number (MAX)或计算的不同数量Buildings (COUNTD)。实际上，如果行级计算的结果为数字，则默认情况下，Tableau通常会将结果字段置于“度量”下。如前所述，可以通过将字段的默认用法从度量更改为维度，反之亦然，方法是将其拖放到数据窗格中。

请注意，Tableau在数据窗格中的字段图标上添加了一个小等号，以指示它们是计算字段：

![img](../images/Image%20[102].jpg)

这两个计算字段的代码针对每行数据执行，并返回行级值。我们可以通过检查源数据来验证代码是否在行级别上运行。只需单击维度旁边的“  查看数据”图标以查看行级别的详细信息（位于上一个屏幕快照中的放大镜图标旁边）。在这里，可以清楚地看到Building和Unit的新字段以及行级值：

![img](../images/Image%20[103].jpg)

*Tableau实际上提供了拆分字段的快捷方式。**您可以使用数据窗格中某个字段上的下拉菜单，然后选择“* *变换”* *|“* *变换”**。**拆分**或**变换* *|* *自定义* *拆分**（如果您使用非标准的定界符）。**结果是与先前创建的字段相似的计算字段，但在确定数据类型方面带有一些其他逻辑。* **转换** *功能（例如拆分）也可用于* *“* *数据源”* *屏幕**上“* *预览”* *或“* *元数据”* *视图* *中的字段**。*

您还可以构建使用其他计算的计算。这称为**嵌套**，而所得的计算称为**嵌套计算**。

例如，假设您知道房间的楼层由房间号指示。从100到199的房间在二楼，从200到299的房间在二楼。您希望该信息可供分析。

我们可能会将此属性添加到源数据中，但是有时这可能不是一种选择，或者是不可行的。我们可能无权更改源数据，或者源可能是每天自动生成的电子表格，所有更改都将被覆盖。

相反，我们可以在Tableau中创建行级计算以扩展数据。为此，创建一个Floor使用以下代码命名的计算字段：

IF LEFT（[Room]，1）=“ 1”

然后“第一层”

ELSEIF LEFT（[Room]，1）=“ 2”

然后“第二层”

结束

此代码使用该LEFT()函数返回房间的最左边字符。因此，112给出结果1；207的结果为2。该IF THEN END逻辑允许我们的结果分配（或者First Floor 或Second Floor），这取决于该情况下是真实的。请注意，您Room在计算中使用了该字段，而该字段又是另一个计算。您可以使用的嵌套级别没有限制。

*每次在Tableau中编写计算时都会问自己几个很好的问题，如下所示：* *如果数据更改，会发生什么？* *我有没有盖过每一种情况？* *例如，仅当所有房间都是100或200层房间时，上一层计算才起作用。**如果有一个房间，306，在3* *次**楼，或者房间，822，在8* *个**楼？*

为了考虑其他情况，我们可以将计算简化为以下内容：

左（[Room]，1）

此代码仅返回房间号的最左字符。我们会得到3 的306和8 为822。但是，如果我们有房号，如1056的10 个楼层和1617 16号？我们必须考虑其他选项，例如：

MID（[Room]，0，LEN（[Room]）-2）

尽管这更复杂，但是字符串函数返回的子字符串从字符串的开头开始，但在最后两个字符之后停止。那给我们10 提供了基础1025，也为我们提供18 了基础1856。

为了总结我们的行级示例，让我们再创建一个计算。Full Name使用以下代码创建一个新的计算字段：

[名字] +“” + [姓氏]

这段代码将的字符串串联在一起，First name并Last Name在它们之间有一个空格。现在，我们只有一个字段，它将显示单个租户的全名。

### 聚合级别的计算 <div id="page_103"></div>

我们已经在Tableau中考虑了汇总，例如sum，min和max。通常，您将字段用作视图中的简单聚合。但是有时候，您可能想在更复杂的计算中使用聚合。

例如，您可能想知道打折后租金的百分比。数据中没有此类字段。它不能真正存储在源中，因为值会根据视图中显示的详细程度而变化（例如，单个单元的折扣百分比将与每层或每栋建筑物的折扣百分比不同）。相反，它必须作为一个汇总进行计算，并随着详细程度的变化而重新计算。

让我们创建一个Discount %使用以下代码命名的计算：

SUM（[折扣]）/ SUM（[出租]）

此代码表明的总和Discount应除以的总和Rent。这意味着Discount将添加所有的值，Rent并将添加所有的值。只有在计算了总和之后，才会进行除法运算。

一旦你创建的计算，你会注意到的Tableau放置在新领域的措施。Tableau  默认将所有带有数字结果的计算放在“度量”下，但是如果需要，您可以将行级计算更改为维。但是，在这种情况下，您甚至无法将新字段重新定义为维度。这样做的原因是，无论返回哪种数据类型，Tableau都会将每个聚合计算视为一种度量。这是因为合计计算取决于尺寸来定义执行计算的详细程度。因此，汇总计算不能是维度本身。

*由于计算值是百分比，因此您可能还需要将格式定义为百分比。**为此，右键单击***Discount％***字段，选择***Default Properties** *|* **Default***。***数字格式***，然后选择***百分比***。**如果需要，您可以调整显示的小数位数。*

现在，创建几个视图，以查看计算如何返回不同的结果，具体取决于视图中的详细程度。首先，我们将构建一个视图来查看每个单独的租赁期：

1. 广场Building，Room，Full Name，Start，和End 上**行**。
2. 在数据窗格中，根据办法，双击每个以下字段：Rent，Discount，和Discount %。Tableau将使用Measure Names和将所有这些措施放置在视图中Measure Values。
3. 重新排列上的字段Measure Values架子，这样的顺序是Rent，Discount和Discount %：

![img](../images/Image%20[104].jpg)

您可以看到每个租期以折扣方式给出的百分比。但是，请注意，当删除除Building和以外的所有字段时，值将如何更改Room：

![img](../images/Image%20[105].jpg)

为什么值会改变？因为聚合取决于定义视图详细程度的维度。在第一种情况，Building和Room，Full Name，Start，和End所定义的细节视图中的水平。因此，计算将每个租赁期的所有租金与该租赁期的所有折扣相加，然后除以它们。在第二种情况下，Building和Room重新定义信息的详细程度。因此，计算将每个建筑物和房间的所有价格与每个建筑物和房间的所有折扣相加，然后将它们相除。

*Measure Names**和**Measure Values**是出现在每个数据连接中的特殊字段（分别在“* *尺寸”**部分和**“度量”**部分**的底部**）。**它们充当在视图中共享同一空间的多个度量的占位符。**例如，在您刚创建的视图中，三个测量了窗格中的所有共享空间。**Measure Values**“在**文本上”**表示**Measure Values**应将架子**上的所有度量值**显示为文本。**的**Measure Names**上字段**列**创建了一列用于每个度量，与该量值的名称的值。*

请注意，如果您查看整个数据集而不按任何维度切片，则值将按预期再次更改：

![img](../images/Image%20[106].jpg)

*使Tableau* *实施**Measure Names**/的**Measure Values**一种简单方法**是记住，**只要您想在视图的同一空间中使用两个或多个度量**，* *就可以使用它们**。*

#### 为什么行级/聚合级差异很重要 <div id="page_104"></div>

假设您Discount % (row-level)使用以下代码创建了一个计算：

[折扣] / [出租]

该代码与您之前创建的汇总计算不同，后者具有以下代码：

SUM（[折扣]）/ SUM（[出租]）

这是结果的巨大差异：

![img](../images/Image%20[107].jpg)

为什么结果会有如此差异？这是执行计算方式的结果。

请注意，它作为SUM Discount % (row-level)出现在Measure Values架子上。这是因为该计算是行级计算，因此它逐行获取计算，然后在确定所有行级值之后将其汇总为度量。您看到的60％值实际上是在基础数据的每条记录中计算出的百分比之和。

实际上，执行行级计算然后进行最终聚合是这样的：

![img](../images/Image%20[108].jpg)

与执行聚合级别计算的方式相反。请注意，该Measure Values视图在架子上的活动字段中列出的聚合是AGG，而不是SUM。这表明您已经在计算中定义了聚合。Tableau不会进一步汇总结果。这是执行聚合级别计算的方式：

![img](../images/Image%20[109].jpg)

了解行级和聚合级计算之间的区别至关重要，以确保获得所需和期望的结果。通常，当您确定将值用作维度或行级值的集合有意义时，请使用行级计算。如果必须在其他操作之前执行汇总，请使用汇总计算。

*编写Tableau计算时遇到的最常见错误消息之一是***不能使用此函数混合聚合和非聚合参数***。**遇到此消息时，请检查您的代码，以确保您没有将行级字段和计算与聚合字段和计算不正确地混合在一起。**例如，您不能拥有* *[Discount] / SUM([Rent])**。*

*行级值（此混合物**Discount**）和（聚集**SUM**的**Rent**）无效。*

### 详细程度计算 <div id="page_105"></div>

**详细程度计算**（有时称为**LOD calc**或**LOD表达式**）是第四种计算类型，可让您以指定的详细程度执行聚合，该聚合可能不同于视图中定义的详细程度。在许多情况下，您可以在行级别使用结果值。这样，您可能会认为LOD计算是聚合计算和行级计算之间的混合。

#### 详细级别语法 <div id="page_106"></div>

详细程度计算遵循以下基本语法格式：

{FIXED | INCLUDE | EXCLUDE [Dim 1]，[Dim 2]：AGG（[Row-Level]）}

前面的声明的定义如下：

- FIXED或INCLUDE或EXCLUDE，是指示LOD计算类型的关键字。我们将在下一节中详细讨论差异。
- Dim 1，Dim 2 （以及所需的尽可能多的维度）是维度字段的逗号分隔列表，用于定义执行计算所依据的详细程度。您可以使用任意数量的尺寸来定义详细程度。
- AGG是您要执行聚合函数（例如SUM，AVG，MIN，和 MAX）。
- Row-Level 是将根据您选择的聚合指定进行聚合的行级字段或行级计算。

#### 详细等级类型 <div id="page_107"></div>

三种类型的详细计算的水平在使用的Tableau： ，FIXED，INCLUDE和EXCLUDE。

##### 固定 <div id="page_108"></div>

**固定**的详细程度表达式聚集在由代码中的维度列表指定的详细程度， *而不管*视图中的维度*如何*。例如，以下代码将返回Rentper 的平均值Building，而不管视图中其他什么维度：

{FIXED [Building]：AVG（[Rent]）}

以下两个代码段表示整个数据源（或上下文过滤器定义的子集）的平均租金的固定计算：

{FIXED：AVG（[Rent]）}

这是您可以使用的其他代码段：

{AVG（[出租]）}

##### 包括 <div id="page_109"></div>

**包括**详细表达式的聚集水平在该真实通过在视图中尺寸确定的详细程度， *以沿着*在代码列出的尺寸。例如，以下代码在由视图中的维定义的明细级别上计算平均租金Room，即使该维Room不在视图中，但也包括维：

{包括[房间]：AVG（[出租]）}

##### 排除 <div id="page_110"></div>

**排除**细节级别表达式以视图中的维度确定的细节级别聚合，*不包括*代码中列出的任何细节。例如，以下代码以视图中定义的详细程度计算平均价格，但即使视图中包含Apartment维，也不包括维数作为详细程度的一部分Apartment：

{排除[公寓]：AVG（[价格]）}

#### 详细程度示例 <div id="page_111"></div>

如果您想将单个房间的平均租金价格与同一建筑物中所有房间的总体平均租金价格进行比较，该怎么办？获得每个房间的平均租金价格相当容易：

![img](../images/Image%20[110].jpg)

在上一个视图中，**视图的详细**级别（由视图中使用的维定义**的详细**级别）为Building并且Room因为这些是视图中的维。因此，平均租金是按每栋建筑的每个房间计算的。

Building 只需从视图中删除单元尺寸，就很容易获得平均面积，如下所示：

![img](../images/Image%20[111].jpg)

但是，如果要在同一视图中同时使用每间客房的平均租金和每栋建筑物的平均租金，该怎么办？这是详细程度计算进入其中的地方。

有几种方法可以解决此问题，但是您可以考虑使用以如下代码EXCLUDE命名的详细程度计算Average Rent (exclude Room)：

{排除[Room]：AVG（Rent）}

然后，您可以在包含视图的视图中使用它，Building并Room在视图的详细程度中使用以下方法：

![img](../images/Image%20[112].jpg)

“ 度量值”架子AVG(Rent)上的字段是在详细信息视图级别执行的，因此我们将获得每个建筑物的每个房间的平均租金。

但是，Average Rent (exclude Room)用于度量的字段不包括“房间”尺寸，因此是按建筑物（视图中唯一的其他尺寸）计算的。现在，我们可以看到，整体平均海滩微风为$ 1,750，而在大楼各个房间可能是更高或更低。

我们将考虑另外的例子两个在解决复杂问题的详细的计算水平的[第11章](docs/Book.md#page_231)， *高级可视化，技术，技巧，和技巧*。

### 参量 <div id="page_112"></div>

在继续介绍行级计算和聚合计算的其他示例之前，让我们花一点时间检查一下参数，因为它们可以在计算中以不可思议的方式使用。

甲**参数**中的Tableau为单一的全局值的占位符，诸如数字，日期或字符串。参数可以显示为控制板或视图的最终用户的控件（例如滑块，下拉列表或键入文本框），使他们能够更改参数的当前值。参数的值是全局值，因此，如果更改了该值，则工作簿中引用该参数的每个视图和计算都将使用新值。参数提供了另一种方式来为仪表板和可视化的最终用户提供丰富的交互性。

参数可用于允许与您的视图或仪表板进行交互的任何人动态地执行许多操作，包括以下内容：

- 更改计算结果
- 更改垃圾箱的大小
- 更改前*n个*过滤器或前*n个*集合中的顶部或底部项目数
- 设置参考线或参考带的值
- 更改垃圾箱的大小
- 将值传递到数据源中使用的自定义SQL语句

其中一些是我们将在后面的章节中考虑的选项。

由于可以在计算中使用参数，并且由于可以使用计算字段来定义可视化的任何方面（从过滤器到颜色再到行和列），因此参数值的更改可能会产生戏剧性的结果。我们将在以下各节中看到一些示例。

#### 创建参数 <div id="page_113"></div>

创建参数类似于创建计算字段。

有多种方法可以在Tableau中创建参数：

- 使用数据窗格中“ 维度”旁边的下拉菜单，然后选择“ 创建参数”
- 右键单击数据窗格中的空白区域，然后选择创建参数
- 使用数据窗格中字段，集合或参数上的下拉菜单，然后选择“ 创建” |“设置”。参数...

在最后一种情况下，Tableau将基于该字段的**域**（不同的值）创建一个带有潜在值列表的参数。对于数据窗格中默认为**离散**（蓝色）的字段，Tableau将创建一个参数，该参数的值列表与该字段的离散值匹配。对于数据窗格中的**连续**字段（绿色），Tableau将创建一个参数，其范围设置为数据中存在的字段的最小值和最大值。

首次创建参数（或随后编辑现有参数）时，Tableau将显示如下界面：

![img](../images/Image%20[113].jpg)

该界面包含以下功能：

1. 该名称将显示为参数控制默认的标题，也将是在计算的参考。您还可以添加注释以描述参数的使用。
2. 数据类型定义参数值允许的数据类型。选项包括整数，浮点数（浮点十进制），字符串，布尔值，日期或带时间的日期。
3. 在当前值定义参数的初始默认值是什么。在此屏幕或显示参数控件的仪表板或可视化文件中更改此值将更改当前值。
4. 的显示格式定义的值将如何被显示。例如，您可能希望将整数值显示为美元金额，将十进制显示为百分比，或以特定格式显示日期。
5. 在允许值的选项给我们，以限制允许值的范围的能力。允许值有三个选项：

- “所有值”允许用户输入的任何与参数的数据类型匹配的输入。
- 列表允许我们定义一个值列表，用户必须从中选择一个选项。该列表可以手动输入，从剪贴板粘贴或从相同数据类型的维加载。从字段添加是一次性操作。如果数据更改并且添加了新值，它们将不会自动出现在参数列表中。
- 范围允许我们定义可能值的范围，包括可选的上限和下限以及步长。也可以从字段或其他参数设置。

1. 在前面的屏幕截图中，“ 值列表”允许我们输入所有可能的值。在此示例中，已输入三个项目的列表。请注意，该值必须与数据类型匹配，但是显示值可以是任何字符串值。该列表是静态的，必须手动更新。即使将参数基于字段中存在的值，即使新值出现在数据中，列表也不会更改。您可以在列表中拖放值以对列表重新排序。

*如果使用的是选项列表，请考虑一种具有最终用户易于理解的显示值的整数数据类型。**可以轻松地在计算中引用这些值来确定进行了哪些选择，并且可以轻松更改显示值而不会中断计算。**这也可以提高性能，因为数值比较比字符串比较更有效。**但是，您将需要在计算的可读性与整数的灵活性和性能之间取得平衡。*

1. 使用List或Range的允许值，您将获得一系列按钮，可让您从各种来源获取值或范围的列表。从参数添加从现有参数复制值列表或范围；“从字段添加”将复制数据中某个字段的不同值或范围的列表，而“ 从剪贴板粘贴”将从已复制到系统剪贴板的所有内容创建值列表。全部清除将清除值列表。
2. 单击确定以保存对参数的更改，或单击取消以还原。

创建参数后，它会出现在“ 参数”部分下的数据窗格中。参数的下拉菜单显示一个选项Show Parameter Control，该选项  将参数控件添加到视图中。参数控件右上角的小下拉箭头显示了一个用于自定义参数控件的外观和行为的菜单。这是我们之前创建的参数的参数控件，显示为单个值列表：

![img](../images/Image%20[114].jpg)

该控件可以显示在任何工作表或仪表板上，并允许最终用户选择一个值。更改值后，将重新评估使用该参数的所有计算，过滤器，集或箱，并且将重绘所有受影响的视图。

### 计算和参数的实际示例 <div id="page_114"></div>

让我们将注意力转向一些实际的计算示例。这些将是行级和聚合级计算的示例。这些仅是示例。目的是学习和理解一些可能的计算方法。在着手进行分析和可视化过程时，您将能够基于这些示例。

*查找有关计算的帮助和建议的好地方是*[community.tableau.com/community/forums上](http://community.tableau.com/community/forums)*的官方Tableau论坛**。*

#### 解决数据问题 <div id="page_115"></div>

通常，数据并不完全干净。也就是说，在完成有意义的分析之前，它需要解决一些问题。例如，日期格式可能不正确，或者字段可能包含数值和字符代码的混合，需要将其分成多个字段。计算字段通常可用于解决此类问题。

我们将继续处理Vacation Rentals数据。您会记得开始日期和结束日期看起来像这样：

| **开始** | **结束** |
| -------- | -------- |
| 十二月2  | 12月9    |
| 12月9    | 十二月15 |
| 十二月16 | 十二月23 |

没有年份，Tableau无法将“ **开始”** 或“ **结束”** 字段识别为日期。相反，Tableau会将它们识别为字符串。您可以尝试使用数据窗格中字段上的下拉菜单将数据类型更改为日期，但是如果没有年份，Tableau几乎肯定会错误地或至少不完全地解析它们。在这种情况下，我们需要使用计算来解决此问题。

假设在这种情况下，您确信年份应始终为2018年，则可以创建名为Start Date和的计算字段End Date。这是获取开始日期的代码：

DATE（[开始] +“，2018”）

这是获取结束日期的代码：

DATE（[结束] +“，2018”）

这些计算字段的作用是将月份和日期与年份连接起来，然后使用该DATE()函数将字符串转换为日期值。实际上，Tableau会将结果字段识别为日期（具有日期字段的所有功能，例如内置层次结构）。在Tableau中进行快速检查即可发现预期结果：

![img](../images/Image%20[115].jpg)

#### 扩展数据 <div id="page_116"></div>

通常，您会希望在数据中包含一些维度或度量，但是这些度量或度量不会出现在源中。很多时候，您将能够使用计算所得的字段扩展数据集。我们已经考虑了为访客的全名创建一个字段的示例，其中只有名字和姓氏字段。

此外，可能需要进行一些有趣的分析的一件事是计算每次租赁的时间。我们有开始和结束日期，但没有这两个日期之间的时间长度。幸运的是，这很容易计算。

创建一个Days Rented使用以下代码命名的计算字段：

DATEDIFF（'day'，[开始日期]，[结束日期]）

*Tableau使用智能代码完成功能。**在代码编辑器中键入时，它将提供有关功能和字段名称的建议。**按**Tab**键将自动完成您根据当前建议开始输入的内容。*

![img](../images/Image%20[116].jpg)

该DATEDIFF()函数采用日期部分说明，开始和结束日期，并返回两个日期之间的差的数值。现在，我们有了一项新措施，以前是无法使用的。我们可以在可视化中使用此新度量，例如“甘特图”租赁图，如下所示：

![img](../images/Image%20[117].jpg)

该图表使我们可以立即了解每个客人的停留时间，房间的占用时间以及房间的空置时间。

#### 增强用户体验，分析和可视化 <div id="page_117"></div>

计算和参数可以极大地增强用户体验，分析和可视化效果。

假设我们要让度假公寓经理能够进行假设分析。每年的12月，她都会提供一个免费的夜晚。她希望能够查看哪些租金将获得免费住宿，具体取决于她选择的夜晚。

为此，请按照下列步骤操作：

1. 如果尚未这样做，请创建先前显示的甘特图。
2. 创建一个名为Free Night的数据类型为Date且起始值为12/12/2018的参数。这将使经理可以设置和调整促销月份的开始日期。通过从数据窗格中参数的下拉菜单中选择“ 显示参数控件”，在视图上显示参数控件。
3. 现在，在视图中添加参考线以显示空闲的夜晚。为此，请切换到左侧栏中的“ 分析”标签。将参考线拖放到视图上，并将其放在表格上：

![img](../images/Image%20[118].jpg)

1. 在出现的对话框中，将“ 线值”设置为“ 免费住宿”。您可能希望将设置标签，以无或自定义与文本晚免费住宿。您可能还希望调整行的格式：

![img](../images/Image%20[119].jpg)

1. 创建一个称为计算字段Gets Free Night，该字段将返回a true或false值，具体取决于免费住宿是否在租赁期内：

[免费住宿]> = [开始日期]

和

[免费住宿] <= [结束日期]

1. 将此新的计算字段放在“ 颜色”架子上。

现在，我们有了一个视图，该视图允许公寓管理员更改日期并查看动态变化的视图，从而可以清楚地看出哪些租户在给定的促销期内会掉价。通过更改Promotional Month Start参数的值进行实验，以查看视图如何更新：

![img](../images/Image%20[120].jpg)

前面的视图以虚线显示了建议的免费住宿，并突出显示了哪些租期将获得免费住宿。线条和颜色会随着公寓管理员调整Free Night参数值而改变。

### 临时计算 <div id="page_118"></div>

通过临时计算，您可以在单个视图中将计算字段添加到货架，而无需在数据窗格中添加字段。

假设您有一个显示的简单视图Rent per Guest，如下所示：

![img](../images/Image%20[121].jpg)

如果您想快速突出显示任何价格低于$ 1,450的房客，该怎么办？一种选择是创建临时计算。为此，只需双击Columns，Rows或Measure  Values卡的空白区域，或Marks架子的空白区域，然后开始键入用于计算的代码。在此示例中，我们双击了“ 标记”架子上的空白区域：

![img](../images/Image%20[122].jpg)

在这里，我们输入了代码，True如果总和Rent小于$ 1,450，False否则将返回。按*Enter键*或在文本框外单击将显示一个新的临时字段，可以将其拖放到视图内的任何位置。在这里，我们将其添加到“ 颜色”架子中：

![img](../images/Image%20[123].jpg)

临时字段仅在视图内可用，而不会显示在数据窗格中。您可以双击该字段以编辑代码。

*将临时字段拖放到数据窗格中会将其转换为常规的计算字段，该字段可用于使用该数据源的其他视图。*

### 性能考量 <div id="page_119"></div>

当使用小型数据集和高效的数据库时，您通常不会注意到效率低下的计算。使用更大的数据集，计算效率可以开始显着提高视图渲染的速度。

以下是一些使您的计算尽可能高效的提示：

- 布尔和数字计算比字符串计算快。如果可能，请避免字符串操作，并使用别名或格式来提供用户友好的标签。例如，请勿编写以下代码： IF [value] == 1 THEN "Yes" ELSE "No" END。相反，只需编写[value] == 1，然后编辑该字段的别名并设置True为Yes 和False即可No。
- 始终寻找提高计算效率的方法。如果发现自己写的IF ELSEIF带有很多条件的长语句，请先检查是否存在一个或两个条件，以消除对所有其他条件的检查。例如，让我们考虑简化以下代码：

如果[类型] =“狗”且[年龄] <1然后是“小狗”

ELSEIF [类型] =“猫”和[年龄] <1然后是“小猫”

结束

- 前面的代码片段也可以这样写：

IF [年龄] <1 THEN

IF [类型] = “狗” THEN “小狗”

ELSEIF [类型] = “猫” THEN “小猫”

END

END

请注意，对于年龄小于的任何记录，都不必对类型进行检查1。这可能是数据集中记录的很高百分比。

必须为每一行数据执行行级计算。尝试最小化行级计算的复杂性。但是，如果这不可能或不能解决性能问题，请考虑最后一种选择。

创建数据提取时，将实现某些行级计算。这意味着在创建提取后，将执行一次计算，然后将结果存储在提取中。这意味着数据引擎不必一遍又一遍地执行计算。取而代之的是，仅从提取中读取值。使用任何用户功能或参数或TODAY()或的计算NOW()都不会在提取中实现，因为该值必定会根据当前用户，参数选择和系统时间而变化。Tableau的优化器还可以确定是否要实现某些在内存中更有效执行的计算，而不必读取存储的值。

*当您使用提取物来实现行级计算时，仅实现在提取时创建的计算。**如果在创建提取后编辑计算的字段或创建新字段，则需要优化提取（使用数据源上的下拉菜单，或从“* *数据”**菜单中**选择它**，然后选择“* *提取”* *|“* *优化”**）。*

### 总结 <div id="page_120"></div>

计算为Tableau开辟了惊人的可能性。您不再局限于源数据中的字段。通过计算，您可以通过添加新的维度和度量来扩展数据，修复格式错误或格式不正确的数据，并通过用于增强可视化效果的用户输入和计算参数来增强用户体验。

使用计算字段的关键是了解Tableau中的四种主要计算类型。对源数据的每一行执行行级计算。这些计算的字段可以用作维度，也可以汇总为度量。聚合级别的计算在视图中存在的维定义的详细级别进行。当您必须先汇总计算的组成部分然后再执行其他操作时，它们特别有用，甚至有必要。详细程度计算允许您定义执行聚合的详细程度，然后在行级别处理结果。

在下一章中，我们将探讨最终的主要计算类型：**表格计算**。就解决问题的能力和进行深入分析的可能性而言，这些是一些最强大的计算方法。实际上，它们的范围从非常简单到异常复杂。

## 第五章 深入了解表格计算 <div id="page_121"></div>

**表计算**是Tableau中最强大的功能之一。它们提供了其他任何方式都无法实现的解决方案（无需编写自定义应用程序或复杂的自定义SQL脚本！）。这些功能包括：

- 他们使使用结构不佳的数据成为可能，并且仍然可以快速获得结果，而无需等待有人在源头修复数据
- 它们使得可以比较结果表中各行的合计值并进行计算
- 他们为分析和创造性方法打开了令人难以置信的可能性，以解决问题，强调见解或改善用户体验

表格计算的复杂程度从难以置信的易于创建（单击两次）到极其复杂（需要了解寻址，分区和数据密集化）。在本章中，我们将从简单开始，然后转向复杂性。目的是为创建和使用表计算，了解它们的工作方式并查看如何使用它们的示例奠定坚实的基础。我们将考虑以下主题：

- 表计算概述
- 快速表格计算
- 范围和方向
- 寻址和分区
- 自定义表格计算
- 实际例子
- 数据密集化

本章中的示例将返回Superstore我们在第一章中使用的示例数据。要跟随示例，请使用Chapter 05 Starter.twbx工作簿。

### 表计算概述 <div id="page_122"></div>

表计算与Tableau中的所有其他计算不同。在上一章中我们已经考虑了行级，聚合计算和LOD表达式，这些查询是对数据源进行查询的一部分。如果要检查Tableau发送到数据源的查询，您会发现将计算代码转换为数据源使用的任何SQL风格。

另一方面，表计算是在初始查询之后执行的。这是一个扩展图，显示了聚合结果如何存储在Tableau的缓存中：

![img](../images/Image%20[124].jpg)

在呈现数据可视化之前，将对Tableau缓存中的数据汇总表执行表计算。正如我们将看到的，出于多种原因要理解这一点很重要，其中包括：

- **汇总**：表计算对汇总数据进行操作。您不能在表计算中引用字段而不将其作为汇总引用。
- **过滤**：常规过滤器将在表格计算之前应用。这意味着表计算将仅应用于从源返回到缓存的数据。您将需要避免过滤任何表格计算所需的数据，以使其按预期工作。
- **后期过滤**：从数据源返回汇总结果后，将应用用作过滤器的表计算。顺序变得很重要：首先应用行级过滤器和聚合过滤器，将聚合数据返回到缓存，然后将表计算应用为有效地从视图中隐藏数据的过滤器。这允许使用一些创造性的方法来解决某些示例中将要考虑的某些类型的问题。
- **性能**：如果您使用到企业数据库服务器的实时连接，那么行级和聚合级计算将利用企业级硬件。表计算在缓存中执行，这意味着它们将在运行Tableau的任何计算机上执行。如果您的表计算是在十二行甚至几百行的汇总数据上运行，或者您期望发布到功能强大的Tableau Server，您将不必担心。但是，如果要在本地计算机上获取成千上万的聚合数据行，则需要考虑表计算的性能。同时，在某些情况下，可以使用表计算来避免从源头进行昂贵的过滤器或计算。

#### 创建和编辑表计算 <div id="page_123"></div>

有多种方法可以在Tableau中创建表计算，包括：

- 使用下拉菜单查看在视图中用作数字聚合的任何活动字段，选择“ 快速表计算”，然后选择所需的计算类型
- 使用下拉菜单查看在视图中用作数字聚合的任何活动字段，选择添加表格计算， 然后选择计算类型，然后调整任何所需的设置
- 创建一个计算字段并使用一个或多个表计算功能编写您自己的自定义表计算

前两个选项创建一个快速表计算，可以使用字段上的下拉菜单并选择编辑表计算...或清除表计算来进行编辑或删除。第三个选项创建一个计算字段，该字段可以像其他任何计算字段一样进行编辑或删除。

视图中使用“表计算”的架子上的字段，或者是使用“表计算”功能计算的字段，都将具有增量符号图标，如下所示：

以下是**Active Field**的代码段 ：

![img](../images/Image%20[125].jpg)

以下是带有表计算的**活动字段**：

![img](../images/Image%20[126].jpg)

本章中的大多数示例都将使用文本表/交叉表报告，因为它们与缓存中的实际汇总表最匹配。这样可以更轻松地查看表计算的工作方式。

*表计算可用于任何类型的可视化。**但是，在构建使用表计算（尤其是更复杂的表）的视图时，请尝试使用在“* **行”***架子**上具有所有维的表，**然后将表计算作为离散值添加**到维右边的“* **行”***上。**一旦所有表计算都按需工作，就可以重新排列视图中的字段以提供适当的可视化效果。*

### 快速表格计算 <div id="page_124"></div>

**快速表计算**是预定义的表计算，可以应用于视图中用作度量的任何字段。这些计算包括常用和有用的计算，例如运行总计，差异，百分比差异，总计百分比，等级，百分位数，移动平均值，年初至今累计，复合增长率Year over Year Growth和年初至今增长。您可以在视图中用作度量的字段的下拉列表中找到适用的选项，如以下屏幕截图所示：

![img](../images/Image%20[127].jpg)

考虑以下使用示例Superstore Sales数据的示例：

![img](../images/Image%20[128].jpg)

在这里，显示 Sales了随着时间的推移。Sales已在“ 行”架子上放置了两次，第二个SUM(Sales)字段已应用“ 运行总快速表计算”。使用快速表计算避免编写任何代码。

*您实际上可以通过双击视图中的“表计算”字段来查看“快速表计算”使用的代码。**这将其转换为临时计算。**您也可以拖动一个活动字段，并将“快速表计算”应用到数据窗格，这会将其转换为可在其他视图中重复使用的计算字段。*

下表演示了一些可用的快速表计算：

![img](../images/Image%20[129].jpg)

### 相对还是固定 <div id="page_125"></div>

稍后，我们将介绍表计算的一些选项。基于这些选项，您可以通过以下两种方式之一来计算表计算：

- **相对的**：表格计算将相对于表格的布局进行计算。他们可能在桌子上或桌子下移动。以更改表格的方式重新排列尺寸将更改表格计算结果。正如我们将看到的，相对表计算的关键是 scope和 direction。当您将表计算设置为使用相对计算时，即使您重新布置视图，它也会继续使用相同的相对范围和方向。
- **固定**：表格计算将使用一个或多个维度进行计算。重新排列这些尺寸将不会更改表格计算的计算。在这里，范围和方向保持固定为一个或多个尺寸，无论它们在视图中的什么位置。在讨论固定表计算时，我们将重点讨论分区和寻址的概念。

您可以在用户界面中看到这些概念。下面是当您从“表计算”字段的菜单中选择“ **编辑表计算** ”时出现的“ **表计算”**编辑器：

![img](../images/Image%20[130].jpg)

我们将更详细地探讨这些选项和术语，但是现在，请注意与指定相对于**Rows**和**Columns**计算的Table Calculation有关的选项，以及指定针对于其中的特定维而固定计算的Table Calculation的选项。风景。

#### 范围和方向 <div id="page_126"></div>

**范围**和**方向**是描述如何相对于表格计算表格计算的术语。当表格计算相对于表格布局时，重新排列视图中的字段不会改变范围和方向：

- **范围**：范围定义了给定表计算可以引用其他值的范围
- **方向**：方向定义表计算在范围内的移动方式

您已经看到表计算是计算表（跨表）（一段时间内的销售总和）和表（向下）（在上一个表中）。在这些情况下，范围是整个表格，方向是交叉或向下。例如，正在运行的总计计算遍及整个表，并在从左向右移动时添加后续值。

要定义表计算的范围和方向，请使用视图中该字段的下拉菜单，然后选择“  使用计算”。您将获得一个选项列表，这些选项将根据视图中维的位置而略有不同。列出的第一个选项使您可以定义相对于表格的范围和方向。在cell的选项之后，您将看到视图中存在的尺寸列表。我们将在下一节中介绍这些内容。

*相对于表格的范围和方向选项：*

- **范围选项***：表格，窗格和单元格*
- **方向选项***：* *下，跨，下，跨，跨，下*

为了理解这些选项，请考虑以下示例：

![img](../images/Image%20[131].jpg)

关于表计算的范围，Tableau进行以下区别：

- 该**表**是整个汇总数据集。
- 该**窗格**是整个表的一小部分。从技术上讲，它是由表的倒数第二个最低级别定义的；也就是说，“ **行**和/或**列”**架子上的倒数第二个维度定义了窗格。在上图中，您可以看到**“** **行**上的**年份** ” 和“ **列**上的**区域”**的交集定义了窗格（突出显示了一个窗格，但视图中实际上有八个窗格）。
- 该**单元格**由表的最低级别定义。在此视图中，一个的交叉点 Department 内的 Region ，一个**季度**一个内**年份**是单细胞（一个被高亮显示，但实际上96有在视图中）。

前面的屏幕快照中的边界区域由范围定义。范围（以及我们将看到的分区）定义 了包含各种表计算的数据中的窗口。窗口功能，例如WINDOW_SUM() ，特别是在窗口范围内。

##### 确定范围和方向 <div id="page_127"></div>

为了了解范围和方向如何协同工作，让我们来看几个示例。我们将从创建自己的自定义表格计算开始。使用代码创建一个名为Index的新计算字段Index()。

*Index()**是一个表计算函数，**1**当它沿着给定方向并在给定范围内移动时，它**的值开始* *并以1递增。**可用于的许多实际用途**Index**，但是我们将在这里使用它，因为很容易看出它在给定范围和方向上的运动方式。*

创建与前面显示的表 YEAR(Order Date) 和 QUARTER(Order Date) 对行和 Region 并 Department 在列。与其在视图中放置“销售”，不如将新创建的 Index 字段 添加到“ 文本”架子。然后使用该字段上的下拉菜单进行实验，然后Index 选择“ 计算依据”以遍历各种范围和方向组合。在以下示例中，我们仅保留了东部和西部地区以及两年的时间：

- **Table（跨表）**：当表中有列时，这是Tableau的默认设置。注意以下内容如何 Index 在整个表中递增：

![img](../images/Image%20[132].jpg)

- **表格（下）**：使用表格（下）时， Index 将整个表格递减：

![img](../images/Image%20[133].jpg)

- **表格（先下然后下）**：Index在整个表格上递增，然后下移，继续在整个表格上递增，然后对整个表格重复：

![img](../images/Image%20[134].jpg)

- **窗格（跨）**：这为定义边界，Index 并导致Index跨边界递增，直到到达窗格边界为止，此时索引重新开始：

![img](../images/Image%20[135].jpg)

- **窗格（向下）**：这为定义边界Index，并使索引向下递增，直到到达窗格边界为止，此时索引重新开始：

![img](../images/Image%20[136].jpg)

- **窗格（横跨然后向下）**：允许Index在窗格上增加，并继续向下移动。窗格在此处定义边界：

![img](../images/Image%20[137].jpg)

您可以在任何表计算中使用范围和方向。请考虑如何使用此处显示的相同移动和边界来计算运行总额或百分比差异。继续尝试不同的选择，直到您对范围和方向的工作方式感到满意为止。

范围和方向相对于表格进行操作，因此您可以重新排列字段，并且计算将继续在相同的范围和方向上进行。例如，可以互换 Year of Order Date 使用 Department ，仍然可以看到 Index 根据你所限定的范围和方向来计算。

#### 寻址和分区 <div id="page_128"></div>

**地址**和**分区**与作用域和方向非常相似，但最常用于描述如何绝对引用视图中的某些字段来计算表计算。通过寻址和分区，您可以定义视图中的哪些维定义寻址（方向），而所有其他维定义分区（作用域）。

使用寻址和分区可以为您提供更好的控制，因为“表计算”不再与表布局相关，并且您还有更多选择可以微调计算的范围，方向和顺序。

为了开始理解它是如何工作的，让我们考虑一个简单的例子。使用前面的视图，从“ 文本 ” 字段的下拉菜单中选择“ 编辑表计算”。在出现的对话框中，在“ 特定尺寸”下进行检查。Index Department

这是选择的结果 Department：

![img](../images/Image%20[138].jpg)

您会注意到，Tableau 沿（沿）检查维的方向计算Index Department。换句话说，您已经使用 Department 了寻址，因此每个新部门都会增加index。视图中所有其他未检查的维都隐式用于分区； 也就是说，它们定义了索引函数必须重新启动的范围或边界。正如我们在范围上看到的那样，这些边界有时被称为窗口。

前面的视图看起来与您设置 Index 为使用**Pane** **（跨）**进行计算时 所看到的视图相同。但是，有很大的不同。使用**Pane** **（跨**Index 窗格）时，即使在视图中重新排列尺寸，删除某些尺寸或添加其他尺寸  ，也始终会在整个窗格中进行计算。但是，当使用维进行寻址计算时，表计算将始终使用该维进行计算。删除该尺寸会破坏表格计算（该字段将变成红色并带有感叹号），您需要通过下拉菜单编辑表格计算以调整设置。如果您在视图中重新排列尺寸，索引将继续沿尺寸进行计算Department 。

例如，这是单击工具栏中的“ **交换行和列”**按钮的结果：

![img](../images/Image%20[139].jpg)

请注意， 即使表格的整个方向已更改，**索引也将**继续计算Department 。为了完成以下示例，我们将撤消“ **行**和**列”**的交换，以将表恢复为原始方向。

##### 高级寻址和分区 <div id="page_129"></div>

让我们看一下添加其他维度时会发生什么情况的其他示例。例如，如果你检查 Quarter of Order Date，你会看到的Tableau突出一个分区的定义 Region 和 Year of Order Date， 与 Index 通过的寻址领域递增 Quarter of Order Date ，然后 Department：

![img](../images/Image%20[140].jpg)

如果要选择Department和Year of Order Date 作为的地址 Index，则会看到一个由 Region 和 定义的分区Quarter，如下所示：

![img](../images/Image%20[141].jpg)

在此视图中，您会注意到，Index对于 Year 和 Department 的分区中的 Quarter 和的 每个组合，该值都会递增Region。

这些是处理寻址和分区时要考虑的其他一些事项：

- 您可以指定排序顺序。例如，如果您希望Index根据销售额的总和递增，则可以使用Table Calculation编辑器底部的下拉列表来定义默认排序。
- 在“编辑表计算”对话框中的“ 在级别上”选项允许您指定执行表计算的级别。在大多数情况下，您会将此设置保留为“ **最深”** （与将其设置为最底端的维度相同），但是有时，如果您需要将某些维度定义分区，但需要在更高级别应用表计算。您还可以通过在“ **特定尺寸** ”复选框中拖放来重新排列**尺寸**。
- 在重新启动每...选项有效地使所选择的领域，在这一领域中选择，该分区的一部分上面的寻址所有方面，但可以让你保持有序的微调。
- 尺寸是唯一可用于寻址的字段。但是，可以使用离散（蓝色）度量来划分表计算。要启用此功能，请使用字段上的下拉菜单，然后取消选中表计算中的忽略。

花一些时间尝试各种选项，并熟悉寻址和分区的工作方式。

### 自定义表格计算 <div id="page_130"></div>

在继续介绍一些实际示例之前，让我们简单地考虑一下如何编写自己的表计算，而不是使用快速表计算。通过创建新的计算并从“ 功能”下的下拉列表中选择“ 表计算”，可以看到可用的表计算功能的列表。

对于每个示例，我们将设置Compute Using |。类别。这意味着 Department将是分区。

您可以考虑将表计算分为几类。下表的计算可以像其他函数一样组合甚至嵌套。

#### 元表功能 <div id="page_131"></div>

这些功能可为您提供有关分区和寻址的信息。这些函数还包括**Index**，**First**，**Last**和**Size** ：

- **索引**沿分区内的地址*移动时*增加。
- **首先**给出与分区第一行的偏移量；因此每个分区的第一行为0。
- **Last**将偏移量分配给分区的最后一行；因此每个分区的最后一行是0。
- **大小**给出分区的大小。

下图显示了各种功能：

![img](../images/Image%20[142].jpg)

**Index**，**First**和**Last**都受范围/分区和方向/寻址的影响，而无论指定什么方向，**Size**都会在分区的每个地址上给出相同的结果。

#### 查找和以前的值 <div id="page_132"></div>

这两个函数中的第一个使您能够引用其他行中的值，而第二个函数使您能够结转值。从以下屏幕截图中注意到，方向对于这两个功能非常重要：

![img](../images/Image%20[143].jpg)

两种计算都使用寻址 Category （ 分区也是如此Department ）进行。

在这里，我们使用了代码Lookup(ATTR([Category]), -1)，该代码在-1与当前行相比偏移了行的行中查找类别的值。每个分区的第一行NULL从查找中获取结果（因为之前没有行）。

对于Previous_Value，我们使用了以下代码：

Previous_Value（“”）+“，” + ATTR（[类别]）

注意，在每个分区的第一行中，没有先前的值，因此Previous_Value()只需返回我们指定的默认值：一个空字符串。然后将其与逗号和该行中的类别连接在一起，为我们提供值**Bookcases**。

在第二行中，**Bookcases**是前一个值，该值与该行中的逗号和类别连接在一起，为我们提供值**Bookcases**，**Chairs和Chairmats**，它成为下一行中的前一个值。该模式在整个分区中继续，然后在**Office Supplies**部门定义的分区中重新启动。

#### 运行功能 <div id="page_133"></div>

这些函数沿着方向运行/寻址，并且包括 Running_Avg()，Running_Count()，Running_Sum()，Running_Min()，和Running_Max()，如下所示：

![img](../images/Image%20[144].jpg)

请注意， Running_Sum(SUM[Sales])) 该分区的每一行继续将销售总和添加到运行总计中。 保持销售总和的价值（如果它是沿着分区的行移动所遇到的最小值）。Running_Min()

#### 视窗功能 <div id="page_134"></div>

这些函数一次在分区中的所有行上运行，并且实质上聚合了聚合。它们包括Window_Sum，，Window_Avg和 Window_Max，Window_Min以及其他内容，如以下屏幕截图所示：

![img](../images/Image%20[145].jpg)

#### 等级函数 <div id="page_135"></div>

这些功能提供了各种基于汇总值进行排名的方法。等级有多种变化，可让您决定如何对待领带以及等级的密度，如以下屏幕截图所示：

![img](../images/Image%20[146].jpg)

#### 脚本功能 <div id="page_136"></div>

这些功能允许与R分析平台或Python集成，这两者都可以合并简单或复杂的脚本，以实现从高级统计到预测建模的所有功能。深入探讨所有可能的内容，这超出了本书的范围，但是在Tableau的网站上以及Tableau社区的各个成员中都可以轻松找到示例。

#### 总计功能 <div id="page_137"></div>

该Total功能应有其自己的类别，因为它的功能与其他功能略有不同。与在缓存中的聚合表上运行的其他函数不同，Total将重新查询基础源以获取组成给定分区的所有源数据行。在大多数情况下，这将产生与窗口函数相同的结果。

例如，Total(SUM([Sales])) 给出与相同的结果Window_Sum(SUM([Sales]))，但Total(AVG([Sales]))可能给出的结果与之不同，Window_AVG(SUM([Sales]))因为合计给出的是基础行的实际平均值，而Window函数是求和的平均值。

### 实际例子 <div id="page_138"></div>

看了表计算的一些基本概念之后，让我们考虑一些实际的例子。我们将看几个示例，尽管表计算的实际应用几乎是无止境的。您可以执行所有操作，包括累计总和，分析同比增长，查看类别之间的百分比差异等等。

#### 同比增长 <div id="page_139"></div>

通常，您可能需要比较年度值。去年我们的客户群增长了多少？与去年同期相比，每个季度的销售额如何？可以使用回答这些类型的问题Year over Year Growth。

Tableau Year over Year Growth在“快速表计算”中作为一个选项公开。这里，例如，是示范视图Sales通过QUARTER，在销售与上年相比四分之一的百分比差异一起：

![img](../images/Image%20[147].jpg)

第二个 Sum(Sales) 字段已 应用“ Year over Year Growth 快速表计算”（并且标记类型更改为bar）。您会注意到右下角的**> 4空值**指示符，提醒您至少有四个空值的事实（这很有意义，因为没有2015年可以与2016年的季度进行比较）。如果您滤除2015年，则空值将出现在2016年，因为“表计算”只能对缓存中聚合数据中存在的值进行运算。应用于数据的任何常规过滤器都将应用于源，被排除的数据永远不会进入缓存。

像构建本示例一样轻松创建视图，请当心，因为Tableau假定视图中的每一年都有相同的季度数。例如，如果不存在或未过滤出2015年**第一季度**的数据，则结果视图不一定代表您想要的视图。例如，考虑以下内容：

![img](../images/Image%20[148].jpg)

这里的问题是，的Tableau使用的寻址计算快速表计算年度和季度和 正处级的价值Year of Order Date。假设所有季度都在场，则此项工作有效。但是，这里的2016年第一季度与2015年现在的第一季度相匹配，实际上是第二季度。要解决此问题，您需要编辑表计算以仅将Year用于寻址。四分之一然后成为分区，因此将对正确的四分之一进行比较。

那么，如果您不想参加2015年该怎么办？对其进行过滤将在2016年引起问题。我们将在本节后面介绍“ *后期过滤”*。删除2015的另一种可能方法是在视图中右键单击2015标题，然后选择隐藏。**Hide**是一个特殊命令，即使在高速缓存中存在数据时，它也只能阻止Tableau呈现数据。如果您以后决定隐藏后要显示**2015**，则可以使用该字段的菜单，YEAR(Order Date) 然后选择显示隐藏数据。或者，您可以使用菜单选择分析 | 显示隐藏数据。

*您可能还希望* *在视图中**隐藏***null指示器***。**您可以通过右键单击指标并选择**隐藏指标**来执行此操作**。**单击指示器将显示用于过滤数据或将其显示为默认值（通常为0）的选项。*

#### 带标题的动态标题 <div id="page_140"></div>

您可能已经注意到为每个视图显示的标题。除非专门打开字幕，否则也不会显示字幕（要执行此操作，请从菜单中选择“ 工作表 | 显示字幕 ”）。

默认情况下，标题显示工作表名称，标题是隐藏的，但是您可以显示和修改每个标题。有时，您可能希望显示总计，以帮助最终用户了解广泛的背景或立即掌握其重要性。

这里，例如，是一个视图，它允许用户选择一个或多个Region ，然后看到Sales每State每个Region：

![img](../images/Image%20[149].jpg)

当用户选择不同的区域时，显示变化数量的状态可能很有用。您可能首先想到使用聚合 State，例如**Count Distinct**。但是，如果尝试在**标题中**显示该值，则将始终看到该值 1。为什么？因为视图详细程度 是 State 和国家的重复计数每状态1！

但是表计算中有一些选项可以让您进一步汇总聚合。或者，您可能会考虑根据窗口的大小确定表中值的数量。实际上，这里有几种可能性：

- 要获得总的非重复计数： TOTAL(COUNTD([State]))
- 在窗口中求和： WINDOW_SUM(SUM(1))
- 要获取窗口的大小： SIZE()

您可能还记得窗口定义为“范围”或“分区”确定的边界。无论选择哪种可能性，我们都希望将窗口定义为整个表格。可以通过Table Down的相对计算或使用所有维度的固定计算来实现。这是一个说明动态标题和标题中所有三个选项的视图：

![img](../images/Image%20[150].jpg)

#### 后期过滤 <div id="page_141"></div>

假设您已经建立了一个视图，可以查看每个部门的总销售额百分比。您已经在该Sales字段上使用了“快速表计算” 来得出总计的百分比。您还用作Department过滤器。但这是一个问题。

由于表计算是在将汇总数据返回到缓存之后执行的，因此部门的过滤器已经在数据源中进行了评估，并且汇总行不包括该过滤器排除的任何部门。因此，总数的百分比总和为100％；也就是说，它是过滤的总数的百分比，如以下屏幕截图所示：

![img](../images/Image%20[151].jpg)

如果您想查看所有部门在总销售额中所占的百分比，即使您希望从显示中排除一些，该怎么办？一种选择是使用表格计算作为过滤器。

如果您创建一个Department (late filter)使用代码调用的计算字段，LOOKUP(ATTR([Department]), 0)并将其放置在“ 筛选器”功能区而不是Department维度上，则该筛选器不会在源中应用，汇总数据对于其他“表计算”可见，并且“表计算”筛选器仅隐藏部门从最终视图开始，如以下屏幕截图所示：

![img](../images/Image%20[152].jpg)

*您可能已经注意到所**ATTR**使用**的**功能。**请记住，表计算需要汇总参数。**ATTR**（属性的缩写）是一种特殊的聚合，如果对于给定的详细程度仅存在该字段的单个值，则返回该字段的值；如果存在多个值，则返回*******。*

*要理解这一点，请尝试同时具有**Department**和**Category**在***Rows***上**的视图**。**使用视图中活动字段上的下拉菜单，更改**Category**为**Attribute**。**因为每个部门有多个类别，所以**它将显示为*******。**然后，撤消并更改**Department**为**Attribute**。**因为每个类别只有一个部门，所以它将显示部门名称。*

### 数据密集化 <div id="page_142"></div>

**数据密集化** 是一个广义术语，表示缺少的值或记录已“填写”。有时，使用特定的术语（例如*域填充*（填写缺失的日期或bin值）或*域完成*（填充缺失的相交或维值））来指定致密化的类型，但是在这里，我们仅使用术语数据致密化。

*值缺失的数据（例如，每个日期都没有记录的数据，或者仅包含已订购产品的记录的数据，而不是库存中的所有产品的***数据***）称为***稀疏数据***。*

在逐步掌握Tableau的过程中，了解Tableau何时使用数据致密化以及如何*打开*或*关闭它*非常重要。有时，Tableau会在您不希望进行数据浓缩时进行这种操作，您需要认识到这一点，并意识到将其关闭的选项。在其他时候，您将需要利用数据密集化来解决某些类型的问题或执行某些类型的分析。

#### 何时何地进行数据密集化 <div id="page_143"></div>

如果您选择使用某些联接，联合或自定义查询来填充丢失的数据，则可能在源中进行数据致密化。但是在这里，我们专注于从源返回汇总数据之后在Tableau中进行的数据浓缩。具体来说，在我们现在考虑的某些情况下，Tableau会在缓存的聚合数据中填充缺失值，如下图所示：

![img](../images/Image%20[153].jpg)

您将认识到该图与我们开始讨论表计算时所检查的图非常相似。实际上，数据密集化几乎与表计算同时发生，有时甚至可以由表计算触发。以下是启用数据密集化的一些时间示例：

- 当启用了“ 显示缺失值”选项时，日期或箱用作行或列的标题。在这里，Tableau将显示日期或bin值的标题（介于最小或最大日期/ bin值之间），即使它们没有出现在数据中（或被过滤器消除）也是如此。您可以通过选择所需的选项轻松地打开或关闭此密实度。
- 随着展会缺失值启用，在视图中使用某些表计算会额外失踪头的视图中添加标记。我们将在本节后面的示例中看到一个示例。
- 启用“ 显示空行 / 列”选项（为此，从菜单中选择“ 分析” |“ 表布局” |“ 显示空行 / C 列”。）这将使Tableau显示所有行/列标题，即使某些值通常无法正常显示也是如此。根据过滤器选择显示。此选项是特定于上下文的，因此显示的值的范围是针对整个数据集，还是针对上下文过滤器定义的上下文。观察显示的类别与未选中的类别之间的区别：

![img](../images/Image%20[154].jpg)

- 在行和列上使用具有离散尺寸的某些表计算，将导致Tableau *打开*  数据致密化。

让我们看一个示例，以及如何有选择地*关闭*  生成的致密化。 观察两个视图之间的差异，如下所示：

![img](../images/Image%20[155].jpg)

这种观点有**14马克**（你可以看到在状态栏中的计数），表明有十四有效的交叉 Container 和 Ship Modes。数据中根本不会出现某些组合（例如，**Express Air**从未发送过**巨型鼓**）。

但是将表计算（例如）添加Index() 到“ 明细”会导致Tableau填写丢失的相交，如下所示：

![img](../images/Image%20[156].jpg)

画面填补在组合Container 和 Ship Mode 现在有21马克。有时，这种行为可能有用（我们将在后面看到这样的示例），但是很多时候，您可能想要避免致密化。如何关闭它？

了解了Tableau由于行和列上的离散维而启用了致密化，您可以重新排列视图，以便行或列上仅保留一个维。该视图中，例如，保持 Ship Mode 在详细  的部分细节的视图级别，但使用特殊聚合 上的列，如图以下截图：ATTR

![img](../images/Image%20[157].jpg)

结果是没有数据致密化的视图仅显示**14个标记**。

*密切注意状态栏和标记计数。**这将帮助您确定数据密集化的可能情况。**然后，您将能够决定何时希望利用致密化或何时将其关闭有用。*

#### 利用数据致密化的示例 <div id="page_144"></div>

除了显示空行或缺少日期的简单示例外，在某些情况下，您还可以使用数据致密化来解决问题或解决数据的局限性，否则这将是非常困难的。

例如，考虑一下，如果您有指示打开或关闭某些生成器的日期的数据，例如以下内容：

| **发电机** | **日期**      | **行动** |
| ---------- | ------------- | -------- |
| 一种       | 1/13/2017     | 上       |
| 乙         | 2017年1月2日  | 上       |
| C          | 2017年1月25日 | 上       |
| d          | 2017年1月25日 | 上       |
| 乙         | 2017年1月7日  | 关       |
| Ë          | 1/29/2017     | 上       |
| 一种       | 1/30/2017     | 关       |
| C          | 1/30/2017     | 关       |

如果您想要可视化显示**在**给定日期有多少个发电机处于**打开状态**，该怎么办？挑战在于数据集稀疏。即，仅存在发生**开**或**关**操作的日期的记录。下面显示了在Tableau中进行可视化是多么容易：

![img](../images/Image%20[158].jpg)

我们只有八个标记可以使用。但是我们已经看到Tableau可以填写丢失的日期，此外，我们可以通过使用某些Table Calculations为每个日期的每个生成器填写一个值来进一步强制数据密化。

我们将用一个计算，它利用人的友好值开始On 或Off 将其更改为我们可以很容易地添加值。该计算名为Action 值，并通过以下代码与值一起使用：

如果[操作] =“开”，则1否则0结束

这将给我们一个1计数生成器的时间On，0否则为一个。

额外的计算，加上启用该 Date 字段 的“ **显示缺失值** ” ，使我们可以在每个日期中填写一个值。新的计算字段称为**“日期的操作值”，**并具有以下代码：

IF NOT ISNULL（MIN（[动作值]））

THEN MIN（[动作值]）

ELSE ZN（PREVIOUS_VALUE（MIN（[动作值]）））

结束

这实现了表格计算，我们将设置该表格计算来计算整个表格。如果 MIN([Action Value])不为null，那么我们已经到了数据给出实际值的日期，我们将保留该值。否则，我们将继续执行PREVIOUS_VALUE()（1如果发电机已打开，则为a；如果发电机已关闭，0则为a ）。该ZN()函数会将所有null值转换为0 （我们将假定生成器处于关闭状态，直到遇到On）。我们将遍历表格，结转值，直到遇到数据中存在的值。然后，我们将继续前进。结果是一个表，其中所有日期都填充有值，如下所示：

![img](../images/Image%20[159].jpg)

请注意，每个生成器在其打开的日期得到一个**1**，并且在表上携带**1**，直到关闭该生成器为止，此时我们得到**0**并携带它。

我们已经结束了，因为我们现在要做的就是对给定日期的所有发电机的值求和，以得出开启的发电机数量。例如，在第13天，只有一个。在第25天，共有四个。

我们可以使用嵌套现有计算的另一个计算来完成此操作。我们将命名此计算字段 Generators Operating并使用以下代码：

WINDOW_SUM（[日期的操作值]）

这里的关键是我们要对表中的所有值求和，但我们希望在表中计算这些值。使用**嵌套表计算**（其他表计算的代码中引用了表计算）时，可以为每个嵌套计算指定范围 / 方向或寻址 / 分区。

例如，在这里，我们将“ 发电机运行计算”字段添加到“ 行”，并使用下拉 菜单选择“ 编辑表计算”选项：

![img](../images/Image%20[160].jpg)

请注意，在“ 嵌套计算” 标题下，有一个下拉列表，您可以在其中更改每个嵌套计算的“ 使用计算”选项。在这里，我们将设置 Generators Operating 为Table（向下），并 Action Value 设置 Date 为Table（跨）。

经过一点清理后，我们的最终视图将如下所示：

![img](../images/Image%20[161].jpg)

最终视图清楚地表明了在给定日期有多少个生成器处于运行状态，即使这些日期中的许多都不存在于数据中，并且我们当然也没有每个日期的每个生成器都有记录。

我们通过执行以下操作对视图进行了一些清理：

- 我们添加了一个First() == 0 过滤器，该过滤器是通过Table（向下）计算的，因为我们可以获取每个生成器的操作值 总和，Date而只需要显示一组总计即可。
- 我们已经隐藏了的列标题 Generator，因为该字段需要在视图中才能定义视图的详细程度，但无需显示。
- 我们已将标记更改为Area。

通过将每个生成器与每个日期连接起来以获取每个组合的记录，在源头上更密集地加密数据会更容易还是更好？很有可能。如果有可能，在给定数据源的情况下，执行这样的连接，您可能会得到一个在Tableau中使用起来容易得多的数据集（而不必使用数据致密化或复杂的表计算）。

您必须根据数据量，数据库的基础功能以及完成转换的速度来评估在源处填充丢失数据的可行性。了解数据密度会为您提供一些选择，以供您考虑是否无法对源进行整形。

但是，使用Tableau Prep，通常很容易实现重塑数据的可能性。我们会考虑一些这些可能性的时候，我们在考察的Tableau准备[第10章](docs/Book.md#page_217)， *介绍的Tableau准备*。

### 总结 <div id="page_145"></div>

在本章中，我们涵盖了有关表计算的许多概念。现在，您有了一个坚实的基础，可以理解从快速表计算到高级表计算和数据浓缩的所有内容。我们所介绍的实际示例几乎没有触及任何可能的表面，但是应该使您对可以实现的目标有所了解。可以解决的问题种类和可以回答的问题种类几乎是无限的！

在接下来的两章中，我们将注意力转移到一些较轻的主题上，着眼于格式和设计，但是在完成之前，我们当然会看到另外一两个Table Calculation！

## 第六章 使外观看起来很棒并且工作良好 <div id="page_146"></div>

Tableau默认情况下会应用许多良好的视觉习惯，并且为了进行快速分析，您可能不必担心更改许多默认设置。但是，在考虑如何最好地交流发现的数据故事时，您将要考虑如何利用从字体和文本到颜色和设计的所有内容，以便可以与受众进行良好的交流。

Tableau的格式设置选项为您提供了很大的灵活性。字体，标题，标题，颜色，行和列带，标签，阴影，注释等等，都可以自定义，以使您的可视化效果令人印象深刻。

本章将涵盖以下主题：

- 可视化注意事项
- Tableau中的格式设置基础
- 为可视化增值

### 可视化注意事项 <div id="page_147"></div>

从您开始将字段放到架子上开始，Tableau就采用了良好的格式化和可视化做法。您会发现离散调色板使用易于区分的颜色，合适的字体，适当的网格线以及数字和日期遵循元数据中定义的默认格式设置。

默认格式足以进行发现和分析。如果您的重点是分析，那么在您进入分析周期之前，您可能不想花太多时间来微调格式。但是，当您考虑如何与他人交流数据时，您可能会考虑对格式的调整如何对数据故事的讲述方式产生重大影响。

*有时，您会牢记某些格式设置首选项或一组决定字体和颜色选择的公司准则。**在这些情况下，您可以在空白工作簿中设置格式选项并将其另存为模板。*

以下是您应考虑的一些事项：

- **听众**：谁是听众，听众有什么需求？
- **目标**：目标是唤起您的情感反应或为事实做出决定以做出热情洋溢的决定吗？您是要突出显示需要采取的行动，还是只是试图引起对某个话题的兴趣？
- **设置**：这是在其中交流数据故事的环境。它是正式的商务会议，其格式应反映出较高的专业水平？是否要在博客上非正式地共享？
- **模式**：如何呈现可视化效果？您需要确保行，列，字体和标记的大小足以容纳投影机，或者足够紧凑以容纳iPad。如果要发布到Tableau Server，Tableau Online或Tableau Public，那么您是否选择了对Web安全的字体？您是否需要使用设备设计器来创建仪表板的不同版本？
- **心情**：某些颜色，字体和布局可用于设置心情。数据是否讲了一个故事，应该引起听众一定的回应？数据故事是阴沉还是好玩？例如，红色可能表示危险，负面结果或表示需要采取措施。但是，您需要对受众和特定上下文保持敏感。颜色在不同的文化和环境中具有不同的含义。在某些文化中，红色可能表示喜悦或幸福。此外，如果红色是公司徽标的颜色，则红色不是传达负性的好选择。
- **一致性**：通常，在所有可视化中使用相同的字体，颜色，形状，线条粗细和行带。当它们在仪表板中一起显示甚至在同一工作簿中使用时，尤其如此。您还可以考虑如何在整个组织中保持一致而不过于僵化。

所有这些注意事项将为您的设计和格式化决策提供依据。与使用Tableau进行的其他所有操作一样，将设计视为迭代过程。经常从目标受众那里征求反馈意见，并根据需要调整自己的做法，以确保您的交流尽可能清晰有效。格式化的整个目标是更有效地传达数据。

### 利用Tableau中的格式 <div id="page_148"></div>

在本章中，我们将重点介绍工作表级别的格式，因为我们已经介绍了元数据，还将介绍仪表板和故事。但是，最好在**Tableau中**查看格式化的整体情况。

Tableau使用默认格式，包括默认字体，颜色，阴影和对齐方式。此外，您可以自定义几种格式设置，如下图所示：

![img](../images/Image%20[162].jpg)

- **数据源级别**： 我们已经了解了如何为数字和日期字段设置默认格式。其他默认值，例如颜色和形状，也可以使用 数据窗格下拉菜单中的**默认属性** 菜单进行设置。

- **工作簿级别**：可以设置各种全局格式设置选项。从菜单中，选择 格式 | 工作簿。

- **故事级别**：导航到故事选项卡，然后选择“ 格式”  |“故事”。 故事（或 Story | Format）可编辑特定于故事的元素的格式。其中包括用于自定义阴影，标题，导航器和描述的选项。

- **仪表板级别**：可以格式化仪表板特定的元素。查看仪表盘时，选择 格式 |格式。仪表板（或 Dashboard | Format）可指定仪表板标题，字幕，阴影和文本对象的格式。

- **工作表级别**：我们将考虑各种选项。以下格式可用于工作表：

- **图纸格式**：此格式包括字体，对齐方式，阴影，边框和线条。您可以覆盖整个工作表的格式，以实现行和列特定的格式。
- **字段级格式**：此格式包括字体，对齐方式，阴影以及数字和日期格式。此格式特定于字段在当前视图中的显示方式。您在字段级别设置的选项将覆盖在工作表级别设置的默认选项。数字和日期格式还将覆盖默认的字段格式。
- **附加格式**：附加格式可以应用于标题，标题，工具提示，标签，注释，参考线，字段标签等。

- **富文本格式**：  标题，标题，注释，标签和工具提示都包含可以用不同的字体，颜色和对齐方式进行格式化的文本。此格式特定于单个文本元素。

#### 工作簿级别的格式化 <div id="page_149"></div>

通过Tableau，您可以在工作簿级别设置某些格式默认设置。要查看选项并更改默认值，请单击“ 格式” |“ 格式”。工作簿...。现在，左窗格将显示工作簿的格式选项：

![img](../images/Image%20[163].jpg)

这些选项包括更改默认字体（可应用于视图或仪表板的各个部分）和默认线（可应用于可视化中使用的各种线型）的功能。如果您希望恢复为默认格式，也请注意“ 重置为默认值”按钮。

#### 工作表级格式 <div id="page_150"></div>

您已经在上一章中看到了如何编辑元数据，并且在以后的章节中将详细介绍仪表板和故事。因此，我们将注意力转移到 工作表级格式上。

在具体研究如何调整格式之前，请考虑与格式相关的视图的以下部分：

![img](../images/Image%20[164].jpg)

该视图包含以下部分，可以对其进行格式化：

1. **行的**字段标签：可以从菜单中设置字段标签的格式（“ 格式” |“ 字段标签...”），也可以在视图中右键单击它们，然后选择“ 格式...”。此外，您可以从菜单中隐藏字段标签（“ 分析” | 表布局，然后取消选中用于显示字段标签的选项）或通过在视图中右键单击它们并选择隐藏选项。您可以使用 分析 | 如果需要，可以使用顶部菜单上的“ 表格布局”选项再次显示它们。
2. **列的字段标签**：这些标签与行的标签具有相同的选项，但它们的格式或显示/隐藏可以独立于行字段标签。
3. **行标题**：除非您仅为行的标题指定不同的格式，否则它们通常遵循标题的格式。请注意，小计和盛大都有标头。标为a和b的小计和总计标题 是总行标题。
4. **列标题**：除非您仅为列的标题指定不同的格式，否则它们通常遵循标题的格式。请注意，小计和总计都有标题。上图中标记的总计标题 是列标题。
5. **窗格**：许多格式设置选项都包括与标题不同的格式化窗格的功能。
6. **总计（列）窗格**：这是可以在工作表或列级别设置格式的总计窗格。
7. **总计（行）窗格**：这是可以在工作表或行级别设置格式的总计的窗格。

工作表级别的格式化是使用“ 格式”窗口来完成的，该窗口将显示在左侧，而不是数据窗格。

要查看格式窗口，请从菜单中选择“ 格式 ”，然后选择“ 字体”，“ 对齐方式”，“ 阴影”，“ 边框 ”或“ 线条”：

![img](../images/000075.gif)

*您也可以右键单击视图中几乎所有元素，然后选择“* **格式”***。**这将打开特定于所选元素上下文的格式窗口。**只需确认格式窗口的标题与您期望的匹配即可。**进行更改时，您应该立即看到视图更新以反映您的格式。**如果不这样做，则可能是在格式设置窗口的错误选项卡中工作，或者您可能已在较低级别（例如***Rows***）**格式化了某些内容* *，而在较高级别（例如***Sheet***）上**进行了更改* *。*

现在，您应该在左侧看到格式窗口。它将类似于以下内容：

![img](../images/Image%20[165].jpg)

请注意格式化窗口的这些关键方面：

- 窗口标题将为您提供格式选择的上下文。
- 顶部的图标与“ **格式”**菜单的选择选项匹配。这使您可以轻松浏览这些选项，而无需每次都返回菜单。
- 三个选项卡： Sheet，Rows和Columns，使您可以在工作表级别指定选项，然后在行和列级别覆盖这些选项和默认值。例如，你可以使 **行**总计有比不同的窗格和标题的字体 **列**总计（虽然这个具体的选择很可能是不和谐的，并且不推荐！）
- 右上角的“ 字段”下拉列表使您可以在字段级别微调格式。
- 您所做的任何更改都将被预览并显示为粗体标签，以指示格式选项已从默认值更改（请注意，“ **Total”**下“ **Header** ”的字体是如何自定义的，导致“ **Header”**的标签文本显示在胆大）。

*清除格式的三个选项如下：*

- **清除单个选项***：在格式窗口中，右键单击标签或您已更改的任何单个选项的控件，然后**从弹出菜单中**选择“**清除* *”。*  
- **清除所有当前选项***：在格式窗口的底部，单击“**清除”**按钮以清除所有可见的更改。**这仅适用于您当前在格式窗口中看到的内容。**例如：如果您正在**“**行”**选项卡**上**查看“* *底纹* *”**，然后单击“**清除”**，则只会**清除* *“**行”**选项卡**上的底纹选项**。*
- **清除表***：从菜单中，选择**工作表* *|* *清除* *|* *格式化**。**您也可以使用工具栏上清除项目中的下拉菜单。**这将清除当前工作表上的所有自定义格式。*  

其他格式选项（例如，对齐方式和阴影）都与字体选项非常相似。仅需提及一些微妙之处：

- **对齐**包括用于水平和垂直对齐，文本方向和文本环绕的选项。
- **阴影**包括用于行和列条带的选项。条带允许交替使用不同的阴影图案，以帮助区分或分组行和列。默认情况下，文本表启用了行分隔带，但在其他可视化类型（如水平条形图）中也很有用。可以将行带设置为不同的级别，这些级别对应于行或列架子上存在的离散（蓝色）字段的数量。
- **边框**是指在单元格，窗格和标题周围绘制的边框。它包括行分隔符和列分隔符的选项。您可以在视图中看到部门之间的分隔线。默认情况下，边框级别是根据行或列中的倒数第二个字段设置的。
- **线**是指在可视化中使用轴绘制的线。这包括网格线，参考线，零线和轴标尺。您可以从菜单的“格式”选项访问参考线和下拉线的更完整的选项集。

#### 字段级格式化 <div id="page_151"></div>

在格式窗口的右上角是一个名为Fields的小下拉菜单。选择此下拉菜单可为您提供当前视图中的字段列表，选择一个字段将使用适合该字段的选项更新格式窗口。例如，这是该SUM(Sales)字段显示的窗口：

![img](../images/Image%20[166].jpg)

格式窗口的标题将提醒您要格式化的字段。为Font，Alignment等选择图标，将切换回图纸级格式。但是，您可以在**Axis** / **Header**和**Pane**的选项卡之间切换 。字段的选项包括“ 字体”，“ 对齐”，“ 阴影 ”以及“数字和 日期”格式。最后两个选项将覆盖任何默认的元数据格式。

##### 自定义数字格式 <div id="page_152"></div>

更改数字格式时，可以从几种标准格式和自定义格式中进行选择。自定义格式允许您输入Tableau用来格式化数字的格式字符串。您的格式字符串可以使用井号/井号（＃），逗号，负号和括号的组合，以及用引号引起来的文字字符串以指示数字的显示方式。

格式字符串最多允许三个条目，以分号分隔，以表示正，负和零格式。

以下是一些示例，假设正数为 34,331.336，负数为-8,156.7777：

![img](../images/000012.gif)

请注意，Tableau如何根据格式字符串四舍五入数字。始终请注意，由于格式的原因，您看到的作为文本，标签或标题的数字可能已经四舍五入。

还请注意如何将格式字符（如井号，逗号和小数点）与字符串混合使用。所示的第四个示例将给出相同的标签，其中通常会显示零值。

最后，请注意，最后一个示例使用Unicode字符，它为您提供了广泛的可能性，例如显示度数或其他度量单位。整个Tableau中，文本框，标题，字段名称和标签，别名等中都可以使用Unicode字符！

*选择接近所需格式的预定义格式，然后切换到自定义格式，将使您可以从接近的自定义格式字符串开始。*

##### 自定义日期格式 <div id="page_153"></div>

以类似的方式，您可以使用自定义字符串定义自定义日期格式。下表说明了基于各种格式字符串的日期值11/ 08/ **2018，1** : **30** **PM**的一些可能格式 ：

![img](../images/000255.gif)

这些仅是示例，您可以根据需要包含尽可能多的文字字符串。有关自定义日期格式字符串选项的完整列表，请访问 <https://onlinehelp.tableau.com/current/pro/desktop/en-us/dates_custom_date_formats.html。>

##### 空格式 <div id="page_154"></div>

格式化字段的另一个方面是专门格式化**NULL**值。格式化字段时，选择“ **窗格”**选项卡并找到“ **特殊值”**部分，如以下屏幕截图所示：

![img](../images/Image%20[167].jpg)

当字段的值为空时，输入要显示在窗格中的任何文本（在“ **文本”**字段中）。您也可以选择标记的显示位置。“ **标记”**下拉菜单提供了多个选项，这些选项定义了在使用轴时应在何处以及如何绘制空值标记。您有以下选择：

- 在“指示器处显示”将显示一个小的指示器，在视图的右下角具有空值数量。您可以单击指示符中的选项以过滤空值或将其显示为默认值。您可以右键单击指示器以将其隐藏。
- “显示为默认值”会在默认位置（通常为0）显示标记。
- 隐藏（连接线）不会为空值放置标记，但是会在所有非空值之间连接线。
- 隐藏（断裂线） 使行在不显示空值而创建间隙的地方断开。

您可以在下面的屏幕快照中看到这些选项，其中两个空值的位置由灰色带指示：

![img](../images/Image%20[168].jpg)

*您会注意到，前面的折线图在视图中绘制的每个标记的位置都带有小圆圈标记。**当标记类型为线时，单击**颜色**架子会打开一个菜单，其中提供了标记的选项。**所有标记类型都有标准选项，例如颜色和透明度。**某些标记类型支持其他选项，例如边框和/或光环，如下所示：*

![img](../images/Image%20[169].jpg)

在上述屏幕快照中，“ 隐藏（折线）”和“ 在指示器处显示”选项效果很好，因为这两个选项不会掩盖空值。但是，格式化仅对实际的空值有所帮助。这些是数据中存在的记录，但具有空值，表示没有值。

但是，没有12月某些日期的记录。在这些情况下，该值不为null，因为甚至没有数据记录。Tableau仍会在那些缺失的日子之间保持联系，可能难以区分是否存在差距。在这种情况下，考虑启用**数据致密化**（可以通过确保完成这个 小号怎么失踪的日期 选项，从下拉的菜单中选择 DAY(Order Date) 现场 栏目 ，然后添加某些表计算，例如 指数（） 的 详细信息 中的选项 风景）。这将导致Tableau生成缺少日期的数据记录，并将值视为空：

![img](../images/Image%20[170].jpg)

或者，也可以使用其他可视化类型，例如条形图，它可以更清楚地指示丢失的日期：

![img](../images/Image%20[171].jpg)

#### 其他格式选项 <div id="page_155"></div>

也可以从格式窗口访问其他格式选项。这些选项包括：

- **参考线**有多种选择
- **放置线的**行和文本选项
- **标题**和**标题的**阴影和边框选项
- **注释的**文本，框和行选项
- **字段标签的**字体，底纹，对齐方式和分隔符选项
- **图例**，**快速过滤器**和**参数的**标题和正文选项
- **单元格大小** 和**工作簿主题**选项

您会发现其中大多数都相当简单。一些选择可能不太明显：

- **垂直线**，其显示为从标记到轴线画出的线条，可以通过启用右键点击视图的窗格中的任何空白区域具有轴线并选择垂直线 | 显示放线。可以使用相同的右键菜单并选择编辑下拉线来访问其他选项。放线仅显示在Tableau Desktop和Reader中，但当视图发布到Tableau Server，Online或Public时当前不可用。

- 通过从菜单中选择“ 工作表 ”，然后选择所需的选项，可以为任何视图显示或隐藏**标题**和**标题**。除了可以应用于标题和标题的标准格式外，还可以编辑标题或标题的文本，并通过双击标题或标题，右键单击标题或标题并选择Edit或通过以下方式来专门设置其格式：使用标题或标题的下拉菜单（或仪表板上视图的下拉菜单）。标题和标题文本可以动态包括参数值，视图中任何字段的值以及某些其他数据和特定于工作表的值。

- **注释** 可以通过以下方式创建右击视图中的标记或者间隔，选择**注释**， 并选择以下三种类型的注解中的一种：

- **标记**注释与视图中的特定标记关联。如果该标记未显示（由于过滤器或轴范围），则注释也将不显示。标记注释可以包括定义标记或其位置的任何字段的值的显示。
- **点**注释被锚定到视图中的特定点。如果该点在视图中不可见，则注释将消失。点注释可以包括定义点位置（例如，轴的坐标）的任何字段值的显示。
- **区域**注释包含在一个矩形区域内。所有注释的文本可以动态包含参数的值以及某些其他数据和特定于工作表的值。

*您可以从一个工作表中选择复制格式到另一个（同一工作簿内或跨工作簿）**复制格式**从***格式***菜单，同时查看源工作表（或选择**复制格式**从右键菜单源工作表标签上的选项） 。**然后，**在查看目标工作表时**在“* *格式”**菜单**上**选择“* *粘贴格式* *”* *（或从“* **目标***工作表”选项卡**的右键单击菜单中选择**选项）。* *此选项会将源工作表上存在的所有自定义格式应用于目标。**但是，在标题，标题，标签和工具提示的文本编辑过程中应用的特定格式不会复制到目标工作表中。*

### 为可视化增值 <div id="page_156"></div>

现在，我们已经考虑了格式化在Tableau中的工作方式，下面让我们看一下格式化可以为可视化添加价值的一些方法。

应用自定义格式时，请始终问自己，格式化对理解数据有何帮助。它使可视化更加清晰和易于理解吗？还是只是增加混乱和噪音？

通常，尝试一种简约的方法。从可视化中删除所有不必要的内容。强调重要的价值，文字和标记，而不再强调仅提供支持或上下文的内容。

考虑以下可视化，全部使用默认格式：

![img](../images/Image%20[172].jpg)

默认格式效果很好。但是，将其与该可视化进行比较：

![img](../images/Image%20[173].jpg)

前面的两个图均按季度显示了销售额，并已过滤到办公用品部门。除了顶视图在“ **列** ”上具有“部门”字段以试图清楚地表明仅显示办公用品销售外，这两个视图的字段排列完全相同。第一个视图使用默认格式。

在第二个视图中考虑一些自定义项：

- 标题已调整为包括部门名称。
- 已将销售格式设置为使用具有两个小数位和百万个单位的自定义货币显示。轴和注解也是如此。通常，较高的精度可能会使可视化混乱。数据的初始视图为我们提供了趋势和足够的细节，以了解数量级。工具提示或其他视图可用于显示细节并提高精度。
- 通过右键单击轴，选择“ 编辑轴”，然后清除文本，可以删除轴标签。视图的标题清楚地表明您正在查看Sales。仅这些值就显示第二个轴是四分之一。如果数据中有多个日期，则可能需要指定使用哪个日期。根据您的目标，您可以考虑完全隐藏轴。
- 行上的网格线已被删除。网格线可以为视图添加值，尤其是在能够确定值的视图中。但是，它们也可能使混乱和分散注意力。您需要根据视图本身和要讲述的故事来确定网格线是否有用。
- 趋势线已经过格式化，以匹配该线的颜色（尽管它更浅更细），从而不再强调它。此外，置信带已被删除。您必须根据您的需求和受众来决定他们是添加上下文还是混乱。
- 线条，阴影和框已从注释中删除，以减少混乱。
- 注释的大小和颜色已更改，以使其脱颖而出。如果目标只是简单地突出显示行中的最小值和最大值，则标签可能是一个更好的选择，因为可以将标签设置为仅以**Min** / **Max**显示。但是，在这种情况下，较低的数字实际上是视图中的第二最低点。
- 轴标尺和刻度线已经过强调和着色，以与标记和参考线匹配（轴标尺在“ **格式”**窗口的“ **线”**选项下可用）。

格式化还可用于显着改变可视化外观。考虑以下图表：

![img](../images/Image%20[174].jpg)

此可视化几乎与以前的视图相同。但是，底纹已应用于工作表和标题。此外，根据需要将字体变暗或变暗，以在黑色背景上很好地显示。一些人发现这种格式更令人愉悦，尤其是在移动设备上。如果将视图嵌入具有深色主题的网站中，则可能需要这种格式。但是，您可能会发现在深色背景上更难以阅读某些文本。在考虑这种格式是否最适合您的情况时，您需要考虑受众，设置和投放方式。

*使用黑色背景时，应反转**顺序调色板**（基于连续字段的单一颜色渐变）。**这是因为在白色背景上，较浅（较低）到较深（较高）的默认设置效果很好，在深色背景上较暗的颜色突出，较浅的颜色逐渐淡入白色。**在黑色背景上，较浅的颜色更加突出，而较暗的颜色则逐渐变为黑色。**在使用下拉菜单上的调色板编辑调色板时，双击图例或右键单击图例**，然后**选择***Edit Colors ...***，然后选中***Reversed***，* *就会找到反向选项**。*

#### 工具提示 <div id="page_157"></div>

由于它们并不总是可见的，因此工具提示是可视化中容易被忽略的方面。但是，它们增加了微妙的专业性。考虑以下默认工具提示，当最终用户将鼠标悬停在上述屏幕快照中显示的标记之一上时显示：

![img](../images/Image%20[175].jpg)

将其与此工具提示进行比较：

![img](../images/Image%20[176].jpg)

通过单击 “ 标记”卡上的“工具提示”来编辑工具提示 ，这会弹出一个编辑器，可以对工具提示中的文本进行丰富的编辑：

![img](../images/Image%20[177].jpg)

该编辑器类似于用于编辑标签，标题，标题和注释的文本的编辑器。您可以输入文本并根据需要设置其格式。此外，“ 编辑工具提示”对话框还具有一些其他功能：

- 右上角的“ 插入”下拉菜单允许您插入图纸，字段，参数和其他动态值。这些特殊或动态文本对象作为标签包含在文本编辑器中（例如， <SUM(Sales)>）。我们稍后将介绍一下床单的特殊情况。
- 显示工具提示的复选框选项 和指示工具提示样式的下拉菜单（响应式-立即显示工具提示或悬停显示）。
- 包括命令按钮的复选框选项。这是默认设置，您可以在本节的第一个未经编辑的工具提示中观察命令按钮。命令按钮包括诸如Include，Exclude，**Create Sets**等选项。通过右键单击，最终用户仍然可以使用其中的许多选项，因此从工具提示中删除这些选项不会阻止用户完全访问它们。
- 允许按类别选择的复选框选项。启用后，此功能允许用户单击工具提示中显示的尺寸值，从而在视图中选择与该值关联的所有标记 。

*考虑取消选中“* *显示工具提示*  *”的任何视图，这些视图不会显着并有意为用户体验增加价值。*

##### 工具提示中的Viz <div id="page_158"></div>

通过Tableau，您可以将可视化效果嵌入到工具提示中，当您将鼠标悬停在不同的标记上时，这些提示将被动态过滤。通常**在工具提示中**称为**Viz**，这极大地扩展了最终用户可以使用的交互性，向下钻取详细信息的能力以及以不同方式快速查看数据的能力。

在前面的屏幕截图中，通过选择“ 插入” |“ 添加”，将以下标记添加到了工具提示中。床单 | 分类：

<Sheet name =“类别” maxwidth =“ 300” maxheight =“ 300” filter =“ <所有字段>”>

您可以编辑此标签，该标签告诉Tableau在“ 类别”表中显示可视化内容，作为工具提示的一部分。默认情况下，最大宽度和高度设置为300像素。该过滤器指示哪个字段（一个或多个）作为从片材到维兹在工具提示的过滤器。默认情况下，<All Fields>表示视图中的所有尺寸都将充当过滤器。但是，您可以指定一个字段列表，以按视图中存在的一个或多个维度（例如<Department>，<Category>）专门过滤 。

注意带有工具提示的最终视图：

![img](../images/Image%20[178].jpg)

考虑工具提示中Viz的多种可能性：

- 深入研究细节。

- 它可以显示数据的不同方面（例如：地理位置作为

  时间序列的工具提示）。

- 它允许最终用户在更广泛的上下文中查看整体的一部分。

- 多得多

*以下是一些提示，以总结我们在工具提示中对Viz的检查：*

- *一个工具提示中可能包含多个视点。*
- *将**工具提示中使用的工作表**的“* *适合”**选项**设置**为“* *整个视图”**，使其适合最大宽度和高度。*
- *您可以通过右键单击工作表的选项卡并选择**隐藏**来**隐藏**工具提示中使用的工作表**。**要恢复它们，请右键单击工具提示中正在使用的工作表的选项卡，然后选择**取消隐藏工作表**。*

### 总结 <div id="page_159"></div>

格式化的目的是增加手头数据的有效通信。在进行格式化的迭代过程时，请始终考虑受众，设置，模式，心情和一致性。寻找可为您的可视化增加价值的格式，并避免无用的混乱。了解格式在Tableau中的工作原理后，您将能够完善在发现和分析中创建的可视化效果，从而对数据故事进行非常有效的交流。

在下一章中，我们将研究如何在仪表板中将它们结合在一起。

## 第七章 使用仪表板讲述数据故事 <div id="page_160"></div>

在数据发现和分析中，您可能会创建许多数据可视化。这些可视化中的每一个都为您提供了数据中故事的快照。每次对数据的洞察都会回答一个或两个问题。有时，发现和分析阶段足以使您做出关键决定，并且周期已完成。在其他情况下，您需要将快照放在一起以向目标受众传达完整且引人入胜的故事。

通过Tableau，您可以将相关的数据可视化集成到单个仪表板中。该仪表板可以是数据各个方面的静态视图，也可以是完全交互的环境，从而允许用户动态过滤，深入查询数据可视化并与之交互。

在本章中，我们将在几个深入的示例的背景下看一看大多数这些概念，在这些示例中，我们将逐步介绍仪表盘的设计过程。和以前一样，不用担心记住指令列表。相反，应重点了解仪表板的组件和方面为何以及如何工作。

本章 将涵盖 以下主题：

- 仪表板介绍
- 仪表板示例
- 互动互动
- 为不同的显示器设计
- 故事点

对于本章中的示例，我们将返回Superstore Sales前几章中使用的示例数据。继续并创建一个与该数据集具有连接的新工作簿。

### 仪表板的关键概念 <div id="page_161"></div>

在研究一些实际示例之前，让我们花一些时间来了解什么是仪表板以及为什么要创建一个仪表板。

#### 仪表板定义 <div id="page_162"></div>

从Tableau的角度来看，**仪表板**是单个可视化文件的排列，以及布置在单个画布上的其他组件（例如图例，过滤器，参数，文本，容器，图像，扩展，按钮和Web对象）。理想情况下，可视化效果和组件应协同工作，以讲述一个完整而引人注目的数据故事。仪表板通常（但并非总是）是交互式的。

#### 仪表板目标 <div id="page_163"></div>

仪表板的主要目的是将数据传达给特定受众，并获得预期结果。通常，我们会谈论*讲数据故事*。也就是说，数据中包含一种叙述（或多种叙述），可以将其传递给他人。

尽管您可以通过单个可视化甚至一系列复杂的仪表板来讲述数据故事，但单个Tableau仪表板是传达单个故事的最常用方法。每个仪表板都试图通过清晰地显示某些信息来讲述一个故事。在构建故事之前，您应该了解数据所讲述的故事。您如何讲故事，取决于许多因素，例如您的听众，听众访问仪表板的方式以及您希望从听众中引起什么反应。

数据可视化领域的领先专家之一Stephen Few将仪表板定义*为实现一个或多个目标所需的最重要信息的可视显示，并将其合并并排列在一个屏幕上，以便可以在以下位置监视信息一眼*。考虑到此定义是很有帮助的，因为它在数据故事周围以及我们在Tableau中尝试讲述的方式放置了一些关键边界。通常，您的数据故事应遵循以下准则：

- 数据故事应重点关注最重要的信息。不能传达或支持主要故事的任何事物都应排除在外。您可能希望将该信息包含在其他仪表板中。
- 您讲述的数据故事必须满足您的关键目标。您的目标范围可能从提供信息到提供进一步探索的界面，到提示您的听众采取行动或做出关键决策。任何不符合您目标的内容都应保留给其他仪表板。
- 数据故事应易于访问，主要思想应明确。根据您的听众，您可能希望根据数据明确陈述您的结论，或者您可能希望指导听众，以便他们得出自己的结论。

着手构建仪表板时，您将需要仔细考虑自己的目标。您的发现和分析应该已经发现了有关数据及其故事的各种见解。现在，您有责任以符合您的目标和他们的需求的方式，将发现和分析打包为与特定受众的有意义的故事交流。

#### 仪表板方法 <div id="page_164"></div>

有多种方法可以根据您的目标构建仪表板。以下绝不是完整列表：

- **指导性分析**：您已经进行了分析，进行了发现，从而对数据故事的含义有了深刻的了解。通常，设计一个仪表板来指导您的听众完成类似的发现自己的过程通常会很有帮助，因此明确采取行动的必要性。例如，您可能在营销部门发现了浪费的支出，但是财务团队可能不准备接受您的结果，除非他们能够看到数据如何使您得出结论。
- **探索性的**：很多时候，您都不知道在下一小时，下一周或明年何时刷新数据时，数据将讲述什么故事。今天故事的重要方面可能不是将来的重要决策点。在这些情况下，您的目标是为受众提供一种分析工具，使他们能够自行探索数据的各个方面并与之交互。例如，今天，所有地区的客户满意度都很高。但是，您的仪表板需要使营销团队具有不断跟踪满意度的能力，按产品和价格动态过滤并观察与质量和交货时间等因素的任何关联。
- **记分卡/状态快照**：**关键绩效指标**（**KPI**）或衡量**绩效**好坏的度量标准可能已达成广泛共识。您无需通过发现来指导观众或强迫他们去探索。他们只需要一个顶级摘要和足够的细节，然后向下钻取即可快速发现并解决问题并奖励成功。例如，您可能有一个仪表板，该仪表板仅显示有多少尚未解决的支持凭单。管理者可以拉起移动设备上的仪表板，并在必要时立即采取措施。
- **叙述**：这种仪表板强调一个故事。可能会有一些探索，指导性分析或性能指标方面的内容，但主要是您从数据中讲出一个故事。例如，您可能希望讲述疾病爆发的故事，包括疾病的传播地点，时间和传播方式。仪表板以可视方式使用数据来讲述故事。

我们将看几个深入的示例，以更好地理解其中的一些不同方法。在此过程中，我们将吸收前几章介绍的许多技能，并介绍Tableau中设计仪表盘的关键方面。

*您的仪表板可能采用混合方法。**例如，您可能有一个探索性仪表板，突出显示一些KPI。**但是，请注意不要使仪表板超载。**试图通过任何一个仪表板实现一个或两个以上目标可能会导致压倒性的混乱。*

### 在Tableau中设计仪表板 <div id="page_165"></div>

无论您的目标或方法是什么，每次在Tableau中设计仪表板的实际任务都会看起来相似。在本节中，我们将介绍一些基本概念。

#### 对象 <div id="page_166"></div>

仪表板由布置在画布上的对象组成。您会在仪表板的左侧窗格中看到可以添加到仪表板的对象列表：

![img](../images/Image%20[179].jpg)

该窗格包括以下对象：

- 水平：一个布局容器，其他对象将在其中排成一排（水平）。
- 垂直：一个布局容器，其他对象将在其中排列（垂直）。
- 文本：允许您在仪表板中包含格式丰富的文本的对象。
- 图像：一个图像（例如， .gif，.png，.jpeg），其可以被定位和尺寸上的仪表板。（可选）您可以设置用户单击图像时用于浏览的URL。
- 网页：允许您将网页内容嵌入到仪表板中的对象。您可以在设计时设置URL。我们还将考虑如何使用操作来动态更改URL。
- Blank：一个空白对象，可用作占位符或提供间距选项。
- 按钮：提供导航到工作簿中其他仪表板和工作表的方法。
- 扩展：Tableau，第三方（甚至可能是您！）开发的越来越多的工具之一，它利用扩展API为仪表板提供扩展功能。这可以让您完成诸如收集大量使用数据，动态更新参数，合并来自其他平台（例如D3）的可视化等工作！

除了可以通过 边栏添加的对象之外，还有其他对象可能适用于给定的仪表板：

- **过滤器**：这些将作为最终用户的控件出现，以便他们可以选择要过滤的值
- **参数**：与过滤器类似，这些将显示为最终用户选择参数选项的控件
- **页面控件**：这些控件为最终用户提供用于翻阅数据的选项
- **图例**：包括颜色，大小和形状的图例，以帮助最终用户理解各种可视化效果
- **荧光笔**：这些使用户可以突出显示视图中的各种尺寸值
- **仪表板标题**：特殊文本对象，默认情况下显示仪表板工作表的名称

##### 平铺与浮动 <div id="page_167"></div>

对象是平铺的还是浮动的。如果是平铺对象，它将捕捉到放置它的仪表板或布局容器中。如果它是一个浮动对象，它将在仪表板上分层浮动。您可以更改浮动对象的图层顺序。

您会在前面的屏幕快照中的“ 对象”面板正下方看到“ 平铺”或“ 浮动”按钮。这些按钮定义了放置在仪表板上的对象的默认设置，但是您可以更改任何给定对象是平铺还是浮动的。

*拖动对象**时，**按住Shift**键可将其快速从平铺更改为浮动，或从浮动更改为平铺。*

随着您在设计仪表板方面的经验，您可能会倾向于使用主要是平铺方法或主要是浮动方法进行设计。（您可以在任何仪表板上混合平铺和浮动对象）。许多设计师发现一种设计方法或另一种适合他们的风格。以下是一些注意事项：

- **精度**：浮动对象的大小和位置可以精确到像素完美，而平铺对象在很大程度上取决于其容器的位置和大小。
- **速度**：许多设计师发现平铺布局的创建速度要快得多，因为他们不必担心精度或分层。
- **动态调整大小**：浮动对象在固定大小的仪表板上可以很好地工作，但是根据窗口大小动态调整大小的仪表板会将浮动对象移动到通常不希望的位置。平铺的对象可以更可靠地移动和调整大小（但并非总是完美！）。
- **灵活性**：某些设计技术可以通过一种方法来实现。例如，可以使用浮动技术在背景图像的顶部分层放置透明的可视化效果。然而，片交换（我们将在考虑[第11章](docs/Book.md#page_231)，*高级可视化，技术，技巧和窍门*）通常完成一个平铺的方式。

尝试各种设计技巧，并随时发展自己的风格！

##### 操作仪表板上的对象 <div id="page_168"></div>

您可能希望在对象成为仪表板的一部分后对其进行操作。每个对象都有某些控件，当您选择它们时这些控件将变为可见：

![img](../images/Image%20[180].jpg)

- 握：单击并拖动手柄来移动物体。
- 从仪表板上删除：单击此按钮可从仪表板上删除对象。
- 转到工作表：要在仪表板上编辑单个可视化文件，请使用此按钮导航到单个工作表。
- 用作过滤器：单击此处将视图用作过滤器。现在，在视图中选择一个标记将过滤仪表板中的其他视图。我们将在本章后面的内容中介绍过滤器操作的细节，以及如何更好地控制视图如何用作过滤器。
- 更多选项：此下拉箭头显示该对象的许多选项，包括参数和过滤器的控件显示选项；在视图上显示或隐藏标题或标题；向仪表板添加图例，参数和过滤器；格式，布局和大小选项；和更多。
- 对象大小调整边框：将鼠标悬停在边框上会导致光标更改为大小调整光标。您可以拖动边框以调整对象的大小。

*您可能会注意到不同的大小调整行为，具体取决于对象内部的容器类型以及对象是平铺还是浮动的。*

### 仪表板示例–利润最低的总是不盈利吗？ <div id="page_169"></div>

在涵盖了一些概念性主题以及与仪表板设计相关的实际问题之后，我们将深入探讨一个示例。

假设您的任务是帮助管理层找到利润最低的项目。管理层认为，应从其库存中剔除大部分利润最低的项目。但是，由于您已经进行了分析，因此您发现某些项目虽然总体上没有盈利，但有时会在各个位置获利。您的主要目标是使管理层能够快速查看利润最低的项目的分析，以识别某项项目是否始终没有利润。此示例将结合引导式分析仪表板和探索工具的各个方面。

#### 建立意见 <div id="page_170"></div>

使用Superstore Sales数据集并按照以下步骤构建将构成仪表板基础的单个视图：

1. 创建一个条形图，按类别显示利润。按利润的总和以降序对类别进行排序。
2. 将Department字段添加到“ 过滤器”并显示一个过滤器。为此，请使用Department数据窗格中字段的下拉菜单，然后选择显示过滤器。
3. 命名工作表Overall Profit by Category：

![img](../images/Image%20[181].jpg)

1. 创建另一个类似的视图，按项目显示利润。按利润的总和按降序对项目进行排序。

1. 您会注意到一次有太多物品要看。为了在此仪表板上实现目标，您可以将项目限制为利润最低的前10名。将项目字段添加到过滤器架子，选择顶部标签，然后调整设置以按字段过滤。通过以下指定底部10Sum(Profit)：

![img](../images/Image%20[182].jpg)

1. 将工作表重命名为Top 10 Least Profitable Items：

![img](../images/Image%20[183].jpg)

1. 创建另一个工作表，显示按州填充的利润图。您可以通过双击State数据窗口中的字段，然后将利润放在颜色架子上来相当快地完成此操作。

1. 将工作表重命名为Profit by State：

![img](../images/Image%20[184].jpg)

1. 创建一张最终表以显示何时获利或亏损。确保已将该Order Date字段添加为Quarter日期值，并且该 字段是连续的（绿色）。
2. 添加线性趋势线。为此，请切换到左侧边栏的“ 分析”选项卡，然后将“ 趋势线”从“ 模型”拖到视图中。或者，右键单击视图画布的空白区域，然后选择“ 趋势线”  |“ 趋势线”。 显示趋势线。
3. 将工作表重命名为Profit Trend：

![img](../images/Image%20[185].jpg)

#### 创建仪表板框架 <div id="page_171"></div>

此时，您已经具有实现仪表板目标的所有必要视图。现在，剩下的就是安排它们并实现有效讲述故事所需的交互性：

1. 通过单击所有现有工作表选项卡右侧的“ 新建仪表板”选项卡或选择“ 仪表板” | “ 新建”来创建新仪表板。菜单中的“ 新建仪表板 ”。
2. 将新的仪表板重命名为Is Least Profitable Always Unprofitable?。
3. 在左侧边栏底部，选中显示仪表板标题。
4. 通过将视图从左侧边栏的“ 仪表板”窗格中拖放到仪表板画布中，将其添加到仪表板中。安排如下：

![img](../images/Image%20[186].jpg)

在将视图添加到仪表板之后，您将需要一些时间来重新定位各种元素和视图并调整其大小。

1. 使用Department过滤器上的下拉菜单，然后将控件更改为“ 单个值”（下拉列表）。
2. 您会注意到，更改过滤器的值只会更改Overall Profit by Category视图。您可以使用下拉菜单调整过滤器适用于哪些视图。使用下拉菜单，选择“ 应用于工作表 | 全部使用此数据源。

*可以使用过滤器控件上的下拉菜单或**视图中**“* *过滤器”**架子**上的字段来设置应用过滤器的选项**。**这些选项包括：*

- **所有正在使用的相关数据源***：过滤器将应用于所有与数据源之间的字段相关的数据源。**关系可以从* *数据* *|* *在主菜单上**编辑关系**。*
- **全部使用此数据源***：筛选器将以该数据源作为主要数据源应用于任何视图。*
- **选定的工作表****...***：筛选器将应用于您选择的工作表。*
- **仅此工作表***：筛选器将仅应用于当前工作表。*

1. 从左侧边栏中，将Text对象拖放到上方， Overall Profit by Category然后输入以下说明：

1.从下拉列表中选择一个部门

2.在下面选择一个类别

3.在下面选择一个项目

1. 使用手柄，将Department过滤器移至Top 10 Least Profitable Items视图上方。
2. 调整文本对象的大小，以使“ 前10个”视图与“ 整体”视图对齐。
3. 将“ 利润”颜色图例移到Profit by State视图下方。
4. 使用的下拉菜单Overall Profit by Category，以适合 | 整个视图。这将确保不需要滚动条即可显示所有类别。
5. 另外，将调整Top 10 Least Profitable Items为整个视图。

此时，您的信息中心应类似于以下内容：

![img](../images/Image%20[187].jpg)

#### 采取行动指导故事 <div id="page_172"></div>

现在，您有了一个支持讲述数据故事的框架。您的受众群体将能够在所选类别的上下文中找到利润最低的商品。然后，选择一个项目将回答一个问题，即它是否在每个位置都一直无利可图。要启用此流程并满足您的目标，通常需要启用交互性。在这种情况下，我们将使用动作。我们将以一些具体步骤结束本示例，然后解开复杂的动作：

1. 单击视图上的用作过滤器按钮Overall Profit by Category。这将导致视图被用作整个仪表板的交互式过滤器。也就是说，当用户选择一个条形图时，所有其他视图将根据选择内容进行过滤：

![img](../images/Image%20[188].jpg)

1. 从主菜单中，选择“ 仪表板”。 动作。您会看到一个列表，其中包含一个名为的操作Filter 1 (generated)。这是您 先前选择用作过滤器时创建的操作：

![img](../images/Image%20[189].jpg)

1. 点击添加操作>按钮，然后选择过滤器。出现的对话框为您提供选择源和目标的选项，以及操作的其他选项。
2. 在这里，我们需要一个操作，当用户选择一个项目时，该操作可以过滤除“ 按类别的总体利润”视图以外的所有内容。在“ 添加过滤器操作”对话框中，将“ 原始图纸”设置 为“最赚钱的前10个项目”，将“ 目标图纸”设置为“ 按州和利润趋势划分的利润”。确保将操作设置为在Select上运行。将过滤器命名为“ 按项目过滤”，然后在此对话框上单击“ 确定 ”。在“ 动作”对话框上执行相同的操作：

![img](../images/Image%20[190].jpg)

现在，您具有驱动仪表板的三个过滤器（两个是动作）：

- 从下拉列表中选择一个部门将过滤整个仪表板（实际上是工作簿中的所有视图，因为您将其设置为使用数据源过滤每个视图）
- 选择一个类别（单击栏或标题）将过滤整个仪表板到该选择
- 选择一个项目（单击栏或标题）将按州和利润趋势仪表板过滤利润

*您可以通过单击空白区域或再次单击所选标记来清除视图中的选择。**例如，如果单击“* *书架* *”栏**以选择它（从而过滤仪表盘的其余部分），则可以再单击一次该栏以取消选择它。*

尝试使用过滤器和操作，以查看仪表板的功能。

#### 插曲–上下文过滤 <div id="page_173"></div>

您可能已经注意到，当您使用下拉过滤器选择一个部门或一个类别时，“ 前十名”视图中的项目少于10个。例如，从“ 部门”过滤器中选择“ 家具”，然后单击“ 表 ”栏，将仅显示三个项目。这是因为“  最重要项目”过滤器与操作过滤器同时评估。只有三类表的类别也位于前十名中。

如果要查看表格类别中的前10个项目怎么办？您可以使用上下文过滤器完成此操作。

**上下文过滤器***是Tableau中的一种特殊类型的过滤器，在其他过滤器之前应用。**然后在上下文过滤器的上下文中应用其他过滤器。**从概念上讲，上下文过滤器产生数据的子集，其他过滤器和计算将在该数据子集上进行操作。**除了***顶部过滤器之外***，**还可以在上下文过滤器定义的上下文内计算***计算集***和***固定详细程度的***计算。*

在这种情况下，请导航至“ 前10名”工作表，然后使用“ 过滤器 ”功能区上的字段的下拉菜单将Department过滤器和新添加的动作（Category）过滤器添加到上下文中。一旦添加到上下文中，这些字段在过滤器架子上将为灰色。现在，您将在所选内容和的上下文中看到前10个项目：DepartmentCategory

![img](../images/Image%20[191].jpg)

请注意，将过滤器添加到上下文会使字段在“ 过滤器”功能区上以灰色编码。

*如果您在仪表板上编辑操作，则过滤器可能会自动更新，您可能必须将其重新添加到上下文中。*

继续并通过选择几个不同的类别和几个不同的项目来逐步执行这些操作。通过讲故事来观察最终仪表板如何满足您的目标：

![img](../images/Image%20[192].jpg)

用户从“ 部门”下拉列表中选择了“ 技术 ” ，从类别列表中选择了“ 电话和通讯 ”，然后选择了10631项目，这是该类别中利润最低的项目。这揭示了该物品的销售状态（按利润进行颜色编码）和该物品的时间序列。

管理层应该从库存中删除物料10631吗？并非不首先考虑该项目仅在一次情况下损失了利润，而且这种趋势是朝着更大的获利趋势发展的。当然，最初的损失是巨大的损失，但这也是很久以前的事了，以后每次出售该物品都会产生收益。您的发现结果可能会导致进一步分析，以确定哪些因素在该项目的损益中起作用，并由管理层做出更好的决策。

*当您查看**Chapter 07 Completed**工作簿时，您只会在仪表板的底部看到一个选项卡。**各个视图已隐藏。**隐藏仪表板或故事中使用的工作表的选项卡是保持工作簿整洁并引导听众避免查看在仪表板或故事中可能看到的工作表的好方法。**要隐藏图纸，请右键单击选项卡，然后选择“* *隐藏图纸”**。**要取消隐藏工作表，请使用工作表导航至仪表板或故事，右键单击左侧窗格中的工作**表**，然后取消选中“* *隐藏工作表”**。**此外，通过右键单击仪表板选项卡并选择适当的选项，可以隐藏或取消隐藏仪表板中使用的所有工作表。**工具提示中使用的工作表可能以相同的方式隐藏或取消隐藏。*

### 为不同的显示器和设备设计 <div id="page_174"></div>

设计仪表盘时，您经常会问自己的一些第一个问题是：*我的听众将如何看待该仪表盘？**他们将使用哪种设备？* 随着移动设备的广泛采用，这个问题变得非常重要，因为在大尺寸平板显示器上看起来不错的东西并不总是在平板电脑或手机上看起来不错。

左侧边栏的“ 仪表板”选项卡的顶部 显示一个按钮，用于预览各种设备上的仪表板，以及“ 大小”选项的下拉列表：

![img](../images/Image%20[193].jpg)

单击设备预览按钮，不仅可以查看仪表盘在各种设备类型（甚至特定型号）下的外观，还可以为每种设备类型添加布局，您可以自定义以下布局：

![img](../images/Image%20[194].jpg)

您不仅可以查看仪表盘在各种设备和型号上的显示方式，还可以根据设备的方向以及是否使用Tableau Mobile应用程序（如果适用于所选设备）查看其外观。

单击“ 添加布局”按钮（即前面的屏幕快照中的“ 添加平板电脑布局”按钮）将在左侧边栏的“ 仪表板”选项卡下添加一个布局：

![img](../images/Image%20[195].jpg)

每个布局都可以有自己的大小和适合选项，并且布局选项使您可以从Default切换到Custom。这使您能够为任何给定的布局重新排列仪表板。您甚至可以删除特定布局的视图和对象。例如，您可以将仪表板简化为手机的一个或两个视图，同时保留三个或四个用于桌面显示的位置。

该Chapter 07 Completed工作簿包含利润分析仪表板的示例，并具有几个布局选项。例如，以下是设置为在手机上显示的仪表板，其中该仪表板将根据电话的宽度放置并允许上下滚动：

![img](../images/Image%20[196].jpg)

如您所见，电话仪表板的排列意味着按州  划分的利润和按利润划分的趋势不会出现在电话设备的预览范围内。但是，它们只需轻扫即可。

### 动作如何运作 <div id="page_175"></div>

在Tableau中，**操作**是用户启动的事件，可触发来自Tableau的响应。您已经看到了一些仪表板中正在使用的操作示例。现在，我们将考虑操作在Tableau中如何工作的一些细节。

Tableau支持五种操作：

- **过滤器操作**：用户的操作导致将一个或多个过滤器应用于一个或多个视图。
- **高亮显示操作**：用户的操作使特定的标记和标题在一个或多个视图中高亮显示。
- **URL操作**：用户的操作导致打开特定的URL（在浏览器，新选项卡或嵌入式Web对象中）。
- **设置动作**：用户的动作定义了一个设置。集合可用于计算，过滤器和架子上，以定义标记的视觉属性。这为复杂和创造性的交互提供了很多可能性。
- **参数操作**：用户的操作更改参数的值。这使用户可以通过新颖有趣的方式直观地与参数进行交互！（截至撰写本文时，参数操作尚未发布，但已计划在不久的将来进行）。

Tableau将根据快捷方式自动生成某些操作。例如，您可以从仪表板上视图的下拉菜单中选择“ 用作过滤器”，这将导致自动生成过滤器动作。使用离散色图例上的按钮或从工具栏中启用突出显示，将自动生成突出显示动作：

![img](../images/Image%20[197].jpg)

您还可以通过选择“ 仪表板” |“ 创建”或“仪表板”操作。菜单中的操作。让我们考虑每种动作的细节。

#### 筛选动作 <div id="page_176"></div>

**过滤器动作**由源表定义，这些源表将一个或多个维值作为过滤器传递给**目标**表。请记住，图纸上的每个标记都是由唯一的尺寸值交集定义的。当涉及其中一个或多个标记的动作发生时，可以将构成标记的尺寸值作为过滤器传递到一个或多个目标表。

创建或编辑过滤器操作时，您将看到与以下类似的选项：

![img](../images/Image%20[198].jpg)

该屏幕允许您执行以下操作：

- 命名过滤器。
- 选择**源**表和**目标**表。所述**源**片是用户将启动动作（悬停，选择，菜单），并且**目标**片材，其中将要应用的响应（在该示例过滤，而且突出显示）。
- 设置触发过滤器的动作，以及选择多个标记还是仅单个标记都会启动该动作。
- 选择清除选择后会发生什么。
- 指定用于将过滤器值传递到目标表的尺寸。

*尝试使用名称来命名您的动作，以帮助您区分仪表板中的多个动作。**此外，如果您将操作设置为在**Menu**上运行**，那么您使用的名称将在工具提示中显示为链接。**使用名称右侧的箭头插入特殊字段占位符。**当用户在工具提示中看到菜单选项时，这些内容将使用标记的字段值动态更新。*

您可以根据需要选择任意数量的源表和目标表。但是，如果您在底部指定了特定的“ 目标”过滤器，则所选字段必须出现在“源”表中（例如，在Rows，Columns和  Detail上）。如果一个字段对于一个或多个“源”工作表不可用，并且不会为这些工作表触发操作，您将收到警告。大多数情况下，您的源和目标将是同一仪表板。（可选）您可以指定其他“目标”工作表或仪表板，除了进行过滤外，这还将导致操作导航到目标。

*在工作表级别定义筛选器操作时（查看工作表时，**从菜单中**选择“* *工作表* *|* *操作* *”），该操作的菜单项将显示为使用相同数据源的每个工作表上每个标记的菜单项。**您可以使用它来快速创建工作表之间以及从仪表板到各个工作表的导航。*

可以将过滤器操作设置为发生在三种可能的操作中的任何一种上：

- **悬停**：用户将鼠标光标移到标记上（或在移动设备上点击标记）。
- **选择**：用户单击或点击一个标记，然后矩形/径向/套索通过单击并拖动它们周围的矩形来选择多个标记，然后单击标题（在这种情况下，将选择该标题的所有标记）。用户可以通过单击/轻击已选择的标记，单击/轻击视图中的空白或通过单击/轻击已选择的标题来**取消**选择。
- **菜单**：用户在工具提示上选择操作的菜单选项。

请考虑以下示例，该示例在源中选择一个条时触发的过滤器操作：

![img](../images/Image%20[199].jpg)

源中的每个条形标记均由“ 类别”  维度定义。选择表格栏时，将在目标上设置一个过滤器。

如果标记是由多个维度定义的（例如Category和Region），则目标表仍将具有单个过滤器，其中包含已选择的维度值的组合。在此示例中，过滤器包含Office Machines和West，它们与定义所选正方形的尺寸匹配：

![img](../images/Image%20[200].jpg)

默认情况下，源视图中存在的所有尺寸都在过滤器操作中使用。（可选）您可以指定应使用哪些字段。您可以使用“ 编辑过滤器操作”对话框中的“ 选定字段”选项来完成以下任务：

- 根据较少的尺寸进行过滤。例如，如果仅选择该Region字段，则选择前面的正方形只会将West区域作为过滤器传递到目标。
- 使用其他数据源过滤目标视图。通过“ 选定的字段”选项，您可以将源字段映射到目标字段（即使目标字段名称不同，尽管值仍必须匹配）。例如，如果目标使用的数据源中East是名为Area的字段的可能值，则可以Region从源映射到目标中的Area。

#### 突出动作 <div id="page_177"></div>

这种类型的操作不会过滤目标表。而是，**突出显示动作**会导致至少部分由所选尺寸值定义的标记在目标表中突出显示。高亮操作的选项与过滤器操作非常相似，源表和目标表以及触发事件的事件均相同。

考虑具有三个视图和基于Region字段的突出显示操作的仪表板。当触发东部区域的动作时，由东部定义的所有标记都会突出显示。用于突出显示的尺寸必须出现在要应用突出显示的所有视图中。无论是地图和散点图有Region对细节的的标志牌：

![img](../images/Image%20[201].jpg)

**荧光笔***（也称为***数据荧光笔***）显示为用户控件（类似于过滤器和参数），这些控件会基于用户交互而导致突出显示。**它们可以应用于一个或多个视图，并将突出显示这些视图的标记。**他们不创建动作。* *要添加* *荧光笔**，请在视图中选择任何离散（蓝色）字段，然后使用下拉菜单* *显示荧光笔**。**或者，您可以使用菜单并选择* *分析* *|* *荧光笔**。**在仪表板上，您可以使用视图的下拉菜单并选择* *突出**显示来添加突出**显示**。*

#### URL动作 <div id="page_178"></div>

**URL操作**允许您基于操作动态生成URL，并在仪表板或新的浏览器窗口或选项卡的Web对象中打开它。URL操作可以由与过滤器和突出显示操作相同的事件触发。URL操作的名称将其区别开来，用作菜单时将显示为链接。

该URL包括您输入的任何硬编码值以及可通过URL文本框右侧的箭头访问的占位符。这些占位符包括字段和参数。当根据构成所选标记的字段的值和参数的当前值触发操作时，这些值将动态插入URL字符串中。

如果您在仪表板中包含一个Web对象，则URL操作将自动将其用作目标。否则，该操作将打开一个新的浏览器窗口（在桌面或阅读器中查看仪表板时）或一个新的选项卡（在Web浏览器中查看仪表板时）。

*在iframe中查看某些网页时，行为会有所不同。**浏览器对象不在Tableau Desktop或Tableau Reader中使用iframe，但在将仪表板发布到Tableau Server，Tableau Online或Tableau Public时使用。**您将需要根据受众如何查看仪表板来测试URL操作。*

您可以在创建或编辑URL操作时为URL操作指定目标：

![img](../images/Image%20[202].jpg)

选项包括“ 新建浏览器”选项卡，“ 网页对象”（如果仪表板上有多个对象，则可以选择哪个对象），如果“不存在任何网页对象”，则可以选择“  浏览器选项卡”。如果仪表板上有多个网页对象，则可能希望给它们指定有意义的名称，以使选择更加容易。为此，请切换到左侧窗格上的“  布局”选项卡，然后展开“ 项目”层次结构，直到找到要重命名的对象。右键单击对象，然后选择“ 重命名仪表板项目”：

![img](../images/Image%20[203].jpg)

#### 设定动作 <div id="page_179"></div>

**设置操作**可让您使用一个或多个维度的一个或多个值填充集合。这是非常强大的功能，因为集可以在任何架子上使用以对任何可视元素进行编码，可以在计算中加以利用，并且可以用作过滤器。它们可以以所有这些方式（以及以不同的方式）在不同的视图中使用。这为您提供了难以置信的灵活性，可以通过设定的动作来完成。我们将先花一些时间来更清楚地定义集合，然后再看一个集合动作的示例。

##### 套装 <div id="page_180"></div>

甲**组**中的Tableau定义的来自数据源的记录的集合。在行级，每一个记录或者是 **在**  或**出**的一套。集合有两种类型：

- **动态集合**（有时称为**已计算** 或者 **计算值集**）
- **固定套**

甲**动态集合**计算基于你定义条件计算单个维度。随着数据的变化，该条件的结果可能会改变，记录可以切换 **在**给**出**该组。例如，如果要使用数据窗格中“ 客户名称”上的下拉菜单，然后选择“ 创建” |“ 创建”。Set，那么您可以规定一个条件，该条件定义哪些记录属于该集合：

![img](../images/Image%20[204].jpg)

在这个例子中，我们创建了一个名为一组动态的ç ustomers谁购买超过$ 100与同时通过设置条件求和的销售额大于100。您会注意到，还有一些用于按公式或Top  N计算的选项。所有这些条件都将处于汇总级别（如果使用上下文过滤器，则跨整个数据集或跨上下文），然后评估每个记录是否在集合中。在这种情况下，每个客户的总销售额将整个数据集来计算，然后将每个记录将被计算**在**或**出** 根据该记录的客户的总销售额是否大于$ 100来确定。

甲**组固定**为一个或多个维度的值的列表。如果单个记录的值匹配的集定义的列表中，则记录是**在**设定和**进行**其他方式。例如，您可以基于“ 客户名称” 字段创建另一个集合，这次使用“ 常规”选项卡：

![img](../images/Image%20[205].jpg)

在这里，你可以选择将定义什么是个人价值观**在**或**出**的一套。请注意排除而不是包括值的选项。在这种情况下，我们创建了一个名为的集合Customers with the first name of Aaron。具有“ 客户名称”与我们选择的6个值之一匹配的所有记录都将在集合中。所有其他人都会**出去**。因为这是一个固定集，所以永远不会计算或重新计算这些值。如果下周在数据集中出现了一个名为**Aaron Burr**的客户的记录，则它们仍将**超出**范围。

在下面的示例中，我们将看到set动作对固定集合起作用。

##### 设定动作示例 <div id="page_181"></div>

您将Chapter 7 Complete.twbx 在名为的仪表板的工作簿中 找到一个set动作的示例，Sales by Region and Category (set actions)如下所示：

![img](../images/Image%20[206].jpg)

仪表板包含两个视图：地图和条形图。在地图上选择一个区域会触发一个设置操作，该操作会更新条形图。过滤操作将过滤条形图，导致每个条形的长度仅显示所选区域的值。但是，此处的设置动作用于显示整个条形图属于该区域的部分，同时仍保留所有区域的条形图全长。

若要复制此交互，请按照下列步骤操作：

1. 使用数据窗格上“ 维度 ” Region下的字段上的下拉菜单，选择“ 创建” |“ 创建”。设置。将集合命名为Region Set。
2. 在出现的“ 创建集”对话框的“ 常规”选项卡下，检查一个或多个值。这将创建一个固定的集合。在此示例中，选择哪个值（如果有的话）都没有关系，因为您将配置set操作以立即更新这些值。
3. 创建条形图Sales by Category。
4. 将“ 区域集”从“数据集”上的数据窗格中拖放到“ 颜色”上：

![img](../images/Image%20[207].jpg)

您可以像其他任何领域一样在架子上使用套装。请注意，集合如何给出两个值，即 **In**和**Out**，它们定义了两种颜色。您可能希望调整颜色以强调**In**。

*您也可以在计算字段中使用集合。**例如，代码**[Region Set]**为每个记录给出布尔值true / false，指示它是否***在***集合中。*

通过创建区域地图，仪表板并实施设置动作来结束设置动作示例。

1. 使用在下拉菜单区域，选择地理角色 | 从创建... | 状态。这告诉Tableau根据**地区**与**州State的**关系将**Region**视为地区。
2. 在新的空白视图中，双击“ 区域”字段以创建地图视图。现在，“ **区域”**已被识别为地理区域，Tableau将生成纬度，经度和渲染形状所需的几何形状。
3. 将地图视图和条形图视图都添加到单个仪表板中。您可以根据需要放置它们。
4. 通过选择“ 仪表板” |“ 添加动作” 从菜单中选择“ 操作 ”，然后单击“添加操作”。在出现的对话框中更改设置值...。出现的对话框具有与其他操作类型类似的许多功能：

![img](../images/Image%20[208].jpg)

您会注意到为动作指定名称的选项；在以下位置执行操作： 悬停，选择或菜单；以及清除选择的选项。就像其他动作类型一样，您也可以指定触发动作的“ 源表 ”。该目标设置  允许你指定的数据源和固定在设置数据源将基于动作的更新值。在这种情况下，我们要在“ 按地区销售（设置操作）”视图上进行选择时更新“  地区集”。清除选择后，我们将选择从集合中删除所有值。

一旦创建了前面的动作，仪表板的功能应与本节开头所示的示例非常相似。在地图上选择一个区域会突出显示与该区域相对应的条形部分。这种技术称为**刷涂**或**比例刷涂**。

此技术只是设置动作的数百种可能应用中的一种。由于可以在任何架子上和计算中使用集合，因此通过集合操作更新值将为用户交互和分析提供几乎无限的可能性。

### 仪表板示例–区域记分卡 <div id="page_182"></div>

现在，我们将考虑另一个示例仪表板，该示例演示了稍微不同的目标。假设组织中的每个人都同意“ **利润率”**的关键绩效指标。此外，大家一致认为可接受的利润率与不良利润率之间的分界点是15％，但是管理层希望可以动态调整该值，以查看其他目标是否可能更好。

考虑以下仪表板：

![img](../images/Image%20[209].jpg)

该仪表板使您的听众可以非常迅速地评估过去六个月中每个区域的效果。行政管理人员可以非常迅速地在其移动设备上启用此仪表板，并根据需要采取适当的措施。

仪表板提供了与KPI目标参数的交互性。如果需要，可以提供对其他仪表板或视图的附加钻取。如果此视图在Tableau Server上发布，则认为区域经理可以订阅该视图并收到包含此仪表板的最新图像的计划电子邮件是合理的。

让我们考虑如何创建类似的仪表板：

1. 创建一个名为Profit Ratio KPI Targetset 的float类型参数，并将其设置为initial .15，格式为百分比。
2. 创建以Profit Ratio代码命名的计算SUM([Profit]) / SUM([Sales])。这是一个汇总计算，将利润总额除以视图中定义的详细程度的销售总额。
3. KPI - Profit Ratio用下面的代码创建第二个计算：

IF [利润率]> = [利润率KPI目标]

然后“可接受”

其他“可怜”

结束

该代码将利润率与参数化的临界值进行比较。等于或高于截止点的任何值Acceptable都将获得的值，低于等于截止点的所有值都将获得的值Poor。

1. 创建一个名为的新工作表Region Scorecard。该视图由Region上排，订购日期作为一个离散的日期部分的列，并且KPI - Profit Ratio在两个形状和颜色字段。您会发现形状已被编辑为使用复选标记和Xs，并且调色板使用的是色盲安全的蓝色和橙色。
2. 使用“ 分析”窗格添加“ 列总计”，并使用自定义标签“ 总体”，加粗字体和浅灰色阴影格式化总计。
3. 添加“ 订购日期”  作为过滤器，并将其设置为“ 前6名”字段（“ 订购日期”为“ 最小”）。这将动态过滤最近六个月的视图：

![img](../images/Image%20[210].jpg)

1. 创建另一个名为“ 按地区的利润率”的工作表。
2. 如果跳过了“设置操作”示例，请使用下拉菜单Region选择“ 地理角色” |“ 地理角色”。从创建... | 状态。这会告诉Tableau Region根据其与State地理字段的关系将其视为地理字段。
3. 双击Region数据窗格中的字段。Tableau将自动基于生成地理可视化Region。我们将在[第11章“](docs/Book.md#page_) *高级可视化，技术，技巧和窍门”*中更详细地研究自定义地理位置的创建。
4. 广场Profit Ratio上的颜色和 标签。您还将需要格式化Profit Ratio为百分比。您可以通过在此视图中专门设置字段的格式，或通过在数据窗格中设置字段的默认数字格式来这样做（后者可能是首选，因为您几乎总是希望将其显示为百分比）。
5. 另外，添加Region到Label。重新排列标记卡中的字段以重新排列标签，或单击“ 标签”架子以直接编辑标签文本。
6. 与对“ 地区记分卡”视图一样，对该视图应用相同的过滤器。您可能希望导航到“ 地区记分卡”工作表，并使用“ 过滤器”功能区上“ 订购日期 ”下拉菜单将现有过滤器应用于多个工作表：

![img](../images/Image%20[211].jpg)

一旦创建了两个视图，就可以通过适当安排两个工作表，参数控件和文本来构造仪表板。Chapter 07 Complete 工作簿中的示例已应用了电话布局。尝试各种元素的布局和位置。

*默认情况下，平铺添加到仪表板的所有对象。***平铺***对象会卡入到位并出现在***浮动***对象**下面**。**通过**在左侧窗口中的“* *新建对象”**下切换切换**，或**将对象拖动到仪表板时**按住**Shift**，**可以将任何对象作为浮动对象添加到仪表**板。*

*按住**Shift键，**可以在浮动对象和平铺对象之间切换现有对象**同时移动对象或使用下拉插入符号菜单。**下拉式插入符号菜单还提供用于调整对象的浮动顺序的选项。**此外，可以通过选择浮动对象并使用左下方的定位和大小调整控件来调整浮动对象的大小并以像素精度定位。*

*您可以混合使用平铺和浮动元素，但是许多仪表板作者更喜欢构建完全由一个或另一个组成的仪表板。**这样可确保不同的布局和屏幕尺寸之间的一致性（尤其是在仪表板设置为“* *自动”* *或“* *范围* *大小”选项时）。*

### 故事 <div id="page_183"></div>

该**故事**功能允许您使用诉说仪表板和意见的互动快照故事。快照成为故事中的重点。这使您可以构建引导性的叙述甚至整个演示文稿。

让我们考虑一个故事点可能有用的示例。执行经理对您先前开发的“ **区域记分卡”**仪表板感到满意。现在，他们希望您向董事会做一个介绍，并重点介绍南方地区的一些具体问题。只需花费很少的精力，您就可以制作简单的计分卡，添加一些其他视图并讲述整个故事：

1. 首先，我们将建立几个其他视图。创建一个名为的简单地理视图ProfitRatio KPI by State。使该KPI – Profit Ratio字段与填充的地图定义颜色。
2. 添加Profit Ratio到“ 标记的详细信息 ” 卡，以便以后使用：

![img](../images/Image%20[212].jpg)

1. 再创建一个名为的视图Profit Ratio by Quarter。使用订购日期作为一个连续的日期值列和利润率上的行。
2. 将标记类型设置为条形。为Profit Ratio KPI Target参数值添加参考线（您可以右键单击“ **获利比率”**轴并将其设置为“ 添加参考线...”）。
3. 添加KPI – Profit Ratio到颜色。您可能还希望单击“ 颜色”架子并添加边框。
4. 继续并向南过滤视图，Region并使用下拉菜单将该过滤器也应用于Profit Ratio KPI by State视图：

![img](../images/Image%20[213].jpg)

1. 创建一个新的仪表板，其两个新视图的排列方式与以下屏幕快照所示的排列方式相同。添加Profit Ratio KPI Target参数和Region过滤器（如果未显示）。

1. 使用下拉菜单Profit Ratio KPI by State将该视图用作过滤器：

![img](../images/Image%20[214].jpg)

1. 通过选择故事 | 创建**新故事** 新的故事从菜单中，或者通过使用在旁边的现有表底部的新的故事标签：

*该**故事**的接口包括了所有可见的仪表板和视图的侧边栏。**在顶部，您会看到**Story Title**，可以对其进行编辑。**故事中的每个新点将显示为带有文本的导航框，也可以对其进行编辑。**单击该框将使您可以访问故事点，然后可以在其中添加单个仪表板或视图。*

![img](../images/Image%20[215].jpg)

您可以使用“ 新建空白点” 按钮（用于新的故事点），“ 复制” 按钮（将创建当前所选故事点的副本快照）或“ 另存为新点” 按钮（用于捕获新的故事点）来创建新的故事点。仪表板的当前状态作为新的故事点）。

单击故事点导航框将调出该故事点的视图或仪表板的快照。您可以通过进行选择，更改过滤器，更改参数值和添加注释等操作与仪表板进行交互。更改仪表板的任何方面都会为您提供一个选项，可以将现有故事点更新为仪表板的当前状态。或者，您可以使用导航框上方的“ **还原”**按钮返回到仪表板的原始状态。单击X将删除故事点。

每个故事点都包含一个完全独立的仪表盘快照。将记住特定故事点的过滤器选择，参数值，选择和注释，但不会影响其他故事点或仪表板中的任何其他表。

您可以通过拖放导航框来重新排列故事点。

我们将通过完成以下步骤来构建故事：

1. 以南部地区分析为标题。
2. 将**区域记分卡**仪表板添加为第一个故事点。在地图上选择南部地区。给故事点以下文字：南部地区在过去6个月中表现不佳：

![img](../images/Image%20[216].jpg)

1. 单击“ 新建空白点”按钮以创建新的故事点，并将“ 利润率分析”仪表板添加到该点。
2. 给这个故事点一个标题：只有一个州总体上达到了15％的目标。
3. 右键点击地图上的Virginia，然后选择Annotate | 马克。将状态和利润率保留为注释的一部分：

![img](../images/Image%20[217].jpg)

1. 单击“ 复制”按钮以复制当前故事点。给这个新的故事点一个标题，三个州的字幕 将达到10％的目标。将“ 利润率KPI目标”设置为10.00%并更新该点。
2. 再次单击“ 复制”按钮，并为新创建的点提供某些状态的标题，这些标题在 历史上表现良好。
3. 右键单击“ 弗吉尼亚”的注释，选择“ 删除”将其删除，然后为“ 路易斯安那”添加一个类似的注释。然后，单击路易斯安那州以选择该州。
4. 确保单击“ 更新”按钮以捕获仪表板的状态。

在“ 演示模式”中，不显示用于添加，复制，更新或删除故事点的按钮。您的最终故事应类似于以下内容：

![img](../images/Image%20[218].jpg)

花一些时间来浏览演示文稿。单击导航框将显示该故事点。您可以在每个故事点与仪表板进行完全交互。这样，您可以即时回答问题并挖掘细节，然后继续讲故事。

*了解仪表板技术（以及通常的数据可视化技术）的一种好方法是订阅**“今日的Viz”**（*<http://www.tableau.com/public/community/viz-of-the-day>*）。**每天都会有一个新的可视化，仪表板或故事。**当您看到要理解的设计技术或可视化效果时，可以下载工作簿并浏览使用的各种技术。*

### 总结 <div id="page_184"></div>

准备好分享发现和分析时，您可能会使用仪表板将故事与听众联系起来。您讲故事的方式取决于您的目标，听众和传送方式。使用视图，对象，参数，过滤器和图例的组合，您可以创建一个令人难以置信的框架来讲述数据故事。通过Tableau，您可以为不同设备专门设计布局，以确保您的听众获得最佳体验。通过介绍动作和互动性，您可以邀请您的听众参与故事。故事点将使您可以汇集仪表板和视图的许多快照，以制作和呈现整个叙述。

在下一章中，我们将注意力转移到更深入的分析上，这些分析涉及趋势，分布，预测和聚类。

## 第八章 深入挖掘：趋势、聚类、分布和预测 <div id="page_185"></div>

使用Tableau进行快速的视觉分析对于回答众多问题和做出关键决策非常有用。但这只是勉强划清可能分析的表面。例如，一个简单的散点图可以显示离群值，但是通常，您想要了解分布或识别相似观测值的群集。一个简单的时间序列可以帮助您查看度量随时间的上升和下降，但是很多时候，您希望查看趋势或对未来值进行预测。

通过Tableau，您可以通过统计分析快速增强数据可视化。趋势模型，聚类，分布和预测等内置功能使您可以快速为可视化分析增加价值。此外，Tableau与R和Python平台集成，这为操作和分析数据打开了无穷的选择。

本章将介绍内置的统计模型和分析，包括以下主题：

- 趋向
- 聚类
- 预测
- 发行版

我们将在一些使用一些示例数据集的示例中介绍这些概念。您可以使用Chapter 8工作簿关注并重现这些示例。

### 发展趋势 <div id="page_186"></div>

World Population.xlsx包含在Chapter 08目录中。它包含每个国家从1960年到2015年每年的一项记录，用于衡量人口。使用此数据集，让我们看一下各个国家的历史趋势。创建类似于以下屏幕快照中所示的视图，该视图显示阿富汗和澳大利亚的人口随时间的变化。您会注意到，“ 国家名称”已被过滤为仅包括阿富汗和澳大利亚，并且该字段已另外添加到“ 颜色”和“ 标签”货架中：

![img](../images/Image%20[219].jpg)

单凭此可视化，您可以进行一些有趣的观察。到1980年，两国人口的增长相当相似。那时，阿富汗人口开始减少，直到1988年**阿富汗**人口开始增加。在1996年左右的某个时候，**阿富汗**的人口超过了**澳大利亚**。从那时起，差距进一步扩大。

尽管我们对这两种趋势有所了解，但是当我们看到趋势线时，它们会变得更加明显。Tableau提供了几种添加趋势线的方法：

- 从菜单中，选择分析 |。趋势线 | 显示趋势线。
- 右键单击视图窗格中的空白区域，然后选择显示趋势线。
- 单击左侧边栏上的“ 分析”选项卡以切换到“ 分析”窗格。
- 将趋势线拖放到您选择的趋势模型上（在本示例中，我们将使用线性，并在本章稍后讨论其他内容）：

![img](../images/Image%20[220].jpg)

将**趋势线**添加到视图后，它应包含两条趋势线，每个国家/地区一条。我们将看一下如何自定义显示。现在，您的视图应如下所示：

![img](../images/Image%20[221].jpg)

查询数据源后，Tableau会计算趋势。趋势线是根据视图中的各种元素绘制的：

- **定义X和Y坐标的两个领域**：田野里的行和列定义*X*和*Ÿ*轴坐标描述，允许的Tableau计算各种趋势的模型。为了显示趋势线，必须在行和列上都使用连续的（绿色）字段。该规则的唯一例外是您可以使用“ 离散”（蓝色）date字段。如果使用离散（蓝色）date字段定义标题，则另一个字段必须是连续（绿色）字段。
- **创建多个不同****趋势线的****其他字段**：行，列或颜色架子上的离散（蓝色）字段可用作将单个趋势线拆分为多个不同趋势线的因素。
- **选择的趋势模型**：下一节将检查模型之间的差异。

在交换中观察到有两条趋势线。由于国家/地区名称是Color上的离散（蓝色）字段，因此默认情况下它为每种颜色定义了一条趋势线。

先前，我们观察到阿富汗的人口在各个历史时期内都有所 增加和减少。请注意，趋势线是沿整个日期范围计算的。如果我们希望在那些时间段看到不同的趋势线怎么办？

一种选择是简单地在视图中选择感兴趣的时间段内的标记。Tableau默认情况下将为当前选择计算一条趋势线。这里，例如，对于点**阿富汗**从1980年的，以1988年被选中，并显示一个新的趋势：

![img](../images/Image%20[222].jpg)

另一个选择是指示Tableau 使用行，列或颜色上的离散字段绘制不同的趋势线。

继续并Period使用以下代码创建一个名为的计算字段，该字段定义不同历史时期的离散值：

如果[年份] <= 1979

然后“ 1960年至1979年”

ELSEIF [年份] <= 1988

然后“ 1980至1988”

ELSE“ 1988年至2015年”

结束

将其放在列上时，您将获得每个时间段的标题，该标题会折行并导致每个时间段显示单独的趋势。您还将观察到Tableau在每个期间的轴上保留了完整的日期范围。右键单击日期轴之一，选择“ 编辑轴”，然后选中每一行或每一列的“独立轴范围 ”选项，可以设置一个独立范围：

![img](../images/Image%20[223].jpg)

在此视图中，透明度已应用于颜色以帮助趋势线突出。此外，对于轴年度（经取消选中隐藏的显示表头在球场上的选项）。现在，您可以清楚地看到不同时间段内趋势的差异。在每个时期，澳大利亚的趋势仅略有变化。阿富汗的趋势差异很大。

#### 自定义趋势线 <div id="page_187"></div>

让我们看另一个示例，该示例使我们可以考虑趋势线的各种选项。使用Real Estate数据源，创建与此视图类似的视图：

![img](../images/Image%20[224].jpg)

在这里，我们已经创建了总和的散点图面积（平米）的列来定义*X*轴和的总和Price就行定义*Ÿ*轴。地址已添加到“ 标记的详细信息 ” 卡中，以定义汇总级别。因此，散点图上的每个标记都是由大小和价格定义的位置上的不同地址。已放置在Color上。趋势线已显示。根据Tableau的默认设置，共有三种：每种颜色一条趋势线。置信带已被隐藏。Type of Sale

假设一个很好的模式，该趋势线表明有多少，以及如何快速 的价格预计将在相关走高的增加尺寸为每种类型的销售。

*在此数据集中，我们有两个字段**Address**和**ID**，每个**字段**定义一个唯一的记录。**将这些字段之一添加到“* *详细程度”可以**有效地分解数据，并允许我们为每个属性绘制标记。**有时，数据中可能没有定义唯一性的维度。**在这种情况下，你可以通过解聚取消选中数据**汇总办法**从**分析**菜单。*

*或者，您可以使用“* *行”**和“* *列”**上每个度量字段的下拉菜单**将它们从度量更改为尺寸，同时保持其连续性。**作为尺寸，每个单独的值将定义一个标记。**保持它们连续将保留**趋势线**所需的轴**。*

让我们考虑趋势线可用的一些选项。您可以使用菜单并选择分析 | 编辑趋势线。趋势线 | 编辑趋势线...或通过在趋势线右击，然后选择编辑趋势线......。完成后，您将看到一个类似于以下对话框：

![img](../images/Image%20[225].jpg)

在这里，您可以选择模型类型；选择适用领域作为模型中的因素；允许离散颜色定义不同的趋势线 ; 显示置信带；将*y*截距强制为零；显示选定标记的重新计算趋势；并显示趋势线的工具提示。我们将更详细地研究这些选项。

现在，尝试这些选项。请注意，删除Type of Sale字段作为因素或取消选中“ 允许每种颜色显示趋势线”选项如何导致一条趋势线。

您还可以Type of Sale在添加到Rows的以下视图中查看将字段排除为因子的结果：

![img](../images/Image%20[226].jpg)

如前一个屏幕截图的左侧部分所示，它Type of Sale是一个因素。这导致每种销售类型都有独特的趋势线。如果Type of Sale不考虑作为因素，则绘制相同的趋势线（所有类型的总体趋势）三次。该技术对于将数据子集与总体趋势进行比较非常有用。

#### 趋势模型 <div id="page_188"></div>

考虑到Tableau中可用的趋势模型，让我们回到原始视图并坚持一条趋势线。可以从趋势线选项窗口中选择以下模型。

##### 线性的 <div id="page_189"></div>

如果我们假设随着大小的增加，价格将以恒定的速率增加，那么我们将使用线性模型。不管大小增加多大，我们都希望价格会增加，以便新数据点接近直线：

![img](../images/Image%20[227].jpg)

##### 对数 <div id="page_190"></div>

如果我们期望有一个有效*的收益递减规律，*那么我们将采用对数模型 -也就是说，在买方停止支付更多费用之前，规模只能增加太多：

![img](../images/Image%20[228].jpg)

##### 指数的 <div id="page_191"></div>

我们将使用指数模型来测试以下想法：大小每增加一次，价格就会急剧增加（指数！）：

![img](../images/Image%20[229].jpg)

##### 功率 <div id="page_192"></div>

如果我们认为大小与价格之间的关系是非线性的，并且在对数趋势减小与爆炸性指数趋势之间处于某种程度，则可以采用幂趋势模型。曲线将表明价格是大小与特定功效的函数。功率趋势可以很好地预测某些事件，例如车辆加速或病毒传播所覆盖的距离：

![img](../images/Image%20[230].jpg)

##### 多项式 <div id="page_193"></div>

如果我们认为大小和价格之间的关系很复杂，并且遵循了更多的**S**形曲线，则可以使用该模型，在这种曲线中，最初增大大小会极大地提高价格，但有时价格会趋于平稳。您可以在2到8之间的任意位置设置多项式模型的次数。此处显示的趋势线是3 次多项式：

![img](../images/Image%20[231].jpg)

#### 分析趋势模型 <div id="page_194"></div>

观察趋势线可能很有用，但是通常我们想了解我们选择的趋势模型是否具有统计意义。幸运的是，Tableau使我们对趋势模型和计算有了一定的了解。

只需将鼠标悬停在一条趋势线上，即可显示该公式以及该趋势线的r平方和P值：

![img](../images/Image%20[232].jpg)

*甲***P值***是描述假设值之间的（随机的机会）没有关系的结果是至少尽可能接近由趋势模型预测结果的概率的统计概念。**甲***P值***的5％（0.05）将指示至少描述以及潮流模型值之间的关系的随机机会的5％的机会。**这就是为什么**通常认为5％或以下的***P值***指示明显的趋势模型。**甲***P值***小于5％往往导致更高的统计人员质疑由趋势模型中描述的相关性。*

此外，通过选择Analysis | ，您可以查看趋势模型的详细说明。趋势线 | 从菜单或在视图窗格上单击鼠标右键使用类似菜单来描述趋势模型...。查看趋势模型时，将看到“ 描述趋势模型”窗口：

![img](../images/Image%20[233].jpg)

*您还可以在工作表描述中获得趋势模型描述，该描述可从**工作表**菜单中或通过按**Ctrl* *+* *E获得**。**工作表描述包括有关当前视图的大量其他有用的摘要信息。*

窗口中显示的大量统计信息包括趋势模型的描述，公式，观察**值的**数量以及整个模型以及每个趋势线的**P值**。请注意，在前面显示的屏幕快照中，“ 类型”字段作为定义三个趋势线的一个因素被包括在内。有时，您可能会注意到，即使一个或多个趋势线可能不是：

*附加摘要统计信息可以通过显示一个给定的视图被显示在桌面的Tableau* *摘要**。**从菜单中，选择“* *工作表”**。**显示摘要**。**可以使用“* *摘要”**卡**上的下拉菜单扩展摘要中显示的信息**。*

![img](../images/000020.gif)

##### 导出统计模型详细信息 <div id="page_195"></div>

Tableau还使您能够导出数据，包括与趋势模型有关的数据。这使您可以更深入地甚至直观地分析趋势模型本身。让我们分析一下3 次多项式趋势线的房地产价格和规模散点图上没有任何因素。要导出与当前视图相关的数据，请使用菜单并选择工作表 | 出口 |  数据。数据将导出为Microsoft Access数据库（.mdb）文件，并提示您将文件保存在何处。

*将数据导出到Access的能力仅限于PC。**如果您使用的是Macintosh，则将无法选择该选项，并且可能希望浏览此部分，但请继续前进。*

在“ 将数据导出到访问”屏幕上，指定访问表名称，然后选择是要从整个视图还是当前选择中导出数据。您还可以指定Tableau应该连接到数据。这将生成数据源，并使其在当前工作簿中以指定名称可用：

![img](../images/Image%20[234].jpg)

新的数据源连接将包含原始视图中的所有字段以及与趋势模型相关的其他字段。这使我们能够使用残差和预测来构建如下所示的视图：

![img](../images/Image%20[235].jpg)

预测（*x*轴）和残差（*y*轴）的散点图使您可以直观地看到每个标记距趋势线预测的位置有多远。它还使您可以查看残差是否在零的两侧均匀分布。分布不均可能表明趋势模型存在问题。

您可以将此新视图与原始视图一起包含在仪表板中，以可视化方式探索趋势模型。使用工具栏上的突出显示按钮以“ 地址”字段突出显示：

![img](../images/000356.gif)

定义了突出显示操作后，在一个视图中选择标记将使您能够在另一视图中看到它们。您可以扩展此技术以导出多个趋势模型和仪表板以同时评估多个趋势模型：

![img](../images/Image%20[236].jpg)

##### 使用R和Python进行高级统计（以及更多！） <div id="page_196"></div>

利用Tableau与R或Python集成的功能，您可以实现更复杂的统计分析。**R** 是一个开源统计分析平台和一种编程语言，您可以使用它定义高级统计模型。**Python**是一种高级编程语言，由于其易用性，尤其是在数据清洗和处理以及统计功能方面，已经在数据分析人员中迅速赢得了广泛的关注。

*要使用R或Python，您首先需要安装* **R Server** *或***TabPy** *（Tableau可提供的Python API），然后将Tableau配置为使用R Server或TabPy。* *要了解有关**安装R Server或TabPy的**更多信息**，请查看以下资源：*  

- **R***：*[https](https://www.tableau.com/solutions/r)*：* [//www.tableau.com/solutions/r](https://www.tableau.com/solutions/r)
- **Python***：*[https](https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916)*：* [//www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916](https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916)

一旦安装了R Server或TabPy，就可以配置Tableau与平台进行通信。从菜单中，选择帮助 | 设置和性能 | 管理外部服务连接。这将为您提供与R Server或TabPy建立连接的选项：

![img](../images/Image%20[237].jpg)

此时，您可以创建调用R和Python函数的计算字段。特殊的表格计算（全部以开头SCRIPT_）允许您传递以下内容：

- 表达式和值到运行中的R Server，R Server将使用内置库或自定义编写的R脚本评估表达式并将结果返回到Tableau
- 完整的Python脚本到TabPy以执行并将结果返回到Tableau

例如，您可以创建一个名为Book Title的计算字段，以使用Python脚本将title字段的值从小写转换为大写：

SCRIPT_STR（“ import re

exceptions = ['a'，'an'，'of'，'the'，'is'，'for'，'in'，'into'，'to']

return_list = []

标题在_arg1：

WORD_LIST = re.split（””，标题）

capitalized_title = [WORD_LIST [0] .capitalize（）]

为在WORD_LIST字[1：]：

capitalized_title.append（字如果字在例外其他word.capitalize（） ）

return_list.append（''.join（capitalized_title））

return return_list

“，ATTR（[title]））

整个Python脚本都包装在该SCRIPT_STR()函数中，该函数还接受了字段标题的属性，然后返回将其转换为标题大小写的字符串值。

R和Python都可以用于统计分析以外的领域。您可以实现预测模型，数据清理，空间转换等！可能性是无止境。

### 聚类 <div id="page_197"></div>

Tableau 10引入了在可视化文件中快速执行聚类分析的功能。这使您可以根据选择的任意数量查找相似的单个数据点的组或**群集**。如以下示例所示，这在许多不同的行业和研究领域中可能很有用：

- 市场营销可能会发现基于支出金额，购买频率或订单时间和订单天数来确定彼此相关的客户群很有用。
- 根据诊断，用药，住院时间和再入院次数，了解彼此相关的患者群体可能会使医院的患者护理主管受益。
- 免疫学家可以根据耐药性或遗传标记物寻找相关的细菌菌株。
- 可再生能源顾问希望根据能源生产来确定风车群，然后将其与地理位置相关联。

*Tableau使用标准的k均值聚类算法，每次渲染视图时都会产生一致的结果。**Tableau将自动分配群集数（k），但是您可以选择调整值以及分配任意数量的变量。*

在考虑聚类时，我们将再次转向房地产数据，以查看是否可以在市场上找到相关房屋的分组，然后根据找到的聚类确定是否存在任何地理格局。

尽管您可以将集群添加到任何可视化中，但我们将从散点图开始，因为散点图已经使我们能够看到两个变量之间的关系。这将使我们对群集的工作方式有一些了解，然后我们可以添加其他变量来查看如何重新定义群集。

从地址按大小和价格的基本散点图开始，切换到“ 分析”窗格，然后将“ 群集”拖动到视图中：

![img](../images/Image%20[238].jpg)

将“ 群集”放到视图上时，Tableau将生成一个新的“ 群集”字段（在此处自动放置在“ 颜色”上），并显示一个“ 群集”窗口，其中包含用作变量的字段和一个用于更改“ 群集数”的选项。默认情况下，变量将包含视图中已经存在的度量：

![img](../images/Image%20[239].jpg)

该变量是所有这一切的聚类算法的用途来确定相关的数据点的因素。该集群的数量决定到多少组数据进行分区。在前面的视图中，您将观察到三组房屋：

- 价格低，体积小
- 那些在中间
- 价格高，尺寸大的

因为用于群集的两个变量与用于散点图的变量相同，所以相对容易看到群集的边界（您可以想象两条对角线对数据进行分区）。

您可以将几乎所有字段拖放到变量部分中（从数据窗格或视图中），以添加和删除变量。群集将在您这样做时自动更新。通过将卧室添加到“ 变量”列表进行实验，观察到**群集1**和**群集2**之间存在一些重叠，因为一些较大的房屋只有两个或三个卧室，而一些较小的房屋可能有四个或五个。现在，卧室的数量有助于定义群集。删除卧室，并注意群集将立即再次更新。

一旦有了有意义的集群，就可以通过从视图中将它们拖放到数据窗格中来在数据源中将它们具体化为组：

![img](../images/Image%20[240].jpg)

将在渲染时重新计算群集组。使用群集组可以完成很多工作，包括以下内容：

- 群集组可用于多个可视化，并可用于仪表板中的操作。
- 如果需要，可以编辑群集组，并在组之间移动单个成员。
- 可以对集群组名称进行别名，从而允许使用比**集群1**和**集群2**更多的描述性名称。
- 群集组可以在计算字段中使用，而群集则不能。

在下面的示例中，上一个视图中的“ 地址（集群）”组已对属性的地图进行了颜色编码，以帮助我们根据价格和规模查看集群是否存在任何地理相关性。虽然可以在此可视化中直接创建集群，但是该组具有一些提及的优点：

![img](../images/Image%20[241].jpg)

在此视图中，每个原始群集现在都是一个已别名的组，以提供对该群集的更好描述。您可以使用数据窗格中组字段的下拉菜单，也可以右键单击颜色图例中的项目以编辑别名。

*有很多选项可用于编辑地图的显示方式。**您可以调整地图上显示的图层，以帮助为正在绘制的数据提供其他上下文。**在顶部菜单中，选择**地图* *|* *地图图层**。**图层选项将显示在左侧栏中。**前面的地图已启用了街道，高速公路，县界和邮政编码边界，以使每个地址的位置都更加精确。**可供选择的图层将取决于地图的缩放级别。*

在查看以前的视图时，您确实确实发现了几乎完全是低价格和规模的社区（**集群1**），而几乎是几乎中档的社区（**集群2**）。考虑一下房地产投资者如何使用这种可视化来寻找中端社区中低价房屋的良好购买。

### 发行版 <div id="page_198"></div>

分析分布可能非常有用。我们已经看到，某些计算可用于确定统计信息，例如平均值，百分位数和标准偏差。通过Tableau，还可以轻松快速地可视化各种分布，包括置信区间，百分比，百分位数，分位数和标准偏差。

您可以使用“  分析”窗格添加任何这些视觉分析功能（或者，您可以右键单击轴并选择添加参考线）。就像参考线和带一样，分布分析可以应用于表，窗格或单元格的范围内。拖放所需的视觉分析时，将具有用于选择范围和轴的选项。在以下示例中，我们已将“ 分配范围” 从“ 分析”窗格拖放到由Sum（Price）定义的轴的窗格范围内：

![img](../images/000201.gif)

选择范围和轴后，将为您提供更改设置的选项。您还可以通过右键单击视图中的分析特征或右键单击轴或参考线本身来编辑线，带，分布和箱形图。

例如，除了颜色以外，让我们使用价格和大小以及列上的销售类型来获取地址的散点图：

![img](../images/Image%20[242].jpg)

接下来，我们将“ 分配范围”从“ 分析”窗格拖放到“ 窗格”中，仅适用于Price定义的轴。完成后，将出现一个对话框来设置选项：

![img](../images/Image%20[243].jpg)

在“ 计算”下的“ 值”下拉菜单中指定的每个特定“ 分发”选项都有唯一的设置。例如，“ 置信区间”允许您指定间隔的百分比值。通过“标准偏差”，您可以输入以逗号分隔的值列表，这些值描述了多少个标准偏差以及什么时间间隔。前述设置反映指定标准偏差的**-2**，**-1**，**1**，和**2**。在如上屏幕截图所示调整标签和格式后，您应该看到如下结果：

![img](../images/Image%20[244].jpg)

由于您对每个窗格应用了标准差，因此每种销售类型都有不同的范围。每个轴可以支持多个分布，参考线和波段。例如，您可以在上一个视图中添加一条平均线，以帮助查看者了解标准偏差的中心。

在散点图中，使用每个轴的分布可以产生一种非常有用的分析异常值的方法。通过显示“ 面积”和“ 价格”的单个标准差，您可以轻松地看到属于，不属于或不属于这两个规范的属性（您可以考虑购买大小偏高但价格在正常价格范围内的房屋！） ：

![img](../images/Image%20[245].jpg)

### 预测 <div id="page_199"></div>

如我们所见，趋势模型可以做出预测。给定一个好的模型，您希望其他数据能跟随趋势。当趋势随时间变化时，您可以了解将来的价值可能会下降。但是，预测未来价值通常需要不同类型的模型。诸如季节性之类的因素可能会产生仅凭趋势无法预测的变化。从8.0版开始，Tableau包含内置的预测模型，可用于预测和可视化未来价值。

若要使用预测，您将需要一个视图，其中包含一个日期字段或足够的日期部分以供Tableau重构日期（例如，“ 年”和“ 月”字段）。Tableau 10还允许基于整数而不是日期进行预测。您可以从“ 分析”窗格中拖放“ 预测 ” ，选择“ 分析” |“  分析” 。预测  | 从菜单显示“预测 ”，或右键单击视图的窗格，然后从上下文菜单中选择选项。

例如，以下是阿富汗和澳大利亚随时间推移的人口增长视图，并显示了预测：

![img](../images/Image%20[246].jpg)

请注意，在显示预测时，Tableau将“预测”图标添加到“ 行”上的SUM(Population)字段以指示该度量正在被预测。此外，Tableau 在“ 颜色”中添加了一个新的特殊“ 预测指标”字段，以便将预测值与视图中的实际值区分开。

*您可以移动“* *预测指标”**字段，甚至将其复制（* *拖放时**按住* *Ctrl**键）到其他架子，以进一步自定义视图。*

当您通过选择分析 | 来编辑预测时 预测 | 从菜单中选择“预测选项... ”或使用视图上的右键单击上下文菜单，将为您提供用于自定义趋势模型的各种选项，如下所示：

![img](../images/Image%20[247].jpg)

在这里，您可以选择设置预测长度，确定汇总，自定义模型以及设置是否要显示预测间隔的选项。默认情况下，预测长度设置为“ 自动”，但是您可以通过自定义值扩展预测。

源数据下的选项允许您有选择地为模型指定不同的数据粒度。例如，您的视图可能按年份显示度量，但您可以允许Tableau查询源数据以按月检索值，并使用更细的粒度来潜在地获得更好的预测结果。

*Tableau能够分别查询数据源以获取更细粒度的数据以获得更精确的结果的功能与关系数据源配合得很好。**但是，OLAP数据源与这种方法不兼容，这就是使用多维数据集时无法进行预测的原因之一。*

默认情况下，最后一个值从模型中排除。当您使用最近时间段不完整的数据时，这很有用。例如，每天添加记录时，直到最后一个记录添加到该月的最后一天之前，最后一个（当前）月才完成。在最后一天之前，如果不忽略模型，则不完整的时间段可能会使模型产生偏差。

可以将模型本身设置为有或没有季节性的“ 自动”，也可以自定义以设置季节性和趋势的选项。要了解选项，请从Superstore样本数据考虑以下按月的销售视图：

![img](../images/Image%20[248].jpg)

数据显示出明显的周期性或季节性模式。对于零售而言，这是非常典型的。许多其他数据集将表现出相似的模式。以下是选择各种自定义选项的结果：

![img](../images/Image%20[249].jpg)

与趋势类似，可以使用菜单访问预测模型和摘要信息。选择分析 | 预测 | Describe Forecast将显示一个带有选项卡的窗口，其中包含有关模型的摘要和详细信息：

![img](../images/Image%20[250].jpg)

单击窗口底部的链接将为您提供有关Tableau中使用的预测模型的更多信息。

*仅在特定条件下启用预测模型。**如果禁用该选项，请确保您已连接到关系数据库而不是OLAP，并且没有使用表计算，并且至少有五个数据点。*

### 总结 <div id="page_200"></div>

Tableau提供了广泛的功能集，可为您的分析增加价值。趋势线使您可以更精确地识别异常值，确定哪些值属于某些模型的预测范围，甚至可以预测预期的测量范围。通过Tableau，您可以深入了解趋势模型，甚至可以导出包含趋势模型预测和残差的数据。群集使您可以根据各种因素查找相关数据点的组。分布对于理解值在数据集中的分布非常有用。预测允许使用复杂的趋势和季节性模型来预测未来的结果。对这些工具有充分的了解将使您能够澄清和验证您的初始视觉分析。

接下来，我们将注意力转向数据。我们很早就考虑了如何连接数据，从那时起我们一直在处理数据。但是，我们花费了大部分时间来处理干净，结构良好的数据。在下一章中，我们将考虑如何处理凌乱的数据。

